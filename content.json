{"meta":{"title":"SunJun","subtitle":null,"description":"ç®€å•å°±å¥½","author":"SunJun","url":""},"pages":[{"title":"bangumi","date":"2019-02-10T13:32:48.000Z","updated":"2019-11-16T09:29:49.000Z","comments":false,"path":"bangumi/index.html","permalink":"/bangumi/index.html","excerpt":"","text":"","keywords":null},{"title":"client","date":"2018-12-20T15:13:35.000Z","updated":"2019-11-16T09:29:49.000Z","comments":false,"path":"client/index.html","permalink":"/client/index.html","excerpt":"","text":"ç›´æ¥ä¸‹è½½ or æ‰«ç ä¸‹è½½ï¼š","keywords":"Androidå®¢æˆ·ç«¯"},{"title":"about","date":"2018-12-12T14:14:36.000Z","updated":"2020-01-03T07:10:24.711Z","comments":false,"path":"about/index.html","permalink":"/about/index.html","excerpt":"","text":"[ã•ãã‚‰è˜ã®SunJun] ä¸&nbsp; Mashiro&nbsp; ï¼ˆ çœŸï¼ˆã¾ï¼‰ç™½ï¼ˆã—ã‚ï¼‰ ï¼‰ å¯¹è¯ä¸­... bot_ui_ini()","keywords":"å…³äº"},{"title":"comment","date":"2018-12-20T15:13:48.000Z","updated":"2019-11-16T09:29:49.000Z","comments":true,"path":"comment/index.html","permalink":"/comment/index.html","excerpt":"","text":"å¿µä¸¤å¥è¯— å™åˆ«æ¢¦ã€æ‰¬å·ä¸€è§‰ã€‚ ã€å®‹ä»£ã€‘å´æ–‡è‹±ã€Šå¤œæ¸¸å®«Â·äººå»è¥¿æ¥¼é›æ³ã€‹","keywords":"ç•™è¨€æ¿"},{"title":"lab","date":"2019-01-05T13:47:59.000Z","updated":"2019-11-16T09:29:49.000Z","comments":false,"path":"lab/index.html","permalink":"/lab/index.html","excerpt":"","text":"sakuraä¸»é¢˜balabala","keywords":"Labå®éªŒå®¤"},{"title":"donate","date":"2018-12-20T15:13:05.000Z","updated":"2019-11-16T09:29:49.000Z","comments":false,"path":"donate/index.html","permalink":"/donate/index.html","excerpt":"","text":"","keywords":"è°¢è°¢é¥²ä¸»äº†å–µ~"},{"title":"links","date":"2018-12-19T15:11:06.000Z","updated":"2020-01-03T07:45:22.173Z","comments":true,"path":"links/index.html","permalink":"/links/index.html","excerpt":"","text":"","keywords":"å‹äººå¸"},{"title":"music","date":"2018-12-20T15:14:28.000Z","updated":"2020-01-03T07:36:10.187Z","comments":false,"path":"music/index.html","permalink":"/music/index.html","excerpt":"","text":"","keywords":"å–œæ¬¢çš„éŸ³ä¹"},{"title":"rss","date":"2018-12-20T15:09:03.000Z","updated":"2019-11-16T09:29:49.000Z","comments":true,"path":"rss/index.html","permalink":"/rss/index.html","excerpt":"","text":""},{"title":"video","date":"2018-12-20T15:14:38.000Z","updated":"2019-11-16T09:29:49.000Z","comments":false,"path":"video/index.html","permalink":"/video/index.html","excerpt":"","text":"var videos = [ { img: 'https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg', title: 'æœèŠ±å¤•èª“â€”â€”äºç¦»åˆ«ä¹‹æœæŸèµ·çº¦å®šä¹‹èŠ±', status: 'å·²è¿½å®Œ', progress: 100, jp: 'ã•ã‚ˆãªã‚‰ã®æœã«ç´„æŸã®èŠ±ã‚’ã‹ã–ã‚ã†', time: 'æ”¾é€æ—¶é—´: 2018-02-24 SUN.', desc: ' ä½åœ¨è¿œç¦»å°˜åš£çš„åœŸåœ°ï¼Œä¸€è¾¹å°†æ¯å¤©çš„äº‹æƒ…ç¼–ç»‡æˆåä¸ºå¸Œæ¯”æ¬§çš„å¸ƒï¼Œä¸€è¾¹é™é™ç”Ÿæ´»çš„ä¼Šæ¬§å¤«äººæ°‘ã€‚åœ¨15å²å·¦å³å¤–è¡¨å°±åœæ­¢æˆé•¿ï¼Œæ‹¥æœ‰æ•°ç™¾å¹´å¯¿å‘½çš„ä»–ä»¬ï¼Œè¢«ç§°ä¸ºâ€œç¦»åˆ«çš„ä¸€æ—â€ï¼Œå¹¶è¢«è§†ä¸ºæ´»ç€çš„ä¼ è¯´ã€‚æ²¡æœ‰åŒäº²çš„ä¼Šæ¬§å¤«å°‘å¥³ç›å¥‡äºšï¼Œè¿‡ç€è¢«ä¼™ä¼´åŒ…å›´çš„å¹³ç¨³æ—¥å­ï¼Œå´æ€»æ„Ÿè§‰â€œå­¤èº«ä¸€äººâ€ã€‚ä»–ä»¬çš„è¿™ç§æ—¥å¸¸ï¼Œä¸€ç¬é—´å°±å´©æºƒæ¶ˆå¤±ã€‚è¿½æ±‚ä¼Šæ¬§å¤«çš„é•¿å¯¿ä¹‹è¡€ï¼Œæ¢…è¨è’‚å†›ä¹˜åç€åä¸ºé›·çº³ç‰¹çš„å¤ä»£å…½å‘åŠ¨äº†è¿›æ”»ã€‚åœ¨ç»æœ›ä¸æ··ä¹±ä¹‹ä¸­ï¼Œä¼Šæ¬§å¤«çš„ç¬¬ä¸€ç¾å¥³è•¾è‰äºšè¢«æ¢…è¨è’‚å¸¦èµ°ï¼Œè€Œç›å¥‡äºšæš—æ‹çš„å°‘å¹´å…‹é‡Œå§†ä¹Ÿå¤±è¸ªäº†ã€‚ç›å¥‡äºšè™½ç„¶æ€»ç®—é€ƒè„±äº†ï¼Œå´å¤±å»äº†ä¼™ä¼´å’Œå½’å»ä¹‹åœ°â€¦â€¦ã€‚' }, { img : 'https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg', title: 'æœèŠ±å¤•èª“â€”â€”äºç¦»åˆ«ä¹‹æœæŸèµ·çº¦å®šä¹‹èŠ±', status: 'å·²è¿½å®Œ', progress: 100, jp: 'ã•ã‚ˆãªã‚‰ã®æœã«ç´„æŸã®èŠ±ã‚’ã‹ã–ã‚ã†', time: '2018-02-24 SUN.', desc: ' ä½åœ¨è¿œç¦»å°˜åš£çš„åœŸåœ°ï¼Œä¸€è¾¹å°†æ¯å¤©çš„äº‹æƒ…ç¼–ç»‡æˆåä¸ºå¸Œæ¯”æ¬§çš„å¸ƒï¼Œä¸€è¾¹é™é™ç”Ÿæ´»çš„ä¼Šæ¬§å¤«äººæ°‘ã€‚åœ¨15å²å·¦å³å¤–è¡¨å°±åœæ­¢æˆé•¿ï¼Œæ‹¥æœ‰æ•°ç™¾å¹´å¯¿å‘½çš„ä»–ä»¬ï¼Œè¢«ç§°ä¸ºâ€œç¦»åˆ«çš„ä¸€æ—â€ï¼Œå¹¶è¢«è§†ä¸ºæ´»ç€çš„ä¼ è¯´ã€‚æ²¡æœ‰åŒäº²çš„ä¼Šæ¬§å¤«å°‘å¥³ç›å¥‡äºšï¼Œè¿‡ç€è¢«ä¼™ä¼´åŒ…å›´çš„å¹³ç¨³æ—¥å­ï¼Œå´æ€»æ„Ÿè§‰â€œå­¤èº«ä¸€äººâ€ã€‚ä»–ä»¬çš„è¿™ç§æ—¥å¸¸ï¼Œä¸€ç¬é—´å°±å´©æºƒæ¶ˆå¤±ã€‚è¿½æ±‚ä¼Šæ¬§å¤«çš„é•¿å¯¿ä¹‹è¡€ï¼Œæ¢…è¨è’‚å†›ä¹˜åç€åä¸ºé›·çº³ç‰¹çš„å¤ä»£å…½å‘åŠ¨äº†è¿›æ”»ã€‚åœ¨ç»æœ›ä¸æ··ä¹±ä¹‹ä¸­ï¼Œä¼Šæ¬§å¤«çš„ç¬¬ä¸€ç¾å¥³è•¾è‰äºšè¢«æ¢…è¨è’‚å¸¦èµ°ï¼Œè€Œç›å¥‡äºšæš—æ‹çš„å°‘å¹´å…‹é‡Œå§†ä¹Ÿå¤±è¸ªäº†ã€‚ç›å¥‡äºšè™½ç„¶æ€»ç®—é€ƒè„±äº†ï¼Œå´å¤±å»äº†ä¼™ä¼´å’Œå½’å»ä¹‹åœ°â€¦â€¦ã€‚' } ] .should-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:95%;}.should-ellipsis-full{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;}.should-ellipsis i{position:absolute;right:24px;}.grey-text{color:#9e9e9e !important}.grey-text.text-darken-4{color:#212121 !important}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}img{border-style:none}progress{display:inline-block;vertical-align:baseline}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}*,*:before,*:after{-webkit-box-sizing:inherit;box-sizing:inherit}ul:not(.browser-default){padding-left:0;list-style-type:none}ul:not(.browser-default)>li{list-style-type:none}.card{-webkit-box-shadow:0 2px 2px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12),0 1px 5px 0 rgba(0,0,0,0.2);box-shadow:0 2px 2px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12),0 1px 5px 0 rgba(0,0,0,0.2)}.hoverable{-webkit-transition:-webkit-box-shadow .25s;transition:-webkit-box-shadow .25s;transition:box-shadow .25s;transition:box-shadow .25s,-webkit-box-shadow .25s}.hoverable:hover{-webkit-box-shadow:0 8px 17px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);box-shadow:0 8px 17px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}i{line-height:inherit}i.right{float:right;margin-left:15px}.bangumi .right{float:right !important}.material-icons{text-rendering:optimizeLegibility;-webkit-font-feature-settings:'liga';-moz-font-feature-settings:'liga';font-feature-settings:'liga'}.row{margin-left:auto;margin-right:auto;margin-bottom:20px}.row:after{content:\"\";display:table;clear:both}.row .col{float:left;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0 .75rem;min-height:1px}.row .col.s12{width:100%;margin-left:auto;left:auto;right:auto}@media only screen and (min-width:601px){.row .col.m6{width:50%;margin-left:auto;left:auto;right:auto}}html{line-height:1.5;font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu,Cantarell,\"Helvetica Neue\",sans-serif;font-weight:normal;color:rgba(0,0,0,0.87)}@media only screen and (min-width:0){html{font-size:14px}}@media only screen and (min-width:992px){html{font-size:14.5px}}@media only screen and (min-width:1200px){html{font-size:15px}}.card{position:relative;margin:.5rem 0 1rem 0;background-color:#fff;-webkit-transition:-webkit-box-shadow .25s;transition:-webkit-box-shadow .25s;transition:box-shadow .25s;transition:box-shadow .25s,-webkit-box-shadow .25s;border-radius:2px}.card .card-title{font-size:24px;font-weight:300}.card .card-title.activator{cursor:pointer}.card .card-image{position:relative}.card .card-image img{display:block;border-radius:2px 2px 0 0;position:relative;left:0;right:0;top:0;bottom:0;width:100%}.card .card-content{padding:24px;border-radius:0 0 2px 2px}.card .card-content p{margin:0}.card .card-content .card-title{display:block;line-height:32px;margin-bottom:8px}.card .card-content .card-title i{line-height:32px}.card .card-reveal{padding:24px;position:absolute;background-color:#fff;width:100%;overflow-y:auto;left:0;top:100%;height:100%;z-index:3;display:none}.card .card-reveal .card-title{cursor:pointer;display:block}.waves-effect{position:relative;cursor:pointer;display:inline-block;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;vertical-align:middle;z-index:1;-webkit-transition:.3s ease-out;transition:.3s ease-out}.waves-effect img{position:relative;z-index:-1}.waves-block{display:block}::-webkit-input-placeholder{color:#d1d1d1}::-moz-placeholder{color:#d1d1d1}:-ms-input-placeholder{color:#d1d1d1}::-ms-input-placeholder{color:#d1d1d1}[type=\"radio\"]:not(:checked){position:absolute;opacity:0;pointer-events:none}[type=\"radio\"]:not(:checked)+span{position:relative;padding-left:35px;cursor:pointer;display:inline-block;height:25px;line-height:25px;font-size:1rem;-webkit-transition:.28s ease;transition:.28s ease;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[type=\"radio\"]:not(:checked)+span:before,[type=\"radio\"]:not(:checked)+span:after{border-radius:50%}[type=\"radio\"]:not(:checked)+span:before,[type=\"radio\"]:not(:checked)+span:after{border:2px solid #5a5a5a}[type=\"radio\"]:not(:checked)+span:after{-webkit-transform:scale(0);transform:scale(0)}[type=\"checkbox\"]:not(:checked){position:absolute;opacity:0;pointer-events:none}[type=\"checkbox\"]:not(:checked):disabled+span:not(.lever):before{border:none;background-color:rgba(0,0,0,0.42)}[type=\"checkbox\"].filled-in:not(:checked)+span:not(.lever):before{width:0;height:0;border:3px solid transparent;left:6px;top:10px;-webkit-transform:rotateZ(37deg);transform:rotateZ(37deg);-webkit-transform-origin:100% 100%;transform-origin:100% 100%}[type=\"checkbox\"].filled-in:not(:checked)+span:not(.lever):after{height:20px;width:20px;background-color:transparent;border:2px solid #5a5a5a;top:0px;z-index:0}input[type=checkbox]:not(:disabled) ~ .lever:active:before,input[type=checkbox]:not(:disabled).tabbed:focus ~ .lever::before{-webkit-transform:scale(2.4);transform:scale(2.4);background-color:rgba(0,0,0,0.08)}input[type=range].focused:focus:not(.active)::-webkit-slider-thumb{-webkit-box-shadow:0 0 0 10px rgba(38,166,154,0.26);box-shadow:0 0 0 10px rgba(38,166,154,0.26)}input[type=range].focused:focus:not(.active)::-moz-range-thumb{box-shadow:0 0 0 10px rgba(38,166,154,0.26)}input[type=range].focused:focus:not(.active)::-ms-thumb{box-shadow:0 0 0 10px rgba(38,166,154,0.26)} ç•ªç»„è®¡åˆ’ è¿™é‡Œå°†æ˜¯æ°¸è¿œçš„å›å¿† window.onload = function(){ videos.forEach(function(video, i){ $('#rootRow').append(` ${video.title} ${video.jp} ${video.status} ${video.title} ${video.jp} æ”¾é€æ—¶é—´: ${video.time} ${video.desc} ${video.status} `) }) }","keywords":"Bç«™"},{"title":"tags","date":"2018-12-12T14:14:16.000Z","updated":"2019-11-16T09:29:49.000Z","comments":true,"path":"tags/index.html","permalink":"/tags/index.html","excerpt":"","text":""},{"title":"theme-sakura","date":"2019-01-04T14:53:25.000Z","updated":"2019-11-16T09:29:49.000Z","comments":false,"path":"theme-sakura/index.html","permalink":"/theme-sakura/index.html","excerpt":"","text":"Hexoä¸»é¢˜Sakuraä¿®æ”¹è‡ªWordPressä¸»é¢˜Sakuraï¼Œæ„Ÿè°¢åŸä½œè€…Mashiro","keywords":"Hexo ä¸»é¢˜ Sakura ğŸŒ¸"}],"posts":[{"title":"å¸¸è§webæœåŠ¡æ”»å‡»å’Œé˜²å¾¡æ‰‹æ®µ","slug":"2019-11-04-common_means_web_attack","date":"2019-11-04T08:50:00.000Z","updated":"2020-01-03T09:35:02.420Z","comments":true,"path":"2019/11/04/2019-11-04-common_means_web_attack/","link":"","permalink":"/2019/11/04/2019-11-04-common_means_web_attack/","excerpt":"","text":"å¸¸è§webæœåŠ¡æ”»å‡»å’Œé˜²å¾¡æ‰‹æ®µXSSè·¨ç«™è„šæœ¬æ”»å‡»XSS (Cross-Site Scripting)ï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼Œå› ä¸ºç¼©å†™å’Œ CSSé‡å ï¼Œæ‰€ä»¥åªèƒ½å« XSSã€‚XSS çš„åŸç†æ˜¯æ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„å¯æ‰§è¡Œç½‘é¡µè„šæœ¬ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­ Web é‡Œé¢çš„è„šæœ¬ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œå¯ä»¥è¾¾åˆ°æ”»å‡»è€…ç›—ç”¨æˆ·ä¿¡æ¯æˆ–å…¶ä»–ä¾µçŠ¯ç”¨æˆ·å®‰å…¨éšç§çš„ç›®çš„ã€‚ åå°„å‹XSSï¼šä¸€èˆ¬æ˜¯é€šè¿‡ç»™åˆ«äººå‘é€å¸¦æœ‰æ¶æ„è„šæœ¬ä»£ç å‚æ•°çš„ URLï¼Œå½“URLè¢«æ‰“å¼€æ—¶ç‰¹æœ‰çš„æ¶æ„ä»£ç å‚æ•°è¢«HTMLè§£ææ‰§è¡Œã€‚ é˜²å¾¡æ‰‹æ®µï¼š å‰ç«¯æ¸²æŸ“æ•°æ®éƒ½è¦ä»åç«¯æ¥ å°½é‡ä¸è¦ä»URLã€document.referrerã€document.formsç­‰è¿™äº›apiè·å–æ•°æ®å¹¶ç›´æ¥æ¸²æŸ“ å°½é‡ä¸è¦ä½¿ç”¨ eval, new Function()ï¼Œdocument.write()ï¼Œdocument.writeln()ç­‰è¿™äº›å¯ä»¥ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²çš„æ–¹æ³• å¦‚æœå¿…é¡»è¦ç”¨çš„è¯ä¹Ÿéœ€è¦å¯¹ä¼ å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œè½¬ä¹‰ å‰ç«¯æ¸²æŸ“çš„æ—¶å€™ä¹Ÿéœ€è¦å¯¹å­—ç¬¦ä¸²åšè½¬ä¹‰ç¼–ç  æŒä¹…æ€§XSSï¼šä¸€èˆ¬æ˜¯é€šè¿‡ç•™è¨€ã€è¯„è®ºç­‰è¿™äº›å¯ä»¥å’Œåç«¯äº¤äº’çš„åŠŸèƒ½å°†å¸¦æœ‰è„šæœ¬çš„å†…å®¹å­˜åˆ°åç«¯æ•°æ®åº“çš„ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢è¯„è®ºçš„æ—¶å€™å°±å¯èƒ½è¢«æŸ¥è¯¢å‡ºæ¥æ¸²æŸ“å¹¶æ‰§è¡Œ é˜²å¾¡æ‰‹æ®µï¼š CSPï¼šæœ¬è´¨ä¸Šä¹Ÿå°±æ˜¯è®¾ç½®ç™½åå•çš„æ–¹å¼ï¼š è®¾ç½® HTTP Header ä¸­çš„ Content-Security-Policy åªå…è®¸åŠ è½½æœ¬ç«™èµ„æº: Content-Security-Policy: default-src â€˜selfâ€™ åªå…è®¸åŠ è½½ HTTPS åè®®å›¾ç‰‡: Content-Security-Policy: img-src https://* å…è®¸åŠ è½½ä»»ä½•æ¥æºæ¡†æ¶: Content-Security-Policy: child-src â€˜noneâ€™ è®¾ç½® meta æ ‡ç­¾çš„æ–¹å¼ è½¬ä¹‰å­—ç¬¦ï¼šè½¬ä¹‰ç”¨æˆ·è¾“å…¥çš„å¼•å·ã€å°–æ‹¬å·ã€æ–œæ† HttpOnly Cookieï¼šè®¾ç½®cookieæ—¶å°†å±æ€§è®¾ç½®æˆHttpOnlyå°±å¯ä»¥é¿å…cookieè¢«æ¶æ„jsè·å– CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ å®ƒåˆ©ç”¨ç”¨æˆ·å·²ç™»å½•çš„èº«ä»½ï¼Œåœ¨ç”¨æˆ·æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œä»¥ç”¨æˆ·çš„åä¹‰å®Œæˆéæ³•æ“ä½œã€‚ç”¨æˆ·å·²ç™»å½•Aç½‘ç«™ï¼Œæ­¤æ—¶è®¿é—®Bç½‘ç«™æ—¶Bç½‘ç«™é€šè¿‡è·å–Aç½‘ç«™çš„cookieå‘é€è¯·æ±‚ç»™Aç½‘ç«™å®Œæˆéæ³•æ“ä½œã€‚ é˜²å¾¡æ‰‹æ®µï¼š - è®¾ç½®cookie SameSiteå±æ€§ï¼Œcookieä¸éšè·¨åŸŸè¯·æ±‚å‘é€ - Referer Checkï¼Œä½†æ˜¯httpsè·³è½¬åˆ°httpç”±äºå®‰å…¨è€ƒè™‘æµè§ˆå™¨ä¸ä¼šæºå¸¦refererï¼Œæ‰€ä»¥æ— æ³•å®Œå…¨ä¾èµ–refereræ£€æŸ¥æ¥é˜²æ­¢CSRFæ”»å‡» - æ¯æ¬¡è¯·æ±‚éƒ½äº§ç”Ÿä¸€ä¸ªéšæœºçš„Tokenï¼ŒæœåŠ¡ç«¯éªŒè¯Token - å…³é”®æ“ä½œå¿…é¡»è¾“å…¥éªŒè¯ç  ç‚¹å‡»åŠ«æŒåŸç†ï¼šæ”»å‡»è€…å°†éœ€è¦æ”»å‡»çš„ç½‘ç«™é€šè¿‡ iframe åµŒå¥—çš„æ–¹å¼åµŒå…¥è‡ªå·±çš„ç½‘é¡µä¸­ï¼Œå¹¶å°† iframe è®¾ç½®ä¸ºé€æ˜ï¼Œåœ¨é¡µé¢ä¸­é€å‡ºä¸€ä¸ªæŒ‰é’®è¯±å¯¼ç”¨æˆ·ç‚¹å‡»ã€‚å¦‚ä½•é˜²å¾¡ï¼š - é€šè¿‡HTTPå¤´`X-FRAME-OPTIONS`é™åˆ¶iframeåµŒå¥—ï¼Œ - jsé˜²å¾¡ï¼Œjsä¸­åˆ¤æ–­é¡µé¢å¤„äºiframeä¸­æ—¶ä¸æ˜¾ç¤ºç½‘é¡µå†…å®¹, é€šè¿‡`self==top`åˆ¤æ–­çª—å£æ˜¯å¦è¢«iframeåµŒå¥— URLè·³è½¬æ¼æ´æœåŠ¡ç«¯è§£æurlå‚æ•°ä¸­çš„ç½‘ç«™å¹¶è·³è½¬ï¼Œæ¶æ„ç”¨æˆ·å¯ä»¥ä¼ªé€ è·³è½¬é“¾æ¥ç”¨æ¥æ”»å‡»å®‰å…¨æ„è¯†è–„å¼±çš„ç”¨æˆ·ã€‚ å¦‚ä½•é˜²å¾¡ï¼š - refereé™åˆ¶ï¼Œé™åˆ¶è®¿é—®æ¥æº - é€šè¿‡åŠ å…¥ç”¨æˆ·ä¸å¯æ§çš„tokenæ¥è¿›è¡Œæ ¡éªŒ SQLæ³¨å…¥åˆ©ç”¨æ½œåœ¨çš„æ•°æ®åº“æ¼æ´è®¿é—®å’Œä¿®æ”¹æ•°æ® æ³¨å…¥çš„åŸç†ï¼šæ¯”å¦‚å‰ç«¯éœ€è¦è¾“å…¥ç”¨æˆ·åå¯†ç ä»¥ç™»å½•ç³»ç»Ÿï¼Œåç«¯é€šè¿‡SELECT * FROM user WHERE username=&#39;admin&#39; AND psw=&#39;password&#39;æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ—¶è¾“å…¥ä¸€ä¸ªusernameæ˜¯admin--å°±å¯ä»¥ç›´æ¥ä»¥adminè´¦å·ç™»å½•ç³»ç»Ÿ å¦‚ä½•é˜²å¾¡ï¼š - æ§åˆ¶webåº”ç”¨è®¿é—®çš„æ“ä½œæƒé™ - åç«¯æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦ç¬¦åˆé¢„æœŸ - å¯¹äºç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰æˆ–ç¼–ç å¤„ç† - ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆé¢„ç¼–è¯‘)ï¼Œä¸è¿›è¡Œsqlæ‹¼æ¥ OSå‘½ä»¤æ³¨å…¥æ”»å‡»å’Œsqlæ³¨å…¥åŸç†ä¸€æ ·ï¼Œåªä¸è¿‡SQLæ³¨å…¥æ˜¯é’ˆå¯¹æ•°æ®åº“çš„ï¼Œè€ŒOSå‘½ä»¤æ³¨å…¥æ˜¯é’ˆå¯¹æ“ä½œç³»ç»Ÿçš„ã€‚ åŸç†ï¼šæ„é€ å‘½ä»¤æäº¤ç»™webåº”ç”¨ç¨‹åºï¼Œwebåº”ç”¨ç¨‹åºæå–æ„é€ çš„å‘½ä»¤ï¼Œæ‹¼æ¥åˆ°è¢«æ‰§è¡Œçš„å‘½ä»¤ä¸­ï¼Œå› æ³¨å…¥çš„å‘½ä»¤æ‰“ç ´äº†åŸæœ‰å‘½ä»¤ç»“æ„ï¼Œå¯¼è‡´webåº”ç”¨æ‰§è¡Œäº†é¢å¤–çš„å‘½ä»¤ã€‚ä¸¾ä¾‹ï¼š exec.Command(fmt.Sprintf(&quot;git clone %s&quot;,repo)) golangä¸­æˆ‘ä»¬è®©å‰ç«¯è¾“å…¥ä¸€ä¸ªgitä»“åº“åœ°å€æ¥å…‹éš†gitä»“åº“ä»£ç ï¼Œè¿™æ—¶å¦‚æœè¾“å…¥ä¸€ä¸ªæ­£å¸¸çš„ä»“åº“åœ°å€å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªè¿™æ ·çš„å‚æ•°repo adress &amp;&amp; rm -rf /*è€Œæ­£å¥½æˆ‘ä»¬çš„ç¨‹åºåˆæ˜¯ä»¥rootå¯åŠ¨ï¼Œé‚£ä¹ˆåé¢çš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œï¼Œæ ¹ç›®å½•ä¼šè¢«åˆ é™¤ã€‚ å¦‚ä½•é˜²å¾¡ï¼š - åç«¯å¯¹å‰ç«¯æå‰çš„æ•°æ®è¿›è¡Œè§„åˆ™æ ¡éªŒï¼ˆä¾‹å¦‚æ­£åˆ™æ ¡éªŒï¼‰ - æ‰§è¡Œå‘½ä»¤å‰å¯¹å‚æ•°è¿›è¡Œè½¬ä¹‰å’Œè¿‡æ»¤ - ä¸è¦ç›´æ¥æ‹¼æ¥å‘½ä»¤é€šè¿‡å·¥å…·åšæ‹¼æ¥ã€è½¬ä¹‰é¢„å¤„ç†","categories":[{"name":"network-security","slug":"network-security","permalink":"/categories/network-security/"}],"tags":[{"name":"web","slug":"web","permalink":"/tags/web/"}],"keywords":[{"name":"network-security","slug":"network-security","permalink":"/categories/network-security/"}]},{"title":"Goæºç é˜…è¯»-ç§æœ‰åº“æ‹‰å–é—®é¢˜","slug":"2019-10-29-go-primary-repo","date":"2019-10-29T06:24:30.000Z","updated":"2020-01-03T09:35:02.381Z","comments":true,"path":"2019/10/29/2019-10-29-go-primary-repo/","link":"","permalink":"/2019/10/29/2019-10-29-go-primary-repo/","excerpt":"","text":"go getæ‹‰å–ç§æœ‰åº“æŠ¥é”™httpæ‹‰å–é—®é¢˜(&gt;=1.6)go get github.com/sjatsh/transfo # cd .; git clone -- https://github.com/sjatsh/transfo /Users/jane/go/src/github.com/sjatsh/transfo Cloning into &#39;/Users/jane/go/src/github.com/sjatsh/transfo&#39;... fatal: could not read Username for &#39;https://github.com&#39;: terminal prompts disabled package github.com/sjatsh/transfo: exit status 128 æˆ‘ä»¬åˆšå¼€å§‹å­¦ä¹ golangçš„æ—¶å€™æˆ‘ä»¬éœ€è¦go getæ‹‰å–æŸä¸ªç§æœ‰åº“çš„æ—¶å€™ç»å¸¸å°±ä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äº terminal prompts disabled è¿™ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œé—®é¢˜æ˜¯ç”±äºhttpæ‹‰å–ç§æœ‰ä»“åº“æ—¶éœ€è¦ç”¨æˆ·åå¯†ç ï¼Œä½†æ˜¯gitå´æ²¡æœ‰æç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç›´æ¥çœ‹æºç ï¼š å‚è§æºç 97è¡Œï¼šgo/get.go at release-branch.go1.6 Â· golang/go Â· GitHub func runGet(cmd *base.Command, args []string) { // è¿™æ®µä»£ç é»˜è®¤è®¾ç½® GIT_TERMINAL_PROMPT = 0 if os.Getenv(&quot;GIT_TERMINAL_PROMPT&quot;) == &quot;&quot; { os.Setenv(&quot;GIT_TERMINAL_PROMPT&quot;, &quot;0&quot;) } } os.Setenv(&quot;GIT_TERMINAL_PROMPT&quot;, &quot;0&quot;) è¿™è¡Œæ ‡è¯†å…³é—­gitå‘½ä»¤è¡Œæç¤º ï¼Œä¹Ÿå°±å¯¼è‡´äº†ä¸Šé¢æåˆ°çš„terminal prompts disabledé”™è¯¯ã€‚ è§£å†³åŠæ³•ï¼šexport GIT_TERMINAL_PROMPT=1 æ‰‹åŠ¨è®¾ç½®gitå¼€å¯å‘½ä»¤è¡Œæç¤ºï¼Œä¹‹åå†go getå°±ä¼šæç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œä¸€åˆ‡æ­£å¸¸ï¼š è¿™ä¸ªissueæœ‰å¯¹è¿™ä¸ªé—®é¢˜çš„è¯¦ç»†è®¨è®ºï¼šhttp://golang.org/issue/9341golang.org/issue/9341 æ›¿æ¢æˆsshæ–¹å¼åå­˜åœ¨çš„é—®é¢˜æ›¿æ¢go getæ—¶gitå°†httpæ‹‰å–æ¢æˆsshæ‹‰å–ä»£ç  git config --global url.&quot;git@github.com:&quot;.insteadOf &quot;https://github.com/&quot; go geté€šè¿‡sshæ–¹å¼æ‹‰å–ä»£ç å¡æ­»é—®é¢˜(&lt;1.8ç‰ˆæœ¬)å¼€å¯ssh ControlMasteré…ç½®åï¼š Host * ControlPath ~/.ssh/master-%r@%h:%p ControlMaster auto ServerAliveInterval 30 ç”±äºå¼€å¯ ControlMaster åsshä¼šä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªmasteré“¾æ¥ï¼Œä¹‹åæ‰€æœ‰è¯·æ±‚éƒ½ä¼šé‡ç”¨è¿™ä¸€ä¸ªTCPé“¾æ¥ï¼Œä»–çš„stdoutå’Œstderrä¹Ÿä¸ä¼šé€€å‡ºã€‚ç„¶è€Œgo getæ—¶ä½¿ç”¨å­è¿›ç¨‹è¿è¡Œgit cloneå¹¶ä¸”ç›‘å¬å­è¿›ç¨‹stdoutå’Œstderré€€å‡ºï¼Œä½†æ˜¯å¼€å¯ControlMasteråsshçš„å®ˆæŠ¤è¿›ç¨‹ä¸ä¼šé€€å‡ºï¼Œgo getå°±ä¼šä¸€ç›´å¡æ­»ã€‚ 1.8ä¹‹åç‰ˆæœ¬é»˜è®¤è®¾ç½®GIT_SSH_COMMAND=ssh -o ControlMaster=noç¦ç”¨ssh ControlMaster è§£å†³ã€‚ å‚è§1.8ç‰ˆæœ¬æºç 151è¡Œï¼šgo/get.go at release-branch.go1.8 Â· golang/go Â· GitHub","categories":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}],"tags":[{"name":"golang","slug":"golang","permalink":"/tags/golang/"}],"keywords":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}]},{"title":"Rabin-Karpåœ¨golangä¸­çš„å®ç°","slug":"2019-09-26-rabin-karp","date":"2019-09-26T04:01:30.000Z","updated":"2020-01-03T09:35:02.437Z","comments":true,"path":"2019/09/26/2019-09-26-rabin-karp/","link":"","permalink":"/2019/09/26/2019-09-26-rabin-karp/","excerpt":"","text":"ç®€ä»‹Rabin-Karpå­—ç¬¦ä¸²å¿«é€ŸæŸ¥æ‰¾ç®—æ³•å’ŒFNV hashç®—æ³•æ˜¯golangä¸­stringsåŒ…ä¸­å­—ç¬¦ä¸²æŸ¥æ‰€ç”¨åˆ°çš„å…·ä½“ç®—æ³•ï¼Œç®—æ³•çš„æ ¸å¿ƒå°±åœ¨äºå¾ªç¯hashï¼Œè€Œ FNVåˆ™æ˜¯æ•£åˆ—æ–¹æ³•çš„å…·ä½“ç®—æ³•å®ç°ã€‚ ç®—æ³•æ€æƒ³Rabin-Karpç®—æ³•æ€æƒ³ï¼š å‡è®¾å¾…åŒ¹é…å­—ç¬¦ä¸²é•¿åº¦Mï¼Œç›®æ ‡å­—ç¬¦ä¸²é•¿åº¦Nï¼ˆN&gt;Mï¼‰ é¦–å…ˆè®¡ç®—å¾…åŒ¹é…å­—ç¬¦ä¸²hashï¼Œè®¡ç®—ç›®æ ‡å­—ç¬¦ä¸²å‰Mä¸ªå­—ç¬¦hash æ¯”è¾ƒå‰ä¸¤ä¸ªhashå€¼ï¼Œæ¯”è¾ƒæ¬¡æ•°N-M+1 è‹¥hashä¸ç›¸ç­‰ï¼Œç»§ç»­è®¡ç®—ç›®æ ‡å­—ç¬¦ä¸²ä¸‹ä¸€ä¸ªé•¿åº¦ä¸ºMçš„hashå¹¶ç»§ç»­å¾ªç¯æ¯”è¾ƒ è‹¥hashç›¸ç­‰åˆ™å†æ¬¡åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰å·²ç¡®ä¿æ­£ç¡®æ€§ FNV hashï¼š å°†å­—ç¬¦ä¸²çœ‹ä½œæ˜¯å­—ç¬¦ä¸²é•¿åº¦çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•°çš„è¿›åˆ¶æ˜¯ä¸€ä¸ªè´¨æ•°ã€‚è®¡ç®—å‡ºæ¥ç»“æœä¹‹åï¼ŒæŒ‰ç…§å“ˆå¸Œçš„èŒƒå›´æ±‚ä½™æ•°å¾—åˆ°ç»“æœã€‚ å…¶ä¸­ä¸åŒæœºåˆ¶å¯¹åº”è´¨æ•°åˆ†åˆ«æ˜¯ï¼š 32 bit FNV_prime = 224 + 28 + 0x93 = 16777619 64 bit FNV_prime = 240 + 28 + 0xb3 = 1099511628211 128 bit FNV_prime = 288 + 28 + 0x3b = 309485009821345068724781371 256 bit FNV_prime = 2168 + 28 + 0x63 = 374144419156711147060143317175368453031918731002211 512 bit FNV_prime = 2344 + 28 + 0x57 = 35835915874844867368919076489095108449946327955754392558399825615420669938882575 126094039892345713852759 1024 bit FNV_prime = 2680 + 28 + 0x8d = 50164565101131186554345988110352789550307653454047907443030175238311120551081474 51509157692220295382716162651878526895249385292291816524375083746691371804094271 873160484737966720260389217684476157468082573 ä»¥ä¸Šè¿™å‡ ä¸ªæ•°éƒ½æ˜¯è´¨æ•°ï¼ˆå“ˆå¸Œçš„ç†è®ºåŸºçŸ³ï¼Œè´¨æ•°åˆ†è¾¨å®šç†)ï¼Œç®€å•åœ°è¯´å°±æ˜¯ï¼šnä¸ªä¸åŒçš„è´¨æ•°å¯ä»¥â€œåˆ†è¾¨â€çš„è¿ç»­æ•´æ•°çš„ä¸ªæ•°å’Œä»–ä»¬çš„ä¹˜ç§¯ç›¸ç­‰ã€‚â€œåˆ†è¾¨â€å°±æ˜¯æŒ‡è¿™äº›è¿ç»­çš„æ•´æ•°ä¸å¯èƒ½æœ‰å®Œå…¨ç›¸åŒçš„ä½™æ•°åºåˆ—ã€‚è¯æ˜è¯¦è§ å¦‚æœæƒ³è¦å¾—åˆ°ä¸æ˜¯ä¸Šé¢è¿›åˆ¶çš„hashï¼š æ¯”å¦‚æƒ³å¾—åˆ°24ä½çš„å“ˆå¸Œå€¼ï¼Œæ–¹æ³•ï¼šå–ä¸Šé¢æ¯”24å¤§çš„æœ€å°çš„ä½æ•°ï¼Œå½“ç„¶æ˜¯32äº†ï¼Œå…ˆç®—å¯¹åº”32ä½å“ˆå¸Œå€¼ï¼Œå†è½¬æ¢æˆ24ä½çš„ã€‚è½¬æ¢æ–¹æ³•ï¼š32 - 24 = 8ï¼Œ å¥½äº†æŠŠå¾—åˆ°çš„32ç æˆä¸¤æ®µï¼Œé«˜8ä½æœ€å’Œä½24ä½ã€‚ç¬¬8ä½ä¸ä½24ä½ä¸­çš„ä½8ä½åšæŠ‘æˆ–ï¼Œå¾—åˆ°çš„24ä½å€¼æ˜¯æœ€ç»ˆç»“æœã€‚ï¼ˆhash&gt;&gt;24) ^ (hash &amp; 0xFFFFFF); å¦‚æœæƒ³å¾—åˆ°èŒƒå›´åœ¨0~9999çš„å“ˆå¸Œå€¼ï¼Œæ–¹æ³•ï¼šå–ä¸Šé¢æ¯”9999å¤§çš„æœ€å°çš„ä½æ•°ï¼Œå½“ç„¶æ˜¯32ï¼Œå…ˆç®—å¯¹åº”32ä½å“ˆå¸Œå€¼ï¼Œå†modï¼ˆ9999 +ï¼‘ï¼‰ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œç»“åˆRabin-Karpçš„æ€æƒ³åŠ ä¸ŠFNV hashå°±å¯ä»¥å®ç°æ‰€è°“çš„å­—ç¬¦ä¸²å¿«é€ŸæŸ¥æ‰¾ç®—æ³•äº†ã€‚ ç»“åˆgolangæºç src/strings/strings.go // Rabin-Karp ä¸­éœ€è¦ä½¿ç”¨çš„32ä½FNV hashç®—æ³•ä¸­çš„åŸºç¡€è´¨æ•°ï¼ˆç›¸å½“äºè¿›åˆ¶ï¼‰ const primeRK = 16777619 // hashæ•£åˆ—æ–¹æ³•ï¼Œ è¿”å›å­—ç¬¦ä¸²hashä»¥åŠ primeRKçš„k-1ï¼ˆlen(sep)-1ï¼‰æ¬¡æ–¹ func hashStr(sep string) (uint32, uint32) { hash := uint32(0) for i := 0; i &lt; len(sep); i++ { hash = hash*primeRK + uint32(sep[i]) // å¾ªç¯å¾—åˆ°å­—ç¬¦ä¸²hash } // ä½è¿ç®—å·§å¦™çš„è·å– primeRK çš„ len(sqp)-1 æ¬¡æ–¹ var pow, sq uint32 = 1, primeRK for i := len(sep); i &gt; 0; i &gt;&gt;= 1 { if i&amp;1 != 0 { pow *= sq } sq *= sq } return hash, pow } func indexRabinKarp(s, substr string) int { // Rabin-Karp search hashss, pow := hashStr(substr) n := len(substr) var h uint32 // è®¡ç®—ç›®æ ‡å­—ç¬¦ä¸²å‰nä½hashå¹¶ä¸å¾…åŒ¹é…å­—ç¬¦ä¸²hashè¿›è¡Œå¯¹æ¯” for i := 0; i &lt; n; i++ { h = h*primeRK + uint32(s[i]) } // hashç›¸åŒå¹¶ä¸”å­—ç¬¦ä¸²ç›¸ç­‰åˆ™è¿”å›å½“å‰ä½ç½®ä¸‹æ ‡ if h == hashss &amp;&amp; s[:n] == substr { return 0 } // Rabin-Karp ç®—æ³•çš„ç²¾åæ‰€åœ¨ï¼Œç›¸é¢è¯¦ç»†ä»‹ç» for i := n; i &lt; len(s); { h *= primeRK h += uint32(s[i]) h -= pow * uint32(s[i-n]) i++ if h == hashss &amp;&amp; s[i-n:i] == substr { return i - n } } return -1 } ç»“åˆæºç å¯ä»¥çŸ¥é“ï¼šå¦‚æœç°åœ¨æˆ‘ä»¬è¦æ±‚ç¬¬iä½å¾€åkä¸ªé•¿åº¦å­—ç¬¦ä¸²çš„hashå¯ä»¥åˆ—ä¸ªå…¬å¼ å…¶ä¸­ï¼šs[i] è¡¨ç¤ºç¬¬iä½å­—èŠ‚å¯¹åº”32ä½æ•´æ•°ä¹Ÿå°±æ˜¯ä¸Šé¢uint32(s[i]) ï¼ˆè¿™é‡Œå¼ºè½¬ä¸€ä¸‹ä¹Ÿå°±æ˜¯å¯¹2^32æ¬¡æ–¹å–ä½™äº†ï¼‰ï¼ŒR å°±æ˜¯ å¯¹åº”è¿›åˆ¶çš„FNV_primeã€‚ ç”±ä¸Šè¿°ç±»æ¨H(i+1)çš„hashå…¬å¼å°±æ˜¯ï¼š ç”±æ­¤å¯ä»¥çœ‹å‡ºæ¥ï¼šæ¯æ¬¡æˆ‘ä»¬å…¶å®ä¸ç”¨é‡æ–°è®¡ç®—æ•´ä¸ªå­—ç¬¦ä¸²çš„hashè€Œæ˜¯ç›´æ¥åŸhashå€¼ä¹˜ä»¥RåŠ ä¸Šs[k-1]å¹¶ä¸”å‡å»s[i]R^(k-1)ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯ FNV_primeçš„k-1æ¬¡æ–¹ï¼Œå¯¹åº”ä¸Šé¢ä»£ç ï¼š var pow, sq uint32 = 1, primeRK for i := len(sep); i &gt; 0; i &gt;&gt;= 1 { if i&amp;1 != 0 { pow *= sq } sq *= sq } ç›¸å¯¹äºæš´åŠ›åŒ¹é…O(mn)æ˜¯æ—¶é—´å¤æ‚åº¦ï¼Œ Rabin-Karp çš„æ—¶é—´å¤æ‚åº¦åœ¨O(m+n)ï¼Œ æœ€åçš„æƒ…å†µæ¯æ¬¡hashç›¸åŒå­—ç¬¦ä¸²ä¸ç›¸åŒæ—¶é—´å¤æ‚åº¦ä¼šå˜æˆO(mn)ä½†æ˜¯è¿™ç§æƒ…å†µæ¯”è¾ƒç½•è§ã€‚ Rabin-Karp è¿˜æœ‰ä¸ªä¼˜ç‚¹åœ¨äºä»–å¯ä»¥è¿›è¡Œå¤šæ¨¡å¼åŒ¹é…ï¼Œæ¯”å¦‚è®ºæ–‡é‡å¤æ€§æ£€æµ‹ï¼Œåªè¦é¢„çƒ­è®¡ç®—å‡ºæ‰€æœ‰å¸¦åŒ¹é…å­—ç¬¦ä¸²çš„hashï¼Œç›®æ ‡å­—ç¬¦ä¸²çš„éå†æ¯”è¾ƒæ—¶åªæ˜¯å¤šä¸€æ­¥æ¯”è¾ƒæ‰€æœ‰å¾…åŒ¹é…å­—ç¬¦ä¸²hashã€‚å¦‚æœå¾…åŒ¹é…å­—ç¬¦ä¸²ä¸ªæ•°æ˜¯kï¼Œé‚£ä¹ˆ Rabin-Karp çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nk)ã€‚","categories":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}],"tags":[{"name":"golang","slug":"golang","permalink":"/tags/golang/"}],"keywords":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}]},{"title":"goå¹³æ»‘é‡å¯é€‰å‹å’Œé¡¹ç›®å®è·µ","slug":"2019-09-17-graceful-reload","date":"2019-09-17T13:38:00.000Z","updated":"2020-01-03T09:35:02.445Z","comments":true,"path":"2019/09/17/2019-09-17-graceful-reload/","link":"","permalink":"/2019/09/17/2019-09-17-graceful-reload/","excerpt":"","text":"ä»€ä¹ˆæ˜¯å¹³æ»‘é‡å¯å½“çº¿ä¸Šä»£ç éœ€è¦æ›´æ–°æ—¶,æˆ‘ä»¬å¹³æ—¶ä¸€èˆ¬çš„åšæ³•éœ€è¦å…ˆå…³é—­æœåŠ¡ç„¶åå†é‡å¯æœåŠ¡. è¿™æ—¶çº¿ä¸Šå¯èƒ½å­˜åœ¨å¤§é‡æ­£åœ¨å¤„ç†çš„è¯·æ±‚, è¿™æ—¶å¦‚æœæˆ‘ä»¬ç›´æ¥å…³é—­æœåŠ¡ä¼šé€ æˆè¯·æ±‚å…¨éƒ¨ ä¸­æ–­, å½±å“ç”¨æˆ·ä½“éªŒ; åœ¨é‡å¯é‡æ–°æä¾›æœåŠ¡ä¹‹å‰, æ–°è¯·æ±‚è¿›æ¥ä¹Ÿä¼š502. è¿™æ—¶å°±å‡ºç°ä¸¤ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜: è€æœåŠ¡æ­£åœ¨å¤„ç†çš„è¯·æ±‚å¿…é¡»å¤„ç†å®Œæ‰èƒ½é€€å‡º(ä¼˜é›…é€€å‡º) æ–°è¿›æ¥çš„è¯·æ±‚éœ€è¦æ­£å¸¸å¤„ç†,æœåŠ¡ä¸èƒ½ä¸­æ–­(å¹³æ»‘é‡å¯) æœ¬æ–‡ä¸»è¦ç»“åˆlinuxå’ŒGolangä¸­ç›¸å…³å®ç°æ¥ä»‹ç»å¦‚ä½•é€‰å‹ä¸å®è·µè¿‡ç¨‹. ä¼˜é›…é€€å‡ºåœ¨å®ç°ä¼˜é›…é‡å¯ä¹‹å‰é¦–å…ˆéœ€è¦è§£å†³çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•ä¼˜é›…é€€å‡ºï¼šæˆ‘ä»¬çŸ¥é“åœ¨go 1.8.xåï¼Œgolangåœ¨httpé‡ŒåŠ å…¥äº†shutdownæ–¹æ³•ï¼Œç”¨æ¥æ§åˆ¶ä¼˜é›…é€€å‡ºã€‚ç¤¾åŒºé‡Œä¸å°‘http gracefulåŠ¨æ€é‡å¯ï¼Œå¹³æ»‘é‡å¯çš„åº“ï¼Œå¤§å¤šæ˜¯åŸºäºhttp.shutdownåšçš„ã€‚ http shutdown æºç åˆ†æå…ˆæ¥çœ‹ä¸‹http shutdownçš„ä¸»æ–¹æ³•å®ç°é€»è¾‘ã€‚ç”¨atomicæ¥åšé€€å‡ºæ ‡è®°çš„çŠ¶æ€ï¼Œç„¶åå…³é—­å„ç§çš„èµ„æºï¼Œç„¶åä¸€ç›´é˜»å¡çš„ç­‰å¾…æ— ç©ºé—²è¿æ¥ï¼Œæ¯500msè½®è¯¢ä¸€æ¬¡ã€‚ var shutdownPollInterval = 500 * time.Millisecond func (srv *Server) Shutdown(ctx context.Context) error { // æ ‡è®°é€€å‡ºçš„çŠ¶æ€ atomic.StoreInt32(&amp;srv.inShutdown, 1) srv.mu.Lock() // å…³é—­listen fdï¼Œæ–°è¿æ¥æ— æ³•å»ºç«‹ã€‚ lnerr := srv.closeListenersLocked() // æŠŠserver.goçš„done chanç»™closeæ‰ï¼Œé€šçŸ¥ç­‰å¾…çš„worekré€€å‡º srv.closeDoneChanLocked() // æ‰§è¡Œå›è°ƒæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å†Œshutdownçš„å›è°ƒæ–¹æ³• for _, f := range srv.onShutdown { go f() } // æ¯500msæ¥æ£€æŸ¥ä¸‹ï¼Œæ˜¯å¦æ²¡æœ‰ç©ºé—²çš„è¿æ¥äº†ï¼Œæˆ–è€…ç›‘å¬ä¸Šæ¸¸ä¼ é€’çš„ctxä¸Šä¸‹æ–‡ã€‚ ticker := time.NewTicker(shutdownPollInterval) defer ticker.Stop() for { if srv.closeIdleConns() { return lnerr } select { case &lt;-ctx.Done(): return ctx.Err() case &lt;-ticker.C: } } } â€¦ æ˜¯å¦æ²¡æœ‰ç©ºé—²çš„è¿æ¥ func (s *Server) closeIdleConns() bool { s.mu.Lock() defer s.mu.Unlock() quiescent := true for c := range s.activeConn { st, unixSec := c.getState() if st == StateNew &amp;&amp; unixSec &lt; time.Now().Unix()-5 { st = StateIdle } if st != StateIdle || unixSec == 0 { quiescent = false continue } c.rwc.Close() delete(s.activeConn, c) } return quiescent } å…³é—­server.doneChanå’Œç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦// å…³é—­doen chan func (s *Server) closeDoneChanLocked() { ch := s.getDoneChanLocked() select { case &lt;-ch: // Already closed. Don&#39;t close again. default: // Safe to close here. We&#39;re the only closer, guarded // by s.mu. close(ch) } } // å…³é—­ç›‘å¬çš„fd func (s *Server) closeListenersLocked() error { var err error for ln := range s.listeners { if cerr := (*ln).Close(); cerr != nil &amp;&amp; err == nil { err = cerr } delete(s.listeners, ln) } return err } // å…³é—­è¿æ¥ func (c *conn) Close() error { if !c.ok() { return syscall.EINVAL } err := c.fd.Close() if err != nil { err = &amp;OpError{Op: &quot;close&quot;, Net: c.fd.net, Source: c.fd.laddr, Addr: c.fd.raddr, Err: err} } return err } è¿™ä¹ˆä¸€ç³»åˆ—çš„æ“ä½œåï¼Œserver.goçš„servä¸»ç›‘å¬æ–¹æ³•ä¹Ÿå°±é€€å‡ºäº†ã€‚func (srv *Server) Serve(l net.Listener) error { ... for { rw, e := l.Accept() if e != nil { select { // é€€å‡º case &lt;-srv.getDoneChan(): return ErrServerClosed default: } ... return e } tempDelay = 0 c := srv.newConn(rw) c.setState(c.rwc, StateNew) // before Serve can return go c.serve(ctx) } } é‚£ä¹ˆå¦‚ä½•ä¿è¯ç”¨æˆ·åœ¨è¯·æ±‚å®Œæˆåï¼Œå†å…³é—­è¿æ¥çš„ï¼Ÿfunc (s *Server) doKeepAlives() bool { return atomic.LoadInt32(&amp;s.disableKeepAlives) == 0 &amp;&amp; !s.shuttingDown() } // Serve a new connection. func (c *conn) serve(ctx context.Context) { defer func() { ... xiaorui.cc ... if !c.hijacked() { // å…³é—­è¿æ¥ï¼Œå¹¶ä¸”æ ‡è®°é€€å‡º c.close() c.setState(c.rwc, StateClosed) } }() ... ctx, cancelCtx := context.WithCancel(ctx) c.cancelCtx = cancelCtx defer cancelCtx() c.r = &amp;connReader{conn: c} c.bufr = newBufioReader(c.r) c.bufw = newBufioWriterSize(checkConnErrorWriter{c}, 4&lt;&lt;10) for { // æ¥æ”¶è¯·æ±‚ w, err := c.readRequest(ctx) if c.r.remain != c.server.initialReadLimitSize() { c.setState(c.rwc, StateActive) } ... ... // åŒ¹é…è·¯ç”±åŠå›è°ƒå¤„ç†æ–¹æ³• serverHandler{c.server}.ServeHTTP(w, w.req) w.cancelCtx() if c.hijacked() { return } ... // åˆ¤æ–­æ˜¯å¦åœ¨shutdown mode, é€‰æ‹©é€€å‡º if !w.conn.server.doKeepAlives() { return } } ... ä¼˜é›…é‡å¯æ–¹æ³•æ¼”è¿›ä»linuxç³»ç»Ÿçš„è§’åº¦ ç›´æ¥ä½¿ç”¨execï¼ŒæŠŠä»£ç æ®µæ›¿æ¢æˆæ–°çš„ç¨‹åºçš„ä»£ç ï¼Œ åºŸå¼ƒåŸæœ‰çš„æ•°æ®æ®µå’Œå †æ ˆæ®µå¹¶ä¸ºæ–°ç¨‹åºåˆ†é…æ–°çš„æ•°æ®æ®µä¸å †æ ˆæ®µï¼Œå”¯ä¸€ç•™ä¸‹çš„å°±æ˜¯è¿›ç¨‹å·ã€‚ è¿™æ ·å°±ä¼šå­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯è€è¿›ç¨‹æ— æ³•ä¼˜é›…é€€å‡ºï¼Œè€è¿›ç¨‹æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ— æ³•æ­£å¸¸å¤„ç†å®Œæˆåé€€å‡ºã€‚å¹¶ä¸”æ–°è¿›ç¨‹æœåŠ¡çš„å¯åŠ¨å¹¶ä¸æ˜¯ç¬æ—¶çš„ï¼Œæ–°è¿›ç¨‹åœ¨listenä¹‹åacceptä¹‹å‰ï¼Œæ–°è¿æ¥å¯èƒ½å› ä¸ºsyn queueé˜Ÿåˆ—æ»¡äº†è€Œè¢«æ‹’ç»(è¿™ç§æƒ…å†µå¾ˆå°‘, ä½†åœ¨å¹¶å‘å¾ˆé«˜çš„æƒ…å†µä¸‹æ˜¯æœ‰å¯èƒ½å‡ºç°)ã€‚è¿™é‡Œç»“åˆä¸‹å›¾ä¸TCPä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹æ¥çœ‹å¯èƒ½ä¼šå¥½ç†è§£å¾ˆå¤šï¼Œä¸ªäººæ„Ÿè§‰æœ‰ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰. é€šè¿‡forkåexecåˆ›å»ºæ–°è¿›ç¨‹ï¼Œ execå‰åœ¨è€è¿›ç¨‹ä¸­é€šè¿‡fcntl(fd, F_SETFD, 0);æ¸…é™¤FD_CLOEXECæ ‡å¿—ï¼Œä¹‹åexecæ–°è¿›ç¨‹å°±ä¼šç»§æ‰¿è€è¿›ç¨‹ çš„fdå¹¶å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ä¹‹åæ–°è¿›ç¨‹å’Œè€è¿›ç¨‹listenç›¸åŒçš„fdåŒæ—¶æä¾›æœåŠ¡ï¼Œ åœ¨æ–°è¿›ç¨‹æ­£å¸¸å¯åŠ¨æœåŠ¡åå‘é€ä¿¡å·ç»™è€è¿›ç¨‹, è€è¿›ç¨‹ä¼˜é›…é€€å‡ºã€‚ä¹‹åæ‰€æœ‰è¯·æ±‚ éƒ½åˆ°äº†æ–°è¿›ç¨‹ä¹Ÿå°±å®Œæˆäº†æœ¬æ¬¡ä¼˜é›…é‡å¯ã€‚ç»“åˆå®é™…çº¿ä¸Šç¯å¢ƒå­˜åœ¨çš„é—®é¢˜: è¿™æ—¶æ–°çš„å­è¿›ç¨‹ç”±äºçˆ¶è¿›ç¨‹çš„é€€å‡º, ç³»ç»Ÿä¼šæŠŠå®ƒçš„çˆ¶è¿›ç¨‹æ”¹æˆ1å·è¿›ç¨‹,ç”±äºçº¿ä¸Šç¯å¢ƒå¤§å¤šæ•°æœåŠ¡éƒ½æ˜¯é€šè¿‡ supervisorè¿›è¡Œç®¡ç†çš„,è¿™å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜, supervisorä¼šè®¤ä¸ºæœåŠ¡å¼‚å¸¸é€€å‡º, ä¼šé‡æ–°å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹. é€šè¿‡ç»™æ–‡ä»¶æè¿°ç¬¦è®¾ç½®SO_REUSEPORTæ ‡å¿—è®©ä¸¤ä¸ªè¿›ç¨‹ç›‘å¬åŒä¸€ä¸ªç«¯å£, è¿™é‡Œå­˜åœ¨çš„é—®é¢˜æ˜¯è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„FDç›‘å¬åŒä¸€ä¸ªç«¯å£ï¼Œè€è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ã€‚ syn queueé˜Ÿåˆ—ä¸­è¿˜æœªè¢«acceptçš„è¿æ¥ä¼šè¢«å†…æ ¸killæ‰ã€‚ é€šè¿‡ancilliary dataç³»ç»Ÿè°ƒç”¨ä½¿ç”¨UNIXåŸŸå¥—æ¥å­—åœ¨è¿›ç¨‹ä¹‹é—´ä¼ é€’æ–‡ä»¶æè¿°ç¬¦ï¼Œ è¿™æ ·ä¹Ÿå¯ä»¥å®ç°ä¼˜é›…é‡å¯ã€‚ä½†æ˜¯è¿™æ ·çš„å®ç°ä¼šæ¯”è¾ƒå¤æ‚ï¼Œ HAProxyä¸­ å®ç°äº†è¯¥æ¨¡å‹ã€‚ ç›´æ¥forkç„¶åexecè°ƒç”¨ï¼Œå­è¿›ç¨‹ä¼šç»§æ‰¿æ‰€æœ‰çˆ¶è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œ å­è¿›ç¨‹æ‹¿åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ä»3é€’å¢ï¼Œ é¡ºåºä¸çˆ¶è¿›ç¨‹æ‰“å¼€é¡ºåºä¸€è‡´ã€‚å­è¿›ç¨‹é€šè¿‡epoll_ctl æ³¨å†Œfdå¹¶æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°(è¿™é‡Œä»¥epollæ¨¡å‹ä¸ºä¾‹)ï¼Œ è¿™æ ·å­è¿›ç¨‹å°±èƒ½å’Œçˆ¶è¿›ç¨‹ç›‘å¬åŒä¸€ä¸ªç«¯å£çš„è¯·æ±‚äº†(æ­¤æ—¶çˆ¶å­è¿›ç¨‹åŒæ—¶æä¾›æœåŠ¡)ï¼Œ å½“å­è¿›ç¨‹æ­£å¸¸å¯åŠ¨å¹¶æä¾›æœåŠ¡å å‘é€SIGHUPç»™çˆ¶è¿›ç¨‹ï¼Œ çˆ¶è¿›ç¨‹ä¼˜é›…é€€å‡ºæ­¤æ—¶å­è¿›ç¨‹æä¾›æœåŠ¡ï¼Œ å®Œæˆä¼˜é›…é‡å¯ã€‚ Golangä¸­çš„å®ç°ä»ä¸Šé¢çœ‹ï¼Œ ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®¹æ˜“çš„å®ç°æ˜¯ç›´æ¥forkandexecçš„æ–¹å¼æœ€ç®€å•ï¼Œ é‚£ä¹ˆæ¥ä¸‹æ¥è®¨è®ºä¸‹åœ¨Golangä¸­çš„å…·ä½“å®ç°ã€‚ æˆ‘ä»¬çŸ¥é“Golangä¸­socketçš„fdé»˜è®¤æ˜¯è®¾ç½®äº†FD_CLOEXECæ ‡å¿—çš„(net/sys_cloexec.goå‚è€ƒæºç ) // Wrapper around the socket system call that marks the returned file // descriptor as nonblocking and close-on-exec. func sysSocket(family, sotype, proto int) (int, error) { // See ../syscall/exec_unix.go for description of ForkLock. syscall.ForkLock.RLock() s, err := socketFunc(family, sotype, proto) if err == nil { syscall.CloseOnExec(s) } syscall.ForkLock.RUnlock() if err != nil { return -1, os.NewSyscallError(&quot;socket&quot;, err) } if err = syscall.SetNonblock(s, true); err != nil { poll.CloseFunc(s) return -1, os.NewSyscallError(&quot;setnonblock&quot;, err) } return s, nil } æ‰€ä»¥åœ¨execåfdä¼šè¢«ç³»ç»Ÿå…³é—­ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡os.Commandæ¥å®ç°ã€‚è¿™é‡Œæœ‰äº›äººå¯èƒ½æœ‰ç‚¹ç–‘æƒ‘äº†ä¸æ˜¯FD_CLOEXECæ ‡å¿—çš„è®¾ç½®ï¼Œæ–°èµ·çš„å­è¿›ç¨‹ç»§æ‰¿çš„fdä¼šè¢«å…³é—­ã€‚äº‹å®æ˜¯os.Commandå¯åŠ¨çš„å­è¿›ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶è¿›ç¨‹çš„fdå¹¶ä¸”ä½¿ç”¨, é˜…è¯»æºç æˆ‘ä»¬å¯ä»¥çŸ¥é“os.Commandä¸­é€šè¿‡Stdout,Stdin,Stderrä»¥åŠExtraFiles ä¼ é€’çš„æè¿°ç¬¦é»˜è®¤ä¼šè¢«Golangæ¸…é™¤FD_CLOEXECæ ‡å¿—, é€šè¿‡Startæ–¹æ³•è¿½æº¯è¿›å»æˆ‘ä»¬å¯ä»¥ç¡®è®¤æˆ‘ä»¬çš„æƒ³æ³•ã€‚(syscall/exec_{GOOS}.goæˆ‘è¿™é‡Œæ˜¯macosçš„æºç å®ç°å‚è€ƒæºç ) // dup2(i, i) won&#39;t clear close-on-exec flag on Linux, // probably not elsewhere either. _, _, err1 = rawSyscall(funcPC(libc_fcntl_trampoline), uintptr(fd[i]), F_SETFD, 0) if err1 != 0 { goto childerror } ç»“åˆsupervisoræ—¶çš„é—®é¢˜å®é™…é¡¹ç›®ä¸­, çº¿ä¸ŠæœåŠ¡ä¸€èˆ¬æ˜¯è¢«supervisorå¯åŠ¨çš„, å¦‚ä¸Šæ‰€è¯´çš„æˆ‘ä»¬å¦‚æœé€šè¿‡çˆ¶å­è¿›ç¨‹, å­è¿›ç¨‹å¯åŠ¨åé€€å‡ºçˆ¶è¿›ç¨‹è¿™ç§æ–¹å¼çš„è¯å­˜åœ¨çš„é—®é¢˜å°±æ˜¯å­è¿›ç¨‹ä¼šè¢«1å·è¿›ç¨‹æ¥ç®¡, å¯¼è‡´supervisor è®¤ä¸ºæœåŠ¡æŒ‚æ‰é‡å¯æœåŠ¡,ä¸ºäº†é¿å…è¿™ç§é—®é¢˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨master, workerçš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼åŸºæœ¬æ€è·¯å°±æ˜¯: é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ç¨‹åºä½œä¸ºmasterå¯åŠ¨å¹¶ç›‘å¬ç«¯å£åˆ›å»ºsocketæè¿°ç¬¦ä½†æ˜¯ä¸å¯¹å¤–æä¾›æœåŠ¡, ç„¶åé€šè¿‡os.Commandåˆ›å»ºå­è¿›ç¨‹é€šè¿‡Stdin, Stdout, Stderr,ExtraFileså’ŒEnvä¼ é€’æ ‡æ¤è¾“å…¥è¾“å‡ºé”™è¯¯å’Œæ–‡ä»¶æè¿°ç¬¦ä»¥åŠç¯å¢ƒå˜é‡. é€šè¿‡ç¯å¢ƒå˜é‡å­è¿›ç¨‹å¯ä»¥çŸ¥é“è‡ªå·±æ˜¯å­è¿›ç¨‹å¹¶é€šè¿‡os.NewFileå°†fdæ³¨å†Œåˆ°epollä¸­, é€šè¿‡fdåˆ›å»ºTCPListenerå¯¹è±¡, ç»‘å®šhandleå¤„ç†å™¨ä¹‹åacceptæ¥å—è¯·æ±‚å¹¶å¤„ç†ï¼Œ å‚è€ƒä¼ªä»£ç : f := os.NewFile(uintptr(3+i), &quot;&quot;) l, err := net.FileListener(f) if err != nil { return fmt.Errorf(&quot;failed to inherit file descriptor: %d&quot;, i) } server:=&amp;http.Server{Handler: handler} server.Serve(l) ä¸Šè¿°è¿‡ç¨‹åªæ˜¯å¯åŠ¨äº†workerè¿›ç¨‹å¹¶æä¾›æœåŠ¡, çœŸæ­£çš„ä¼˜é›…é‡å¯, å¯ä»¥é€šè¿‡æ¥å£(ç”±äºçº¿ä¸Šç¯å¢ƒå‘å¸ƒæœºå™¨å¯èƒ½æ²¡æœ‰æƒé™,åªèƒ½æ›²çº¿æ•‘å›½)æˆ–è€…å‘é€ä¿¡å·ç»™workerè¿›ç¨‹,worker å‘é€ä¿¡å·ç»™master, masterè¿›ç¨‹æ”¶åˆ°ä¿¡å·åèµ·ä¸€ä¸ªæ–°worker, æ–°workerå¯åŠ¨å¹¶æ­£å¸¸æä¾›æœåŠ¡åå‘é€ä¸€ä¸ªä¿¡å·ç»™master,masterå‘é€é€€å‡ºä¿¡å·ç»™è€worker,è€workeré€€å‡º. æ—¥å¿—æ”¶é›†çš„é—®é¢˜ï¼Œ å¦‚æœé¡¹ç›®æœ¬èº«æ—¥å¿—æ˜¯ç›´æ¥æ‰“åˆ°æ–‡ä»¶ï¼Œå¯èƒ½ä¼šå­˜åœ¨fdæ»šåŠ¨ç­‰é—®é¢˜(ç›®å‰æ²¡æœ‰ç ”ç©¶é€å½»). ç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯é¡¹ç›®logå…¨éƒ¨è¾“å‡ºåˆ°stdoutç”±supervisoræ¥æ”¶é›†åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œ åˆ›å»ºworkerçš„æ—¶å€™stdout, stderræ˜¯å¯ä»¥ç»§æ‰¿è¿‡å»çš„ï¼Œè¿™å°±è§£å†³äº†æ—¥å¿—çš„é—®é¢˜ï¼Œ å¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼ç¯å¢ƒä¸€èµ·æ¢è®¨ã€‚ å‚è€ƒæ–‡ç« è°ˆè°ˆgolangç½‘ç»œåº“çš„å…¥é—¨è®¤è¯†æ·±å…¥ç†è§£Linux TCP backloggoä¼˜é›…å‡çº§/é‡å¯å·¥å…·è°ƒç ”è®°ä¸€æ¬¡æƒŠå¿ƒçš„ç½‘ç«™TCPé˜Ÿåˆ—é—®é¢˜æ’æŸ¥ç»å†acceptå’Œaccept4çš„åŒºåˆ«","categories":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}],"tags":[{"name":"golang","slug":"golang","permalink":"/tags/golang/"}],"keywords":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}]},{"title":"","slug":"2018-04-25-java_classloader","date":"2019-09-17T13:17:33.000Z","updated":"2020-01-03T10:12:29.136Z","comments":true,"path":"2019/09/17/2018-04-25-java_classloader/","link":"","permalink":"/2019/09/17/2018-04-25-java_classloader/","excerpt":"layout: posttitle: â€œJavaç±»åŠ è½½å™¨â€tag: â€œclassloaderâ€date: â€œ2018-04-25 00:00:00 +0800â€ categories: â€œjavaâ€åŸºæœ¬æ¦‚å¿µæœ€åˆä¸ºäº†æ»¡è¶³Java Appletçš„éœ€è¦è€Œè¢«å¼€å‘å‡ºæ¥çš„ï¼ŒJava Applet éœ€è¦ä»è¿œç¨‹ä¸‹è½½Javaç±»åˆ°æµè§ˆå™¨æ‰§è¡Œï¼Œç°åœ¨Webå®¹å™¨å’ŒOSGiä¸­å¾—åˆ°äº†å¹¿æ³›çš„ä½¿ç”¨ã€‚ç±»åŠ è½½å™¨è´Ÿè´£è¯»å– Java å­—èŠ‚ä»£ç ï¼Œå¹¶è½¬æ¢æˆ java.lang.Class ç±»çš„å®ä¾‹ã€‚æ¯ä¸ª java.lang.Class å®ä¾‹ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªJavaç±»ï¼Œé€šè¿‡ newInstance() åˆ›å»ºè¯¥ç±»å¯¹è±¡ï¼ŒnewInstance()åªèƒ½è°ƒç”¨æ— å‚æ„é€ å™¨ã€‚","text":"layout: posttitle: â€œJavaç±»åŠ è½½å™¨â€tag: â€œclassloaderâ€date: â€œ2018-04-25 00:00:00 +0800â€ categories: â€œjavaâ€åŸºæœ¬æ¦‚å¿µæœ€åˆä¸ºäº†æ»¡è¶³Java Appletçš„éœ€è¦è€Œè¢«å¼€å‘å‡ºæ¥çš„ï¼ŒJava Applet éœ€è¦ä»è¿œç¨‹ä¸‹è½½Javaç±»åˆ°æµè§ˆå™¨æ‰§è¡Œï¼Œç°åœ¨Webå®¹å™¨å’ŒOSGiä¸­å¾—åˆ°äº†å¹¿æ³›çš„ä½¿ç”¨ã€‚ç±»åŠ è½½å™¨è´Ÿè´£è¯»å– Java å­—èŠ‚ä»£ç ï¼Œå¹¶è½¬æ¢æˆ java.lang.Class ç±»çš„å®ä¾‹ã€‚æ¯ä¸ª java.lang.Class å®ä¾‹ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªJavaç±»ï¼Œé€šè¿‡ newInstance() åˆ›å»ºè¯¥ç±»å¯¹è±¡ï¼ŒnewInstance()åªèƒ½è°ƒç”¨æ— å‚æ„é€ å™¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒClassLoaderè¿˜è´Ÿè´£åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºï¼Œå¦‚å›¾åƒæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ç­‰ã€‚ é™¤äº†BootstrapClassLoaderæ˜¯ç”±C++æˆ–å…¶ä»–è¯­è¨€ç¼–å†™ï¼Œå…¶ä»–éƒ½æ˜¯ java.lang.ClassLoader çš„å®ä¾‹ï¼ŒClassLoader ä¸­ä¸åŠ è½½ç±»ç›¸å…³çš„æ–¹æ³•ï¼š æ–¹æ³• è¯´æ˜ getParent() è¿”å›è¯¥ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ loadClass(String name) åŠ è½½åç§°ä¸ºnameçš„ç±» findClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„ç±» findLoadedClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±» defineClass(String name, byte[] b, int off, int len) æŠŠå­—èŠ‚æ•°ç»„ bä¸­çš„å†…å®¹è½¬æ¢æˆ Java ç±» resolveClass(Class&lt;?&gt; c) é“¾æ¥æŒ‡å®šJavaç±» æ³¨æ„ï¼šClass.forName(className)åŠ è½½classçš„åŒæ—¶ä¼šåˆå§‹åŒ–é™æ€ä»£ç å—ï¼ŒClassLoader.loadClass(className)åˆ™ä¸ä¼šåˆå§‹åŒ–é™æ€å—ã€‚ bootstrap class loaderä¸€åˆ‡ä»bootstrap class loaderå¼€å§‹ï¼Œbootstrap class loaderå¯åŠ¨åŠ è½½jre/lib/ä¸‹çš„rt.jarã€resources.jarã€charsets.jarç­‰æ ¸å¿ƒç±»åº“ã€‚ä¹‹ååŠ è½½ExtClassLoaderã€ AppClassLoader BootstrapClassLoader: ç”±c++å®ç°ï¼Œè´Ÿè´£åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åŠ è½½Jdkæ ¸å¿ƒç±»åº“ä»¥åŠåŠ è½½åä¸¤ä¸ªç±»åŠ è½½å™¨ã€‚ ExtClassLoader: Launcherå­ç±»ï¼Œç»§æ‰¿è‡ªURLClassLoaderï¼Œè´Ÿè´£åŠ è½½{JAVA_HOME}/jre/lib/ext/ç›®å½•ä¸‹çš„jaråŒ…ã€‚ AppClassLoader: Launcherå­ç±»ï¼Œç»§æ‰¿è‡ªURLClassLoaderï¼Œè´Ÿè´£åŠ è½½åº”ç”¨ç¨‹åºclasspathç›®å½•ä¸‹çš„æ‰€æœ‰jarå’Œclassæ–‡ä»¶ã€‚ ExtClassLoaderã€AppClassLoader æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨ClassLoaderä¸­çš„nativeæ–¹æ³•ï¼ŒdefineClass0ã€defineClass1ã€defineClass2ã€‚ æ³¨æ„ï¼šç»å¸¸çœ‹èµ„æ–™è¯´çš„ç±»è½½å…¥å™¨çš„å±‚çº§ä½“ç³»(classloader hierarchy)ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºçš„å±‚çº§ä½“ç³»ï¼ˆçˆ¶å­ç±»ç»§æ‰¿çš„å±‚çº§ä½“ç³»ï¼‰ã€‚ç±»åˆ«è½½å…¥å™¨çš„å±‚çº§ä½“ç³»å¦æœ‰æ‰€æŒ‡ï¼Œä¸è¦æ··æ·†ã€‚ ExtClassLoaderã€AppClassLoaderå…¶å®éƒ½æ˜¯ç”±BootstrapClassLoaderåŠ è½½ï¼Œä»–ä»¬è°ƒç”¨getClassLoader()è¿”å›éƒ½æ˜¯nullè¡¨ç¤ºåŠ è½½ä»–ä»¬çš„éƒ½æ˜¯BootstrapClassLoaderï¼Œåªä¸è¿‡AppClassLoaderè®¾ç½®å…¶parentæ˜¯ExtClassLoaderã€‚ ç±»è½½å…¥å™¨çš„åŒäº²å§”æ´¾æ¨¡å¼ä¸Šé¢è¯´çš„ç±»åˆ«è½½å…¥å™¨çš„å±‚çº§ä½“ç³»å°±æ˜¯ä¸ºäº†å®ç°åŒäº²å§”æ´¾æ¨¡å¼ï¼Œæ‰€è°“åŒäº²å§”æ´¾æ¨¡å¼å°±æ˜¯ç±»åˆ«è½½å…¥å™¨åœ¨è½½å…¥ç±»çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆè¯·ç¤º Parent ä½¿ç”¨ Parent æœç´¢è·¯å¾„å¸®å¿™è½½å…¥ï¼Œå¦‚æœ Parent æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆæ‰ç”¨è‡ªå·±çš„æœç´¢è·¯å¾„å»æœç´¢åŠ è½½ç±» æ³¨æ„ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±çš„Main.classè°ƒç”¨äº†Test.classä¸­çš„æ–¹æ³•ï¼Œä½†æ˜¯Main.classæ”¾åœ¨ Parent åŠ è½½å™¨æœç´¢è·¯å¾„ä¸­ï¼Œä½†æ˜¯Test.classæ”¾åœ¨å­ç±»åŠ è½½å™¨æœç´¢è·¯å¾„æˆ–å…¶ä»–è·¯å¾„ï¼Œå°±ä¼šå‡ºç°NoClassDefFoundErrorï¼Œè¿™ä¹Ÿæ˜¯Javaçš„å®‰å…¨ç­–ç•¥ã€‚ ç±»è½½å…¥å™¨çš„åŠŸç”¨ä»ä¸‹é¢è¿™å¼ å›¾æ¥åˆ†æï¼š ç±»è½½å…¥å™¨æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç³»ç»Ÿï¼Œä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™ä¹ˆä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿå‘¢ï¼Ÿè‚¯å®šæ˜¯æœ‰é“ç†çš„ï¼Œé™¤äº†åŠ¨æ€æ€§å®ç°åŠ¨æ€åŠ è½½ä»¥å¤–ï¼Œå…¶å®æ›´é‡è¦çš„è«è¿‡äºå®‰å…¨æ€§ã€‚ è¿™å¼ å›¾è¯´æ˜äº†ä¸¤ä»¶äº‹ï¼š ç¬¬ä¸€ï¼šå‡è®¾æˆ‘ä»¬ç”¨URLClassLoaderåˆ°ç½‘ä¸Šéšä¾¿ä¸‹è½½ä¸€ä¸ªclassï¼Œè¿™ä¸ªclassä¸å¯èƒ½æ˜¯AppClassLoaderã€ExtClassLoaderæˆ–è€…æ˜¯Bootstrap Loaderè·¯å¾„ä¸‹çš„åŒåç±»ï¼ˆæŒ‡å…¨è·¯å¾„ï¼‰ï¼Œå› æ­¤è“„æ„ç ´åè€…æ²¡æœ‰åŠæ³•æ¤å…¥ä»£ç åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œé™¤éç›´æ¥é»‘å¦‚ä½ çš„ç”µè„‘æ›¿æ¢æ–‡ä»¶ï¼Œè¿™å…¶å®ä¹Ÿä¸æ˜¯Javaè€ƒè™‘çš„èŒƒå›´äº†ï¼Œè¿™æ˜¯æ“ä½œç³»ç»Ÿå®‰å…¨çš„è¯¥è€ƒè™‘çš„ã€‚ ç¬¬äºŒï¼šç±»è½½å…¥å™¨æ— æ³•çœ‹åˆ°åŒçº§åˆ«ç±»è½½å…¥å™¨è½½å…¥çš„ç±»ï¼Œé™¤äº†æ„å‘³ç€ä¸åŒçš„ç±»åˆ¥è½½å…¥å™¨å¯ä»¥è½½å…¥å®Œå…¨ç›¸åŒçš„ç±»ä¹‹å¤–ï¼Œä¹Ÿæ’é™¤äº†è¯¯ç”¨æˆ–ä½¿ç”¨åˆ¥äººçš„æ¶æ„ä»£ç çš„æœºä¼šã€‚ ç–‘é—®ä¸Šé¢è¯´åˆ°ä¸€ä¸ªç±»ç”±ä¸€ä¸ªè½½å…¥å™¨åŠ è½½ï¼Œä»–è°ƒç”¨çš„æ–¹æ³•æ‰€åœ¨çš„ç±»ä¹Ÿå¿…é¡»åœ¨è¯¥è½½å…¥å™¨çš„æœç´¢è·¯å¾„ä¸‹ã€‚ä½†æ˜¯å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼ŒJDBCæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿjava.sql.Driverå±äºåŸºç¡€ç±»åº“ï¼Œç”±BootstrapClassLoaderåŠ è½½ï¼Œä½†æ˜¯JDBC Driverçš„å®ç°æ˜¯ç”±å„ä¸ªå‚å•†å®ç°çš„ï¼ŒæŒ‰ç…§ä¸Šé¢çš„é€»è¾‘BootstrapClassLoadeåº”è¯¥ä¼šåœ¨jre/lib/ä¸‹é¢æ‰¾å¯¹åº”å®ç°ç±»ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾æˆ‘ä»¬çš„é©±åŠ¨çš„jaråŒ…æ˜¯åœ¨classpathä¸‹é¢ï¼ŒJDBCçš„å®ç°åç»­ç»§ç»­å†è®¨è®ºã€‚","categories":[],"tags":[],"keywords":[]},{"title":"","slug":"2018-02-01-win_ics","date":"2019-09-16T16:33:58.000Z","updated":"2020-01-03T10:12:29.172Z","comments":true,"path":"2019/09/17/2018-02-01-win_ics/","link":"","permalink":"/2019/09/17/2018-02-01-win_ics/","excerpt":"layout: posttitle: â€œwindows ICSâ€tag: â€œwindowsâ€date: â€œ2018-02-01 00:00:00 +0800â€ categories: â€œsystemâ€ä»€ä¹ˆæ˜¯windows ICSå…¨ç§°windows internet connect sharing,ç”¨äºåœ¨ç”µè„‘ä¸¤ä¸ªç½‘å¡ä¹‹é—´å…±äº«ç½‘ç»œï¼Œè®©windowsä¸»æœºæˆå®ç°ä¸€ä¸ªç®€å•çš„è·¯ç”±åŠŸèƒ½ã€‚","text":"layout: posttitle: â€œwindows ICSâ€tag: â€œwindowsâ€date: â€œ2018-02-01 00:00:00 +0800â€ categories: â€œsystemâ€ä»€ä¹ˆæ˜¯windows ICSå…¨ç§°windows internet connect sharing,ç”¨äºåœ¨ç”µè„‘ä¸¤ä¸ªç½‘å¡ä¹‹é—´å…±äº«ç½‘ç»œï¼Œè®©windowsä¸»æœºæˆå®ç°ä¸€ä¸ªç®€å•çš„è·¯ç”±åŠŸèƒ½ã€‚ è®¾ç½®åœ¨æ›´æ”¹é€‚é…å™¨é€‰é¡¹ä¸­é€‰æ‹©è¿æ¥å¤–ç½‘çš„ç½‘å¡å³é”®å±æ€§ï¼Œé€‰æ‹©å…±äº«ï¼Œé€‰æ‹©å…è®¸å…¶ä»–ç”¨æˆ·é€šè¿‡æ­¤è®¡ç®—æœºçš„internetè¿æ¥æ¥è¿æ¥å¹¶é€‰æ‹©éœ€è¦å…±äº«çš„ç½‘å¡ã€‚é»˜è®¤è¢«å…±äº«çš„ç½‘å¡ï¼ˆåé¢ç§°LANå£ï¼‰ipæ˜¯192.168.137.1ï¼Œç”µè„‘æ¥ä¸Šè¯¥ç½‘å£åä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ª192.168.137æ®µçš„ipã€‚ å­˜åœ¨çš„é—®é¢˜å¦‚æœæˆ‘ä»¬ä¿®æ”¹LANå£ipåä¼šå‘ç°ï¼Œè¿æ¥lanå£çš„è®¾å¤‡è·å–çš„ipä¸æ˜¯LANå£çš„ipæ®µã€‚ ä¿®æ”¹æ³¨å†Œè¡¨é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨SYSTEM\\CurrentControlSet\\services\\SharedAccess\\Parametersä¸­çš„ScopeAddressã€ScopeAddressBackupã€StandaloneDhcpAddress,å…¶ä¸­ScopeAddressã€ScopeAddressBackupè®¾ç½®ä¿®æ”¹åçš„LANå£ipï¼ŒStandaloneDhcpAddressä¿®æ”¹ä¸ºæ–°çš„LANå£DNSåœ°å€ã€‚ å¦‚ä½•è·å–å±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡çš„ipåœ°å€å¦‚æœç°åœ¨æœ‰ä¸ªéœ€æ±‚éœ€è¦æˆ‘ä»¬è·å–å’ŒLANå£è¿æ¥çš„è®¾å¤‡çš„ipåœ°å€ï¼Œè€Œæ­¤è®¾å¤‡åˆæ˜¯dhcpï¼Œæœ€å¥½çš„æ–¹å¼å¯èƒ½å°±æ˜¯é€šè¿‡arpå‘½ä»¤æ¥è·å–äº†ï¼ˆä¸ªäººè®¤ä¸ºï¼Œæœ‰ä»€ä¹ˆå…¶ä»–çš„æ›´å¥½çš„æ–¹å¼æ¬¢è¿æŒ‡æ­£ï¼‰ã€‚å…·ä½“å¦‚ä½•ä½¿ç”¨arpå‘½ä»¤æ‰«æå±€åŸŸç½‘å†…çš„ipåœ°å€ï¼Œå¯ä»¥æœç´¢arpçš„ä½¿ç”¨æ–¹æ³•ã€‚ä¸Šé¢è¿™äº›æ–¹æ³•éƒ½å¯ä»¥é€šè¿‡goä»£ç å®ç°ã€‚","categories":[],"tags":[],"keywords":[]},{"title":"","slug":"2018-10-09-sputnik","date":"2019-09-16T16:33:58.000Z","updated":"2020-01-03T09:55:50.212Z","comments":true,"path":"2019/09/17/2018-10-09-sputnik/","link":"","permalink":"/2019/09/17/2018-10-09-sputnik/","excerpt":"layout: posttitle: â€œäº’è”ç½‘ç¼–å¹´å²-sputnikâ€description: â€œäº’è”ç½‘ç¼–å¹´å²-sputnikâ€tag: â€œsputnikâ€date: â€œ2018-10-09 00:00:00 +0800â€ categories: â€œnetâ€ ç¬¬ä¸€é¢—äººé€ å«æ˜Ÿçš„å‘å°„æˆåŠŸï¼Œç›´æ¥å¯¼è‡´äº†å†·æˆ˜æ—¶æœŸç¾ä¿„ä¸¤å›½çš„å¤ªç©ºç«èµ› &emsp;1957å¹´è‹è”å‘å°„äº†äººç±»ç¬¬ä¸€é¢—äººé€ å«æ˜Ÿâ€Sputnikâ€ã€‚ &emsp;åœ¨Sputnikè¿›å…¥å¤ªç©ºä¹‹åçš„60å¹´é—´ï¼Œäººé€ å«æ˜Ÿåœ¨ç§‘å­¦ã€å†›äº‹å’Œæ°‘ç”Ÿç­‰å„ä¸ªæ–¹é¢éƒ½è·å¾—äº†æå…¶å¹¿æ³›çš„åº”ç”¨ï¼Œå¯¹äººç±»é€šè®¯æ–¹å¼å¸¦æ¥äº†é¢ è¦†æ€§çš„å½±å“ï¼Œæ­å¼€å¹¶æ·±åŒ–äº†å†·æˆ˜ï¼Œå‚¬ç”Ÿäº†äº’è”ç½‘ï¼Œè¿›è€Œå½»åº•æ”¹å˜äº†äººä»¬è®¤è¯†è‡ªæˆ‘ã€è§‚çœ‹ä¸–ç•Œçš„æ–¹å¼ã€‚","text":"layout: posttitle: â€œäº’è”ç½‘ç¼–å¹´å²-sputnikâ€description: â€œäº’è”ç½‘ç¼–å¹´å²-sputnikâ€tag: â€œsputnikâ€date: â€œ2018-10-09 00:00:00 +0800â€ categories: â€œnetâ€ ç¬¬ä¸€é¢—äººé€ å«æ˜Ÿçš„å‘å°„æˆåŠŸï¼Œç›´æ¥å¯¼è‡´äº†å†·æˆ˜æ—¶æœŸç¾ä¿„ä¸¤å›½çš„å¤ªç©ºç«èµ› &emsp;1957å¹´è‹è”å‘å°„äº†äººç±»ç¬¬ä¸€é¢—äººé€ å«æ˜Ÿâ€Sputnikâ€ã€‚ &emsp;åœ¨Sputnikè¿›å…¥å¤ªç©ºä¹‹åçš„60å¹´é—´ï¼Œäººé€ å«æ˜Ÿåœ¨ç§‘å­¦ã€å†›äº‹å’Œæ°‘ç”Ÿç­‰å„ä¸ªæ–¹é¢éƒ½è·å¾—äº†æå…¶å¹¿æ³›çš„åº”ç”¨ï¼Œå¯¹äººç±»é€šè®¯æ–¹å¼å¸¦æ¥äº†é¢ è¦†æ€§çš„å½±å“ï¼Œæ­å¼€å¹¶æ·±åŒ–äº†å†·æˆ˜ï¼Œå‚¬ç”Ÿäº†äº’è”ç½‘ï¼Œè¿›è€Œå½»åº•æ”¹å˜äº†äººä»¬è®¤è¯†è‡ªæˆ‘ã€è§‚çœ‹ä¸–ç•Œçš„æ–¹å¼ã€‚ &emsp;1958å¹´ç¾å›½æˆåŠŸå‘å°„äº†è‡ªå·±çš„ç¬¬ä¸€é¢—äººé€ å«æ˜ŸExplorer Iã€‚ä½†é‚£ä¸ªæ—¶å€™ï¼Œé©±åŠ¨å¤§å›½å¤ªç©ºæ¢ç´¢é¡¹ç›®çš„åŠ¨åŠ›ä¸æ˜¯æ¢ç´¢ï¼Œè€Œæ˜¯æ„è¯†å½¢æ€ç«äº‰å’Œå›½å®¶è£èª‰ã€‚Sputnik çš„æ”¿æ²»æ„ä¹‰å¾ˆæ¸…æ¥šçš„ä¸€ç‚¹æ˜¯ï¼š åœ¨å®ƒä¹‹å‰ï¼Œæ²¡äººæƒ³ç€å¤ªç©ºç«èµ›ã€‚ &emsp;ç¾å›½å›½ä¼šåœ¨ 1958 å¹´ 1æœˆé€šè¿‡äº†å¤ªç©ºè¡ŒåŠ¨è®¡åˆ’ï¼ŒåŒå¹´ 10 æœˆ 1 æ—¥ NASA è¯ç”Ÿã€‚ &emsp;Sputnikçš„å‡ç©ºä¸ä»…ä»…æ ‡å¿—ç€äººç±»ç¬¬ä¸€é¢—äººé€ å«æ˜Ÿçš„å‡ç©ºï¼Œè¿™æ¿€å‘äº†ç¾å›½æƒ³è¦åœ¨ç™»æœˆè®¡åˆ’ä¸­é¢†å…ˆçš„å†³å¿ƒï¼Œæˆ–è®¸å¯ä»¥è¯´å¦‚æœæ²¡æœ‰æœ€åˆè‹è”çš„é‚£é¢—äººé€ å«æ˜Ÿï¼Œç¾å›½çš„é˜¿æ³¢ç½—è®¡åˆ’ä¸ä¼šè¿™ä¹ˆå¿«å®ç°ï¼Œå¤§å›½è¿›è¡Œå¤ªç©ºæ¢ç´¢çš„åŠ¨åŠ›ä¹Ÿä¸ä¼šè¿™ä¹ˆè¶³ã€‚ &emsp;1961å¹´4æœˆ12æ—¥ï¼Œè‹è”äººåŠ åŠ æ—ä¹˜åä¸œæ–¹ 1 å·å®‡å®™é£èˆ¹èŠ±äº† 1 å°æ—¶ 48 åˆ†ï¼Œç»•ç€åœ°çƒé£äº†ä¸€åœˆï¼Œå®Œæˆäº†äººç±»å†å²ä¸Šç¬¬ä¸€æ¬¡å®‡å®™é£è¡Œã€‚ &emsp;1969å¹´7æœˆ20æ—¥ï¼Œé˜¿æ³¢ç½—11å·ç¬¬5æ¬¡è½½äººä»»åŠ¡ï¼Œä¹Ÿæ˜¯äººç±»çš„ç¬¬ä¸€æ¬¡ç™»æœˆã€‚ &emsp;è¿™ä¸€ç³»åˆ—çš„å¤ªç©ºå¯¹æŠ—å¼•å‘äº†ç¾å›½å¯¹ç§‘æŠ€æ•™è‚²çš„å€¾æ–œï¼Œç¾å›½ã€Šå›½é˜²æ•™è‚²æ³•ã€‹é€šè¿‡åï¼Œå›½å®¶æ‹¨äº†å‡ åäº¿ç¾å…ƒï¼Œè®©ä¸»ä¿®æ•°å­¦ã€å·¥ç¨‹å’Œç§‘å­¦çš„å­¦ç”Ÿäº«å—ä½åˆ©ç‡çš„è´·æ¬¾ï¼Œåˆ° 1968 å¹´ï¼Œå›½å®¶ç§‘å­¦åŸºé‡‘ä¼šçš„é¢„ç®—ä» 10 å¹´å‰çš„ 3400 ä¸‡ç¾å…ƒå¢é•¿åˆ° 5 äº¿ç¾å…ƒã€‚ é€šè®¯å«æ˜Ÿä¿ƒè¿›äº†å…¨çƒåŒ–ï¼Œå¹¶æ”¹å˜äº†äººä»¬è§‚çœ‹è‡ªæˆ‘ã€è§‚çœ‹ä¸–ç•Œçš„æ–¹å¼ &emsp;NASA åœ¨æˆç«‹ 2 å¹´åç»ˆäºå‘å°„äº†ç¬¬ä¸€é¢—ä¸“é—¨ç”¨äºå…¨çƒé€šä¿¡çš„äººé€ å«æ˜Ÿâ€œå›å£° 1 å·â€ï¼Œè¿™æ˜¯ä¸€ä¸ªç›´å¾„ 30 ç±³çš„å¤§æ°”çƒï¼Œè¡¨é¢é•€é“ï¼Œåªèƒ½åå°„åœ°é¢ç”µç£ä¿¡å·ï¼Œä½†æ²¡æœ‰æ”¾å¤§å’ŒæŒ‡å‘ä½œç”¨ï¼Œå› å—åˆ°é™¨çŸ³æ’å‡»ï¼Œä¸ä¹…å°±çˆ†æ¯äº†ã€‚ &emsp;è€Œç¾å›½ç¬¬ä¸€é¢—çœŸæ­£æœ‰å®ç”¨ä»·å€¼çš„æ°‘ç”¨é€šä¿¡å«æ˜Ÿï¼Œæ˜¯ NASA åœ¨ 1962 å¹´ 7 æœˆ 10 æ—¥ä¸ºç¾å›½ç”µè¯ç”µæŠ¥å…¬å¸å‘å°„çš„â€œç”µæ˜Ÿå·â€ï¼Œé€ ä»· 100 ä¸‡ç¾å…ƒï¼Œå¯ä»¥åœ¨ç¾å›½ç¼…å› å·ä¸œéƒ¨çš„å®‰å¤šä½›åœ°é¢ç«™å’Œè®¾åœ¨è‹±å›½çš„è´¡å¸Œåˆ©é•‡å’Œæ³•å›½è²å°¼æ–¯æ³°å°”çœæ™®å‹’é»˜â€”â€”åšå¤šçš„æ¬§æ´²ç«™ä¹‹é—´ï¼Œä¼ é€å¤šè·¯ç”µè¯é€šä¿¡å’Œç”µè§†å›¾åƒã€‚ &emsp;ç°ä»£äº’è”ç½‘çš„é›å½¢ï¼Œæºè‡ªç¾ä¿„å†·æˆ˜æ—¶æœŸçš„å¤ªç©ºç«èµ›ã€‚åœ¨â€œå®³æ€•æ ¸æˆ˜äº‰çš„äººä»¬ï¼Œå¦‚ä½•åœ¨å†·æˆ˜æœŸé—´æ¨åŠ¨äº†äº’è”ç½‘çš„è¯ç”Ÿâ€è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæœ‰è¿‡è¯¦ç»†çš„è§£è¯»ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœä¸æ˜¯å†›é˜Ÿæœ‰å‘åŠ¨æˆ˜äº‰çš„éœ€æ±‚ï¼Œäº’è”ç½‘å¾ˆå¯èƒ½å°±ä¸ä¼šè¯ç”Ÿã€‚æˆ–è€…ä¸ä¼šè¯ç”Ÿåœ¨ç¾å›½å›½é˜²éƒ¨é«˜çº§ç ”ç©¶è®¡åˆ’å±€ï¼ˆAdvanced Research Projects Agencyï¼Œç®€ç§° ARPAï¼‰æ‰‹ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ 1958 å¹´å»ºç«‹çš„ï¼Œæ—¨åœ¨å¸®åŠ©ç¾å›½åœ¨å¤ªç©ºç«èµ›ä¸­èµ¶è¶…è‹è”çš„ç»„ç»‡ã€‚ &emsp;å¦‚ä»Šï¼Œå…¨çƒäº’è”ç½‘çš„ç”¨æˆ·æ•°å·²ç»çªç ´ 30 äº¿ã€‚","categories":[],"tags":[],"keywords":[]},{"title":"git workflow","slug":"2018-08-21-git_workflow","date":"2018-08-21T09:30:00.000Z","updated":"2020-01-03T09:35:02.423Z","comments":true,"path":"2018/08/21/2018-08-21-git_workflow/","link":"","permalink":"/2018/08/21/2018-08-21-git_workflow/","excerpt":"Gitä¸SVNçš„æ¯”è¾ƒåŸç†ä¸Š Gitç›´æ¥è®°å½•æ–‡ä»¶å¿«ç…§ï¼ŒSVNæ¯æ¬¡æäº¤è®°å½•å“ªäº›æ–‡ä»¶æ›´æ–°æ›´æ–°äº†å“ªäº›è¡Œ Gitæœ‰æœ¬åœ°ä»“åº“ï¼ŒSVNæ²¡æœ‰æœ¬åœ°ä»“åº“ Gitå¤§å¤šæ•°æ˜¯æœ¬åœ°æ“ä½œï¼ŒSVNå¤§å¤šæ•°æ“ä½œéœ€è¦è”ç½‘ æ“ä½œä¸Š Gitå…ˆæäº¤åˆ°æœ¬åœ°ä»“åº“ç„¶åæ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ŒSVNç›´æ¥æ¨é€åˆ°è¿œç¨‹ä»“åº“ Gitæœ‰å„ç§â€åæ‚”â€æŒ‡ä»¤ï¼ŒSVNæ²¡æœ‰ Gitæœ‰çœŸæ­£çš„branchï¼Œè€ŒSVNåªæ˜¯å·¥ä½œç©ºé—´çš„å‰¯æœ¬","text":"Gitä¸SVNçš„æ¯”è¾ƒåŸç†ä¸Š Gitç›´æ¥è®°å½•æ–‡ä»¶å¿«ç…§ï¼ŒSVNæ¯æ¬¡æäº¤è®°å½•å“ªäº›æ–‡ä»¶æ›´æ–°æ›´æ–°äº†å“ªäº›è¡Œ Gitæœ‰æœ¬åœ°ä»“åº“ï¼ŒSVNæ²¡æœ‰æœ¬åœ°ä»“åº“ Gitå¤§å¤šæ•°æ˜¯æœ¬åœ°æ“ä½œï¼ŒSVNå¤§å¤šæ•°æ“ä½œéœ€è¦è”ç½‘ æ“ä½œä¸Š Gitå…ˆæäº¤åˆ°æœ¬åœ°ä»“åº“ç„¶åæ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ŒSVNç›´æ¥æ¨é€åˆ°è¿œç¨‹ä»“åº“ Gitæœ‰å„ç§â€åæ‚”â€æŒ‡ä»¤ï¼ŒSVNæ²¡æœ‰ Gitæœ‰çœŸæ­£çš„branchï¼Œè€ŒSVNåªæ˜¯å·¥ä½œç©ºé—´çš„å‰¯æœ¬ Gitflowå·¥ä½œæµGitflowä¸ºä¸åŒçš„åˆ†æ”¯åˆ†é…ä¸€ä¸ªå¾ˆæ˜ç¡®çš„è§’è‰²ï¼Œå¹¶å®šä¹‰åˆ†æ”¯ä¹‹é—´å¦‚ä½•å’Œä»€ä¹ˆæ—¶å€™è¿›è¡Œäº¤äº’ã€‚ å†å²åˆ†æ”¯developå’Œmasteræ˜¯ä¸¤ä¸ªå¸¸é©»åˆ†æ”¯ï¼Œmasteråˆ†æ”¯è®°å½•äº†æ­£å¼å‘å¸ƒçš„å†å²ï¼Œè€Œdevelopåˆ†æ”¯ä½œä¸ºåŠŸèƒ½çš„é›†æˆåˆ†æ”¯ã€‚å› æ­¤ï¼Œmasteråˆ†æ”¯çš„æ¯æ¬¡æäº¤éƒ½åº”åˆ†é…ä¸€ä¸ªç‰ˆæœ¬å·ã€‚ åŠŸèƒ½åˆ†æ”¯æ–°çš„åŠŸèƒ½åˆ†æ”¯åº”è¯¥ä»developåˆ†æ”¯è¿å‡ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œæ–°åŠŸèƒ½å¼€å‘å®Œæˆä¹‹åå†åˆå¹¶å›developåˆ†æ”¯ï¼Œå¸¸ç”¨å‘½ä»¤ï¼š å¼€å‘åŠŸèƒ½agit checkout -b feature-a develop å¼€å‘å®Œæˆååˆå¹¶å›developåˆ†æ”¯git checkout develop git merge --no-ff feature-a git push git branch -d feature-a å‘å¸ƒåˆ†æ”¯ å½“å¼€å‘å®Œæˆæ—¶ï¼Œç›´æ¥ä»developåˆ†æ”¯checkoutå‡ºreleaseåˆ†æ”¯git checkout -b release-0.1 develop releaseåˆ†æ”¯ç”¨äºå‘å¸ƒï¼Œå‘å¸ƒå®Œæˆåå°†releaseåˆ†æ”¯åˆå¹¶åˆ°masteråˆ†æ”¯å¹¶ä¸”æ‰“æ ‡ç­¾ï¼Œæ–¹ä¾¿åç»­è·Ÿè¸ªæ¯æ¬¡å‘å¸ƒã€‚`git checkout mastergit merge â€“no-ff release-0.1git push git tag -a 0.1 -m â€œrelease 0.1 publishâ€ mastergit push â€“tags #### ç»´æŠ¤åˆ†æ”¯/çƒ­ä¿®å¤ 1. ä»`master`åˆ†æ”¯æ‹‰å‡ºä¸€ä¸ª`hotfix`åˆ†æ”¯ç»´æŠ¤åˆ†æ”¯ç”¨äºbugä¿®å¤ã€å¿«é€Ÿç»™å‘å¸ƒç‰ˆæœ¬æ‰“è¡¥ä¸ git checkout -b hotfix master 2. bugä¿®å¤å®Œæˆç«‹å³åˆå›`master`åˆ†æ”¯å’Œ`develop`åˆ†æ”¯ï¼Œå®Œæˆç»´æŠ¤ååˆ é™¤`hotfix`åˆ†æ”¯ git checkout mastergit merge â€“no-ff hotfixgit push git checkout developgit merge â€“no-ff hotfixgit push git branch -d hotfix 3. `master`ä¸Šæ‰“æ–°tag git tag -a 0.2 -m â€œrelease 0.2 publishâ€ mastergit push â€“tags` ä¼˜ç‚¹ å•ä¸ªåŠŸèƒ½ç‹¬ç«‹å¼€å‘ï¼Œå¹¶è¡Œå¼€å‘äº’ä¸å¹²æ‰° masterå’Œdevelopåˆ†æ”¯åˆ†åˆ«è®°å½•å‘å¸ƒå’ŒåŠŸèƒ½å¼€å‘çš„å†å² ç”±äºæœ‰å‘å¸ƒåˆ†æ”¯ï¼Œå…¶ä»–æš‚ä¸å‘å¸ƒçš„åŠŸèƒ½çš„å¼€å‘ä¸å—å‘å¸ƒçš„å½±å“ï¼Œå¯ä»¥ç»§ç»­æäº¤ ç»´æŠ¤åˆ†æ”¯èƒ½å¿«é€Ÿæ‰“è¡¥ä¸ï¼Œä¸å½±å“æ­£åœ¨å¼€å‘çš„åŠŸèƒ½ ç¼ºç‚¹ å¤æ‚ï¼Œåˆ†æ”¯ç¹å¤š Git GUIä¸æ”¯æŒï¼Œçº¯å‘½ä»¤è¡Œ å¯¹å¼€å‘è€…è¦æ±‚é«˜ï¼ˆç†è§£å·¥ä½œæµï¼Œç†Ÿæ‚‰Gitå‘½ä»¤ï¼‰ æ‰€æœ‰åŠŸèƒ½åˆ†æ”¯åŸºäºä¸ç¨³å®šçš„develop éœ€è¦ç»´æŠ¤ä¸¤ä¸ªé•¿æœŸåˆ†æ”¯masterå’Œdevelop GitHub Flow æ‰€æœ‰åœ¨masterä¸Šçš„ä¸œè¥¿éƒ½æ˜¯å¯å‘å¸ƒçš„ï¼ˆå·²å‘å¸ƒæˆ–é©¬ä¸Šå‘å¸ƒï¼‰ å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼Œä»masteræ‹‰ä¸€ä¸ªåç§°æ¸…æ™°çš„æ–°åˆ†æ”¯ åœ¨æœ¬åœ°æäº¤åˆ°è¿™ä¸ªåˆ†æ”¯çš„åŒæ—¶æŠŠå®ƒpushåˆ°è¿œç¨‹ä»“åº“ å½“ä½ éœ€è¦å¾—åˆ°åé¦ˆæˆ–å¸®åŠ©ï¼Œæˆ–è€…è¯¥åˆ†æ”¯å‡†å¤‡mergeæ—¶ï¼Œæ‰“å¼€ä¸€ä¸ªpull request è¯¥åˆ†æ”¯è¢«reviewä¸”åŒæ„åˆå¹¶åï¼Œåˆå¹¶åˆ°master pushåˆ°masteråï¼Œåº”è¯¥ç«‹å³å‘å¸ƒ ä¼˜ç‚¹ æ“ä½œç®€å• ä¸»å¹²çš„ä»£ç æœ‰è´¨é‡ä¿è¯ ç¼ºç‚¹ æµ‹è¯•çº¿å’Œæ­£å¼ç¯å¢ƒçš„å‘å¸ƒæ²¡æœ‰åŒºåˆ† Git-DevelopGit-Developæ¨¡å¼å°†developåˆ†æ”¯ä½œä¸ºå›ºå®šçš„æŒç»­é›†æˆå’Œå‘å¸ƒåˆ†æ”¯ æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½ä»masteræ‹‰ä¸€ä¸ªåŠŸèƒ½åˆ†æ”¯ã€‚ åœ¨è¿™ä¸ªåŠŸèƒ½åˆ†æ”¯ä¸Šå¼€å‘ï¼ŒåŠŸèƒ½å®Œæˆåˆ°å‘å¸ƒæ—¶ï¼Œæäº¤code reviewï¼Œé€šè¿‡åè‡ªåŠ¨åˆå¹¶åˆ°developã€‚ å¾…æ‰€æœ‰è®¡åˆ’å‘å¸ƒçš„å˜æ›´åˆ†æ”¯ä»£ç éƒ½åˆå¹¶åˆ°developåï¼Œrebase masteråˆ°developï¼Œå®Œæˆå‘å¸ƒã€‚ åº”ç”¨å‘å¸ƒæˆåŠŸåæ‰“ä¸€ä¸ªtagã€‚ developåˆ†æ”¯çš„å‘å¸ƒç‰ˆæœ¬åˆå¹¶å›masterã€‚ ä¼˜ç‚¹ æ“ä½œç›¸å¯¹ç®€å• æµç¨‹ç¨ä½œæ”¹åŠ¨ï¼Œå³å¯åŒºåˆ†æµ‹è¯•çº¿å’Œæ­£å¼ç¯å¢ƒ æ¯æ¬¡å¼€å‘éƒ½åŸºäºæ­£å¼ç‰ˆæœ¬æœ€æ–°çš„ä»£ç ï¼ˆmaster)ï¼Œå’Œå½“å‰å¼€å‘çš„å…¶ä»–åˆ†æ”¯ä¸äº§ç”Ÿä¾èµ–å…³ç³» masterå§‹ç»ˆæ˜¯å·²å‘å¸ƒçŠ¶æ€ Pull RequestsPull requestsä¸æ˜¯ä¸€ç§å·¥ä½œæµï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½è®©å¼€å‘è€…æ›´æ–¹ä¾¿åœ°è¿›è¡Œåä½œçš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æè®®çš„ä¿®æ”¹åˆå¹¶åˆ°æ­£å¼é¡¹ç›®ä¹‹å‰å¯¹ä¿®æ”¹è¿›è¡Œè®¨è®ºã€‚ å¼€å‘è€…åœ¨æœ¬åœ°ä»“åº“æ–°å»ºä¸€ä¸ªåŠŸèƒ½åˆ†æ”¯ã€‚ åŠŸèƒ½å®Œæˆåï¼Œå¼€å‘è€…pushåˆ†æ”¯ä¿®æ”¹åˆ°è¿œç¨‹ä»“åº“ä¸­ã€‚ å¼€å‘è€…å‘èµ·Pull requestsã€‚ å›¢é˜Ÿæˆå‘˜æ”¶åˆ°é€šçŸ¥ï¼Œè¿›è¡Œcode reviewï¼Œè®¨è®ºå’Œä¿®æ”¹ã€‚ é¡¹ç›®ç»´æŠ¤è€…åˆå¹¶åŠŸèƒ½åˆ°ä»“åº“ä¸­å¹¶å…³é—­Pull Requestsã€‚","categories":[{"name":"vcs","slug":"vcs","permalink":"/categories/vcs/"}],"tags":[{"name":"git","slug":"git","permalink":"/tags/git/"}],"keywords":[{"name":"vcs","slug":"vcs","permalink":"/categories/vcs/"}]},{"title":"å…³äºTCPé‚£äº›äº‹ï¼ˆäºŒï¼‰","slug":"2018-08-20-something_about_tcp2","date":"2018-08-19T17:20:00.000Z","updated":"2020-01-03T09:55:50.201Z","comments":true,"path":"2018/08/20/2018-08-20-something_about_tcp2/","link":"","permalink":"/2018/08/20/2018-08-20-something_about_tcp2/","excerpt":"TCPé‡ä¼ æœºåˆ¶TCPç¡®è®¤æœºåˆ¶å±äºç´¯ç§¯ç¡®è®¤ï¼Œæ¥æ”¶ç«¯ç»™å‘é€ç«¯çš„Ackç¡®è®¤åªä¼šç¡®è®¤æœ€åä¸€ä¸ªè¿ç»­çš„åŒ…ï¼ŒSeqNumå’ŒAckæ˜¯ä»¥å­—èŠ‚æ•°ä¸ºå•ä½ï¼Œæ‰€ä»¥ackçš„æ—¶å€™ï¼Œä¸èƒ½è·³ç€ç¡®è®¤ï¼Œåªèƒ½ç¡®è®¤æœ€å¤§çš„è¿ç»­æ”¶åˆ°çš„åŒ…ï¼Œä¸ç„¶å‘é€ç«¯å°±ä»¥ä¸ºä¹‹å‰çš„éƒ½æ”¶åˆ°äº†ã€‚","text":"TCPé‡ä¼ æœºåˆ¶TCPç¡®è®¤æœºåˆ¶å±äºç´¯ç§¯ç¡®è®¤ï¼Œæ¥æ”¶ç«¯ç»™å‘é€ç«¯çš„Ackç¡®è®¤åªä¼šç¡®è®¤æœ€åä¸€ä¸ªè¿ç»­çš„åŒ…ï¼ŒSeqNumå’ŒAckæ˜¯ä»¥å­—èŠ‚æ•°ä¸ºå•ä½ï¼Œæ‰€ä»¥ackçš„æ—¶å€™ï¼Œä¸èƒ½è·³ç€ç¡®è®¤ï¼Œåªèƒ½ç¡®è®¤æœ€å¤§çš„è¿ç»­æ”¶åˆ°çš„åŒ…ï¼Œä¸ç„¶å‘é€ç«¯å°±ä»¥ä¸ºä¹‹å‰çš„éƒ½æ”¶åˆ°äº†ã€‚ è¶…æ—¶é‡ä¼ å‘é€ç«¯å‘äº†1,2,3,4,5ä¸€å…±äº”ä»½æ•°æ®ï¼Œæ¥æ”¶ç«¯æ”¶åˆ°äº†1ï¼Œ2ï¼Œäºæ˜¯å›ack 3ï¼Œç„¶åæ”¶åˆ°äº†4ï¼ˆæ³¨æ„æ­¤æ—¶3æ²¡æ”¶åˆ°ï¼‰ã€‚è¿™ç§æ–¹å¼å‘é€ç«¯ä¼šå› ä¸ºæ²¡æœ‰æ”¶åˆ°3çš„ACKé‡ä¼ ï¼Œä¸€æ—¦æ”¶åˆ°3åä¼šACK4ï¼Œæ„å‘³ç€3ã€4éƒ½æ”¶åˆ°äº†ã€‚ä½†æ˜¯è¿™ç§å½“æ—¶æœ‰å¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚æœæ²¡æ”¶åˆ°3å°±ä¼šæ­»ç­‰3ï¼Œå³ä½¿4ã€5éƒ½æ”¶åˆ°äº†å‘é€ç«¯ä¹Ÿä¸çŸ¥é“ï¼Œå› ä¸ºæ²¡æœ‰æ”¶åˆ°å›å¤ã€‚è¿™å¯èƒ½åˆ°ä¼šæ–¹ç«¯æ‚²è§‚çš„è®¤ä¸º4ã€5éƒ½æ²¡æœ‰æ”¶åˆ°è€Œå¯¼è‡´é‡ä¼ ã€‚ å°±ä¼šæœ‰ä¸¤ç§é€‰æ‹©: åªé‡ä¼ timeoutçš„åŒ… é‡ä¼ timeoutåçš„æ‰€æœ‰çš„åŒ… ç¬¬ä¸€ç§èŠ‚çœå¸¦å®½ä½†æ˜¯æ…¢ï¼Œç¬¬äºŒç§å¿«ä½†æ˜¯æµªè´¹å¸¦å®½ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´ä¸¤ç§éƒ½ä¸æ˜¯æœ€å¥½çš„æ–¹å¼ã€‚ å¿«é€Ÿé‡ä¼ TCPæœ‰Fast Retransmitå¿«é€Ÿé‡ä¼ æœºåˆ¶ï¼Œä¸ä»¥æ—¶é—´é©±åŠ¨ï¼Œä»¥æ•°æ®é©±åŠ¨é‡ä¼ ã€‚åŒ…æ²¡æœ‰è¿ç»­åˆ°è¾¾å°±ACKæœ€åé‚£ä¸ªè¿ç»­çš„åŒ…ï¼Œå‘é€æ–¹å¦‚æœè¿ç»­3æ¬¡æ”¶åˆ°ç›¸åŒçš„ACKå°±é‡ä¼ è¯¥åŒ…ï¼Œå¿«é€Ÿé‡ä¼ çš„å¥½å¤„åœ¨äºä¸ç”¨ç­‰å¾…timeoutã€‚ä½†æ˜¯å¿«é€Ÿé‡ä¼ åªæ˜¯è§£å†³ä¸€ä¸ªé—®é¢˜é‚£å°±æ˜¯timeouté—®é¢˜ï¼Œä½†æ˜¯ä¾ç„¶é¢ä¸´è¿™ä¸ªè‰°éš¾çš„é€‰æ‹©ï¼Œå°±æ˜¯åªé‡ä¼ è¶…æ—¶çš„é‚£ä¸€ä¸ªåŒ…è¿˜æ˜¯é‡ä¼ æ‰€æœ‰åŒ…ã€‚ SACKæ–¹æ³•å¦ä¸€ç§é€‰æ‹©æ˜¯Selective Acknowledgment (SACK)ï¼Œè¿™ä¸ªéœ€è¦åœ¨TCPå¤´åŠ ä¸Šä¸€ä¸ªSACKï¼ŒACKè¿˜æ˜¯å¿«é€Ÿé‡ä¼ ï¼ŒSACKåˆ™æ˜¯æ±‡æŠ¥æ”¶åˆ°çš„æ•°æ®ç¢ç‰ˆã€‚ è¿™æ ·å°±çŸ¥é“å“ªäº›æ•°æ®æ”¶åˆ°äº†å“ªäº›æ²¡æœ‰æ”¶åˆ°ï¼Œè¿™æ ·å°±ä¼˜åŒ–äº†å¿«é€Ÿé‡ä¼ ç®—æ³•ï¼Œä½†æ˜¯éœ€è¦ä¸¤è¾¹éƒ½æ”¯æŒåœ¨ Linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡tcp_sackå‚æ•°æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4åé»˜è®¤æ‰“å¼€ï¼‰ã€‚ è¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š æ¥æ”¶æ–¹Renegingï¼Œæ‰€è°“Renegingçš„æ„æ€å°±æ˜¯æ¥æ”¶æ–¹æœ‰æƒæŠŠå·²ç»æŠ¥ç»™å‘é€ç«¯SACKé‡Œçš„æ•°æ®ç»™ä¸¢äº†ã€‚è¿™æ ·å¹²æ˜¯ä¸è¢«é¼“åŠ±çš„ï¼Œå› ä¸ºè¿™ä¸ªäº‹ä¼šæŠŠé—®é¢˜å¤æ‚åŒ–äº†ï¼Œä½†æ˜¯ï¼Œæ¥æ”¶æ–¹è¿™ä¹ˆåšå¯èƒ½ä¼šæœ‰äº›æç«¯æƒ…å†µï¼Œæ¯”å¦‚è¦æŠŠå†…å­˜ç»™åˆ«çš„æ›´é‡è¦çš„ä¸œè¥¿ã€‚ å‘é€æ–¹ä¹Ÿä¸èƒ½å®Œå…¨ä¾èµ–SACKï¼Œè¿˜æ˜¯è¦ä¾èµ–ACKï¼Œå¹¶ç»´æŠ¤Time-Outï¼Œå¦‚æœåç»­çš„ACKæ²¡æœ‰å¢é•¿ï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦æŠŠSACKçš„ä¸œè¥¿é‡ä¼ ï¼Œå¦å¤–ï¼Œæ¥æ”¶ç«¯è¿™è¾¹æ°¸è¿œä¸èƒ½æŠŠSACKçš„åŒ…æ ‡è®°ä¸ºAckã€‚ æ³¨æ„ï¼šSACKä¼šæ¶ˆè´¹å‘é€æ–¹çš„èµ„æºï¼Œè¯•æƒ³ï¼Œå¦‚æœä¸€ä¸ªæ”»å‡»è€…ç»™æ•°æ®å‘é€æ–¹å‘ä¸€å †SACKçš„é€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´å‘é€æ–¹å¼€å§‹è¦é‡ä¼ ç”šè‡³éå†å·²ç»å‘å‡ºçš„æ•°æ®ï¼Œè¿™ä¼šæ¶ˆè€—å¾ˆå¤šå‘é€ç«¯çš„èµ„æºã€‚è¯¦ç»†çš„ä¸œè¥¿è¯·å‚çœ‹ã€ŠTCP ACKçš„æ€§èƒ½æƒè¡¡ã€‹ Duplicate SACK â€“ é‡å¤æ”¶åˆ°æ•°æ®çš„é—®é¢˜Duplicate SACKåˆç§°D-SACKï¼Œå…¶ä¸»è¦ä½¿ç”¨äº†SACKæ¥å‘Šè¯‰å‘é€æ–¹æœ‰å“ªäº›æ•°æ®è¢«é‡å¤æ¥æ”¶äº†ã€‚ D-SACKä½¿ç”¨äº†SACKçš„ç¬¬ä¸€ä¸ªæ®µæ¥åšæ ‡å¿—ï¼š å¦‚æœSACKçš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢«ACKæ‰€è¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯D-SACK å¦‚æœSACKçš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢«SACKçš„ç¬¬äºŒä¸ªæ®µè¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯D-SACK","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"tcp","slug":"tcp","permalink":"/tags/tcp/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"å…³äºTCPé‚£äº›äº‹ï¼ˆä¸€ï¼‰","slug":"2018-08-19-something_about_tcp1","date":"2018-08-19T15:20:00.000Z","updated":"2020-01-03T09:55:50.256Z","comments":true,"path":"2018/08/19/2018-08-19-something_about_tcp1/","link":"","permalink":"/2018/08/19/2018-08-19-something_about_tcp1/","excerpt":"TCPå¤´æ ¼å¼ éœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š TCPåŒ…æ²¡æœ‰IPåœ°å€ï¼Œé‚£æ˜¯IPå±‚çš„äº‹ã€‚åªæœ‰æºç«¯å£å’Œç›®æ ‡ç«¯å£ã€‚ ä¸€ä¸ªTCPè¿æ¥éœ€è¦å››ä¸ªå…ƒç»„æ¥è¡¨ç¤ºæ˜¯åŒä¸€ä¸ªè¿æ¥ï¼ˆsrc_ip, src_port, dst_ip, dst_portï¼‰å‡†ç¡®è¯´æ˜¯äº”å…ƒç»„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åè®®ã€‚ä½†å› ä¸ºè¿™é‡Œåªæ˜¯è¯´TCPåè®®ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘åªè¯´å››å…ƒç»„ã€‚ Sequence Numberæ˜¯åŒ…çš„åºå·ï¼Œç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºï¼ˆreorderingï¼‰é—®é¢˜ã€‚ Acknowledgement Numberå°±æ˜¯ACKâ€”â€”ç”¨äºç¡®è®¤æ”¶åˆ°ï¼Œç”¨æ¥è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜ã€‚ Windowåˆå«Advertised-Windowï¼Œä¹Ÿå°±æ˜¯è‘—åçš„æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰ï¼Œç”¨äºè§£å†³æµæ§ã€‚ TCP Flagï¼ŒåŒ…ç±»å‹ï¼Œç”¨äºæ§åˆ¶TCPçŠ¶æ€æœºã€‚","text":"TCPå¤´æ ¼å¼ éœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š TCPåŒ…æ²¡æœ‰IPåœ°å€ï¼Œé‚£æ˜¯IPå±‚çš„äº‹ã€‚åªæœ‰æºç«¯å£å’Œç›®æ ‡ç«¯å£ã€‚ ä¸€ä¸ªTCPè¿æ¥éœ€è¦å››ä¸ªå…ƒç»„æ¥è¡¨ç¤ºæ˜¯åŒä¸€ä¸ªè¿æ¥ï¼ˆsrc_ip, src_port, dst_ip, dst_portï¼‰å‡†ç¡®è¯´æ˜¯äº”å…ƒç»„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åè®®ã€‚ä½†å› ä¸ºè¿™é‡Œåªæ˜¯è¯´TCPåè®®ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘åªè¯´å››å…ƒç»„ã€‚ Sequence Numberæ˜¯åŒ…çš„åºå·ï¼Œç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºï¼ˆreorderingï¼‰é—®é¢˜ã€‚ Acknowledgement Numberå°±æ˜¯ACKâ€”â€”ç”¨äºç¡®è®¤æ”¶åˆ°ï¼Œç”¨æ¥è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜ã€‚ Windowåˆå«Advertised-Windowï¼Œä¹Ÿå°±æ˜¯è‘—åçš„æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰ï¼Œç”¨äºè§£å†³æµæ§ã€‚ TCP Flagï¼ŒåŒ…ç±»å‹ï¼Œç”¨äºæ§åˆ¶TCPçŠ¶æ€æœºã€‚ TCPçš„çŠ¶æ€æœºTCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹ ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥éœ€è¦3æ¬¡æ¡æ‰‹ï¼Œæ–­å¼€éœ€è¦4æ¬¡æŒ¥æ‰‹ï¼š å¯¹äº3æ¬¡æ¡æ‰‹ï¼Œä¸»è¦æ˜¯åˆå§‹åŒ–Sequence Numberï¼ŒåŒæ–¹éœ€è¦äº’é€šåŒæ–¹çš„åˆå§‹åŒ–Sequence Numberä»¥åŠMSSï¼ˆæœ€å¤§æŠ¥æ–‡é•¿åº¦ï¼‰ã€WSOPTï¼ˆçª—å£æ¯”ä¾‹å› å­ï¼‰ç­‰ç­‰ï¼Œè¿™å°±æ˜¯å«SYNè€Œä¸æ˜¯CONNECTåŸå› ï¼Œå¹¶ä¸”ä¸‰æ¬¡æ¡æ‰‹æ­£å¥½åŒæ–¹éƒ½å¯¹å¯¹æ–¹çš„æŠ¥æ–‡è¿›è¡Œäº†ä¸€æ¬¡æ”¶å‘æ“ä½œï¼Œè¯´æ˜åŒæ–¹éƒ½å¤„äºå¯ç”¨çŠ¶æ€ã€‚å››æ¬¡æˆ–æ›´å¤šæ¬¡å…¶å®ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯æ²¡æœ‰å¿…è¦å› ä¸ºæ¥ä¸‹æ¥å°±è¦å¼€å§‹æ•°æ®å‘é€ï¼Œåªè¦æœ‰æ•°æ®å‘é€å°±è¯´æ˜è¿æ¥æ˜¯æ­£å¸¸çš„ å››æ¬¡æŒ¥æ‰‹ï¼Œå…¶å®ä»”ç»†çœ‹æ˜¯2æ¬¡æŒ¥æ‰‹ï¼Œå› ä¸ºTCPæ˜¯å…¨åŒå·¥çš„ï¼Œå‘é€æ–¹å’Œæ¥å—æ–¹éƒ½éœ€è¦Finå’ŒAckã€‚å› ä¸ºæœ‰ä¸€æ–¹æ˜¯è¢«åŠ¨çš„ï¼Œæ‰€ä»¥çœ‹ä¸Šå»å°±æˆäº†æ‰€è°“çš„4æ¬¡æŒ¥æ‰‹ï¼Œå¦‚æœä¸¤è¾¹åŒæ—¶æ–­å¼€è¿æ¥éƒ½ä¼šå…ˆè¿›å…¥CLOSINGçŠ¶æ€ï¼Œç„¶ååˆ°TIME_WAITã€‚ è¿æ¥æ—¶çš„SYNè¶…æ—¶ï¼Œå¦‚æœæœåŠ¡ç«¯å‘é€SYN-ACKåClientæ‰çº¿ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šå¤„äºä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œè¿æ¥æ—¢æ²¡æœ‰æˆåŠŸä¹Ÿæ²¡æœ‰å¤±è´¥ã€‚æœåŠ¡ç«¯ä¼šå› ä¸ºè¶…æ—¶é‡ä¼ ï¼ŒLinuxä¸‹é»˜è®¤é‡è¯•æ¬¡æ•°ä¸º5æ¬¡æ—¶é—´é—´éš”ä»1så¼€å§‹æ¯æ¬¡ç¿»å€ï¼Œæ‰€ä»¥éœ€è¦2^6-1=63sæ‰ä¼šæ–­å¼€è¿™ä¸ªè¿æ¥ã€‚ SYN Floodæ”»å‡»ï¼Œå¯ä»¥é€šè¿‡åªå‘é€SYNå°±ä¸‹çº¿æœåŠ¡ç«¯å°±éœ€è¦ç­‰å¾…63sæ‰ä¼šæ–­å¼€è¿æ¥ï¼Œæ”»å‡»è€…å¯ä»¥å¾ˆå¿«æŠŠæœåŠ¡ç«¯SYNè¿æ¥è€—å°½ã€‚ tcp_syncookiesçš„å‚æ•°æ¥åº”å¯¹è¿™ä¸ªäº‹â€”â€”å½“SYNé˜Ÿåˆ—æ»¡äº†åï¼ŒTCPä¼šé€šè¿‡æºåœ°å€ç«¯å£ã€ç›®æ ‡åœ°å€ç«¯å£å’Œæ—¶é—´æˆ³æ‰“é€ å‡ºä¸€ä¸ªç‰¹åˆ«çš„Sequence Numberå‘å›å»ï¼ˆåˆå«cookieï¼‰ï¼Œå¦‚æœæ˜¯æ”»å‡»è€…åˆ™ä¸ä¼šæœ‰å“åº”ï¼Œå¦‚æœæ˜¯æ­£å¸¸è¿æ¥ï¼Œåˆ™ä¼šæŠŠè¿™ä¸ª SYN Cookieå‘å›æ¥ï¼Œç„¶åæœåŠ¡ç«¯å¯ä»¥é€šè¿‡cookieå»ºè¿æ¥ï¼ˆå³ä½¿ä½ ä¸åœ¨SYNé˜Ÿåˆ—ä¸­ï¼‰ã€‚è¯·æ³¨æ„ï¼Œè¯·å…ˆåƒä¸‡åˆ«ç”¨tcp_syncookiesæ¥å¤„ç†æ­£å¸¸çš„å¤§è´Ÿè½½çš„è¿æ¥çš„æƒ…å†µã€‚å› ä¸ºï¼Œsynccookiesæ˜¯å¦¥åç‰ˆçš„TCPåè®®ï¼Œå¹¶ä¸ä¸¥è°¨ã€‚ tcp_synack_retriesï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°è®¾ç½®SYNACKé‡è¯•æ¬¡æ•°ã€‚ tcp_max_syn_backlogï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°å¢åŠ SYNè¿æ¥æ•°ã€‚ tcp_abort_on_overflowï¼Œè®¾ç½®è¿™ä¸ªå‚æ•°å¤„ç†ä¸è¿‡æ¥å°±ç›´æ¥æ‹’ç»ã€‚ ISNçš„åˆå§‹åŒ–ï¼Œå¦‚æœè¿æ¥å»ºå¥½åå§‹ç»ˆç”¨1æ¥åšISNï¼Œå¦‚æœclientå‘äº†30ä¸ªsegmentè¿‡å»ï¼Œä½†æ˜¯ç½‘ç»œæ–­äº†ï¼Œäºæ˜¯ clienté‡è¿ï¼Œåˆç”¨äº†1åšISNï¼Œä½†æ˜¯ä¹‹å‰è¿æ¥çš„é‚£äº›åŒ…åˆ°äº†ï¼Œäºæ˜¯å°±è¢«å½“æˆäº†æ–°è¿æ¥çš„åŒ…ï¼Œæ­¤æ—¶ï¼Œclientçš„Sequence Number å¯èƒ½æ˜¯3ï¼Œè€ŒServerç«¯è®¤ä¸ºclientç«¯çš„è¿™ä¸ªå·æ˜¯30äº†ã€‚RFC793ä¸­è¯´äº†ISNå’Œä¸€ä¸ªå‡æ—¶é’Ÿç»‘å®šï¼Œæ¯4å¾®å¦™åŠ ä¸€ç›´åˆ°è¶…è¿‡2^32ä¸€ä¸ªISNå‘¨æœŸå¤§çº¦éœ€è¦4.55å°æ—¶ï¼Œä¸€ä¸ªåŒ…åœ¨ç½‘ç»œä¸Šå­˜æ´»æ—¶é—´ä¸ä¼šè¶…è¿‡MSLï¼Œæ‰€ä»¥åªè¦MSLå°äº4.55å°æ—¶å°±ä¸ä¼šé‡ç”¨ISNã€‚ MSLå’ŒTIME_WAIT,ä¸ºä»€ä¹ˆTIME_WAITæ˜¯2MSLï¼Ÿ ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ—¶é—´è®©å¯¹æ–¹æ”¶åˆ°ACKï¼Œå¦‚æœè¢«åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹æ²¡æœ‰æ”¶åˆ°ACKå°±ä¼šè§¦å‘è¢«åŠ¨æ–¹é‡å‘FINï¼Œä¸€æ¥ä¸€å›æœ€å¤§æ­£å¥½æ˜¯2MSL æœ‰è¶³å¤Ÿçš„æ—¶é—´è®©è¿™ä¸ªè¿æ¥ä¸å’Œåé¢æ–°å»ºç«‹çš„è¿æ¥æ··åœ¨ä¸€æ¬¡ï¼Œå¦‚æœè¿æ¥è¢«é‡ç”¨å»¶è¿Ÿæ”¶åˆ°çš„åŒ…å¯èƒ½ä¼šå’Œæ–°è¿æ¥æ··åœ¨ä¸€èµ·ã€‚ TIME_WAITè¿‡å¤šï¼Œåœ¨å¤§é‡å¹¶å‘çŸ­è¿æ¥çš„æƒ…å†µä¸‹å°±å¯èƒ½å‡ºç°å¤§é‡TIME_WAITï¼Œä¿®æ”¹tcp_tw_reuseä¸tcp_tw_recycle,è¿™ä¸¤ä¸ªå‚æ•°é»˜è®¤æ˜¯å…³é—­çš„ã€‚ tcp_tw_reuseåŠ ä¸Štcp_timestampså¯ä»¥ä¿è¯åè®®è§’åº¦ä¸Šçš„å®‰å…¨ï¼Œtcp_tw_reuseåªå¯¹å®¢æˆ·ç«¯æœ‰æ•ˆå¯¹æœåŠ¡ç«¯æ— æ•ˆï¼Œtcp_timestampséœ€è¦åŒæ–¹éƒ½æ‰“å¼€ï¼Œå¦åˆ™é»˜å†™åœºæ™¯å¯èƒ½è¿˜æ˜¯ä¼šæœ‰é—®é¢˜ã€‚ tcp_tw_recycleé»˜è®¤è®¤ä¸ºå¯¹ç«¯å·²ç»å¼€å¯tcp_timestampsï¼Œæ¯”è¾ƒæ—¶é—´æˆ³å˜å¤§äº†å°±å¯ä»¥é‡ç”¨ã€‚ä½†æ˜¯å¦‚æœå¯¹ç«¯æ˜¯NATç½‘æˆ–è€…IPè¢«å¦ä¸€å°ç”µè„‘é‡ç”¨ï¼Œé€šå¸¸æœåŠ¡å™¨ä¹Ÿæ˜¯åœ¨è´Ÿè½½åé¢è´Ÿè½½ä¼šæŠŠ timestamp éƒ½ç»™æ¸…ç©ºï¼Œè¿™ä¸ªæ—¶å€™æƒ…å†µå°±å¤æ‚äº†ã€‚ tcp_max_tw_bucketsï¼Œæ§åˆ¶å¹¶å‘TIME_WAITæ•°é»˜è®¤æ˜¯180000,é»˜è®¤è¶…å‡ºé™åˆ¶ä¼šæŠŠå¤šçš„destoryæ‰ç„¶åæ‰“time wait bucket table overflowï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°æŠ—DDosæ”»å‡»ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´å¤§å°ã€‚ tcp_tw_reuseå’Œtcp_tw_recycleæ¥è§£å†³TIME_WAITçš„é—®é¢˜æ˜¯éå¸¸éå¸¸å±é™©çš„ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‚æ•°è¿åäº†TCPåè®®","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"tcp","slug":"tcp","permalink":"/tags/tcp/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"çªç ´ç®—æ³•ä¹‹-æ’åˆ—ç»„åˆ","slug":"2018-08-19-permutation_algorithms","date":"2018-08-18T18:00:00.000Z","updated":"2020-01-03T10:12:29.179Z","comments":true,"path":"2018/08/19/2018-08-19-permutation_algorithms/","link":"","permalink":"/2018/08/19/2018-08-19-permutation_algorithms/","excerpt":"ç®—æ³•åŸç†æ€è·¯æ˜¯å¼€ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸‹æ ‡è¡¨ç¤º1åˆ°nä¸ªæ•°ï¼Œæ•°ç»„å…ƒç´ çš„å€¼ä¸º1è¡¨ç¤ºå…¶ä¸‹æ ‡ä»£è¡¨çš„æ•°è¢«é€‰ä¸­ï¼Œä¸º0åˆ™æ²¡é€‰ä¸­ã€‚é¦–å…ˆåˆå§‹åŒ–ï¼Œå°†æ•°ç»„å‰mä¸ªå…ƒç´ ç½®1ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªç»„åˆä¸ºå‰mä¸ªæ•°ã€‚ç„¶åä»å·¦åˆ°å³æ‰«ææ•°ç»„å…ƒç´ å€¼çš„â€10â€ç»„åˆï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªâ€10â€ç»„åˆåå°†å…¶å˜ä¸ºâ€œ01â€ç»„åˆï¼ŒåŒæ—¶å°†å…¶å·¦è¾¹çš„æ‰€æœ‰â€1â€å…¨éƒ¨ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å·¦ç«¯ã€‚å½“ç¬¬ä¸€ä¸ªâ€1â€ç§»åŠ¨åˆ°æ•°ç»„çš„m-nçš„ä½ç½®ï¼Œå³nä¸ªâ€1â€å…¨éƒ¨ç§»åŠ¨åˆ°æœ€å³ç«¯æ—¶ï¼Œå°±å¾—åˆ°äº†æœ€åä¸€ä¸ªç»„åˆã€‚","text":"ç®—æ³•åŸç†æ€è·¯æ˜¯å¼€ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸‹æ ‡è¡¨ç¤º1åˆ°nä¸ªæ•°ï¼Œæ•°ç»„å…ƒç´ çš„å€¼ä¸º1è¡¨ç¤ºå…¶ä¸‹æ ‡ä»£è¡¨çš„æ•°è¢«é€‰ä¸­ï¼Œä¸º0åˆ™æ²¡é€‰ä¸­ã€‚é¦–å…ˆåˆå§‹åŒ–ï¼Œå°†æ•°ç»„å‰mä¸ªå…ƒç´ ç½®1ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªç»„åˆä¸ºå‰mä¸ªæ•°ã€‚ç„¶åä»å·¦åˆ°å³æ‰«ææ•°ç»„å…ƒç´ å€¼çš„â€10â€ç»„åˆï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªâ€10â€ç»„åˆåå°†å…¶å˜ä¸ºâ€œ01â€ç»„åˆï¼ŒåŒæ—¶å°†å…¶å·¦è¾¹çš„æ‰€æœ‰â€1â€å…¨éƒ¨ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å·¦ç«¯ã€‚å½“ç¬¬ä¸€ä¸ªâ€1â€ç§»åŠ¨åˆ°æ•°ç»„çš„m-nçš„ä½ç½®ï¼Œå³nä¸ªâ€1â€å…¨éƒ¨ç§»åŠ¨åˆ°æœ€å³ç«¯æ—¶ï¼Œå°±å¾—åˆ°äº†æœ€åä¸€ä¸ªç»„åˆã€‚ Golangå®ç°githubåœ°å€ package permulation import ( &quot;fmt&quot; &quot;math/big&quot; &quot;sort&quot; ) // permutationOfIndex né€‰mç»„åˆç´¢å¼• func combinationNumOfIndex(n, m int) [][]int { if m &lt; 1 || m &gt; n { fmt.Println(&quot;Illegal argument. Param m must between 1 and len(nums).&quot;) return [][]int{} } // all permutation result result := make([][]int, 0, combinationNum(n, m).Int64()) // save all of index result indexS := make([]int, n) // first index array for i := 0; i &lt; n; i++ { if i &lt; m { indexS[i] = 1 } else { indexS[i] = 0 } } // ç¬¬ä¸€ç»„ç»„åˆç´¢å¼• result = addTo(result, indexS) for { find := false for i := 0; i &lt; n-1; i++ { // if index i==1 and index i+1==0, // æ‰¾å‡ºç¬¬ä¸€ç»„1,0ä¸‹æ ‡, äº¤æ¢åå°†ä¸‹æ ‡å·¦è¾¹1å…¨éƒ¨å·¦ç§» if 1 == indexS[i] &amp;&amp; 0 == indexS[i+1] { find = true indexS[i], indexS[i+1] = 0, 1 if i &gt; 1 { moveOneToLeft(indexS[:i]) } result = addTo(result, indexS) break } } if !find { break } } return result } // addTo addTo func addTo(result [][]int, indexS []int) [][]int { newIndexS := make([]int, len(indexS)) copy(newIndexS, indexS) return append(result, newIndexS) } // moveOneToLeft moveOneToLeft func moveOneToLeft(indexS []int) { num := 0 for i := 0; i &lt; len(indexS); i++ { if 1 == indexS[i] { num++ } } for i := 0; i &lt; len(indexS); i++ { if i &lt; num { indexS[i] = 1 } else { indexS[i] = 0 } } } // findByIndexS findByIndexS func findByIndexS(numS []int, indexS [][]int) [][]int { if 0 == len(indexS) { return [][]int{} } result := make([][]int, len(indexS)) for i, index := range indexS { line := make([]int, 0) for j, num := range index { if 1 == num { line = append(line, numS[j]) } } result[i] = line } return result } // permutation å…¨æ’åˆ—ï¼ˆå­—å…¸æ³•ï¼‰ func permutation(nums []int) [][]int { result := make([][]int, 0) //ä»å°åˆ°å¤§æ’åº sort.Slice(nums, func(j, k int) bool { return nums[j] &lt; nums[k] }) result = addTo(result, nums) for { find := false pos1, pos2 := 0, 0 //ä»å³å‘å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªé™åºæ•°çš„ä¸‹æ ‡ä½ for j := len(nums) - 2; j &gt;= 0; j-- { if nums[j] &lt; nums[j+1] { find = true pos1 = j break } } //å·²ç»æ‰¾å‡ºæ‰€æœ‰æ’åˆ— if !find { break } //ä»å³å‘ç¬¬ä¸€ä¸‹æ ‡ä½å·¦æ‰¾åˆ°æœ€å°çš„æ¯”ç¬¬ä¸€ä¸ªä¸‹æ ‡ä½çš„æ•°å¤§çš„æ•° for j := len(nums) - 1; j &gt; pos1; j-- { if nums[j] &gt;= nums[pos1] { pos2 = j break } } // äº¤æ¢ nums[pos1], nums[pos2] = nums[pos2], nums[pos1] for j, k := pos1+1, len(nums)-1; j &lt; k; j, k = j+1, k-1 { nums[j], nums[k] = nums[k], nums[j] } result = addTo(result, nums) } return result } // recursionPermutation é€’å½’åŠ å›æº¯å…¨æ’åˆ— func recursionPermutation(nums []int, index int) [][]int { result := make([][]int, 0) if index == len(nums)-1 { result = addTo(result, nums) return result } for i := index; i &lt; len(nums); i++ { nums[i], nums[index] = nums[index], nums[i] result = append(result, recursionPermutation(nums, index+1)...) nums[i], nums[index] = nums[index], nums[i] } return result } // permutationNum æ’åˆ—æ•° func permutationNum(n, m int) *big.Int { return big.NewInt(1).Div(factorial(n), factorial(n-m)) } // combinationNum ç»„åˆæ•° func combinationNum(n, m int) *big.Int { return big.NewInt(1).Div(factorial(n), big.NewInt(1).Mul(factorial(n-m), factorial(m))) } // factorial é˜¶ä¹˜ func factorial(n int) *big.Int { result := big.NewInt(1) for i := 2; i &lt;= n; i++ { result = result.Mul(result, big.NewInt(int64(i))) } return result }","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[{"name":"permutation","slug":"permutation","permalink":"/tags/permutation/"}],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"çªç ´ç®—æ³•ä¹‹-å¿«é€Ÿæ’åº","slug":"2018-08-1-quick_sort","date":"2018-08-18T17:30:00.000Z","updated":"2020-01-03T10:12:29.197Z","comments":true,"path":"2018/08/19/2018-08-1-quick_sort/","link":"","permalink":"/2018/08/19/2018-08-1-quick_sort/","excerpt":"ç®—æ³•åŸç†å¿«é€Ÿæ’åºæ˜¯å›¾çµå¥–å¾—ä¸»C.R.A. Hoareä¸1960å¹´æå‡ºçš„ä¸€ç§åˆ’åˆ†äº¤æ¢æ’åºï¼Œå®ƒé‡‡ç”¨äº†ä¸€ç§åˆ†æ²»ç­–ç•¥ã€‚åˆ†æ²»æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå°†åŸé—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªè§„æ¨¡æ›´å°ä½†ç»“æ„ä¸åŸé—®é¢˜ç›¸ä¼¼çš„å­é—®é¢˜ã€‚é€’å½’åœ°è§£è¿™äº›å­é—®é¢˜ï¼Œç„¶åå°†è¿™äº›å­é—®é¢˜çš„è§£ç»„åˆä¸ºåŸé—®é¢˜çš„è§£ã€‚","text":"ç®—æ³•åŸç†å¿«é€Ÿæ’åºæ˜¯å›¾çµå¥–å¾—ä¸»C.R.A. Hoareä¸1960å¹´æå‡ºçš„ä¸€ç§åˆ’åˆ†äº¤æ¢æ’åºï¼Œå®ƒé‡‡ç”¨äº†ä¸€ç§åˆ†æ²»ç­–ç•¥ã€‚åˆ†æ²»æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå°†åŸé—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªè§„æ¨¡æ›´å°ä½†ç»“æ„ä¸åŸé—®é¢˜ç›¸ä¼¼çš„å­é—®é¢˜ã€‚é€’å½’åœ°è§£è¿™äº›å­é—®é¢˜ï¼Œç„¶åå°†è¿™äº›å­é—®é¢˜çš„è§£ç»„åˆä¸ºåŸé—®é¢˜çš„è§£ã€‚ åˆ©ç”¨åˆ†æ²»æ³•å¯å°†å¿«é€Ÿæ’åºçš„åˆ†ä¸ºä¸‰æ­¥ï¼š åœ¨æ•°æ®é›†ä¹‹ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸ºâ€åŸºå‡†â€ï¼ˆpivotï¼‰ æ‰€æœ‰å°äºâ€åŸºå‡†â€çš„å…ƒç´ ï¼Œéƒ½ç§»åˆ°â€åŸºå‡†â€çš„å·¦è¾¹ï¼›æ‰€æœ‰å¤§äºâ€åŸºå‡†â€çš„å…ƒç´ ï¼Œéƒ½ç§»åˆ°â€åŸºå‡†â€çš„å³è¾¹ã€‚è¿™ä¸ªæ“ä½œç§°ä¸ºåˆ†åŒº (partition) æ“ä½œï¼Œåˆ†åŒºæ“ä½œç»“æŸåï¼ŒåŸºå‡†å…ƒç´ æ‰€å¤„çš„ä½ç½®å°±æ˜¯æœ€ç»ˆæ’åºåå®ƒçš„ä½ç½®ã€‚ å¯¹â€åŸºå‡†â€å·¦è¾¹å’Œå³è¾¹çš„ä¸¤ä¸ªå­é›†ï¼Œä¸æ–­é‡å¤ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å­é›†åªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ä¸ºæ­¢ã€‚ Golangå®ç°package main import &quot;fmt&quot; /** 1. ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º&quot;åŸºå‡†&quot;ï¼ˆpivotï¼‰ 2. é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œã€‚ 3. é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚ */ func main() { // http://jbcdn2.b0.upaiyun.com/2012/01/Visual-and-intuitive-feel-of-7-common-sorting-algorithms.gif array := []int{6, 7, 9, 3, 6, 8, 1, 9, 3} sort(array, 0, len(array)-1) fmt.Println(array) } func sort(array []int, left, right int) { if left &gt; right { return } var storeIndex = partition(array, left, right) sort(array, left, storeIndex-1) sort(array, storeIndex+1, right) } func partition(array []int, left, right int) int { // æ•°ç»„åˆ†åŒºï¼Œå·¦å°å³å¤§ var storeIndex = left // ç›´æ¥é€‰æœ€å³è¾¹çš„å…ƒç´ ä¸ºåŸºå‡†å…ƒç´  var pivot = array[right] for i := left; i &lt; right; i++ { if array[i] &lt; pivot { if i != storeIndex { array[storeIndex], array[i] = array[i], array[storeIndex] } // äº¤æ¢ä½ç½®åï¼ŒstoreIndex è‡ªå¢ 1ï¼Œä»£è¡¨ä¸‹ä¸€ä¸ªå¯èƒ½è¦äº¤æ¢çš„ä½ç½® storeIndex++ } } // å°†åŸºå‡†å…ƒç´ æ”¾ç½®åˆ°æœ€åçš„æ­£ç¡®ä½ç½®ä¸Š array[right], array[storeIndex] = array[storeIndex], array[right] return storeIndex } githubåœ°å€","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[{"name":"sort","slug":"sort","permalink":"/tags/sort/"}],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"çªç ´ç®—æ³•ä¹‹-äºŒåˆ†æ’å…¥æ’åº","slug":"2018-08-19-binary_insertion_sort","date":"2018-08-18T16:00:00.000Z","updated":"2020-01-03T09:35:02.409Z","comments":true,"path":"2018/08/19/2018-08-19-binary_insertion_sort/","link":"","permalink":"/2018/08/19/2018-08-19-binary_insertion_sort/","excerpt":"äºŒåˆ†æ’å…¥æ’åºåŸç†äºŒåˆ†æ³•æ˜¯å¯¹ç›´æ¥æ’å…¥çš„æ”¹è¿›ï¼Œç”±ç›´æ¥æ’å…¥æ’åºçš„å¾ªç¯éå†æ‰¾å‡ºæ’å…¥ç‚¹æ”¹ä¸ºäºŒåˆ†æ³•æ‰¾å‡ºæ’å…¥ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦O(nlogn)ã€‚","text":"äºŒåˆ†æ’å…¥æ’åºåŸç†äºŒåˆ†æ³•æ˜¯å¯¹ç›´æ¥æ’å…¥çš„æ”¹è¿›ï¼Œç”±ç›´æ¥æ’å…¥æ’åºçš„å¾ªç¯éå†æ‰¾å‡ºæ’å…¥ç‚¹æ”¹ä¸ºäºŒåˆ†æ³•æ‰¾å‡ºæ’å…¥ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦O(nlogn)ã€‚äºŒåˆ†æ³•æ’å…¥æ’åºæ˜¯åœ¨æ’å…¥ç¬¬iä¸ªå…ƒç´ æ—¶ï¼Œå¯¹å‰é¢çš„0ï½i-1å…ƒç´ è¿›è¡ŒæŠ˜åŠï¼Œå…ˆè·Ÿä»–ä»¬ä¸­é—´çš„é‚£ä¸ªå…ƒç´ æ¯”ï¼Œå¦‚æœå°ï¼Œåˆ™å¯¹å‰åŠå†è¿›è¡ŒæŠ˜åŠï¼Œå¦åˆ™å¯¹ååŠè¿›è¡ŒæŠ˜åŠï¼Œç›´åˆ°left&gt;rightï¼Œç„¶åå†æŠŠç¬¬iä¸ªå…ƒç´ å‰1ä½ä¸ç›®æ ‡ä½ç½®ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ åç§»ï¼Œå†æŠŠç¬¬iä¸ªå…ƒç´ æ”¾åœ¨ç›®æ ‡ä½ç½®ä¸Šã€‚ Golangå®ç°package main import &quot;fmt&quot; // äºŒåˆ†æ’å…¥æ’åº // ç®—æ³•æ€æƒ³ç®€å•æè¿°ï¼š //åœ¨æ’å…¥ç¬¬iä¸ªå…ƒç´ æ—¶ï¼Œå¯¹å‰é¢çš„0ï½i-1å…ƒç´ è¿›è¡ŒæŠ˜åŠï¼Œå…ˆè·Ÿä»–ä»¬ //ä¸­é—´çš„é‚£ä¸ªå…ƒç´ æ¯”ï¼Œå¦‚æœå°ï¼Œåˆ™å¯¹å‰åŠå†è¿›è¡ŒæŠ˜åŠï¼Œå¦åˆ™å¯¹ååŠ //è¿›è¡ŒæŠ˜åŠï¼Œç›´åˆ°left&gt;rightï¼Œç„¶åå†æŠŠç¬¬iä¸ªå…ƒç´ å‰1ä½ä¸ç›®æ ‡ä½ç½®ä¹‹é—´ //çš„æ‰€æœ‰å…ƒç´ åç§»ï¼Œå†æŠŠç¬¬iä¸ªå…ƒç´ æ”¾åœ¨ç›®æ ‡ä½ç½®ä¸Šã€‚ func main() { array := []int{6, 7, 9, 3, 6, 8, 1, 9, 3} var start, end, temp, mid int for i := 1; i &lt; len(array); i++ { start = 0 end = i - 1 temp = array[i] for start &lt;= end { mid = (start + end) / 2 if temp &lt; array[mid] { end = mid - 1 } else { start = mid + 1 } } //å¾ªç¯å®Œåï¼Œstart=end+1,æ­¤æ—¶startä¸ºå½“å‰æ’å…¥æ•°å­—æ‰€å¾…å‘ä½ //æŠŠå‘ä½ç»™å½“å‰æ’å…¥çš„æ•°æ®æŒªå‡ºæ¥ for j := i - 1; j &gt;= start; j-- { array[j+1] = array[j] } //å°†å½“å‰æ’å…¥æ•°å­—æŒªå…¥å®ƒè¯¥å¾…çš„å‘ä½ array[start] = temp } fmt.Println(array) } githubåœ°å€","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"çªç ´ç®—æ³•ä¹‹-å¸Œå°”æ’åº","slug":"2018-08-18-shell_sort","date":"2018-08-18T12:24:00.000Z","updated":"2020-01-03T10:12:29.200Z","comments":true,"path":"2018/08/18/2018-08-18-shell_sort/","link":"","permalink":"/2018/08/18/2018-08-18-shell_sort/","excerpt":"ç®—æ³•è¦ç‚¹ å¸Œå°”(Shell)æ’åºåˆç§°ä¸ºç¼©å°å¢é‡æ’åºï¼Œå®ƒæ˜¯ä¸€ç§æ’å…¥æ’åºã€‚å®ƒæ˜¯å¯¹ç›´æ¥æ’å…¥æ’åºç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ã€‚ è¯¥æ–¹æ³•å› DLï¼Shelläº1959å¹´æå‡ºè€Œå¾—åã€‚ ç®—æ³•æ€æƒ³å®ƒçš„ä½œæ³•ä¸æ˜¯æ¯æ¬¡ä¸€ä¸ªå…ƒç´ æŒ¨ä¸€ä¸ªå…ƒç´ çš„æ¯”è¾ƒã€‚è€Œæ˜¯åˆæœŸé€‰ç”¨å¤§è·¨æ­¥ï¼ˆå¢é‡è¾ƒå¤§ï¼‰é—´éš”æ¯”è¾ƒï¼Œä½¿è®°å½•è·³è·ƒå¼æ¥è¿‘å®ƒçš„æ’åºä½ç½®ï¼›ç„¶åå¢é‡ç¼©å°ï¼›æœ€åå¢é‡ä¸º 1 ï¼Œè¿™æ ·è®°å½•ç§»åŠ¨æ¬¡æ•°å¤§å¤§å‡å°‘ï¼Œæé«˜æ’åºæ•ˆç‡ã€‚","text":"ç®—æ³•è¦ç‚¹ å¸Œå°”(Shell)æ’åºåˆç§°ä¸ºç¼©å°å¢é‡æ’åºï¼Œå®ƒæ˜¯ä¸€ç§æ’å…¥æ’åºã€‚å®ƒæ˜¯å¯¹ç›´æ¥æ’å…¥æ’åºç®—æ³•çš„ä¸€ç§ä¼˜åŒ–ã€‚ è¯¥æ–¹æ³•å› DLï¼Shelläº1959å¹´æå‡ºè€Œå¾—åã€‚ ç®—æ³•æ€æƒ³å®ƒçš„ä½œæ³•ä¸æ˜¯æ¯æ¬¡ä¸€ä¸ªå…ƒç´ æŒ¨ä¸€ä¸ªå…ƒç´ çš„æ¯”è¾ƒã€‚è€Œæ˜¯åˆæœŸé€‰ç”¨å¤§è·¨æ­¥ï¼ˆå¢é‡è¾ƒå¤§ï¼‰é—´éš”æ¯”è¾ƒï¼Œä½¿è®°å½•è·³è·ƒå¼æ¥è¿‘å®ƒçš„æ’åºä½ç½®ï¼›ç„¶åå¢é‡ç¼©å°ï¼›æœ€åå¢é‡ä¸º 1 ï¼Œè¿™æ ·è®°å½•ç§»åŠ¨æ¬¡æ•°å¤§å¤§å‡å°‘ï¼Œæé«˜æ’åºæ•ˆç‡ã€‚ å¸Œå°”æ’åºå¯¹æ’å…¥æ’åºä¸€ä¸‹ä¸¤ç‚¹åšå‡ºæ”¹è¿›ï¼š æ’å…¥æ’åºåœ¨å¯¹å‡ ä¹å·²ç»æ’å¥½åºçš„æ•°æ®æ“ä½œæ—¶ï¼Œ æ•ˆç‡é«˜ï¼Œ å³å¯ä»¥è¾¾åˆ°çº¿æ€§æ’åºçš„æ•ˆç‡ ä½†æ’å…¥æ’åºä¸€èˆ¬æ¥è¯´æ˜¯ä½æ•ˆçš„ï¼Œ å› ä¸ºæ’å…¥æ’åºæ¯æ¬¡åªèƒ½å°†æ•°æ®ç§»åŠ¨ä¸€ä½ æ€è·¯ï¼š é¦–å…ˆå»ä¸€ä¸ªæ•´æ•°d1(d1&lt;n)ä½œä¸ºæ­¥é•¿ï¼ŒæŠŠè®°å½•åˆ†æˆd1ä¸ªåˆ†ç»„ï¼Œæ‰€æœ‰è·ç¦»ä¸ºd1çš„å€æ•°çš„è®°å½•çœ‹æˆä¸€ç»„ï¼Œç„¶ååœ¨å„ç»„ç»„å†…è¿›è¡Œæ’å…¥æ’åº ç„¶åå–d2(d2&lt;d1) é‡å¤ä¸Šè¿°åˆ†ç»„å’Œæ’å…¥æ’åºæ“ä½œï¼Œç›´åˆ°di=1(i&gt;=1)å³æ‰€æœ‰è®°å½•æˆä¸ºä¸€ç»„ï¼Œæœ€åå¯¹è¿™ç»„è¿›è¡Œæ’ã€‚ä¸€èˆ¬é€‰d1ä¸ºn/2ã€d2=d1/2,â€¦,di=1ã€‚ Golangå®ç°package main import &quot;fmt&quot; /** 1 è®¾ç½®gapåºåˆ—å³å¢é‡åºåˆ—ï¼Œæœ€åä¸€æ¬¡gapå¿…é¡»æ˜¯1 2 å°†ç›¸è·gapçš„ä¸€ç»„æ•°æŒ‰ç…§æ’å…¥æ’åºï¼ˆæ³¨æ„ æ’å…¥æ’åºä»ç¬¬äºŒä¸ªå¼€å§‹ï¼‰ 3 æ’å…¥æ’åº å¢é‡ä¸ºgap è€Œä¸æ˜¯1 */ func main() { array := []int{6, 7, 9, 3, 6, 8, 1, 9, 3} n := len(array) for gap := n / 2; gap &gt; 0; gap /= 2 { for i := gap; i &lt; n; i++ { preIndex := i - gap current := array[i] for ; preIndex &gt;= 0 &amp;&amp; array[preIndex] &gt; current; { array[preIndex+gap] = array[preIndex] preIndex -= gap } array[preIndex+gap] = current } } fmt.Println(array) } githubåœ°å€ ç®—æ³•åˆ†æç®—æ³•æ€§èƒ½ å‚æ•° ç»“æœ æ’åºç±»å‹ æ’å…¥æ’åº æ’åºæ–¹æ³• å¸Œå°”æ’åº å¹³å‡æ—¶é—´å¤æ‚åº¦ O(Nlog2N) æœ€åæ—¶é—´å¤æ‚åº¦ O(N1.5) æœ€å¥½æ—¶é—´å¤æ‚åº¦ ç©ºé—´å¤æ‚åº¦ O(1) ç¨³å®šæ€§ ä¸ç¨³å®š å¤æ‚æ€§ è¾ƒå¤æ‚ æ—¶é—´å¤æ‚åº¦æ­¥é•¿çš„é€‰æ‹©æ˜¯å¸Œå°”æ’åºçš„å…³é”®ï¼Œåªè¦æœ€ç»ˆæ­¥é•¿ä¸º1éƒ½å¯ä»¥ã€‚ å¸Œå°”æ’åºçš„å¢é‡åºåˆ—çš„é€‰æ‹©ï¼š Hibbardåºåˆ—ï¼š{1,3,7â€¦â€¦2k-1}ï¼Œkä¸ºå¤§äº0çš„è‡ªç„¶æ•°ï¼Œä½¿ç”¨Hibbardåºåˆ—çš„å¸Œå°”æ’åºå¹³å‡è¿è¡Œæ—¶é—´ä¸ºÎ¸(n5/4)ï¼Œæœ€åæƒ…å½¢ä¸ºO(n3/2)ã€‚ Sedgewickåºåˆ—ï¼šä»¤iä¸ºè‡ªç„¶æ•°ï¼Œå°†94-92+1çš„æ‰€æœ‰ç»“æœä¸4-3*2+1çš„æ‰€æœ‰ç»“æœè¿›è¡Œå¹¶é›†è¿ç®—ï¼Œæ‰€å¾—æ•°åˆ—{1,5,19,41,109â€¦â€¦}ã€‚ä½¿ç”¨æ­¤åºåˆ—çš„å¸Œå°”æ’åºæœ€åæƒ…å½¢ä¸ºO(n4/3)ï¼Œå¹³å‡æƒ…å½¢ä¸ºO(n7/6) å¸Œå°”æ’åºçš„æ€§èƒ½ï¼ˆä½¿ç”¨Sedgewickåºåˆ—ï¼‰åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶ä¾ç„¶æ˜¯ä¸é”™çš„ã€‚å¦‚æœè¯´æ’å…¥æ’åºæ˜¯æˆ‘ä»¬çš„â€œåˆçº§æ’åºâ€ï¼Œç”¨äºè¾ƒå°‘æ•°æ®æˆ–è¶‹äºæœ‰åºæ•°æ®çš„æƒ…å†µï¼Œé‚£ä¹ˆå¸Œå°”æ’åºå°±æ˜¯æˆ‘ä»¬çš„â€œä¸­çº§æ’åºâ€ï¼Œç”¨äºæ•°æ®é‡åå¤šçš„æƒ…å†µã€‚å½“ç„¶ï¼Œå½“æ•°æ®é‡æå¤§æ—¶ï¼Œæˆ‘ä»¬å°†ç”¨ä¸Šæˆ‘ä»¬çš„â€œé«˜çº§æ’åºâ€â€”â€”å¿«é€Ÿæ’åºã€‚","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[{"name":"sort","slug":"sort","permalink":"/tags/sort/"}],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"çªç ´ç®—æ³•ä¹‹-ç›´æ¥æ’å…¥æ’åº","slug":"2018-08-17-insertion_sort","date":"2018-08-17T06:30:00.000Z","updated":"2020-01-03T10:12:29.148Z","comments":true,"path":"2018/08/17/2018-08-17-insertion_sort/","link":"","permalink":"/2018/08/17/2018-08-17-insertion_sort/","excerpt":"ç›´æ¥æ’å…¥æ’åºåŸç†æ’å…¥æ’åºä¸é€‰æ‹©æ’åºæœ€å¤§çš„ä¸åŒåœ¨äºç»´æŠ¤æœ‰åºåˆ—çš„æ–¹å¼ä¸åŒï¼š é€‰æ‹©æ’åºé€šè¿‡ä»æ— åºåˆ—ä¸­æ‰¾å‡ºæœ€å¤§æˆ–æœ€å°å€¼æ”¾åœ¨æœ‰åºåˆ—å°¾ï¼Œç›´åˆ°å¾ªç¯åˆ°æœ€åä¸€ä¸ªå…ƒç´ æ•´ä¸ªæ•°ç»„æœ‰åº æ’å…¥æ’åºæ˜¯ä¾æ¬¡æŠŠæ— åºåˆ—ä¸­å…ƒç´ ä»æœ‰åºåˆ—å°¾å¼€å§‹æ¯”è¾ƒæ’å…¥ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„æˆ–è€…æ¯”å®ƒå¤§çš„å…ƒç´ åé¢ï¼Œç›´åˆ°å¾ªç¯åˆ°æœ€åä¸€ä¸ªå…ƒç´ æ•´ä¸ªåºåˆ—æœ‰åº","text":"ç›´æ¥æ’å…¥æ’åºåŸç†æ’å…¥æ’åºä¸é€‰æ‹©æ’åºæœ€å¤§çš„ä¸åŒåœ¨äºç»´æŠ¤æœ‰åºåˆ—çš„æ–¹å¼ä¸åŒï¼š é€‰æ‹©æ’åºé€šè¿‡ä»æ— åºåˆ—ä¸­æ‰¾å‡ºæœ€å¤§æˆ–æœ€å°å€¼æ”¾åœ¨æœ‰åºåˆ—å°¾ï¼Œç›´åˆ°å¾ªç¯åˆ°æœ€åä¸€ä¸ªå…ƒç´ æ•´ä¸ªæ•°ç»„æœ‰åº æ’å…¥æ’åºæ˜¯ä¾æ¬¡æŠŠæ— åºåˆ—ä¸­å…ƒç´ ä»æœ‰åºåˆ—å°¾å¼€å§‹æ¯”è¾ƒæ’å…¥ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„æˆ–è€…æ¯”å®ƒå¤§çš„å…ƒç´ åé¢ï¼Œç›´åˆ°å¾ªç¯åˆ°æœ€åä¸€ä¸ªå…ƒç´ æ•´ä¸ªåºåˆ—æœ‰åº Golangä»£ç å®ç°package main import &quot;fmt&quot; /** ä¸€èˆ¬æ¥è¯´ï¼Œæ’å…¥æ’åºéƒ½é‡‡ç”¨in-placeåœ¨æ•°ç»„ä¸Šå®ç°ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹ï¼š 1. ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åºï¼› 2. å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼› 3. å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½®ï¼› 4. é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½®ï¼› 5. å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åï¼› 6. é‡å¤æ­¥éª¤2~5ã€‚ */ func main() { var preIndex, current int array := []int{6, 7, 9, 3, 6, 8, 1, 9, 3} for i := 1; i &lt; len(array); i++ { preIndex = i - 1 current = array[i] for preIndex &gt;= 0 &amp;&amp; array[preIndex] &gt; current { array[preIndex+1] = array[preIndex] preIndex-- } array[preIndex+1] = current } fmt.Println(array) } githubåœ°å€","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[{"name":"algorithms","slug":"algorithms","permalink":"/tags/algorithms/"}],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"çªç ´ç®—æ³•ä¹‹-å†’æ³¡æ’åº","slug":"2018-08-17-bubble_sort","date":"2018-08-17T05:30:00.000Z","updated":"2020-01-03T09:35:02.399Z","comments":true,"path":"2018/08/17/2018-08-17-bubble_sort/","link":"","permalink":"/2018/08/17/2018-08-17-bubble_sort/","excerpt":"å†’æ³¡æ’åºåŸç†å¯¹æ•°ç»„å†…æ‰€æœ‰nä¸ªå…ƒç´ ä¾æ¬¡è¿›è¡Œæ¯”è¾ƒå’Œäº¤æ¢ä½ç½®ï¼Œè¾ƒå¤§çš„å…ƒç´ å¾€ä¸Šæµ®è¾ƒå°çš„å…ƒç´ å¾€ä¸‹æ²‰ï¼Œå¤–å±‚è¿›è¡Œn-1æ¬¡å¾ªç¯åæ•°ç»„ä¼šä»å°åˆ°å¤§æ’å¥½åºï¼Œæ—¶é—´å¤æ‚åº¦O(n^2)ã€‚","text":"å†’æ³¡æ’åºåŸç†å¯¹æ•°ç»„å†…æ‰€æœ‰nä¸ªå…ƒç´ ä¾æ¬¡è¿›è¡Œæ¯”è¾ƒå’Œäº¤æ¢ä½ç½®ï¼Œè¾ƒå¤§çš„å…ƒç´ å¾€ä¸Šæµ®è¾ƒå°çš„å…ƒç´ å¾€ä¸‹æ²‰ï¼Œå¤–å±‚è¿›è¡Œn-1æ¬¡å¾ªç¯åæ•°ç»„ä¼šä»å°åˆ°å¤§æ’å¥½åºï¼Œæ—¶é—´å¤æ‚åº¦O(n^2)ã€‚ Golangä»£ç å®ç°package main import &quot;fmt&quot; /** 1. æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ªï¼› 2. å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ï¼Œè¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ï¼› 3. é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼› 4. é‡å¤æ­¥éª¤1~3ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚ */ func main() { array := []int{6, 7, 9, 3, 6, 8, 1, 9, 3} len := len(array) for i := 0; i &lt; len-1; i++ { for j := i+1; j &lt; len; j++ { if array[i] &gt; array[j] { array[i], array[j] = array[j], array[i] } } } fmt.Println(array) } &lt;a href=â€https://github.com/sjatsh/algorithms/blob/master/src/github.com/sjatsh/algorithms/sort/bubble.go&quot; target=â€_blankâ€â€&gt;githubåœ°å€","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"HTTPå¹‚ç­‰æ€§","slug":"2018-07-16-http_idempotence","date":"2018-07-15T16:00:00.000Z","updated":"2020-01-03T10:12:29.228Z","comments":true,"path":"2018/07/16/2018-07-16-http_idempotence/","link":"","permalink":"/2018/07/16/2018-07-16-http_idempotence/","excerpt":"åŸæ–‡ HTTPåè®®æ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„é¢å‘èµ„æºçš„ç½‘ç»œåº”ç”¨å±‚åè®®ï¼ŒWeb APIå¦‚æ­¤æµè¡Œå¾ˆå¤§ç¨‹åº¦ä¸Šåº”å½’åŠŸäºç®€å•æœ‰æ•ˆçš„HTTPåè®®ã€‚ç„¶è€Œï¼Œæ­£å¦‚ç®€å•çš„Javaè¯­è¨€å¹¶ä¸æ„å‘³ç€é«˜è´¨é‡çš„Javaç¨‹åºï¼Œç®€å•çš„HTTPåè®®ä¹Ÿä¸æ„å‘³ç€é«˜è´¨é‡çš„Web APIã€‚è¦æƒ³è®¾è®¡å‡ºé«˜è´¨é‡çš„Web APIï¼Œè¿˜éœ€è¦æ·±å…¥ç†è§£åˆ†å¸ƒå¼ç³»ç»ŸåŠHTTPåè®®çš„ç‰¹æ€§ã€‚","text":"åŸæ–‡ HTTPåè®®æ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„é¢å‘èµ„æºçš„ç½‘ç»œåº”ç”¨å±‚åè®®ï¼ŒWeb APIå¦‚æ­¤æµè¡Œå¾ˆå¤§ç¨‹åº¦ä¸Šåº”å½’åŠŸäºç®€å•æœ‰æ•ˆçš„HTTPåè®®ã€‚ç„¶è€Œï¼Œæ­£å¦‚ç®€å•çš„Javaè¯­è¨€å¹¶ä¸æ„å‘³ç€é«˜è´¨é‡çš„Javaç¨‹åºï¼Œç®€å•çš„HTTPåè®®ä¹Ÿä¸æ„å‘³ç€é«˜è´¨é‡çš„Web APIã€‚è¦æƒ³è®¾è®¡å‡ºé«˜è´¨é‡çš„Web APIï¼Œè¿˜éœ€è¦æ·±å…¥ç†è§£åˆ†å¸ƒå¼ç³»ç»ŸåŠHTTPåè®®çš„ç‰¹æ€§ã€‚ httpå¹‚ç­‰æ€§å®šä¹‰http1.1è§„èŒƒä¸­å¹‚ç­‰æ€§çš„å®šä¹‰æ˜¯ï¼š Methods can also have the property of â€œidempotenceâ€ in that (aside from error or expiration issues) the side-effects of N &gt; 0 identicalrequests is the same as for a single request. HTTPæ–¹æ³•çš„å¹‚ç­‰æ€§æ˜¯æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„å‰¯ä½œç”¨ã€‚å¹‚ç­‰æ€§å±äºè¯­ä¹‰èŒƒç•´ï¼Œæ­£å¦‚ç¼–è¯‘å™¨åªèƒ½å¸®åŠ©æ£€æŸ¥è¯­æ³•é”™è¯¯ä¸€æ ·ï¼ŒHTTPè§„èŒƒä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡æ¶ˆæ¯æ ¼å¼ç­‰è¯­æ³•æ‰‹æ®µæ¥å®šä¹‰å®ƒï¼Œè¿™å¯èƒ½æ˜¯å®ƒä¸å¤ªå—åˆ°é‡è§†çš„åŸå› ä¹‹ä¸€ã€‚ä½†å®é™…ä¸Šï¼Œå¹‚ç­‰æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ååˆ†é‡è¦çš„æ¦‚å¿µã€‚ åˆ†å¸ƒå¼äº‹åŠ¡ vs å¹‚ç­‰æ€§ä¸ºä»€ä¹ˆéœ€è¦å¹‚ç­‰æ€§ï¼Ÿä»ä¸€ä¸ªè´¦æˆ·å……é’±çš„è¿œç¨‹APIï¼ˆå¯ä»¥æ˜¯HTTPçš„ä¹Ÿå¯ä»¥ä¸æ˜¯HTTPçš„ï¼‰ï¼š bool withdraw(account_id, amount) withdrawæ˜¯ä»è´¦å·account_idä¸­æ‰£é™¤amountæ•°é¢çš„é’±ï¼Œæ‰£é™¤æˆåŠŸåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseè´¦æˆ·ä½™é¢ä¸å˜ã€‚ä¸€ç§å¯èƒ½çš„æƒ…å†µæ˜¯ï¼ŒæœåŠ¡å™¨å·²ç»æˆåŠŸå¤„ç†è¯·æ±‚å¹¶è¿”å›ï¼Œä½†æ˜¯ç”±äºç½‘ç»œç­‰åŸå› å¯èƒ½å¯¼è‡´å®¢æˆ·ç«¯å¹¶æ²¡æœ‰æ”¶åˆ°å“åº”ç»“æœã€‚å¦‚æœæ˜¯åœ¨ç½‘é¡µä¸Šï¼Œä¸€äº›ä¸æ°å½“çš„è®¾è®¡å¯èƒ½è®©ç”¨æˆ·è®¤ä¸ºä¸Šæ¬¡æ“ä½œå¤±è´¥ç„¶ååˆ·æ–°ç½‘é¡µï¼Œè¿™å°±ä¼šå¯¼è‡´withdrawè¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œè´¦æˆ·å†æ¬¡è¢«æ‰£é’±ã€‚å¦‚å›¾æ‰€ç¤ºï¼š è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸€æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé€šè¿‡å¼•å…¥æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸­é—´ä»¶æ¥ä¿è¯withdrawåŠŸèƒ½çš„äº‹åŠ¡æ€§ã€‚åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¼˜ç‚¹æ˜¯å¯¹äºè°ƒç”¨è€…å¾ˆç®€å•ï¼Œå¤æ‚æ€§éƒ½äº¤ç»™äº†ä¸­é—´ä»¶æ¥ç®¡ç†ã€‚ç¼ºç‚¹åˆ™æ˜¯ä¸€æ–¹é¢æ¶æ„å¤ªé‡é‡çº§ï¼Œå®¹æ˜“è¢«ç»‘åœ¨ç‰¹å®šçš„ä¸­é—´ä»¶ä¸Šï¼Œä¸åˆ©äºå¼‚æ„ç³»ç»Ÿçš„é›†æˆï¼›å¦ä¸€æ–¹é¢åˆ†å¸ƒå¼äº‹åŠ¡è™½ç„¶èƒ½ä¿è¯äº‹åŠ¡çš„ACIDæ€§è´¨ï¼Œè€Œä½†å´æ— æ³•æä¾›æ€§èƒ½å’Œå¯ç”¨æ€§çš„ä¿è¯ã€‚ å¦ä¸€ç§æ›´è½»é‡çº§çš„è§£å†³æ–¹æ¡ˆæ˜¯å¹‚ç­‰è®¾è®¡ï¼š int create_ticket() bool idempotent_withdraw(ticket_id, account_id, amount) create_ticketçš„è¯­ä¹‰æ˜¯è·å–ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„å”¯ä¸€çš„å¤„ç†å·ticket_idï¼Œå®ƒå°†ç”¨äºæ ‡è¯†åç»­çš„æ“ä½œã€‚idempotent_withdrawå’Œwithdrawçš„åŒºåˆ«åœ¨äºå…³è”äº†ä¸€ä¸ªticket_idï¼Œä¸€ä¸ªticket_idè¡¨ç¤ºçš„æ“ä½œè‡³å¤šåªä¼šè¢«å¤„ç†ä¸€æ¬¡ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½å°†è¿”å›ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶çš„å¤„ç†ç»“æœã€‚è¿™æ ·ï¼Œidempotent_withdrawå°±ç¬¦åˆå¹‚ç­‰æ€§äº†ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æ”¾å¿ƒåœ°å¤šæ¬¡è°ƒç”¨ã€‚ åŸºäºå¹‚ç­‰æ€§çš„è§£å†³æ–¹æ¡ˆä¸­ä¸€ä¸ªå®Œæ•´çš„å–é’±æµç¨‹è¢«åˆ†è§£æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼š1.è°ƒç”¨create_ticket()è·å–ticket_idï¼›2.è°ƒç”¨idempotent_withdraw(ticket_id, account_id, amount)ã€‚è™½ç„¶create_ticketä¸æ˜¯å¹‚ç­‰çš„ï¼Œä½†åœ¨è¿™ç§è®¾è®¡ä¸‹ï¼Œå®ƒå¯¹ç³»ç»ŸçŠ¶æ€çš„å½±å“å¯ä»¥å¿½ç•¥ï¼ŒåŠ ä¸Šidempotent_withdrawæ˜¯å¹‚ç­‰çš„ï¼Œæ‰€ä»¥ä»»ä½•ä¸€æ­¥ç”±äºç½‘ç»œç­‰åŸå› å¤±è´¥æˆ–è¶…æ—¶ï¼Œå®¢æˆ·ç«¯éƒ½å¯ä»¥é‡è¯•ï¼Œç›´åˆ°è·å¾—ç»“æœã€‚ å’Œåˆ†å¸ƒå¼äº‹åŠ¡ç›¸æ¯”ï¼Œå¹‚ç­‰è®¾è®¡çš„ä¼˜åŠ¿åœ¨äºå®ƒçš„è½»é‡çº§ï¼Œå®¹æ˜“é€‚åº”å¼‚æ„ç¯å¢ƒï¼Œä»¥åŠæ€§èƒ½å’Œå¯ç”¨æ€§æ–¹é¢ã€‚åœ¨æŸäº›æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„åº”ç”¨ï¼Œå¹‚ç­‰è®¾è®¡å¾€å¾€æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚ HTTPçš„å¹‚ç­‰æ€§HTTP GETæ–¹æ³•ç”¨äºè·å–èµ„æºï¼Œä¸åº”æœ‰å‰¯ä½œç”¨ï¼Œæ‰€ä»¥æ˜¯å¹‚ç­‰çš„ã€‚ HTTP DELETEæ–¹æ³•ç”¨äºåˆ é™¤èµ„æºï¼Œæœ‰å‰¯ä½œç”¨ï¼Œä½†å®ƒåº”è¯¥æ»¡è¶³å¹‚ç­‰æ€§ã€‚æ¯”å¦‚ï¼šDELETE http://www.forum.com/article/4231 ï¼Œè°ƒç”¨ä¸€æ¬¡å’ŒNæ¬¡å¯¹ç³»ç»Ÿäº§ç”Ÿçš„å‰¯ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œå³åˆ æ‰idä¸º4231çš„å¸–å­ï¼›å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥å¤šæ¬¡è°ƒç”¨æˆ–åˆ·æ–°é¡µé¢è€Œä¸å¿…æ‹…å¿ƒå¼•å…¥é”™è¯¯ã€‚ æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ˜¯HTTP POSTå’ŒPUTã€‚POSTå’ŒPUTçš„åŒºåˆ«å®¹æ˜“è¢«ç®€å•åœ°è¯¯è®¤ä¸ºâ€POSTè¡¨ç¤ºåˆ›å»ºèµ„æºï¼ŒPUTè¡¨ç¤ºæ›´æ–°èµ„æºâ€ï¼›è€Œå®é™…ä¸Šï¼ŒäºŒè€…å‡å¯ç”¨äºåˆ›å»ºèµ„æºï¼Œæ›´ä¸ºæœ¬è´¨çš„å·®åˆ«æ˜¯åœ¨å¹‚ç­‰æ€§æ–¹é¢ã€‚ The POST method is used to request that the origin server accept the entity enclosed in the request as a new subordinate of the resource identifiedby the Request-URI in the Request-Line. â€¦â€¦ If a resource has been created on the origin server, the response SHOULD be 201 (Created) and contain anentity which describes the status of the request and refers to the new resource, and a Location header. The PUT method requests that the enclosed entity be stored under the supplied Request-URI. If the Request-URI refers to an already existingresource, the enclosed entity SHOULD be considered as a modified version of the one residing on the origin server. If the Request-URI does not pointto an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create theresource with that URI. POSTæ‰€å¯¹åº”çš„URIå¹¶éåˆ›å»ºçš„èµ„æºæœ¬èº«ï¼Œè€Œæ˜¯èµ„æºçš„æ¥æ”¶è€…ã€‚æ¯”å¦‚ï¼šPOST http://www.forum.com/articlesçš„è¯­ä¹‰æ˜¯åœ¨ http://www.forum.com/articles ä¸‹åˆ›å»ºä¸€ç¯‡å¸–å­ï¼ŒHTTPå“åº”ä¸­åº”åŒ…å«å¸–å­çš„åˆ›å»ºçŠ¶æ€ä»¥åŠå¸–å­çš„URIã€‚ä¸¤æ¬¡ç›¸åŒçš„POSTè¯·æ±‚ä¼šåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸¤ä»½èµ„æºï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„URIï¼›æ‰€ä»¥ï¼ŒPOSTæ–¹æ³•ä¸å…·å¤‡å¹‚ç­‰æ€§ã€‚ è€ŒPUTæ‰€å¯¹åº”çš„URIæ˜¯è¦åˆ›å»ºæˆ–æ›´æ–°çš„èµ„æºæœ¬èº«ã€‚æ¯”å¦‚ï¼šPUT http://www.forum/articles/4231 çš„è¯­ä¹‰æ˜¯åˆ›å»ºæˆ–æ›´æ–°IDä¸º4231çš„å¸–å­ã€‚å¯¹åŒä¸€URIè¿›è¡Œå¤šæ¬¡PUTçš„å‰¯ä½œç”¨å’Œä¸€æ¬¡PUTæ˜¯ç›¸åŒçš„ï¼›å› æ­¤ï¼ŒPUTæ–¹æ³•å…·æœ‰å¹‚ç­‰æ€§ã€‚","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"http","slug":"http","permalink":"/tags/http/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"Java å†…å­˜å¯è§æ€§ä¸æŒ‡ä»¤é‡æ’","slug":"2018-04-20-java_volatile","date":"2018-04-19T16:00:00.000Z","updated":"2020-01-03T10:12:29.143Z","comments":true,"path":"2018/04/20/2018-04-20-java_volatile/","link":"","permalink":"/2018/04/20/2018-04-20-java_volatile/","excerpt":"å†…å­˜å¯è§æ€§çš„é—®é¢˜å¤šçº¿ç¨‹ç³»ç»Ÿä¸­å…±äº«å˜é‡åœ¨ä¸»å­˜ï¼Œçº¿ç¨‹ä¿å­˜ä¸€ä»½å˜é‡çš„å‰¯æœ¬ï¼ŒæŸä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨é€šè¿‡æ”¹åŠ¨å˜é‡å‰¯æœ¬ç„¶ååŒæ­¥åˆ°ä¸»å­˜ä¸­çš„å…±äº«å˜é‡ï¼Œä½†æ˜¯å…¶ä»–çº¿ç¨‹ä¿å­˜çš„å¯èƒ½è¿˜æ˜¯ä¹‹å‰çš„å˜é‡å‰¯æœ¬ï¼Œæ­¤æ—¶å¯èƒ½å°±ä¼šå­˜åœ¨é—®é¢˜ã€‚","text":"å†…å­˜å¯è§æ€§çš„é—®é¢˜å¤šçº¿ç¨‹ç³»ç»Ÿä¸­å…±äº«å˜é‡åœ¨ä¸»å­˜ï¼Œçº¿ç¨‹ä¿å­˜ä¸€ä»½å˜é‡çš„å‰¯æœ¬ï¼ŒæŸä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨é€šè¿‡æ”¹åŠ¨å˜é‡å‰¯æœ¬ç„¶ååŒæ­¥åˆ°ä¸»å­˜ä¸­çš„å…±äº«å˜é‡ï¼Œä½†æ˜¯å…¶ä»–çº¿ç¨‹ä¿å­˜çš„å¯èƒ½è¿˜æ˜¯ä¹‹å‰çš„å˜é‡å‰¯æœ¬ï¼Œæ­¤æ—¶å¯èƒ½å°±ä¼šå­˜åœ¨é—®é¢˜ã€‚ å…¨å±€å˜é‡openï¼š boolean open=true; çº¿ç¨‹Aç»è¿‡ä¸€äº›æ“ä½œä¹‹åæŠŠopenè®¾ç½®æˆfalseï¼š //çº¿ç¨‹A open = false; resource.close(); æ­¤æ—¶çº¿ç¨‹Bé€šè¿‡åˆ¤æ–­opençŠ¶æ€è¿›è¡Œèµ„æºè®¿é—®ï¼š //çº¿ç¨‹B while(open) { doSomethingWithResource(resource); } æ­¤æ—¶å°†openç½®ä¸ºfalseåå…³é—­èµ„æºï¼Œä½†æ˜¯æ­¤æ—¶openå˜é‡å¯èƒ½å¹¶æ²¡æœ‰åŒæ­¥åˆ°çº¿ç¨‹Bï¼Œæ­¤æ—¶openå¯¹çº¿ç¨‹Bä¸å¯è§ã€‚ä½†æ˜¯å®é™…èµ„æºå·²ç»è¢«å…³é—­ï¼Œæ­¤æ—¶å†å¯¹å·²å…³é—­çš„èµ„æºè¿›è¡Œæ“ä½œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚ volatileæä¾›å†…å­˜å¯è§æ€§volatileå¯è§æ€§åŸç†æ˜¯åœ¨æ¯æ¬¡è®¿é—®å˜é‡æ—¶éƒ½ä¼šè¿›è¡Œä¸€æ¬¡åˆ·æ–°ï¼Œå› æ­¤æ¯æ¬¡è®¿é—®éƒ½æ˜¯ä¸»å†…å­˜ä¸­æœ€æ–°çš„ç‰ˆæœ¬ã€‚æ‰€ä»¥volatileå…³é”®å­—çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯ä¿è¯å˜é‡ä¿®æ”¹çš„å®æ—¶å¯è§æ€§ã€‚ æŒ‡ä»¤é‡æ’é—®é¢˜æŒ‡ä»¤é‡æ’å¯¼è‡´å•ä¾‹æ¨¡å¼å¤±æ•ˆï¼š public class Singleton { private static Singleton instance = null; private Singleton() { } public static Singleton getInstance() { if(instance == null) { synchronzied(Singleton.class) { if(instance == null) { instance = new Singleton(); //éåŸå­æ“ä½œ } } } return instance; } } å…¶ä¸­instance= new Singleton()å¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œå®é™…ä¸Šä¼šè¢«æŠ½è±¡æˆå‡ ä¸ªJVMæŒ‡ä»¤ï¼š memory = allocate(); //1ï¼šåˆ†é…å†…å­˜ç©ºé—´ ctorInstance(memory); //2ï¼šåˆå§‹åŒ–å¯¹è±¡ instance = memory; //3ï¼šinstanceå¼•ç”¨æŒ‡å‘å†…å­˜ç©ºé—´ å…¶ä¸­1ã€2ï¼Œ1ã€3ç›¸äº’ä¾èµ–ï¼Œä½†æ˜¯2ã€3å¹¶ä¸æ˜¯ç›¸äº’ä¾èµ–ï¼ŒJVMå¯ä»¥å¯¹ä»–ä»¬è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–é‡æ’ï¼š memory = allocate(); //1ï¼šåˆ†é…å†…å­˜ç©ºé—´ instance = memory; //2ï¼šinstanceå¼•ç”¨æŒ‡å‘å†…å­˜ç©ºé—´ ctorInstance(memory); //3ï¼šåˆå§‹åŒ–å¯¹è±¡ ç”±äºinstanceå¼•ç”¨åœ¨ç¬¬äºŒæ­¥å·²ç»æŒ‡å‘å†…å­˜æ‰€ä»¥ä¸ä¸ºç©ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¯¹å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè¿™æ—¶getInstanceåˆ¤æ–­instanceä¸ä¸ºç©ºæ‹¿å»ä½¿ç”¨å°±ä¼šå¯¼è‡´å‡ºé”™ã€‚ å†…å­˜å±éšœå†…å­˜å±éšœï¼ˆMemory Barrierï¼Œæˆ–æœ‰æ—¶å«åšå†…å­˜æ …æ ï¼ŒMemory Fenceï¼‰æ˜¯ä¸€ç§CPUæŒ‡ä»¤ï¼Œç”¨äºæ§åˆ¶ç‰¹å®šæ¡ä»¶ä¸‹çš„é‡æ’åºå’Œå†…å­˜å¯è§æ€§é—®é¢˜ã€‚Javaç¼–è¯‘å™¨ä¹Ÿä¼šæ ¹æ®å†…å­˜å±éšœçš„è§„åˆ™ç¦æ­¢é‡æ’åºã€‚å†…å­˜å±éšœå¯ä»¥è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ LoadLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadLoad; Load2ï¼Œåœ¨Load2åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚ StoreStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚ LoadStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚ StoreLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚ ä¸ºäº†ä¿è¯finalå­—æ®µçš„ç‰¹æ®Šè¯­ä¹‰ï¼Œä¹Ÿä¼šåœ¨ä¸‹é¢çš„è¯­å¥åŠ å…¥å†…å­˜å±éšœï¼šx.finalField = v; StoreStore; sharedRef = x; finalåŸŸé‡æ’åºåœ¨å†™finalåŸŸçš„æ—¶å€™æœ‰ä¸¤ä¸ªè§„åˆ™ï¼š JVMç¦æ­¢ç¼–è¯‘å™¨æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤– ç¼–è¯‘å™¨ä¼šåœ¨finalåŸŸçš„å†™ä¹‹åï¼Œæ„é€ å‡½æ•°returnä¹‹å‰ï¼Œæ’å…¥ä¸€ä¸ªStoreStoreå±éšœï¼Œè¿™ä¸ªå±éšœç¦æ­¢å¤„ç†å™¨æŠŠfinalåŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚ å†™finalåŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿:åœ¨å¯¹è±¡å¼•ç”¨ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰,å¯¹è±¡çš„finalåŸŸå·²ç»è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ã€‚","categories":[{"name":"java","slug":"java","permalink":"/categories/java/"}],"tags":[{"name":"volatile","slug":"volatile","permalink":"/tags/volatile/"}],"keywords":[{"name":"java","slug":"java","permalink":"/categories/java/"}]},{"title":"mysql8.0.11ç²¾ç®€ç‰ˆ","slug":"2018-04-20-mysql_8011","date":"2018-04-19T16:00:00.000Z","updated":"2020-01-03T10:12:29.182Z","comments":true,"path":"2018/04/20/2018-04-20-mysql_8011/","link":"","permalink":"/2018/04/20/2018-04-20-mysql_8011/","excerpt":"","text":"mysql8.0.11ç²¾ç®€ç‰ˆä»…ä¾›å­¦ä¹ äº¤æµï¼šç™¾åº¦ç½‘ç›˜åœ°å€ å¯†ç ï¼š8g3h","categories":[{"name":"db","slug":"db","permalink":"/categories/db/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"}],"keywords":[{"name":"db","slug":"db","permalink":"/categories/db/"}]},{"title":"mysql bin/redo logé¡ºåºä¸€è‡´æ€§é—®é¢˜","slug":"2018-04-13-mysql_tow_phase_commit","date":"2018-04-12T16:00:00.000Z","updated":"2020-01-03T10:08:01.049Z","comments":true,"path":"2018/04/13/2018-04-13-mysql_tow_phase_commit/","link":"","permalink":"/2018/04/13/2018-04-13-mysql_tow_phase_commit/","excerpt":"ä¸ºä»€ä¹ˆmysqlæ—¢æœ‰bin logä¹Ÿæœ‰redo logbin logæ˜¯å±äºmysql serverå±‚çš„logï¼Œä¸»è¦æ˜¯ç”¨æ¥åšä¸»ä»å¤åˆ¶å’Œå³æ—¶ç‚¹æ¢å¤æ—¶ä½¿ç”¨çš„ï¼Œredo logæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚çš„ï¼Œç”¨æ¥ä¿è¯äº‹åŠ¡å®‰å…¨ã€‚ä¸ç®¡ç”¨å“ªç§å­˜å‚¨å¼•æ“éƒ½æœ‰bin logï¼Œè€Œredo logåªæœ‰InnoDBæœ‰ï¼Œè¿™æ˜¯ç”±mysqlä½“ç³»æ¶æ„å†³å®šçš„ã€‚","text":"ä¸ºä»€ä¹ˆmysqlæ—¢æœ‰bin logä¹Ÿæœ‰redo logbin logæ˜¯å±äºmysql serverå±‚çš„logï¼Œä¸»è¦æ˜¯ç”¨æ¥åšä¸»ä»å¤åˆ¶å’Œå³æ—¶ç‚¹æ¢å¤æ—¶ä½¿ç”¨çš„ï¼Œredo logæ˜¯InnoDBå­˜å‚¨å¼•æ“å±‚çš„ï¼Œç”¨æ¥ä¿è¯äº‹åŠ¡å®‰å…¨ã€‚ä¸ç®¡ç”¨å“ªç§å­˜å‚¨å¼•æ“éƒ½æœ‰bin logï¼Œè€Œredo logåªæœ‰InnoDBæœ‰ï¼Œè¿™æ˜¯ç”±mysqlä½“ç³»æ¶æ„å†³å®šçš„ã€‚ bin logmysql5.1ä¹‹åæœ‰bin logï¼Œä¸»è¦ç”¨äºä¸»å¤‡å¤åˆ¶ã€‚ æœªå¼€å¯bin logæœªå¼€å¯bin logæƒ…å†µä¸‹ï¼ŒInnoDBé€šè¿‡redo logã€undo logè¿›è¡Œæ•°æ®çš„å›å¤å’Œäº‹åŠ¡å›æ»šï¼Œä»¥æ­¤ä¿è¯CrashSafeã€‚å¯ä»¥é€šè¿‡innodb_flush_log_at_trx_commitæ¥æ§åˆ¶ä½•æ—¶å†™å…¥redo logï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚æ¥è‡ªè¡Œè°ƒæ•´ã€‚innodb_flush_log_at_trx_commit = 0|1|2 0ï¼šæ¯Nç§’å°†Redo Log Bufferçš„è®°å½•å†™å…¥Redo Logæ–‡ä»¶ï¼Œå¹¶ä¸”å°†æ–‡ä»¶åˆ·å…¥ç¡¬ä»¶å­˜å‚¨1æ¬¡ã€‚Nç”±innodb_flush_log_at_timeoutæ§åˆ¶ã€‚ 1ï¼šæ¯ä¸ªäº‹åŠ¡æäº¤æ—¶ï¼Œå°†è®°å½•ä»Redo Log Bufferå†™å…¥Redo Logæ–‡ä»¶ï¼Œå¹¶ä¸”å°†æ–‡ä»¶åˆ·å…¥ç¡¬ä»¶å­˜å‚¨ã€‚ 2ï¼šæ¯ä¸ªäº‹åŠ¡æäº¤æ—¶ï¼Œä»…å°†è®°å½•ä»Redo Log Bufferå†™å…¥Redo Logæ–‡ä»¶ã€‚Redo Logä½•æ—¶åˆ·å…¥ç¡¬ä»¶å­˜å‚¨ç”±æ“ä½œç³»ç»Ÿå’Œinnodb_flush_log_at_timeoutå†³å®šã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥ä¿è¯åœ¨MySQLå®•æœºï¼Œè€Œæ“ä½œç³»ç»Ÿæ­£å¸¸å·¥ä½œæ—¶ï¼Œæ•°æ®çš„å®Œæ•´æ€§ã€‚ crash recoveryæ—¶ï¼Œå·²ç»åœ¨InnoDBå†…éƒ¨æäº¤çš„äº‹åŠ¡ç”¨redo logæ¢å¤ï¼Œæ‰€æœ‰prepareä½†æ˜¯æ²¡æœ‰commitçš„transactionsç”¨undo logåšrollbackã€‚ å¼€å¯bin logåœ¨å¼€å¯bin logçš„æƒ…å†µä¸‹ï¼Œè¦ä¿è¯ä¸»å¤‡æ•°æ®ä¸€è‡´æ€§å°±å¿…é¡»ä¿è¯bin logå’Œredo logæ—¥å¿—çš„ä¸€è‡´æ€§ï¼Œmysqlå¼•å…¥ä¸¤é˜¶æ®µæäº¤ï¼ˆtwo phase commit or 2pcï¼‰ã€‚mysqlå†…éƒ¨ä¼šå°†ä¸€ä¸ªæ™®é€šçš„äº‹ç‰©ä½œä¸ºä¸€ä¸ªXAäº‹ç‰©ï¼ˆåˆ†å¸ƒå¼äº‹ç‰©ï¼‰æ¥å¤„ç†ã€‚ ä¸ºæ¯ä¸€ä¸ªäº‹åŠ¡åˆ†é…ä¸€ä¸ªXID commitåˆ†ä¸ºprepareå’Œcommitä¸¤ä¸ªé˜¶æ®µ bin logä½œä¸ºäº‹åŠ¡çš„åè°ƒè€…(Transaction Coordinator)ï¼Œbin log eventä½œä¸ºåè°ƒè€…æ—¥å¿— prepareé˜¶æ®µï¼šsqlæˆåŠŸæ‰§è¡Œï¼Œç”Ÿæˆxidã€redo logã€undo logã€‚è°ƒç”¨prepareå°†äº‹åŠ¡çŠ¶æ€è®¾ä¸ºTRX_PREPAREDï¼Œå¹¶å°†redo logã€undo logåˆ·ç£ç›˜ commité˜¶æ®µï¼š è®°å½•bin logï¼Œwrite()&amp;fsync()ï¼Œåªè¦fsync()æˆåŠŸäº‹åŠ¡å°±ä¸€å®šè¦æäº¤äº†ï¼Œæ­¤æ—¶ç”ŸæˆXid_log_eventï¼Œå¤±è´¥è°ƒç”¨ha_rollback_transå›æ»šã€‚ InnoDB commitå®Œæˆäº‹åŠ¡æäº¤ï¼Œæ¸…é™¤undo logã€åˆ·redo logæ—¥å¿—ï¼Œè®¾ç½®äº‹åŠ¡çŠ¶æ€ä¸ºTRX_NOT_STARTED ä¸¤é˜¶æ®µæäº¤é€šè¿‡innodb_support_xaæ§åˆ¶ï¼Œé»˜è®¤trueå¼€å¯ã€‚ä¸ºäº†ä¿è¯CrashSafeï¼Œä¸Šé¢fsyncå¯ä»¥é€šè¿‡sync_binlog=1&amp;innodb_flush_log_at_trx_commit=1ä¿è¯ã€‚ innodb_flush_log_at_trx_commit(redo log) 0ï¼šæ¯ç§’ä¸€æ¬¡å†™å…¥log fileï¼Œå¹¶ä¸”fsyncã€‚ 1ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤å†™å…¥log fileå¹¶fsyncï¼ˆé»˜è®¤ï¼‰ã€‚ 2ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤å†™å…¥log fileä¸fsyncï¼Œä½•æ—¶fsyncç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚ sync_binlog(binlog) 0ï¼šä½•æ—¶fsyncç”±OSå†³å®šã€‚ Nï¼šNæ¬¡äº‹åŠ¡æäº¤åfsyncã€‚ crash recoveryå¼€å¯bin logçš„mysqlåœ¨crash recoveryæ—¶æ‰¾å‡ºæ‰€æœ‰prepareé˜¶æ®µç”Ÿæˆçš„xidå¹¶æ‰¾å‡ºå¯¹åº”çš„Xid_log_event Xid_log_eventå­˜åœ¨ï¼Œäº‹åŠ¡æäº¤ Xid_log_eventä¸å­˜åœ¨ï¼Œäº‹åŠ¡å›æ»š ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œåªè¦æ˜¯bin log fsync()åˆ·ç›˜æˆåŠŸç”ŸæˆXid_log_eventæ­¤æ—¶äº‹åŠ¡å¿…å®šcommitæˆåŠŸã€‚ bin logã€redo logé¡ºåºä¸€è‡´ä¸¤é˜¶æ®µæäº¤åªèƒ½ä¿è¯bin logã€redo logæ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯å´ä¸èƒ½ä¿è¯bin logä¸redo logçš„å­˜å‚¨é¡ºåºä»¥ç›´æ€§ã€‚ä½†æ˜¯åœ¨å¹¶å‘åœºæ™¯ä¸‹å´æ— æ³•ä¿è¯æ‰€æœ‰äº‹ç‰©åœ¨bin logã€redo logä¸­æäº¤é¡ºåºçš„ä¸€è‡´æ€§ã€‚å½“æˆ‘ä»¬ä½¿ç”¨xtrabackupæˆ–ibbackupè¿›è¡Œæ•°æ®å¤‡ä»½æ—¶å°±å¯èƒ½é€ æˆæ•°æ®çš„ä¸ä¸€è‡´ï¼Œå¦‚å›¾ï¼š 5.6ä¹‹å‰é€šè¿‡prepare_commit_mutexæ¥ä¿è¯XAäº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªXAäº‹åŠ¡èƒ½å¤Ÿè·å¾—è¯¥é”ã€‚ ä¸Šå›¾æ‰€ç¤ºMySQLå¼€å¯Binary logæ—¶ä½¿ç”¨prepare_commit_mutexä¿è¯äºŒè¿›åˆ¶æ—¥å¿—å’Œå­˜å‚¨å¼•æ“é¡ºåºä¿æŒä¸€è‡´ï¼Œprepare_commit_mutexçš„é”æœºåˆ¶é€ æˆé«˜å¹¶å‘æäº¤äº‹åŠ¡çš„æ—¶å€™æ€§èƒ½éå¸¸å·®è€Œä¸”bin logä¹Ÿæ— æ³•group commitã€‚ mysql5.6ä¹‹åå¼•å…¥ä¸‰é˜¶æ®µæäº¤ï¼Œç§»é™¤prepare_commit_mutexï¼Œå¹¶ä¸”bin log&amp;redo logéƒ½æ˜¯group commitã€‚MySQLç»„æäº¤","categories":[{"name":"db","slug":"db","permalink":"/categories/db/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"}],"keywords":[{"name":"db","slug":"db","permalink":"/categories/db/"}]},{"title":"mysql undo logä¸MVCCçš„å®ç°åŸç†","slug":"2018-04-12-mysql_undo_log_mvcc","date":"2018-04-11T16:00:00.000Z","updated":"2020-01-03T10:08:01.056Z","comments":true,"path":"2018/04/12/2018-04-12-mysql_undo_log_mvcc/","link":"","permalink":"/2018/04/12/2018-04-12-mysql_undo_log_mvcc/","excerpt":"###mysqlæ¶æ„ æ¦‚å¿µä¸Šå¯ä»¥åˆ†ä¸ºå››å±‚ï¼š æ¥å…¥å±‚ï¼šä¸åŒå®¢æˆ·ç«¯é€šè¿‡mysqlåè®®ä¸mysqlè¿æ¥é€šè®¯ï¼Œæ¥å…¥å±‚è¿›è¡Œæƒé™éªŒè¯ã€è¿æ¥æ± ç®¡ç†çº¿ç¨‹ç®¡ç†ç­‰ã€‚ æœåŠ¡å±‚ï¼šsqlè§£æå™¨ã€ä¼˜åŒ–å™¨ã€æ•°æ®ç¼“å†²ã€ç¼“å­˜ç­‰ã€‚ å­˜å‚¨å¼•æ“ï¼šå¸¸ç”¨çš„MyISAMã€InnoDBç­‰å­˜å‚¨å¼•æ“ã€‚ æ–‡ä»¶ç³»ç»Ÿï¼šä¿å­˜æ•°æ®ã€ç´¢å¼•ã€æ—¥å¿—ç­‰ã€‚","text":"###mysqlæ¶æ„ æ¦‚å¿µä¸Šå¯ä»¥åˆ†ä¸ºå››å±‚ï¼š æ¥å…¥å±‚ï¼šä¸åŒå®¢æˆ·ç«¯é€šè¿‡mysqlåè®®ä¸mysqlè¿æ¥é€šè®¯ï¼Œæ¥å…¥å±‚è¿›è¡Œæƒé™éªŒè¯ã€è¿æ¥æ± ç®¡ç†çº¿ç¨‹ç®¡ç†ç­‰ã€‚ æœåŠ¡å±‚ï¼šsqlè§£æå™¨ã€ä¼˜åŒ–å™¨ã€æ•°æ®ç¼“å†²ã€ç¼“å­˜ç­‰ã€‚ å­˜å‚¨å¼•æ“ï¼šå¸¸ç”¨çš„MyISAMã€InnoDBç­‰å­˜å‚¨å¼•æ“ã€‚ æ–‡ä»¶ç³»ç»Ÿï¼šä¿å­˜æ•°æ®ã€ç´¢å¼•ã€æ—¥å¿—ç­‰ã€‚ MVCCMVCC(Multi Version Concurrency Control)å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚InnoDBå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸­èšé›†ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜äº†å›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘ä¿®æ”¹å‰çš„å­˜æ”¾åœ¨undo logä¸­çš„æ•°æ®ï¼ŒInnoDBä¹Ÿæ­£æ˜¯é€šè¿‡å›æ»šæŒ‡é’ˆå’Œundo logå®ç°MVCCå’Œäº‹åŠ¡å›æ»šã€‚ undo logä¸­çš„å†…å®¹åªæ˜¯ä¸²è¡ŒåŒ–çš„ç»“æœï¼Œè®°å½•äº†å¤šä¸ªäº‹åŠ¡çš„è¿‡ç¨‹ï¼Œä¸å±äºå¤šç‰ˆæœ¬å…±å­˜ã€‚ä½†ç†æƒ³çš„MVCCæ˜¯éš¾ä»¥å®ç°çš„ï¼Œå½“äº‹åŠ¡ä»…ä¿®æ”¹ä¸€è¡Œè®°å½•ä½¿ç”¨ç†æƒ³çš„MVCCæ¨¡å¼æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¯ä»¥é€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·è¿›è¡Œå›æ»šï¼Œä½†å½“äº‹åŠ¡å½±å“åˆ°å¤šè¡Œæ•°æ®æ—¶ï¼Œç†æƒ³çš„MVCCå°±æ— èƒ½ä¸ºåŠ›äº†ã€‚ é—®é¢˜ï¼štransaction1ä¿®æ”¹row1ã€row2ï¼Œrow1ä¿®æ”¹å¤±è´¥row2ä¿®æ”¹æˆåŠŸï¼Œæ­¤æ—¶äº‹åŠ¡éœ€è¦å›æ»šrow1ã€row2ä¸éœ€è¦å›æ»šï¼Œæ­¤æ—¶row1ä¸Šæ˜¯æ²¡æœ‰é”çš„å¹¶ä¸”å¯èƒ½è¢«transaction2ä¿®æ”¹ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å›æ»šrow1çš„å†…å®¹å°±å¯èƒ½é€ æˆç ´åtransaction2çš„ç»“æœã€‚ æ€è€ƒï¼šç†æƒ³MVCCéš¾ä»¥å®ç°çš„æ ¹æœ¬åŸå› åœ¨äºä¼å›¾é€šè¿‡ä¹è§‚é”ä»£æ›¿äºŒæ®µæäº¤ã€‚ä¿®æ”¹ä¸¤è¡Œæ•°æ®ï¼Œä½†ä¸ºäº†ä¿è¯å…¶ä¸€è‡´æ€§ï¼Œä¸ä¿®æ”¹ä¸¤ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®å¹¶æ— åŒºåˆ«ï¼Œè€ŒäºŒæäº¤æ˜¯ç›®å‰è¿™ç§åœºæ™¯ä¿è¯ä¸€è‡´æ€§çš„å”¯ä¸€æ‰‹æ®µã€‚ äºŒæ®µæäº¤çš„æœ¬è´¨æ˜¯é”å®š ä¹è§‚é”çš„æœ¬è´¨æ˜¯æ¶ˆé™¤é”å®šï¼Œæœ¬è´¨ä¸Šå­˜åœ¨çŸ›ç›¾ ç†æƒ³çš„MVCCéš¾ä»¥å®ç°ï¼ŒInnodbåªæ˜¯å€Ÿäº†MVCCè¿™ä¸ªåå­—ï¼Œæä¾›äº†éé˜»å¡è¯» redo/undo/bin log redo logï¼šå†…å­˜ä¸­çš„ä¿®æ”¹æ“ä½œéƒ½ä¼šè®°å½•åœ¨redo logä¸­ï¼Œå½“å†…å­˜å’Œç£ç›˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´æˆ–äº‹ç‰©æäº¤æ—¶ä¼šè¿›è¡Œä¸€æ¬¡flushæ“ä½œã€‚ undo logï¼šè®°å½•æ•°æ®çš„åå‘æ“ä½œï¼Œç”¨äºæ“ä½œçš„æ’¤å›å’Œæ•°æ®çš„æ¢å¤ï¼Œé€šè¿‡undo logå¯ä»¥å®ç°äº‹åŠ¡å›æ»šï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®undo logå›æº¯åˆ°æŸä¸ªç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå®ç°MVCCã€‚ bin logï¼šbinlogæ˜¯mysqlæœåŠ¡å±‚äº§ç”Ÿçš„æ—¥å¿—ï¼Œå¸¸ç”¨æ¥è¿›è¡Œæ•°æ®æ¢å¤ã€æ•°æ®åº“å¤åˆ¶ï¼Œå¸¸è§çš„mysqlä¸»ä»æ¶æ„ï¼Œå°±æ˜¯é‡‡ç”¨slaveåŒæ­¥masterçš„binlogå®ç°çš„, å¦å¤–é€šè¿‡è§£æbinlogèƒ½å¤Ÿå®ç°mysqlåˆ°å…¶ä»–æ•°æ®æºï¼ˆå¦‚ElasticSearch)çš„æ•°æ®å¤åˆ¶ã€‚ redo/bin logä¸€è‡´æ€§ä¿è¯ä¸ºäº†é˜²æ­¢å†™å®Œbin logä½†æ˜¯redo logçš„äº‹åŠ¡æ²¡æäº¤ä»è€Œå¯¼è‡´çš„ä¸ä¸€è‡´ï¼Œinnodb ä½¿ç”¨äº†ä¸¤é˜¶æ®µæäº¤ï¼Œå…¶åŸºæœ¬é€»è¾‘å°±æ˜¯ä¸Šé”ï¼š InnoDB prepare write/sync redo/undo log (prepare_commit_mutex mysql5.6å‰) write/sync Binlog InnoDB commit (å†™å…¥COMMITæ ‡è®°åé‡Šæ”¾prepare_commit_mutex)","categories":[{"name":"db","slug":"db","permalink":"/categories/db/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"}],"keywords":[{"name":"db","slug":"db","permalink":"/categories/db/"}]},{"title":"mysql clustered index","slug":"2018-04-12 -mysql_clustered_index","date":"2018-04-11T16:00:00.000Z","updated":"2020-01-03T10:12:29.237Z","comments":true,"path":"2018/04/12/2018-04-12 -mysql_clustered_index/","link":"","permalink":"/2018/04/12/2018-04-12 -mysql_clustered_index/","excerpt":"mysqlèšé›†ç´¢å¼•çš„ç†è§£InnoDBä½¿ç”¨èšé›†ç´¢å¼•å­˜å‚¨æ•°æ®ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯èšé›†ç´¢å¼•ï¼Œèšé›†ç´¢å¼•ç›´æ¥å®šä¹‰äº†è¡¨ä¸­æ•°æ®çš„çœŸå®çš„ç‰©ç†å­˜å‚¨é¡ºåºã€‚èšé›†ç´¢å¼•å°±åƒä¸€ä¸ªç”µè¯ç°¿ï¼ŒæŒ‰ç…§å§“æ°æ’åºï¼Œå¹¶ä¸”ç”µè¯å·ç ç´§è·Ÿç€åé¢ã€‚ä¸€ä¸ªè¡¨æœ‰ä¸”åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼Œé»˜è®¤ä¸»é”®ä½œä¸ºèšé›†ç´¢å¼•ï¼Œæ²¡æœ‰ä¸»é”®åˆ™ä»¥ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºé”®ä½œä¸ºèšé›†ç´¢å¼•ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰åˆ™InnoDBä¼šç”Ÿæˆä¸€ä¸ªéšè—idä½œä¸ºèšé›†ç´¢å¼•ã€‚","text":"mysqlèšé›†ç´¢å¼•çš„ç†è§£InnoDBä½¿ç”¨èšé›†ç´¢å¼•å­˜å‚¨æ•°æ®ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯èšé›†ç´¢å¼•ï¼Œèšé›†ç´¢å¼•ç›´æ¥å®šä¹‰äº†è¡¨ä¸­æ•°æ®çš„çœŸå®çš„ç‰©ç†å­˜å‚¨é¡ºåºã€‚èšé›†ç´¢å¼•å°±åƒä¸€ä¸ªç”µè¯ç°¿ï¼ŒæŒ‰ç…§å§“æ°æ’åºï¼Œå¹¶ä¸”ç”µè¯å·ç ç´§è·Ÿç€åé¢ã€‚ä¸€ä¸ªè¡¨æœ‰ä¸”åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼Œé»˜è®¤ä¸»é”®ä½œä¸ºèšé›†ç´¢å¼•ï¼Œæ²¡æœ‰ä¸»é”®åˆ™ä»¥ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºé”®ä½œä¸ºèšé›†ç´¢å¼•ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰åˆ™InnoDBä¼šç”Ÿæˆä¸€ä¸ªéšè—idä½œä¸ºèšé›†ç´¢å¼•ã€‚ æ³¨ï¼šèšé›†ç´¢å¼•ä¸­çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹åŒ…å«ä¸»é”®å€¼ã€äº‹åŠ¡IDã€å›æ»šæŒ‡é’ˆ(rollback pointerç”¨äºäº‹åŠ¡å’ŒMVCC)å’Œä½™ä¸‹çš„åˆ— èšé›†ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼š é€šè¿‡ä¸»é”®æŸ¥è¯¢å’ŒåŒºé—´æŸ¥è¯¢éå¸¸å¿«ï¼Œèšé›†ç´¢å¼•èƒ½å¤Ÿå¿«é€Ÿå®šä½åŒºé—´çš„å¼€å§‹ä½ç½®ä¸ç»“æŸä½ç½®ã€‚ å¦‚æœæŸä¸ªå­—æ®µç»å¸¸ç”¨æ¥æ’åºå¹¶ä¸”è¯¥å­—æ®µå°±æ˜¯èšé›†ç´¢å¼•ï¼Œé‚£ä¹ˆæ’åºæ—¶é—´å°±æ˜¯æ•°æ®æŸ¥è¯¢æ—¶é—´ã€‚ ç¼ºç‚¹ï¼š èšé›†ç´¢å¼•è¢«å®šä¹‰çš„å¾ˆå¤§ï¼Œè¾…åŠ©ç´¢å¼•ä¹Ÿä¼šå˜å¾—å¾ˆå¤§ï¼Œå› ä¸ºè¾…åŠ©ç´¢å¼•éƒ½å­˜å‚¨äº†èšé›†ç´¢å¼•çš„keyã€‚ èšé›†ç´¢å¼•è¢«ä¸ªæ›´æ”¹ä¼šæ¶‰åŠèšé›†ç´¢å¼•çš„é‡æ’ï¼Œèšé›†ç´¢å¼•çš„æ›´æ”¹ä»£ä»·å¾ˆé«˜ã€‚ æ’å…¥å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œå¦‚æœæ•°æ®ä¸æ˜¯æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥ã€‚ è¾…åŠ©ç´¢å¼•InnoDBä¸å­˜åœ¨è¾…åŠ©ç´¢å¼•çš„æ›´æ–°ï¼Œè¾…åŠ©ç´¢å¼•çš„æ›´æ–°æ„å‘³ç€å…ˆåˆ é™¤å†æ·»åŠ ã€‚ èšé›†ç´¢å¼•ä¸è¾…åŠ©ç´¢å¼•çš„åŒºåˆ«èšé›†ç´¢å¼•æ—¢å­˜å‚¨äº†ç´¢å¼•ï¼Œä¹Ÿå­˜å‚¨äº†è¡Œå€¼ã€‚è¾…åŠ©ç´¢å¼•å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼å’Œç´¢å¼•keyï¼Œè¾…åŠ©ç´¢å¼•ä¸€èˆ¬åŒ…å«ä¸¤æ¬¡æŸ¥æ‰¾ï¼Œä¸€æ¬¡æŸ¥æ‰¾ç´¢å¼•è‡ªèº«ï¼Œä¸€æ¬¡æŸ¥æ‰¾ä¸»é”®ï¼ˆèšé›†ç´¢å¼•ï¼‰è·å–æ•°æ®è¡Œã€‚","categories":[{"name":"db","slug":"db","permalink":"/categories/db/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"}],"keywords":[{"name":"db","slug":"db","permalink":"/categories/db/"}]},{"title":"mysql InnoDB locks","slug":"2018-04-11-mysql_row_lock","date":"2018-04-10T16:00:00.000Z","updated":"2020-01-03T10:04:00.490Z","comments":true,"path":"2018/04/11/2018-04-11-mysql_row_lock/","link":"","permalink":"/2018/04/11/2018-04-11-mysql_row_lock/","excerpt":"###InnoDBçš„é”æœºåˆ¶ æ•°æ®åº“é”ä¸ºäº†æ”¯æŒæ›´å¥½çš„å¹¶å‘ï¼Œæä¾›æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚é”çš„ç±»å‹æœ‰ï¼šå…±äº«é”ï¼ˆSï¼‰ã€æ’ä»–é”ï¼ˆXï¼‰ã€æ„å‘å…±äº«ï¼ˆISï¼‰ã€æ„å‘æ’ä»–ï¼ˆIXï¼‰ã€‚ä¸ºäº†æ›´å¥½çš„å¹¶å‘ï¼ŒInnoDBé€šè¿‡MVCCæä¾›éé”å®šè¯»ï¼šä¸ç­‰å¾…è¡Œä¸Šçš„é”é‡Šæ”¾ï¼Œè¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§ã€‚","text":"###InnoDBçš„é”æœºåˆ¶ æ•°æ®åº“é”ä¸ºäº†æ”¯æŒæ›´å¥½çš„å¹¶å‘ï¼Œæä¾›æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚é”çš„ç±»å‹æœ‰ï¼šå…±äº«é”ï¼ˆSï¼‰ã€æ’ä»–é”ï¼ˆXï¼‰ã€æ„å‘å…±äº«ï¼ˆISï¼‰ã€æ„å‘æ’ä»–ï¼ˆIXï¼‰ã€‚ä¸ºäº†æ›´å¥½çš„å¹¶å‘ï¼ŒInnoDBé€šè¿‡MVCCæä¾›éé”å®šè¯»ï¼šä¸ç­‰å¾…è¡Œä¸Šçš„é”é‡Šæ”¾ï¼Œè¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§ã€‚ InnoDBæ”¯æŒçš„é”å®šæ–¹å¼ Record Lockï¼šè®°å½•é”ï¼Œé”ç›´æ¥åŠ åœ¨ç´¢å¼•è®°å½•ä¸Šé¢ï¼Œé”ä½çš„æ˜¯keyè€Œä¸æ˜¯è®°å½•å€¼ã€‚ Gap Lockï¼šé—´éš™é”ï¼Œé”çš„ä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡çš„æ’å…¥æ“ä½œï¼Œä»¥æ­¤é˜²æ­¢å¹»è¯»çš„å‘ç”Ÿã€‚ Next-Key Lockï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚ é”å®šæ–¹å¼çš„é€‰æ‹© å¦‚æœæ¡ä»¶æ²¡æœ‰èµ°ç´¢å¼•ï¼Œä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ‰€ä»¥ä¸Šå‡ä¸ºè¡¨é”ã€‚ å¦‚æœæ¡ä»¶ä¸ºç´¢å¼•å­—æ®µï¼Œä½†æ˜¯å¹¶éå”¯ä¸€ç´¢å¼•ï¼ˆåŒ…æ‹¬ä¸»é”®ç´¢å¼•ï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šä½¿ç”¨Next-Key Lockï¼Œä¸ºä»€ä¹ˆç”¨Next-Key Lockï¼š ç¬¦åˆæ¡ä»¶çš„è®°å½•ä¸ŠåŠ ä¸Šæ’ä»–é”ï¼Œä¼šé”å®šå½“å‰éå”¯ä¸€ç´¢å¼•å’Œå¯¹åº”çš„ä¸»é”®ç´¢å¼•çš„å€¼ ä¿è¯é”å®šçš„åŒºé—´ä¸èƒ½æ’å…¥æ–°çš„æ•°æ® å¦‚æœæ¡ä»¶ä¸ºå”¯ä¸€ç´¢å¼•ï¼Œä½¿ç”¨Record Lock","categories":[{"name":"db","slug":"db","permalink":"/categories/db/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"}],"keywords":[{"name":"db","slug":"db","permalink":"/categories/db/"}]},{"title":"mysql transaction isolation","slug":"2018-04-09-mysql_transaction_isolation","date":"2018-04-08T16:00:00.000Z","updated":"2020-01-03T09:35:02.406Z","comments":true,"path":"2018/04/09/2018-04-09-mysql_transaction_isolation/","link":"","permalink":"/2018/04/09/2018-04-09-mysql_transaction_isolation/","excerpt":"###ä½•ä¸ºéš”ç¦»çº§åˆ« éš”ç¦»çº§åˆ«å†³å®šäº‹åŠ¡é—´çš„å¯è§ç¨‹åº¦ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹ç»“æœåœ¨ä»€ä¹ˆæ—¶å€™èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼Œç”±æ­¤SQL1992è§„èŒƒå¯¹éš”ç¦»æ€§å®šä¹‰äº†ä¸åŒçš„éš”ç¦»çº§åˆ«ç”¨æ¥åˆ’åˆ†è¿™ä¸ªå¯è§èŒƒå›´ã€‚","text":"###ä½•ä¸ºéš”ç¦»çº§åˆ« éš”ç¦»çº§åˆ«å†³å®šäº‹åŠ¡é—´çš„å¯è§ç¨‹åº¦ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹ç»“æœåœ¨ä»€ä¹ˆæ—¶å€™èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼Œç”±æ­¤SQL1992è§„èŒƒå¯¹éš”ç¦»æ€§å®šä¹‰äº†ä¸åŒçš„éš”ç¦»çº§åˆ«ç”¨æ¥åˆ’åˆ†è¿™ä¸ªå¯è§èŒƒå›´ã€‚ mysqlå››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«SQL1992ä¸­å®šä¹‰çš„å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šREAD UNCOMMITTEDã€READ COMMITTEDã€REPEATABLE READã€SERIALIZABLEï¼Œmysql InnoDBé»˜è®¤REPEATABLE READï¼Œmysqlå¯ä»¥ç”¨transaction-isolationæˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä¸ºæ‰€æœ‰è¿æ¥è®¾ç½®éš”ç¦»ææˆ‘winiseI my.iniè®¾ç½®ï¼š transaction-isolation = {READ-UNCOMMITTED | READ-COMMITTED | REPEATABLE-READ | SERIALIZABLE} SET TRANSACTIONè®¾ç½®ï¼š SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED|READ COMMITTED|REPEATABLE READ|SERIALIZABLE} globalè®¾ç½®å…¨å±€äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œsessionè®¾ç½®session æŸ¥è¯¢å…¨å±€æˆ–è€…å½“å‰sessionéš”ç¦»çº§åˆ«ï¼š SELECT @@global.tx_isolation; SELECT @@session.tx_isolation; SELECT @@tx_isolation; éš”ç¦»çº§åˆ« è„è¯»ï¼ˆDirty Readï¼‰ ä¸å¯é‡å¤è¯»ï¼ˆNonRepeatable Readï¼‰ å¹»è¯» æœªæäº¤è¯»ï¼ˆRead uncommittedï¼‰ å¯èƒ½ å¯èƒ½ å¯èƒ½ å·²æäº¤è¯»ï¼ˆRead committedï¼‰ ä¸å¯èƒ½ å¯èƒ½ å¯èƒ½ å¯é‡å¤è¯»ï¼ˆRepeatable readï¼‰ ä¸å¯èƒ½ ä¸å¯èƒ½ å¯èƒ½ å¯ä¸²è¡ŒåŒ–ï¼ˆSerializable ï¼‰ ä¸å¯èƒ½ ä¸å¯èƒ½ ä¸å¯èƒ½ éš”ç¦»çº§åˆ«ï¼š æœªæäº¤è¯»ï¼šå…è®¸è„è¯»ï¼Œä¹Ÿå°±æ˜¯å¯èƒ½è¯»å–åˆ°å…¶ä»–ä¼šè¯ä¸­æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ® å·²æäº¤è¯»ï¼šåªèƒ½è¯»å–åˆ°å·²ç»æäº¤çš„æ•°æ®ã€‚Oracleç­‰å¤šæ•°æ•°æ®åº“é»˜è®¤éƒ½æ˜¯è¯¥çº§åˆ« (ä¸é‡å¤è¯») å¯é‡å¤è¯»ï¼šå¯é‡å¤è¯»ã€‚åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…çš„æŸ¥è¯¢éƒ½æ˜¯äº‹åŠ¡å¼€å§‹æ—¶åˆ»ä¸€è‡´çš„ï¼ŒInnoDBé»˜è®¤çº§åˆ«ã€‚åœ¨SQLæ ‡å‡†ä¸­ï¼Œè¯¥éš”ç¦»çº§åˆ«æ¶ˆé™¤äº†ä¸å¯é‡å¤è¯»ï¼Œä½†æ˜¯è¿˜å­˜åœ¨å¹»è±¡è¯» å¯ä¸²è¡ŒåŒ–ï¼šå®Œå…¨ä¸²è¡ŒåŒ–çš„è¯»ï¼Œæ¯æ¬¡è¯»éƒ½éœ€è¦è·å¾—è¡¨çº§å…±äº«é”ï¼Œè¯»å†™ç›¸äº’éƒ½ä¼šé˜»å¡ ç°è±¡/ç»“æœï¼š è„è¯»ï¼šå½“å‰äº‹åŠ¡å¯ä»¥è¯»å–å’Œä½¿ç”¨å…¶ä»–äº‹åŠ¡ä¸­æœªæäº¤çš„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­ç”±äºå¦ä¸€ä¸ªäº‹åŠ¡å¯¹åŒä¸€æ•°æ®é€ æˆä¿®æ”¹ï¼Œä»è€Œå¯¼è‡´äº‹åŠ¡å†…ä¸¤æ¬¡è¯»å–åˆ°çš„æ•°æ®ä¸ä¸€è‡´ã€‚ å¹»è¯»ï¼šå¹»è¯»å¯èƒ½çš„æƒ…å†µå¾ˆå¤š ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­åœ¨æ’å…¥æ•°æ®å‰å…ˆæŸ¥è¯¢å‘ç°æ•°æ®ä¸å­˜åœ¨ï¼Œæ¥ä¸‹æ¥å‡†å¤‡æ‰§è¡Œinsertï¼Œæ­¤æ—¶äº‹åŠ¡äºŒä¸­æ‰§è¡Œç›¸åŒæ“ä½œå¹¶æäº¤ã€‚æ­¤æ—¶äº‹åŠ¡ä¸€ä¸­insertæ—¶å°±ä¼šæŠ¥é”™ï¼šæ•°æ®å·²å­˜åœ¨ã€‚å°±å¥½åƒäº§ç”Ÿäº†å¹»è§‰ä¸€æ ·æ˜æ˜æŸ¥è¯¢çš„æ—¶å€™æ²¡æœ‰è¯¥æ•°æ®ï¼Œä½†æ˜¯insertçš„æ—¶å€™å´æŠ¥é”™å·²å­˜åœ¨ã€‚ æˆ–è€…ç¬¬ä¸€ä¸ªäº‹åŠ¡å¯¹å…¨è¡¨æ‰§è¡Œupdateæ“ä½œï¼Œæ­¤æ—¶äº‹åŠ¡äºŒinsertäº†ä¸€æ¡æ•°æ®ï¼Œäº‹åŠ¡ä¸€ç”¨æˆ·ä¹‹åå°±ä¼šå‘ç°è¡¨ä¸­è¿˜ä¼šæœ‰æ²¡æœ‰æ›´æ–°çš„æ•°æ®ï¼Œå¥½åƒäº§ç”Ÿå¹»è§‰ã€‚ å½“äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»çš„æ—¶å€™ï¼Œå¹¶ä¸”innodb_locks_unsafe_for_binlog=offï¼ˆé»˜è®¤ï¼‰ï¼Œæœç´¢indexå¹¶åŠ è¡Œé”çš„æ—¶å€™ä½¿ç”¨next-key lockså¯ä»¥æœ‰æ•ˆé¿å…å¹»è¯»ã€‚ä½†è¿™é‡Œéœ€è¦æ³¨æ„åŠ è¡Œé”å­—æ®µå¿…é¡»æ˜¯ç´¢å¼•å­—æ®µï¼Œå¦åˆ™ä¼šè¡¨é”ã€‚","categories":[{"name":"db","slug":"db","permalink":"/categories/db/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"}],"keywords":[{"name":"db","slug":"db","permalink":"/categories/db/"}]},{"title":"gateway framework","slug":"2018-04-07-gateway_framework","date":"2018-04-06T16:00:00.000Z","updated":"2020-01-03T09:35:02.378Z","comments":true,"path":"2018/04/07/2018-04-07-gateway_framework/","link":"","permalink":"/2018/04/07/2018-04-07-gateway_framework/","excerpt":"gateway framework","text":"gateway framework CDNï¼šCDNæ˜¯å°†æºç«™å†…å®¹åˆ†å‘è‡³æœ€æ¥è¿‘ç”¨æˆ·çš„èŠ‚ç‚¹ï¼Œä½¿ç”¨æˆ·å¯å°±è¿‘å–å¾—æ‰€éœ€å†…å®¹ï¼Œæé«˜ç”¨æˆ·è®¿é—®çš„å“åº”é€Ÿåº¦å’ŒæˆåŠŸç‡ã€‚ é«˜é˜²ï¼šæŠŠåŸŸåè§£æåˆ°é«˜é˜²IPï¼ˆWebä¸šåŠ¡æŠŠåŸŸåè§£ææŒ‡å‘é«˜é˜²IPï¼›éWebä¸šåŠ¡ï¼ŒæŠŠä¸šåŠ¡IPæ›¿æ¢æˆé«˜é˜²IPï¼‰ï¼Œå¹¶é…ç½®æºç«™IPã€‚æ‰€æœ‰å…¬ç½‘æµé‡éƒ½ç»è¿‡é«˜é˜²IPæœºæˆ¿ï¼Œé€šè¿‡ç«¯å£åè®®è½¬å‘çš„æ–¹å¼å°†è®¿é—®æµé‡é€šè¿‡é«˜é˜²IPè½¬å‘åˆ°æºç«™IPï¼ŒåŒæ—¶å°†æ¶æ„æ”»å‡»æµé‡åœ¨é«˜é˜²IPä¸Šè¿›è¡Œæ¸…æ´—è¿‡æ»¤åå°†æ­£å¸¸æµé‡è¿”å›ç»™æºç«™IPï¼Œä»è€Œç¡®ä¿æºç«™IPç¨³å®šè®¿é—®ã€‚æŠ—DDOSå¿…é¡»ç¡¬ä»¶ä¸ŠæŠ—ä½ï¼Œä¸€èˆ¬æœåŠ¡å™¨è¢«DDOSä¼šé»˜è®¤å½“ä½œå®¢æˆ·è´£ä»»ä»è€Œsuspendæ‰å®¢æˆ·çš„æœºå™¨ï¼Œä½†æ˜¯é«˜é˜²æœåŠ¡å™¨ï¼Œæœºæˆ¿ä¼šç”¨ç¡¬ä»¶é˜²ç«å¢™æˆ–è€…å¤§å¸¦å®½å¸®ä½ æŠ—ä½ã€‚ WAFï¼šä¼ ç»Ÿé˜²ç«å¢™æ— æ³•å¯¹åº”ç”¨å±‚çš„æ”»å‡»è¿›è¡Œæœ‰æ•ˆæŠµæŠ—ï¼Œå¹¶ä¸”IPSä¹Ÿæ— æ³•ä»æ ¹æœ¬ä¸Šé˜²æŠ¤åº”ç”¨å±‚çš„æ”»å‡»ã€‚å› æ­¤å‡ºç°äº†ä¿æŠ¤Webåº”ç”¨å®‰å…¨çš„Webåº”ç”¨é˜²ç«å¢™ç³»ç»Ÿã€‚WAFæ˜¯ä¸€ç§åŸºç¡€çš„å®‰å…¨ä¿æŠ¤æ¨¡å—ï¼Œé€šè¿‡ç‰¹å¾æå–ã€åˆ†å—æ£€ç´¢è¿›è¡Œç‰¹å¾åŒ¹é…ï¼Œæˆ–è€…é…ç½®é»‘ç™½åå•ï¼Œä¸»è¦é’ˆå¯¹HTTPè®¿é—®çš„Webç¨‹åºä¿æŠ¤ã€‚ ç½‘å…³é›†ç¾¤ä¸€èˆ¬é€šè¿‡nginx+luaå¯¹è¯·æ±‚è§£æå¹¶å°†è¯·æ±‚ä»£ç†è´Ÿè½½åˆ°åç«¯åº”ç”¨æœåŠ¡å™¨æˆ–è€…ULBã€‚","categories":[{"name":"framework","slug":"framework","permalink":"/categories/framework/"}],"tags":[],"keywords":[{"name":"framework","slug":"framework","permalink":"/categories/framework/"}]},{"title":"hsts preload","slug":"2018-04-07-hsts_preload_list","date":"2018-04-06T16:00:00.000Z","updated":"2020-01-03T10:12:29.140Z","comments":true,"path":"2018/04/07/2018-04-07-hsts_preload_list/","link":"","permalink":"/2018/04/07/2018-04-07-hsts_preload_list/","excerpt":"æœåŠ¡å™¨httpsè·³è½¬çš„é—®é¢˜ä¸€èˆ¬æˆ‘ä»¬çš„ç«™ç‚¹å¼ºåˆ¶è·³è½¬httpséƒ½æ˜¯é€šè¿‡nginxã€caddyè¿›è¡Œhttpçš„å¼ºåˆ¶httpsè·³è½¬ã€‚è¿™ä¸ªè¿‡ç¨‹å°±å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ç›´æ¥è¾“å…¥åŸŸåexample.comçš„æ—¶å€™å‘èµ·çš„æ˜¯ä¸€ä¸ªæ˜æ–‡çš„httpè¯·æ±‚å¾ˆå®¹æ˜“è¢«æ”»å‡»è€…æ‹¦æˆªå¹¶å®šå‘åˆ°é’“é±¼ç½‘ç«™","text":"æœåŠ¡å™¨httpsè·³è½¬çš„é—®é¢˜ä¸€èˆ¬æˆ‘ä»¬çš„ç«™ç‚¹å¼ºåˆ¶è·³è½¬httpséƒ½æ˜¯é€šè¿‡nginxã€caddyè¿›è¡Œhttpçš„å¼ºåˆ¶httpsè·³è½¬ã€‚è¿™ä¸ªè¿‡ç¨‹å°±å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ç›´æ¥è¾“å…¥åŸŸåexample.comçš„æ—¶å€™å‘èµ·çš„æ˜¯ä¸€ä¸ªæ˜æ–‡çš„httpè¯·æ±‚å¾ˆå®¹æ˜“è¢«æ”»å‡»è€…æ‹¦æˆªå¹¶å®šå‘åˆ°é’“é±¼ç½‘ç«™ï¼Œå¹¶ä¸”å¦‚æœä½¿ç”¨çš„æ˜¯å›½å†…çš„vpsæ—¶å¾ˆå¯èƒ½è¦æ±‚åŸŸåå¿…é¡»å¤‡æ¡ˆï¼Œæ²¡æœ‰å¤‡æ¡ˆç›´æ¥è¿›è¡Œhttpè®¿é—®çš„æ—¶å€™ï¼Œä¼šç›´æ¥è·³è½¬åˆ°ä¸€ä¸ªæç¤ºé¡µé¢å¾ˆæ˜¯æ¶å¿ƒ~ hstsæ—¢ç„¶å»ºç«‹HTTPSè¿æ¥ä¹‹å‰çš„è¿™ä¸€æ¬¡HTTPæ˜æ–‡è¯·æ±‚å’Œé‡å®šå‘æœ‰å¯èƒ½è¢«æ”»å‡»è€…åŠ«æŒï¼Œé‚£ä¹ˆè§£å†³è¿™ä¸€é—®é¢˜çš„æ€è·¯è‡ªç„¶å°±å˜æˆäº†å¦‚ä½•é¿å…å‡ºç°è¿™æ ·çš„HTTPè¯·æ±‚ã€‚æˆ‘ä»¬æœŸæœ›çš„æµè§ˆå™¨è¡Œä¸ºæ˜¯ï¼Œå½“ç”¨æˆ·è®©æµè§ˆå™¨å‘èµ·HTTPè¯·æ±‚çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†å…¶è½¬æ¢ä¸ºHTTPSè¯·æ±‚ï¼Œç›´æ¥ç•¥è¿‡ä¸Šè¿°çš„HTTPè¯·æ±‚å’Œé‡å®šå‘ï¼Œä»è€Œä½¿å¾—ä¸­é—´äººæ”»å‡»å¤±æ•ˆï¼Œè§„é¿é£é™©ã€‚HSTSæœ€ä¸ºæ ¸å¿ƒçš„æ˜¯ä¸€ä¸ªHTTPå“åº”å¤´ï¼ˆHTTP Response Headerï¼‰ã€‚æ­£æ˜¯å®ƒå¯ä»¥è®©æµè§ˆå™¨å¾—çŸ¥ï¼Œåœ¨æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´å†…ï¼Œå½“å‰åŸŸååªèƒ½é€šè¿‡HTTPSè¿›è¡Œè®¿é—®ï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨å‘ç°å½“å‰è¿æ¥ä¸å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œå¼ºåˆ¶æ‹’ç»ç”¨æˆ·çš„åç»­è®¿é—®è¦æ±‚ã€‚HSTS Headerçš„è¯­æ³•:Strict-Transport-Security: &lt;max-age=&gt;[; includeSubDomains][; preload] max-ageæ˜¯å¿…é€‰å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„æ•°å€¼ï¼Œå®ƒä»£è¡¨ç€HSTS Headerçš„è¿‡æœŸæ—¶é—´ï¼Œé€šå¸¸è®¾ç½®ä¸º1å¹´ï¼Œå³31536000ç§’ã€‚ includeSubDomainsæ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœåŒ…å«å®ƒï¼Œåˆ™æ„å‘³ç€å½“å‰åŸŸååŠå…¶å­åŸŸåå‡å¼€å¯HSTSä¿æŠ¤ã€‚ preloadæ˜¯å¯é€‰å‚æ•°ï¼Œåªæœ‰å½“ä½ ç”³è¯·å°†è‡ªå·±çš„åŸŸååŠ å…¥åˆ°æµè§ˆå™¨å†…ç½®åˆ—è¡¨çš„æ—¶å€™æ‰éœ€è¦ä½¿ç”¨åˆ°å®ƒã€‚å…³äºæµè§ˆå™¨å†…ç½®åˆ—è¡¨ï¼Œä¸‹æ–‡æœ‰è¯¦ç»†ä»‹ç»ã€‚ hsts preload listHSTSå­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒè–„å¼±çš„ç¯èŠ‚ï¼Œé‚£å°±æ˜¯æµè§ˆå™¨æ²¡æœ‰å½“å‰ç½‘ç«™çš„HSTSä¿¡æ¯çš„æ—¶å€™ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œä¾ç„¶éœ€è¦ä¸€æ¬¡æ˜æ–‡çš„HTTPè¯·æ±‚å’Œé‡å®šå‘æ‰èƒ½åˆ‡æ¢åˆ°HTTPSï¼Œä»¥åŠåˆ·æ–°HSTSä¿¡æ¯ã€‚è€Œå°±æ˜¯è¿™ä¹ˆä¸€ç¬é—´å´ç»™æ”»å‡»è€…ç•™ä¸‹äº†å¯ä¹˜ä¹‹æœºï¼Œä½¿å¾—ä»–ä»¬å¯ä»¥æŠŠè¿™ä¸€æ¬¡çš„HTTPè¯·æ±‚åŠ«æŒä¸‹æ¥ï¼Œç»§ç»­ä¸­é—´äººæ”»å‡»ã€‚ åŠ å…¥hsts preload listhttps://hstspreload.org/è®¾ç½®å¥½hstså“åº”å¤´ï¼Œå¹¶ä¸”è¯ä¹¦æœ‰æ•ˆå¯ä»¥åœ¨è¿™é‡Œæäº¤åŠ å…¥hsts preload listï¼Œè¿™æ ·å°±å¯ä»¥è®©æµè§ˆç›´æ¥å¼ºåˆ¶è®¿é—®httpsè€Œä¸éœ€è¦åœ¨è¿™ä¹‹å‰å‘èµ·ä¸€æ¬¡httpè¯·æ±‚ã€‚åŒæ ·ä¹Ÿé¿å…äº†å›½å†…vpsè¦æ±‚åŸŸåå¤‡æ¡ˆçš„é—®é¢˜ï¼ˆå½“ç„¶èƒ½å¤‡æ¡ˆè¿˜æ˜¯å¤‡æ¡ˆä¸€ä¸‹ï¼Œå°±ç›®å‰çŸ¥é“.meå·²ç»ä¸èƒ½å¤‡æ¡ˆäº†ï¼‰ã€‚","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"https","slug":"https","permalink":"/tags/https/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"clion wsl","slug":"2018-04-06-clion_wsl","date":"2018-04-05T16:00:00.000Z","updated":"2020-01-03T09:35:02.454Z","comments":true,"path":"2018/04/06/2018-04-06-clion_wsl/","link":"","permalink":"/2018/04/06/2018-04-06-clion_wsl/","excerpt":"clion wslclionæ–°ç‰ˆå¼€å§‹æ”¯æŒwslï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›´æ¥åœ¨windowsä¸Šç¼–è¯‘linuxç‰¹æ€§çš„Cä»£ç ã€‚ Bash on Windows åœ¨æ§åˆ¶é¢æ¿\\ç¨‹åº\\ç¨‹åºå’ŒåŠŸèƒ½ å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½ä¸­å‹¾é€‰ é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ åœ¨è®¾ç½®ä¸­æ‰“å¼€å¼€å‘äººå‘˜æ¨¡å¼ é‡å¯åpowershellè¾“å…¥","text":"clion wslclionæ–°ç‰ˆå¼€å§‹æ”¯æŒwslï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›´æ¥åœ¨windowsä¸Šç¼–è¯‘linuxç‰¹æ€§çš„Cä»£ç ã€‚ Bash on Windows åœ¨æ§åˆ¶é¢æ¿\\ç¨‹åº\\ç¨‹åºå’ŒåŠŸèƒ½ å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½ä¸­å‹¾é€‰ é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ åœ¨è®¾ç½®ä¸­æ‰“å¼€å¼€å‘äººå‘˜æ¨¡å¼ é‡å¯åpowershellè¾“å…¥ lxrun /install /y å‘½ä»¤è¡Œç›´æ¥è¾“å…¥bashå°±å¯ä»¥å¯åŠ¨äº† ubuntu on windowsmicrosoft store ç›´æ¥å®‰è£…ubuntuå­ç³»ç»Ÿ é‡è£…openssh sudo apt-get remove openssh-server sudo apt-get install openssh-server ä¿®æ”¹sshdè®¾ç½®vim /etc/ssh/sshd_config UsePrivilegeSeparation no PasswordAuthentication yes ListenAddress 0.0.0.0 é‡å¯sshd sudo service ssh --full-restart å¯èƒ½çš„é—®é¢˜sshd ../sysdeps/posix/getaddrinfo.c:2603: getaddrinfo: Assertion IN6_IS_ADDR_V4MAPPED (sin6-&gt;sin6_addr.s6_addr32) failed. åŸå› ipv6çš„é—®é¢˜ï¼Œä¿®æ”¹sshd_configï¼ŒListenAddress 0.0.0.0 sshd fail because getaddrinfo UsePrivilegeSeparation no è‡ªå¯åŠ¨sshä¸€æ—¦bashè¿›ç¨‹è¢«å…³é—­ï¼Œsshå°±æ— æ³•è¿æ¥ï¼š æ·»åŠ å¯åŠ¨é¡¹ï¼Œè®©bashå¼€æœºè‡ªå¯ ä½¿ç”¨sudo service ssh startå¯åŠ¨éœ€è¦è¾“å…¥å¯†ç æ‰€ä»¥éœ€è¦visudoå…å¯†ç æ“ä½œ å…·ä½“æ“ä½œï¼š ä½¿ç”¨vbså¯åŠ¨bashå¹¶è¿è¡Œsudo service ssh start set ws=wscript.createobject(&quot;wscript.shell&quot;) ws.run &quot;C:\\Windows\\System32\\bash.exe&quot;,0 ws.run &quot;C:\\Windows\\System32\\bash.exe -c &#39;sudo /usr/sbin/service ssh start&#39;&quot;,0 å…¶ä»–å¯åŠ¨é¡¹ç±»ä¼¼ä¹Ÿå¯ä»¥åŠ åœ¨è„šæœ¬åé¢ï¼ŒæŠŠvbsæ–‡ä»¶æ”¾å…¥å¦‚ä¸‹ç›®å½•ï¼š %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup è¿è¡Œsudo visudo,æ·»åŠ é…ç½®username ALL = (root) NOPASSWD: /usr/sbin/service æ„‰å¿«çš„å†™linux cå§ #include&lt;stdio.h&gt; #include&lt;pthread.h&gt; #include&lt;string.h&gt; #include&lt;sys/types.h&gt; #include&lt;unistd.h&gt; pthread_t main_tid; void print_ids(const char *str) { pid_t pid; //è¿›ç¨‹id pthread_t tid; //çº¿ç¨‹id pid = getpid(); //è·å–å½“å‰è¿›ç¨‹id tid = pthread_self(); //è·å–å½“å‰çº¿ç¨‹id printf(&quot;%s pid: %u tid: %u (0x%x)\\n&quot;, str, (unsigned int) pid, (unsigned int) tid, (unsigned int) tid); } void *func(void *arg) { print_ids(&quot;new thread:&quot;); return ((void *) 0); } int main() { int err; err = pthread_create(&amp;main_tid, NULL, func, NULL); //åˆ›å»ºçº¿ç¨‹ if (err != 0) { printf(&quot;create thread error: %s/n&quot;, strerror(err)); return 1; } printf(&quot;main thread: pid: %u tid: %u (0x%x)\\n&quot;, (unsigned int) getpid(), (unsigned int) pthread_self(), (unsigned int) pthread_self()); print_ids(&quot;main thread:&quot;); sleep(1); return 0; } CMakeList.txtæœ€ååŠ ä¸Š find_package(Threads) target_link_libraries(projectName ${CMAKE_THREAD_LIBS_INIT})","categories":[{"name":"ide","slug":"ide","permalink":"/categories/ide/"}],"tags":[],"keywords":[{"name":"ide","slug":"ide","permalink":"/categories/ide/"}]},{"title":"why codis not redis cluster","slug":"2018-04-04-choose_codis_not_redis_cluster","date":"2018-04-03T16:00:00.000Z","updated":"2020-01-03T09:35:02.357Z","comments":true,"path":"2018/04/04/2018-04-04-choose_codis_not_redis_cluster/","link":"","permalink":"/2018/04/04/2018-04-04-choose_codis_not_redis_cluster/","excerpt":"why not redis cluster æ— ä¸­å¿ƒçš„è®¾è®¡ï¼Œå¾ˆéš¾æŠŠç¨‹åºå†™å¯¹ ä»£ç æœ‰ç‚¹å“äººï¼ŒclusterProcessPacketæœ‰426è¡Œï¼Œå¤§è„‘å¾ˆéš¾å¤„ç†åˆ°æ‰€æœ‰çš„çŠ¶æ€åˆ‡æ¢ è¿Ÿè¿Ÿæ²¡æœ‰æ­£å¼ç‰ˆï¼Œç­‰äº†4å¹´ä¹‹ä¹… ç¼ºä¹Best Practiseï¼Œè¿˜æ²¡äººå†™ä¸€ä¸ªRedis Clusterçš„è‹¥å¹²æ¡æ³¨æ„äº‹é¡¹ è¿™ä¸ªç³»ç»Ÿé«˜åº¦è€¦åˆï¼Œå‡çº§å›°éš¾ å¦‚æœslotæ‰€åœ¨çš„redis masterã€slaveåŒæ—¶æŒ‚æ‰ï¼Œæ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ã€‚codisæ˜¯å¦ä¸€æ ·?å¾…éªŒè¯â€¦","text":"why not redis cluster æ— ä¸­å¿ƒçš„è®¾è®¡ï¼Œå¾ˆéš¾æŠŠç¨‹åºå†™å¯¹ ä»£ç æœ‰ç‚¹å“äººï¼ŒclusterProcessPacketæœ‰426è¡Œï¼Œå¤§è„‘å¾ˆéš¾å¤„ç†åˆ°æ‰€æœ‰çš„çŠ¶æ€åˆ‡æ¢ è¿Ÿè¿Ÿæ²¡æœ‰æ­£å¼ç‰ˆï¼Œç­‰äº†4å¹´ä¹‹ä¹… ç¼ºä¹Best Practiseï¼Œè¿˜æ²¡äººå†™ä¸€ä¸ªRedis Clusterçš„è‹¥å¹²æ¡æ³¨æ„äº‹é¡¹ è¿™ä¸ªç³»ç»Ÿé«˜åº¦è€¦åˆï¼Œå‡çº§å›°éš¾ å¦‚æœslotæ‰€åœ¨çš„redis masterã€slaveåŒæ—¶æŒ‚æ‰ï¼Œæ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ã€‚codisæ˜¯å¦ä¸€æ ·?å¾…éªŒè¯â€¦ why codiscodisæ”¹è¿›redisçš„å‡ ä¸ªç‚¹: redis æ•°æ®é‡å¤ªå¤§çš„è¯ï¼ˆ22G ä»¥ä¸Šï¼‰ï¼Œå¤„ç†æ€§èƒ½å°±å¼€å§‹ä¸‹é™ æ— æ³•åŒºåˆ†å†·çƒ­æ•°æ®ï¼Œå†…å­˜æµªè´¹ä¸¥é‡ RDB Block ä½æ•´ä¸ªæœåŠ¡ å†™æ“ä½œå¤ªé¢‘ç¹ï¼ŒAOFåˆ·ç›˜å¤ªå¤šï¼Œå¾ˆå®¹æ˜“rewrite https://segmentfault.com/a/1190000012908434","categories":[{"name":"redis","slug":"redis","permalink":"/categories/redis/"}],"tags":[],"keywords":[{"name":"redis","slug":"redis","permalink":"/categories/redis/"}]},{"title":"redis sentinel/cluster","slug":"2018-04-04-redis_sentinel_cluster","date":"2018-04-03T16:00:00.000Z","updated":"2020-01-03T10:12:29.195Z","comments":true,"path":"2018/04/04/2018-04-04-redis_sentinel_cluster/","link":"","permalink":"/2018/04/04/2018-04-04-redis_sentinel_cluster/","excerpt":"å•ä¾‹æ¨¡å¼rediså•ä¾‹å­˜åœ¨çš„é—®é¢˜ï¼š å•ç‚¹æ•…éšœ æ•°æ®å¤‡ä»½ æ•°æ®é‡å¤§äº†ä»¥åçš„æ€§èƒ½é—®é¢˜","text":"å•ä¾‹æ¨¡å¼rediså•ä¾‹å­˜åœ¨çš„é—®é¢˜ï¼š å•ç‚¹æ•…éšœ æ•°æ®å¤‡ä»½ æ•°æ®é‡å¤§äº†ä»¥åçš„æ€§èƒ½é—®é¢˜ ä¸»ä»æ¨¡å¼ä¸»ä»æ¨¡å¼æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºmasterï¼Œå…¶ä½™çš„å®ä¾‹ä½œä¸ºslave,ä¸»æœºå’Œä»æœºçš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä¸»æœºæ”¯æŒæ•°æ®çš„å†™å…¥å’Œè¯»å–ç­‰å„é¡¹æ“ä½œï¼Œè€Œä»æœºåˆ™åªæ”¯æŒä¸ä¸»æœºæ•°æ®çš„åŒæ­¥å’Œè¯»å–ï¼ˆä¹Ÿå¯ä»¥è®¾ç½®å¯å†™ï¼Œä½†æ˜¯ä¼šåœ¨masteråŒæ­¥åä¸¢å¤±ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å¯ä»¥å°†æ•°æ®å†™å…¥åˆ°ä¸»æœºï¼Œç”±ä¸»æœºè‡ªåŠ¨å°†æ•°æ®çš„å†™å…¥æ“ä½œåŒæ­¥åˆ°ä»æœºã€‚ä¸»ä»æ¨¡å¼å¾ˆå¥½çš„è§£å†³äº†æ•°æ®å¤‡ä»½é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºä¸»ä»æœåŠ¡æ•°æ®å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œå› è€Œå¯ä»¥å°†å†™å…¥æ•°æ®çš„å‘½ä»¤å‘é€ç»™ä¸»æœºæ‰§è¡Œï¼Œè€Œè¯»å–æ•°æ®çš„å‘½ä»¤å‘é€ç»™ä¸åŒçš„ä»æœºæ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°è¯»å†™åˆ†ç¦»çš„ç›®çš„ã€‚å¦‚ä¸‹æ‰€ç¤ºä¸»æœºredis-Aåˆ†åˆ«æœ‰redis-Bã€redis-Cã€redis-Dã€redis-Eå››ä¸ªä»æœºï¼š æ³¨æ„ï¼š ä¸»ä»æ¨¡å¼ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢åä¸¤ä¸ªé—®é¢˜è€Œæä¾›çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨å•ç‚¹æ•…éšœçš„é—®é¢˜ã€‚ master downæ‰ä¼šå¯¼è‡´slaveä¹Ÿä¸å¯ç”¨ï¼Œå¯æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªslaveå‡æ ¼ä¸ºmasterï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿç»§ç»­æä¾›æœåŠ¡ã€‚ç„¶è€Œæ•´ä¸ªè¿‡ç¨‹å¾ˆéº»çƒ¦éœ€è¦äººå·¥ä»‹å…¥ï¼Œéš¾ä»¥å®ç°è‡ªåŠ¨åŒ–ã€‚ sentinelæ¨¡å¼ä¸ºäº†è§£å†³ä¸»ä»æ¨¡å¼master downæ‰ä¼šå¯¼è‡´slaveä¹Ÿä¸å¯ç”¨ï¼Œéœ€è¦äººå·¥æ¥å…¥çš„é—®é¢˜ï¼Œredis2.8æä¾›sentinelå·¥å…·ï¼Œå®ç°è‡ªåŠ¨åŒ–çš„ç³»ç»Ÿç›‘æ§å’Œæ•…éšœæ¢å¤åŠŸèƒ½sentinelçš„ä½œç”¨å°±æ˜¯ç›‘æ§Redisç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼š ç›‘æ§ä¸»æ•°æ®åº“å’Œä»æ•°æ®åº“æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ ä¸»æ•°æ®åº“å‡ºç°æ•…éšœæ—¶è‡ªåŠ¨å°†ä»æ•°æ®åº“è½¬æ¢ä¸ºä¸»æ•°æ®åº“ã€‚ å¯ä»¥ç”¨info replicationæŸ¥çœ‹ä¸»ä»æƒ…å†µ æ³¨æ„ï¼š sentinel 1 å¾ˆå¤š Bugï¼Œè¢«å®˜æ–¹å¼ƒç”¨ï¼Œç”¨ redis2.8 ä»¥åŠ sentinel 2 ä¸»ä»åˆ‡æ¢é…ç½®è¦åŠ ä¸Š sentinel can-failover server1 yes clusteræ¨¡å¼åŠæ—¶ä½¿ç”¨sentinelæ¯ä¸ªrediså®ä¾‹ä¹Ÿæ˜¯å…¨é‡å­˜å‚¨ï¼Œæµªè´¹å†…å­˜å¹¶ä¸”ä¼šæœ‰æœ¨æ¡¶æ•ˆåº”ã€‚é›†ç¾¤è‡³å°‘éœ€è¦3ä¸»3ä»ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„é…ç½®æ–‡ä»¶ï¼š cluster-enabled yes cluster-config-file nodes-xx.conf ä½¿ç”¨redisè‡ªå¸¦çš„é›†ç¾¤å·¥å…·åˆ›å»ºé›†ç¾¤ï¼š å®‰è£…rubygemsï¼šyum install ruby ã€yum install rubygems ã€gem install redis åˆ†åˆ«å¯åŠ¨6ä¸ªrediså®ä¾‹ redis-trib.rb create â€“replicas 1 127.0.0.1:6379 â€¦ å…¶ä¸­replicas 1è¡¨ç¤ºç»™æ¯ä¸ªmasteråˆ†é…å¤šå°‘ä¸ªslave æ€»ç»“sentinel ä¸»ä»åˆ‡æ¢è‡ªåŠ¨åŒ– æœ¬èº«ä¹Ÿæ”¯æŒé›†ç¾¤ï¼Œç”¨sentinelé›†ç¾¤æ¥ç›‘æ§redisé›†ç¾¤ è‡ªèº«ä¹Ÿéœ€è¦å¤šæ•°ï¼Œé¿å…å•ç‚¹é—®é¢˜ åªæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Rediså®ä¾‹ å¯ä»¥é€šè¿‡å‘å¸ƒä¸è®¢é˜…æ¥è‡ªåŠ¨å‘ç°æ­£åœ¨ç›‘è§†ç›¸åŒä¸»å®ä¾‹çš„å…¶ä»–Sentinel failover è¿‡ç¨‹å¯¹ä»£ç å®¢æˆ·ç«¯æ˜¯é€æ˜çš„ cluster ä¸€ä¸ªredisé›†ç¾¤åŒ…å«16384ä¸ªå“ˆå¸Œæ§½ï¼ˆhash slotï¼‰ redisé›†ç¾¤å¯¹èŠ‚ç‚¹ä½¿ç”¨äº†ä¸»ä»å¤åˆ¶åŠŸèƒ½ï¼Œæé«˜ç¨³å®šæ€§ï¼ˆHAï¼‰ redisé›†ç¾¤çš„èŠ‚ç‚¹é—´é€šè¿‡gossipåè®®é€šä¿¡ è¦ç‚¹ ä¸»ä»æ¨¡å¼æ˜¯ä¸ºäº†HA sentinelæ˜¯ä¸€ç§è‡ªåŠ¨failoverå’Œé«˜å¯ç”¨ï¼ˆHAï¼‰è§£å†³æ–¹æ¡ˆ clusteræ˜¯ä¸€ç§åˆ†ç‰‡çš„æ–¹æ¡ˆï¼Œè‡ªå¸¦failoverï¼Œä¸»è¦è§£å†³çš„æ˜¯åœ¨çº¿åŠ¨æ€æ¨ªå‘æ‰©å®¹","categories":[{"name":"redis","slug":"redis","permalink":"/categories/redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"/tags/redis/"}],"keywords":[{"name":"redis","slug":"redis","permalink":"/categories/redis/"}]},{"title":"å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’","slug":"2018-04-03-pass_by_value_and_reference","date":"2018-04-02T16:00:00.000Z","updated":"2020-01-03T10:12:29.234Z","comments":true,"path":"2018/04/03/2018-04-03-pass_by_value_and_reference/","link":"","permalink":"/2018/04/03/2018-04-03-pass_by_value_and_reference/","excerpt":"åˆ°åº•ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’åŸºç¡€ä¸­çš„åŸºç¡€ï¼Œé¦–å…ˆä¸è¦çº ç»“å­—é¢æ„æ€ï¼ŒJavaä¸­ï¼ˆbyteã€shortã€intã€longã€floatã€doubleï¼‰ã€å­—ç¬¦å‹ï¼ˆcharï¼‰ã€å¸ƒå°”å‹ï¼ˆbooleanï¼‰è¿™äº›åŸºæœ¬ç±»å‹æ•°æ®ç›´æ¥ä¿å­˜åœ¨æ ˆä¸­ï¼Œè€Œç±»ã€æ¥å£ã€æ•°ç»„æ•°æ®æ˜¯ä¿å­˜åœ¨å †ä¸­ï¼Œæ ˆåªæ˜¯ä¿å­˜ä¸€ä¸ªæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆã€‚","text":"åˆ°åº•ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’åŸºç¡€ä¸­çš„åŸºç¡€ï¼Œé¦–å…ˆä¸è¦çº ç»“å­—é¢æ„æ€ï¼ŒJavaä¸­ï¼ˆbyteã€shortã€intã€longã€floatã€doubleï¼‰ã€å­—ç¬¦å‹ï¼ˆcharï¼‰ã€å¸ƒå°”å‹ï¼ˆbooleanï¼‰è¿™äº›åŸºæœ¬ç±»å‹æ•°æ®ç›´æ¥ä¿å­˜åœ¨æ ˆä¸­ï¼Œè€Œç±»ã€æ¥å£ã€æ•°ç»„æ•°æ®æ˜¯ä¿å­˜åœ¨å †ä¸­ï¼Œæ ˆåªæ˜¯ä¿å­˜ä¸€ä¸ªæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆã€‚ å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’çš„æœ¬è´¨å°±æ˜¯ä¼ é€’å€¼è¿˜æ˜¯å†…å­˜åœ°å€","categories":[{"name":"java","slug":"java","permalink":"/categories/java/"}],"tags":[{"name":"transmit","slug":"transmit","permalink":"/tags/transmit/"}],"keywords":[{"name":"java","slug":"java","permalink":"/categories/java/"}]},{"title":"B-Treeå’ŒB+Tree","slug":"2018-04-02-b-tree-b++tree","date":"2018-04-01T16:00:00.000Z","updated":"2020-01-03T09:55:50.153Z","comments":true,"path":"2018/04/02/2018-04-02-b-tree-b++tree/","link":"","permalink":"/2018/04/02/2018-04-02-b-tree-b++tree/","excerpt":"å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»ŸåŠæ–‡ä»¶ç³»ç»Ÿéƒ½é‡‡ç”¨B-Treeæˆ–å…¶å˜ç§B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä¸ºä»€ä¹ˆB-Treeå’ŒB+Treeåœ¨è¢«å¦‚æ­¤å¹¿æ³›ç”¨äºç´¢å¼•ï¼Ÿå…ˆä»æ•°æ®ç»“æ„çš„è§’åº¦æ¥åˆ†æã€‚ å‡ ç§å¸¸è§çš„æ ‘ç»“æ„äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBalanced Binary Search Treeï¼‰ï¼Œçº¢é»‘æ ‘(Red-Black Tree )ï¼ŒB-tree/B+-tree/ B*-tree (B~Tree)ã€‚å‰ä¸‰éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦O(log2N)ä¸æ ‘çš„æ·±åº¦æœ‰å…³ï¼Œé™ä½æ·±åº¦è‡ªç„¶ä¹Ÿèƒ½æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚","text":"å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»ŸåŠæ–‡ä»¶ç³»ç»Ÿéƒ½é‡‡ç”¨B-Treeæˆ–å…¶å˜ç§B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä¸ºä»€ä¹ˆB-Treeå’ŒB+Treeåœ¨è¢«å¦‚æ­¤å¹¿æ³›ç”¨äºç´¢å¼•ï¼Ÿå…ˆä»æ•°æ®ç»“æ„çš„è§’åº¦æ¥åˆ†æã€‚ å‡ ç§å¸¸è§çš„æ ‘ç»“æ„äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBalanced Binary Search Treeï¼‰ï¼Œçº¢é»‘æ ‘(Red-Black Tree )ï¼ŒB-tree/B+-tree/ B*-tree (B~Tree)ã€‚å‰ä¸‰éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦O(log2N)ä¸æ ‘çš„æ·±åº¦æœ‰å…³ï¼Œé™ä½æ·±åº¦è‡ªç„¶ä¹Ÿèƒ½æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ é¢ä¸´çš„é—®é¢˜å®é™…çš„å¤§è§„æ¨¡å­˜å‚¨ä¸­ï¼Œåœ¨å®ç°ç´¢å¼•æŸ¥è¯¢çš„èƒŒæ™¯ä¸‹ï¼Œæ ‘èƒ½å­˜å‚¨çš„æ•°æ®é‡æ˜¯æœ‰é™çš„ï¼Œå¤§æ•°æ®é‡æƒ…å†µä¸‹å¯¼è‡´æ ‘è¿‡æ·±é€ æˆç£ç›˜I/Oè¯»å†™è¿‡äºé¢‘ç¹ï¼ˆç£ç›˜æ„é€ æœ‰å…³ï¼‰ï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡åº•ä¸‹ã€‚é‚£ä¹ˆå‡å°æ ‘çš„æ·±åº¦å°±æˆä¸ºæœ‰æ•ˆçš„æé«˜æŸ¥è¯¢æ•ˆç‡çš„æ‰‹æ®µã€‚é‚£ä¹ˆå¾ˆè‡ªç„¶ä¸€ä¸ªæƒ³æ³•å°±æ˜¯å¤šå‰æ ‘ç»“æ„ã€‚ ç£ç›˜çš„æ„é€  ç£ç›˜ä¸Šæ•°æ®é€šè¿‡ä¸€ä¸ªä¸‰ç»´åœ°å€å”¯ä¸€æ ‡ç¤ºï¼šæŸ±é¢å·ã€ç›˜é¢å·ã€å—å·(ç£é“ä¸Šçš„ç›˜å—)ã€‚ ç£ç›˜çš„è¯»å†™éœ€è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼š å®šä½ï¼ˆæŸ¥æ‰¾ï¼‰ï¼šç§»åŠ¨è‡‚æ ¹æ®æŸ±é¢å·ä½¿ç£å¤´ç§»åŠ¨åˆ°æ‰€éœ€è¦çš„æŸ±é¢ ç¡®å®šç›˜é¢ï¼šè¿™æ—¶æ ¹æ®ç›˜é¢å·æ¥ç¡®å®šæŒ‡å®šç›˜é¢ä¸Šçš„ç£é“ ç¡®å®šå—å·ï¼šå°†æŒ‡å®šå—å·çš„ç£é“æ®µç§»åŠ¨è‡³ç£å¤´ä¸‹ è®¿é—®å…·ä½“ä¿¡æ¯ç”±ä¸‰æ­¥æ—¶é—´ç»„æˆï¼š æŸ¥æ‰¾æ—¶é—´(seek time) Tsï¼šå®Œæˆä¸Šé¢æ­¥éª¤ä¸€æ‰€éœ€æ—¶é—´ï¼Œä»£ä»·æœ€é«˜ï¼Œæœ€å¤§åˆ°0.1så·¦å³ã€‚ ç­‰å¾…æ—¶é—´(latency time) Tlï¼šä¸Šè¿°ä¸‰æ­¥è€—æ—¶ã€‚ ä¼ è¾“æ—¶é—´(transmission time) Tt: æ•°æ®é€šè¿‡ç³»ç»Ÿæ€»çº¿ä¼ é€åˆ°å†…å­˜çš„æ—¶é—´ã€‚ B-Treeã€B+Treeä¸ºä»€ä¹ˆé€‚åˆåšç´¢å¼• B-Treeã€B+Treeæ˜¯å¤šè·¯æœç´¢æ ‘ï¼ŒæŸ¥è¯¢ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒIOæ¬¡æ•°æ˜¯æ’å®šçš„ï¼Œæœ€å¤šéœ€è¦è®¿é—®hä¸ªèŠ‚ç‚¹ï¼ˆhä¸ºæ ‘é«˜ï¼‰ã€‚ mysqlå·§å¦™åœ°å°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ç½®äº†ä¸€é¡µçš„å¤§å°ï¼Œæ¯æ¬¡ç£ç›˜è¯»å–ä¸€é¡µçš„æ•°æ®å°±èƒ½åœ¨ä¸€æ¬¡IO çš„æƒ…å†µä¸‹å°†æ•´ä¸ªèŠ‚ç‚¹çš„æ•°æ®è¯»å‡ºæ¥ã€‚ mysql B-Treeä¸€èˆ¬é«˜åº¦ä¸è¶…è¿‡3ï¼Œ100é˜¶çš„é«˜åº¦ä¸º3çš„B-Treeï¼Œå¯ä»¥å­˜100100100=10^6çš„æ•°æ®ï¼ŒåŸºæœ¬ä¸Š3æ¬¡IOå°±å¯ä»¥å®Œæˆç´¢å¼•ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘å› ä¸ºçº¢é»‘æ ‘æ˜¯äºŒå‰æ ‘ï¼Œå­˜å‚¨å¤§é‡æ•°æ®çš„æ—¶å€™æ ‘çš„é«˜åº¦ä¼šéå¸¸å¤§ï¼Œä¼šé€ æˆå¤šæ¬¡IOè¯»å–ï¼Œæ€§èƒ½å¾ˆå·®ã€‚å¦‚ä¸Šæ‰€è¿°10^6çš„æ•°æ®åœ¨çº¢é»‘æ ‘ä¸­å°±ä¸å¯èƒ½åœ¨3æ¬¡IOå†…å®Œæˆï¼Œå› æ­¤çº¢é»‘æ ‘ä¸é€‚åˆä½œä¸ºå¤–å­˜ç´¢å¼•ã€‚ æ€»ç»“ç”±æ­¤å¯ä»¥çœ‹å‡ºæé«˜ç´¢å¼•æŸ¥è¯¢æ•ˆç‡çš„å…³é”®åœ¨äºå‡å°‘ç£ç›˜çš„å®šä½å’ŒIOæ¬¡æ•°ï¼Œè€Œå‡å°‘ç£ç›˜IOå…³é”®åœ¨äºé™ä½æ ‘çš„é«˜åº¦ã€‚","categories":[{"name":"struct","slug":"struct","permalink":"/categories/struct/"}],"tags":[{"name":"struct","slug":"struct","permalink":"/tags/struct/"}],"keywords":[{"name":"struct","slug":"struct","permalink":"/categories/struct/"}]},{"title":"Java HashMap","slug":"2018-04-02-hash_map","date":"2018-04-01T16:00:00.000Z","updated":"2020-01-03T10:12:29.216Z","comments":true,"path":"2018/04/02/2018-04-02-hash_map/","link":"","permalink":"/2018/04/02/2018-04-02-hash_map/","excerpt":"Java HashMapçš„æœ¬è´¨HashMapçš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°ç»„åŠ é“¾è¡¨ã€‚ å®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚","text":"Java HashMapçš„æœ¬è´¨HashMapçš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°ç»„åŠ é“¾è¡¨ã€‚ å®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ HashMapå¯»å€æ–¹å¼å¯¹æ–°æ•°æ®çš„æ’å…¥æˆ–è€…è¯»å–æ•°æ®æ—¶ï¼ŒHashMapå°†Keyçš„å“ˆå¸Œå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œç»“æœä½œä¸ºè¯¥Entryåœ¨æ•°ç»„ä¸­çš„indexã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œå–æ¨¡çš„ä»£ä»·è¿œé«˜äºä½æ“ä½œçš„ä»£ä»·ï¼Œå› æ­¤HashMapè¦æ±‚æ•°ç»„çš„é•¿åº¦å¿…é¡»ä¸º2çš„Næ¬¡æ–¹ã€‚æ­¤æ—¶å°†Keyçš„å“ˆå¸Œå€¼å¯¹2^N-1è¿›è¡Œä¸è¿ç®—ï¼Œå…¶æ•ˆæœå³ä¸å–æ¨¡ç­‰æ•ˆã€‚HashMapå¹¶ä¸è¦æ±‚ç”¨æˆ·åœ¨æŒ‡å®šHashMapå®¹é‡æ—¶å¿…é¡»ä¼ å…¥ä¸€ä¸ª2çš„Næ¬¡æ–¹çš„æ•´æ•°ï¼Œè€Œæ˜¯ä¼šé€šè¿‡Integer.highestOneBitç®—å‡ºæ¯”æŒ‡å®šæ•´æ•°å°çš„æœ€å¤§çš„2^Nå€¼ã€‚ public static int highestOneBit(int i) { i |= (i &gt;&gt; 1); i |= (i &gt;&gt; 2); i |= (i &gt;&gt; 4); i |= (i &gt;&gt; 8); i |= (i &gt;&gt; 16); return i - (i &gt;&gt;&gt; 1); } ç”±äºKeyçš„å“ˆå¸Œå€¼çš„åˆ†å¸ƒç›´æ¥å†³å®šäº†æ‰€æœ‰æ•°æ®åœ¨å“ˆå¸Œè¡¨ä¸Šçš„åˆ†å¸ƒæˆ–è€…è¯´å†³å®šäº†å“ˆå¸Œå†²çªçš„å¯èƒ½æ€§ï¼Œå› æ­¤ä¸ºé˜²æ­¢ç³Ÿç³•çš„Keyçš„hashCodeå®ç°ï¼ˆä¾‹å¦‚ä½ä½éƒ½ç›¸åŒï¼Œåªæœ‰é«˜ä½ä¸ç›¸åŒï¼Œä¸2^N-1å–ä¸åçš„ç»“æœéƒ½ç›¸åŒï¼‰ï¼ŒJDK 1.7çš„HashMapé€šè¿‡å¦‚ä¸‹æ–¹æ³•ä½¿å¾—æœ€ç»ˆçš„å“ˆå¸Œå€¼çš„äºŒè¿›åˆ¶å½¢å¼ä¸­çš„1å°½é‡å‡åŒ€åˆ†å¸ƒä»è€Œå°½å¯èƒ½å‡å°‘å“ˆå¸Œå†²çªã€‚ int h = hashSeed; h ^= k.hashCode(); h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4); ä¸ºä»€ä¹ˆHashMapçº¿ç¨‹ä¸å®‰å…¨HashMapçš„çº¿ç¨‹ä¸å®‰å…¨ä¸»è¦ä½“ç°åœ¨resizeæ—¶çš„æ­»å¾ªç¯åŠä½¿ç”¨è¿­ä»£å™¨æ—¶çš„fast-failä¸Šã€‚ resizeæ­»å¾ªç¯å½“HashMapçš„sizeè¶…è¿‡Capacity*loadFactoræ—¶ï¼Œéœ€è¦å¯¹HashMapè¿›è¡Œæ‰©å®¹ã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œé•¿åº¦ä¸ºåŸæ¥Capacityä¸¤å€çš„æ•°ç»„ï¼Œä¿è¯æ–°çš„Capacityä»ä¸º2çš„Næ¬¡æ–¹ï¼Œä»è€Œä¿è¯ä¸Šè¿°å¯»å€æ–¹å¼ä»é€‚ç”¨ã€‚åŒæ—¶éœ€è¦é€šè¿‡å¦‚ä¸‹transferæ–¹æ³•å°†åŸæ¥çš„æ‰€æœ‰æ•°æ®å…¨éƒ¨é‡æ–°æ’å…¥ï¼ˆrehashï¼‰åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚ void transfer(Entry[] newTable, boolean rehash) { int newCapacity = newTable.length; for (Entry&lt;K,V&gt; e : table) { while(null != e) { Entry&lt;K,V&gt; next = e.next; if (rehash) { e.hash = null == e.key ? 0 : hash(e.key); } int i = indexFor(e.hash, newCapacity); e.next = newTable[i]; newTable[i] = e; e = next; } } } è¿™é‡Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œäº†putæ“ä½œå¹¶å¼•å‘äº†rehashï¼Œæ‰§è¡Œäº†transferæ–¹æ³•ï¼Œå¹¶å‡è®¾çº¿ç¨‹ä¸€è¿›å…¥transferæ–¹æ³•å¹¶æ‰§è¡Œå®Œnext = e.nextåï¼Œå› ä¸ºçº¿ç¨‹è°ƒåº¦æ‰€åˆ†é…æ—¶é—´ç‰‡ç”¨å®Œè€Œâ€œæš‚åœâ€ï¼Œæ­¤æ—¶çº¿ç¨‹äºŒå®Œæˆäº†transferæ–¹æ³•çš„æ‰§è¡Œã€‚æ­¤æ—¶çŠ¶æ€å¦‚ä¸‹ã€‚ çº¿ç¨‹ä¸€ï¼š e=key(5) next=e.next=key(9) çº¿ç¨‹äºŒï¼š table[1]-&gt;key(9)-&gt;key(5)-&gt;null æ¥ç€çº¿ç¨‹1è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œç¬¬ä¸€è½®å¾ªç¯çš„å‰©ä½™éƒ¨åˆ† e.next = newTable[1] = null newTable[1] = e = key(5) e = next = key(9) e.next=table[1]=null table[1]=e=key(5) e=next=key(9) next=e.next=key(5) e.next=table[1]=key(5) table[1]=e=key(9) e=next=key(5) next=e.next=null e.next=table[1]=key(9) table[1]=e=key(5) e=next=null æ­¤æ—¶å¾ªç¯é“¾è¡¨å½¢æˆï¼Œå¹¶ä¸”key(11)æ— æ³•åŠ å…¥åˆ°çº¿ç¨‹1çš„æ–°æ•°ç»„ã€‚åœ¨ä¸‹ä¸€æ¬¡è®¿é—®è¯¥é“¾è¡¨æ—¶ä¼šå‡ºç°æ­»å¾ªç¯ã€‚ Fast-failåœ¨ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­å¦‚æœHashMapä¸­keyè¢«removeï¼Œé‚£ä¹ˆConcurrentModificationExceptionå°†è¢«æŠ›å‡ºï¼Œä¹Ÿå³Fast-failç­–ç•¥ã€‚ å½“HashMapçš„iterator()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šæ„é€ å¹¶è¿”å›ä¸€ä¸ªæ–°çš„EntryIteratorå¯¹è±¡ï¼Œå¹¶å°†EntryIteratorçš„expectedModCountè®¾ç½®ä¸ºHashMapçš„modCountï¼ˆè¯¥å˜é‡è®°å½•äº†HashMapè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼‰ã€‚ HashIterator() { expectedModCount = modCount; if (size &gt; 0) { // advance to first entry Entry[] t = table; while (index &lt; t.length &amp;&amp; (next = t[index++]) == null) ; } } java8å¯¹HashMapçš„ä¼˜åŒ–å½“æˆå‘˜å˜é‡ MIN_TREEIFY_CAPACITYï¼ˆæ ‘å½¢æœ€å°å®¹é‡ï¼‰&gt;64 &amp;&amp; TREEIFY_THRESHOLDï¼ˆæ ‘å½¢é˜ˆå€¼ï¼‰&gt;8 æ—¶å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ ,å½“TREEIFY_THRESHOLD&lt;=6æ—¶ä¼šå†å°†çº¢é»‘æ ‘è½¬åŒ–æˆé“¾è¡¨ã€‚è€Œå°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ä¸»è¦æ˜¯ä¸ºäº†åŠ å¿«hashå†²çªæ—¶çš„æŸ¥è¯¢é€Ÿåº¦ã€‚æ•´ä¸ªçº¢é»‘æ ‘çš„æŸ¥æ‰¾ï¼Œæ’å…¥å’Œåˆ é™¤éƒ½æ˜¯O(logN)çš„ï¼ŒåŸå› å°±æ˜¯æ•´ä¸ªçº¢é»‘æ ‘çš„é«˜åº¦æ˜¯logNï¼ŒæŸ¥æ‰¾ä»æ ¹åˆ°å¶ï¼Œèµ°è¿‡çš„è·¯å¾„æ˜¯æ ‘çš„é«˜åº¦ï¼Œåˆ é™¤å’Œæ’å…¥æ“ä½œæ˜¯ä»å¶åˆ°æ ¹çš„ï¼Œæ‰€ä»¥ç»è¿‡çš„è·¯å¾„éƒ½æ˜¯logNã€‚çº¢é»‘æ ‘æ·±å…¥å‰–æ","categories":[{"name":"struct","slug":"struct","permalink":"/categories/struct/"}],"tags":[{"name":"hashmap","slug":"hashmap","permalink":"/tags/hashmap/"}],"keywords":[{"name":"struct","slug":"struct","permalink":"/categories/struct/"}]},{"title":"æˆé•¿æ›²çº¿","slug":"2018-03-28-grow_up","date":"2018-03-27T16:00:00.000Z","updated":"2020-01-03T10:12:29.169Z","comments":true,"path":"2018/03/28/2018-03-28-grow_up/","link":"","permalink":"/2018/03/28/2018-03-28-grow_up/","excerpt":"æŠ€æœ¯æˆé•¿ä¹‹è·¯15å¹´é‚£ä¼šå¤§å››å³å°†æ¯•ä¸šï¼Œé¢ä¸´ç€å·¥ä½œé—®é¢˜ã€‚ç”±äºå¹¶ä¸æ˜¯ä»€ä¹ˆå¥½å­¦æ ¡ï¼Œæ¥æ ¡å†…æ‹›äººçš„å…¬å¸åŸºæœ¬ä¸Šæ˜¯ä¸€äº›é”€å”®çš„æ´»ï¼Œå¶æœ‰å‡ ä¸ªæŠ€æœ¯å²—ä½ä¹Ÿæ˜¯èµ°ä¸ªè¿‡åœºè€Œå·²ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½çš„æœºä¼šã€‚åæ¥å’ŒåŒå­¦ä¸€èµ·å‚åŠ äº†javaåŸ¹è®­ï¼Œæˆ–è®¸å¹¶ä¸æ˜¯ä¸ºäº†å¸Œæœ›å­¦ä¹ åˆ°å¤šå°‘ä¸œè¥¿è€ŒæŠ¥åï¼Œè€Œæ˜¯ä¸ºäº†èƒ½å¤Ÿæœ‰ä¸ªå¥½çš„æœºä¼šã€‚","text":"æŠ€æœ¯æˆé•¿ä¹‹è·¯15å¹´é‚£ä¼šå¤§å››å³å°†æ¯•ä¸šï¼Œé¢ä¸´ç€å·¥ä½œé—®é¢˜ã€‚ç”±äºå¹¶ä¸æ˜¯ä»€ä¹ˆå¥½å­¦æ ¡ï¼Œæ¥æ ¡å†…æ‹›äººçš„å…¬å¸åŸºæœ¬ä¸Šæ˜¯ä¸€äº›é”€å”®çš„æ´»ï¼Œå¶æœ‰å‡ ä¸ªæŠ€æœ¯å²—ä½ä¹Ÿæ˜¯èµ°ä¸ªè¿‡åœºè€Œå·²ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½çš„æœºä¼šã€‚åæ¥å’ŒåŒå­¦ä¸€èµ·å‚åŠ äº†javaåŸ¹è®­ï¼Œæˆ–è®¸å¹¶ä¸æ˜¯ä¸ºäº†å¸Œæœ›å­¦ä¹ åˆ°å¤šå°‘ä¸œè¥¿è€ŒæŠ¥åï¼Œè€Œæ˜¯ä¸ºäº†èƒ½å¤Ÿæœ‰ä¸ªå¥½çš„æœºä¼šã€‚ä¸‰ä¸ªæœˆæ—¶é—´è¿‡å»ï¼Œå’Œé¢„æƒ³çš„ä¸€æ ·ï¼ŒåŸ¹è®­å¹¶æ²¡æœ‰æ•™ä½ å¤šå°‘ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯åŸºç¡€ã€‚ä½†æ˜¯é€šè¿‡æœºæ„é¡ºåˆ©æ‹¿åˆ°äº†å‡ å®¶å…¬å¸çš„offerï¼Œæœ€åé€šè¿‡è‡ªå·±çš„è€ƒè™‘é€‰æ‹©äº†ä¸€å®¶å°çš„åˆ›ä¸šå…¬å¸ã€‚ å›æƒ³é‚£ä¸€ä¼šï¼ŒæŠ±ç€å¿å¿‘çš„å¿ƒæƒ…è¿›å…¥è¿™å®¶å…¬å¸çš„æŠ€æœ¯éƒ¨é—¨ï¼Œæ¥æ‰‹ç¬¬ä¸€ä»½å·¥ä½œå’Œä»»åŠ¡ã€‚å„ç§æ–°å¥‡çš„å¼€å‘å·¥å…·ï¼Œå«ä¸ä¸Šåå­—çš„ä¼—å¤šè½¯ä»¶æ¡†æ¶ï¼Œåºå¤§çš„ä»£ç åº“ã€‚æœ€ä¸»è¦çš„æ˜¯æœ‰æŠ€æœ¯å¤§ç‰›ã€‚è¿™ä¸€åˆ‡éƒ½æ˜¯åœ¨å­¦æ ¡é‚£ä¼šæ¥è§¦ä¸åˆ°çš„ï¼ŒåŒæ ·ä¹Ÿæ„Ÿå—åˆ°å‰æ‰€æœªæœ‰çš„å‹åŠ›ã€‚åœ¨å¼€å§‹é‚£åŠå¹´å°±åƒä¸€æ ªä¹…æ—±çš„ç¦¾è‹—é‡åˆ°äº†é›¨æ°´ï¼Œæ‹¼å‘½åœ°å¸æ”¶ç€å·¥ä½œä¸­é‡åˆ°çš„æ¯ä¸€ç‚¹çŸ¥è¯†ã€‚å­¦ä¹ æ–°çš„å¼€å‘å·¥å…·ï¼Œå­¦ä¹ è°ƒè¯•å’Œè§£bugçš„æŠ€å·§ï¼Œä¹Ÿå­¦ä¹ å¤„ç†å„ç§æ£˜æ‰‹çš„ä¸šåŠ¡é€»è¾‘ã€‚è™½ç„¶æ¯å¤©å·¥ä½œå¾ˆç´¯ï¼Œä½†æ¯å¤©éƒ½æ˜¯æ»¡æ»¡çš„æ”¶è·ã€‚ è€Œç°åœ¨ä¿¨ç„¶åœ¨æŸäº›æ–¹é¢å·²ç»æ˜¯è€æ‰‹äº†ï¼Œå¯¹äºå·¥ä½œä¸­é‡åˆ°çš„ä¸€èˆ¬é—®é¢˜éƒ½èƒ½æ¸¸åˆƒæœ‰ä½™çš„è§£å†³ã€‚è®¡ç®—é‡åˆ°é—®é¢˜ä¹Ÿæ˜¯åœ¨ç°æœ‰çš„æ¥å£ä¸Šä¿®æ”¹æ·»åŠ æœ€å¤šé‡æ–°è®¾è®¡ä¸€ç•ªï¼Œå•é—®é¢˜æ˜¯è¿™æ ·é•¿æ­¤ä»¥å¾€ä¸‹å»ä¼šå˜æˆæ¸©æ°´ç…®é’è›™ï¼Œè‡ªç„¶è€Œç„¶çš„å‘ç°ç°åœ¨æ²¡æœ‰ä»¥å‰åˆšå¼€å§‹é‚£æ ·çªé£çŒ›è¿›çš„è¿›æ­¥äº†ã€‚è¿™æ—¶ä»–æƒ³èµ·ä¸€å¥å¤§ç¥è¯´è¿‡çš„è¯ï¼Œæˆ–è®¸ä½ éœ€è¦ç»å†ä¸€æ®µæ²¡æœ‰å¤§ç¥å¸¦çš„é˜¶æ®µã€‚æˆ–è®¸æ˜¯è¿™æ ·çš„ï¼Œè·Ÿéšå¤§ç¥èƒ½å¤Ÿå­¦æ ¡å’Œæ¥è§¦åˆ°å¾ˆå¤šæ–°æŠ€æœ¯å’ŒçŸ¥è¯†ç‚¹ï¼Œä½†è¿™ç§åœ¨å¤§ç¥çš„æŠ€æœ¯å®åŠ›èƒŒåæ°¸è¿œä¸ä¼šå‘ç°è‡ªå·±çœŸæ­£çš„é—®é¢˜å’Œæ¬ ç¼ºç‚¹åœ¨å“ªé‡Œï¼Œé—®é¢˜éƒ½æ˜¯å¤§ç¥å¸®ä½ è§£å†³äº†ï¼Œæ€è·¯å¤§ç¥ä¹Ÿç»™ä½ æƒ³å¥½äº†ã€‚é‚£ä¹ˆä½ åšçš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±åªæ˜¯æŒ‰ç…§åˆ«äººçš„æ€è·¯å»åšäº‹è€Œå·²ï¼Œæ°¸è¿œä¸ä¼šåŸ¹å…»å‡ºæ¥è‡ªå·±çš„æ€ç»´æ¨¡å¼ï¼Œä¸ä¼šç‹¬ç«‹æ€è€ƒã€‚è¿™æœ‰ä¸¤ç§ç»“å±€ï¼Œä¸€ç§è‡ªå·±åŠªåŠ›æˆé•¿å­¦ä¹ åŸ¹å…»å‡ºè‡ªå·±çš„æ€ç»´æ¨¡å¼ï¼Œå­¦ä¼šç‹¬ç«‹æ€è€ƒã€‚æˆ–è€…åœ¨æ¸©æ°´ä¸­éšé‡è€Œå®‰ï¼Œæ…¢æ…¢çš„å’Œå¤§å¤šæ•°äººä¸€æ ·å°±è¿™æ ·äº†ï¼Œä¹Ÿå°±åºŸäº†ï¼ æˆé•¿æ›²çº¿å¾ˆå¤šæŠ€æœ¯äººå‘˜åœ¨å·¥ä½œä¸€ä¸¤å¹´ä¹‹åï¼Œå¯¹å·¥ä½œå‘¨å›´çš„äº‹æƒ…éƒ½é©¾è½»å°±ç†Ÿäº†ï¼Œå°±å¯èƒ½ä¼šé™·å…¥ç¬¬ä¸€ä¸ªç“¶é¢ˆæœŸï¼Œå†éš¾çªç ´ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œçªç ´çš„è¿‡ç¨‹ï¼Œç»éè½»è€Œæ˜“ä¸¾ï¼Œè€Œä¸”æœ‰å¯èƒ½ä¼´éšç€é˜µç—›ã€‚èˆ’é€‚æœŸå¯¹äººæœ‰ä¸€ç§å¤©ç„¶çš„å¸å¼•åŠ›ï¼Œæˆ‘ä»¬åªè¦å¾…åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå°±èƒ½è·å¾—æœ€å¤§çš„å®‰å…¨æ„Ÿï¼Œå°½é‡å°‘åœ°é­å—ä¸ç¡®å®šæ€§çš„æŠ˜ç£¨ã€‚å¾ˆå¤šäººä¼šé€‰æ‹©å¾…åœ¨è¿™ä¸ªåŒºé—´ï¼Œä¸å†èµ°å‡ºä¸€æ­¥ã€‚è€Œå¦ä¸€äº›äººåˆ™ä¼šå¯¹è¿™ä¸€é˜¶æ®µçš„ç¼“æ…¢å¢é•¿äº§ç”Ÿç„¦è™‘ï¼Œäºæ˜¯èˆ’é€‚æœŸå˜æˆäº†ç“¶é¢ˆæœŸï¼Œä»è€Œå¼•å‘ä¸‹ä¸€è½®çš„çªç ´ã€‚ çªç ´çš„è¦é¢† æ ¹åŸºï¼šè‰¯å¥½çš„åŸºç¡€æœ‰åˆ©äºæˆ‘ä»¬å¿«é€Ÿçªç ´ã€‚ ç¯å¢ƒï¼šè¿‡äºå®½æ¾çš„ç¯å¢ƒè‡ªç„¶ä¸åˆ©äºäººçš„è¿›æ­¥ï¼Œè€Œç›²ç›®çš„ç´§å¼ ä¹Ÿä¸åˆ©äºäººçš„æˆé•¿ã€‚çªç ´çš„è¿‡ç¨‹éœ€è¦ä»˜å‡ºå¤§é‡çš„ç²¾åŠ›ï¼Œæ‰€ä»¥éœ€è¦æŠ•å…¥è¶³å¤Ÿçš„æ—¶é—´å»ä»å®¹å®Œæˆã€‚ æ­£ç¡®çš„å­¦ä¹ èµ„æ–™ï¼šéœ€è¦ç³»ç»Ÿåœ°å»è¡¥ä¹ çŸ¥è¯†æ¶æ„ï¼ŒæŠ€å·§åº”è¯¥å»ºç«‹åœ¨å¯¹äºæ™®éè§„åˆ™çš„ç†è§£ä¹‹ä¸Šã€‚åœ¨å¥”å‘æŠ€æœ¯ä¸“å®¶çš„è·¯ä¸Šï¼Œé˜…è¯»Specï¼Œæ˜¯ä¸å¯é€¾è¶Šçš„ä¸€é“åŠŸè¯¾ã€‚æŠ€æœ¯çš„æ­£å®—ä¸é‡è·¯å­ ç‹¬ç«‹æ€è€ƒï¼šå¾ˆå¤šäººå–œæ¬¢æŠŠæŠ€æœ¯å¥½çš„äººå–Šä½œâ€œå¤§ç¥â€ï¼Œè¿™è‡ªç„¶æ˜¯ä»£è¡¨ä¸€ç§å°Šé‡ã€‚å¾ˆå¤šäººç¢°åˆ°é—®é¢˜å°±å–œæ¬¢æ‰¾èº«è¾¹â€œå¤§ç¥â€å»é—®ï¼Œä½†æ®Šä¸çŸ¥é—®å†å¤šé—®é¢˜ï¼Œä½ ä»ç„¶æ— æ³•çœŸæ­£åœ°æœ‰æ‰€æé«˜ã€‚æ™®é€šäººå’Œâ€œå¤§ç¥â€ä¹‹é—´çœŸæ­£çš„é¸¿æ²Ÿåœ¨äºï¼Œèƒ½å¦ç‹¬ç«‹æ€è€ƒå’Œè§£å†³é—®é¢˜ã€‚ æœºé‡ï¼šä¸å¾—ä¸æ‰¿è®¤å¥½çš„æœºé‡è®©ä½ é‡åˆ°å¥½çš„ç¯å¢ƒæ¥è§¦åˆ°å¥½çš„äººå¯ä»¥è®©ä½ äº‹åŠåŠŸå€ï¼Œæœ‰æ—¶å€™æŠ€æœ¯çš„ç“¶é¢ˆå¾€å¾€åªéœ€è¦åˆ«äººæç‚¹ä¸€äºŒã€‚","categories":[{"name":"me","slug":"me","permalink":"/categories/me/"}],"tags":[{"name":"grow","slug":"grow","permalink":"/tags/grow/"}],"keywords":[{"name":"me","slug":"me","permalink":"/categories/me/"}]},{"title":"mysql index","slug":"2018-03-24-mysql_index","date":"2018-03-23T16:00:00.000Z","updated":"2020-01-03T10:12:29.166Z","comments":true,"path":"2018/03/24/2018-03-24-mysql_index/","link":"","permalink":"/2018/03/24/2018-03-24-mysql_index/","excerpt":"ä»€ä¹ˆæ˜¯æ•°æ®åº“ç´¢å¼•ï¼ˆMysqlï¼‰ç”¨äº†è¿™ä¹ˆä¹…Mysqlï¼ŒMysqlç´¢å¼•ç›¸å…³çŸ¥è¯†ç‚¹å´ä¸å¤ªæ¸…æ¥šï¼Œå¯ä»¥è¯´åŒ®ä¹ã€‚æ­£å¥½çœ‹åˆ°æœ‰é¢è¯•é—®é“ï¼Œç¨å¾®çœ‹çœ‹å’Œæ•´ç†ä¸€ä¸‹ã€‚","text":"ä»€ä¹ˆæ˜¯æ•°æ®åº“ç´¢å¼•ï¼ˆMysqlï¼‰ç”¨äº†è¿™ä¹ˆä¹…Mysqlï¼ŒMysqlç´¢å¼•ç›¸å…³çŸ¥è¯†ç‚¹å´ä¸å¤ªæ¸…æ¥šï¼Œå¯ä»¥è¯´åŒ®ä¹ã€‚æ­£å¥½çœ‹åˆ°æœ‰é¢è¯•é—®é“ï¼Œç¨å¾®çœ‹çœ‹å’Œæ•´ç†ä¸€ä¸‹ã€‚ ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å­˜å‚¨å¼•æ“ï¼ˆstorage engineï¼‰çš„å®ç°ï¼Œä¸æ˜¯serverã€‚ä¸æ˜¯æ‰€æœ‰å­˜å‚¨å¼•æ“éƒ½æ”¯æŒæ‰€æœ‰çš„ç´¢å¼•ç±»å‹ã€‚å³ä½¿å¤šä¸ªå­˜å‚¨å¼•æ“æ”¯æŒæŸä¸€ç´¢å¼•ï¼Œå®ƒä»¬çš„å®ç°å’Œè¡Œä¸ºä¹Ÿå¯èƒ½æœ‰æ‰€ä¸åŒã€‚ Mysqlå®˜æ–¹å®šä¹‰ï¼šå¸®åŠ©Mysqlé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„,ç®€å•æ¥è¯´ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨ä»¥åŠ å¿«æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ã€‚ ç´¢å¼•çš„åˆ†ç±»æ•°æ®ç»“æ„è§’åº¦ B+æ ‘ç´¢å¼•(O(log(n)))ï¼šå…³äºB+æ ‘ç´¢å¼• hashç´¢å¼• åªèƒ½æ»¡è¶³ç›¸ç­‰æŸ¥è¯¢ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ æ•ˆç‡é«˜ã€ä¸€æ¬¡å®šä½ï¼Œä¸åƒB-Tree ç´¢å¼•éœ€è¦ä»æ ¹èŠ‚ç‚¹éå†ï¼ŒHash ç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡è¦è¿œé«˜äºB-Tree åªæœ‰Memoryå­˜å‚¨å¼•æ“æ˜¾ç¤ºæ”¯æŒhashç´¢å¼• FULLTEXTç´¢å¼•ï¼ˆMyISAMå’ŒInnoDBå¼•æ“éƒ½æ”¯æŒäº†ï¼‰ R-Treeç´¢å¼•ï¼ˆç”¨äºå¯¹GISæ•°æ®ç±»å‹åˆ›å»ºSPATIALç´¢å¼•ï¼‰ å­˜å‚¨è§’åº¦ èšé›†ç´¢å¼•ï¼ˆclustered indexï¼‰ è¾…åŠ©ç´¢å¼•ï¼ˆnon-clustered indexï¼‰ å‚è€ƒ é€»è¾‘è§’åº¦ ä¸»é”®ç´¢å¼•ï¼šä¸»é”®ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ æ™®é€šç´¢å¼•æˆ–è€…å•åˆ—ç´¢å¼• å¤šåˆ—ç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰ï¼šå¤åˆç´¢å¼•æŒ‡å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œåªæœ‰åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨äº†åˆ›å»ºç´¢å¼•æ—¶çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œç´¢å¼•æ‰ä¼šè¢«ä½¿ç”¨ã€‚æœ€å·¦å‰ç¼€åŸåˆ™ å”¯ä¸€ç´¢å¼• ç©ºé—´ç´¢å¼•ï¼ˆMYISAMï¼‰ï¼šç©ºé—´ç´¢å¼•æ˜¯å¯¹ç©ºé—´æ•°æ®ç±»å‹çš„å­—æ®µå»ºç«‹çš„ç´¢å¼•ï¼ŒMYSQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯GEOMETRYã€POINTã€LINESTRINGã€POLYGONã€‚MYSQLä½¿ç”¨SPATIALå…³é”®å­—è¿›è¡Œæ‰©å±•ï¼Œä½¿å¾—èƒ½å¤Ÿç”¨äºåˆ›å»ºæ­£è§„ç´¢å¼•ç±»å‹çš„è¯­æ³•åˆ›å»ºç©ºé—´ç´¢å¼•ã€‚åˆ›å»ºç©ºé—´ç´¢å¼•ï¼Œå¿…é¡»å£°æ˜ä¸ºNOT NULLï¼Œåªèƒ½åœ¨MYISAMçš„è¡¨ä¸­åˆ›å»º ä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„åŒºåˆ«ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ï¼Œå”¯ä¸€ç´¢å¼•å¯ä»¥ä¸ºç©ºã€‚æ™®é€šç´¢å¼•æˆ–å•åˆ—ç´¢å¼•åªæ˜¯å­—æ®µæ•°æ®å•ç‹¬ä½¿ç”¨æ•°æ®ç»“æ„å­˜å‚¨åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œæ²¡æœ‰å…¶ä»–ç‰¹æ®Šçº¦æŸã€‚ æœ‰ç´¢å¼•ä½†ä¸ç”Ÿæ•ˆçš„æƒ…å†µ å¦‚æœæ¡ä»¶ä¸­æœ‰orï¼Œå³ä½¿å…¶ä¸­æœ‰éƒ¨åˆ†æ¡ä»¶å¸¦ç´¢å¼•ä¹Ÿä¸ä¼šä½¿ç”¨ï¼Œè¦æƒ³ä½¿ç”¨orï¼Œåˆæƒ³è®©ç´¢å¼•ç”Ÿæ•ˆï¼Œåªèƒ½å°†oræ¡ä»¶ä¸­çš„æ¯ä¸ªåˆ—éƒ½åŠ ä¸Šç´¢å¼•ã€‚ å¯¹äºå¤šåˆ—ç´¢å¼•ï¼Œæ»¡è¶³æ–­ç‚¹å‰ç”Ÿæ•ˆè§„åˆ™ï¼Œå‚è€ƒã€‚ likeæŸ¥è¯¢æ˜¯ä»¥%å¼€å¤´ã€‚ å­˜åœ¨æ•°æ®ç±»å‹éšå½¢è½¬æ¢ï¼ˆå¦‚ï¼šå­—æ®µæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ŒæŸ¥è¯¢æ—¶ä¸åŠ å¼•å·ï¼‰ã€‚ whereæ¡ä»¶å¯¹å­—æ®µæœ‰æ•°å­¦è¿ç®—ã€‚ whereæ¡ä»¶å¯¹å­—æ®µä½¿ç”¨å‡½æ•°ã€‚ mysqlåˆ¤æ–­ä½¿ç”¨å…¨è¡¨æ‰«æè¦æ¯”ä½¿ç”¨ç´¢å¼•æ—¶ï¼ˆå¦‚ï¼šæ•°æ®é‡æå°‘æ—¶ï¼‰ã€‚ ä¸æ¨èä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ æ•°æ®å”¯ä¸€æ€§å·®ï¼ˆå–å€¼åªæœ‰å‡ ç§ï¼Œæ„å‘³ç€ç´¢å¼•æ ‘çº§åˆ«å°‘ï¼Œå¤šæ˜¯å¹³çº§ï¼Œæ— å¼‚äºå…¨è¡¨æ‰«æï¼‰ é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸è¦ä½¿ç”¨ç´¢å¼•ï¼ˆé¢‘ç¹å˜åŒ–å¯¼è‡´ç´¢å¼•ä¹Ÿé¢‘ç¹å˜åŒ–ï¼Œå¢å¤§æ•°æ®åº“å·¥ä½œé‡ï¼Œé™ä½æ•ˆç‡ï¼‰ å­—æ®µä¸åœ¨whereè¯­å¥å‡ºç°æ—¶ whereåå«IS NULL / IS NOT NULL/ like â€˜%**%â€™ ç­‰æ¡ä»¶æ—¶ where å­å¥é‡Œå¯¹ç´¢å¼•åˆ—ä½¿ç”¨ä¸ç­‰äºï¼ˆ&lt;&gt;ï¼‰ï¼Œä½¿ç”¨ç´¢å¼•æ•ˆæœä¸€èˆ¬ è¦†ç›–ç´¢å¼•ï¼ˆcovering indexï¼‰covering index æå‡æŸ¥è¯¢æ•ˆç‡ï¼šMySQLåªéœ€è¦é€šè¿‡ç´¢å¼•å°±å¯ä»¥è¿”å›æŸ¥è¯¢æ‰€éœ€è¦çš„æ•°æ®ï¼Œä¸å¿…å›è¡¨æŸ¥è¯¢ã€‚å‚è€ƒ ä¼˜åŒ–ç»éªŒå‚è€ƒï¼šhttps://blog.csdn.net/kaka1121/article/details/53395587å‚è€ƒï¼šhttp://www.cnblogs.com/hongfei/archive/2012/10/19/2731342.html","categories":[{"name":"db","slug":"db","permalink":"/categories/db/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"/tags/mysql/"}],"keywords":[{"name":"db","slug":"db","permalink":"/categories/db/"}]},{"title":"let's encrypt","slug":"2018-03-18-let's_encrypt","date":"2018-03-17T16:00:00.000Z","updated":"2020-01-03T10:12:29.243Z","comments":true,"path":"2018/03/18/2018-03-18-let's_encrypt/","link":"","permalink":"/2018/03/18/2018-03-18-let's_encrypt/","excerpt":"è·å–letâ€™s encryptå…è´¹æ³›åŸŸåè¯ä¹¦é¦–å…ˆDNSéœ€è¦æ”¯æŒCAAï¼Œæˆ‘ç”¨çš„CloudXNSï¼Œæ·»åŠ CAAè®°å½•è®°å½•å€¼0 issue letsencrypt.org,vpscurl https://get.acme.sh|sh,æ·»åŠ ç¯å¢ƒå˜é‡","text":"è·å–letâ€™s encryptå…è´¹æ³›åŸŸåè¯ä¹¦é¦–å…ˆDNSéœ€è¦æ”¯æŒCAAï¼Œæˆ‘ç”¨çš„CloudXNSï¼Œæ·»åŠ CAAè®°å½•è®°å½•å€¼0 issue letsencrypt.org,vpscurl https://get.acme.sh|sh,æ·»åŠ ç¯å¢ƒå˜é‡ export CX_Key=&quot;&quot; export CX_Secret=&quot;&quot; .acme.sh/acme.sh --issue --dns dns_cx -d *.sjis.me -d sjis.me --keylength ec-384 å…¶ä¸­CX_keyå’ŒCX_Secretåˆ†åˆ«æ˜¯CloudXNSè´¦æˆ·ä¸­çš„API KEYå’ŒSECRET KEYè·‘å®Œä¹‹åä¼šå‘ç°CloudXNSå¤šäº†ä¸¤æ¡TXTè®°å½•ã€‚ä¹‹åç­‰å¾…ä¸€ä¸¤åˆ†é’Ÿç­‰è®°å½•ç”Ÿæ•ˆã€‚æœ€åç›´æ¥éªŒè¯ç­¾å‘è¯ä¹¦ ~/.acme.sh/acme.sh --installcert --ecc -d *.sjis.me --key-file /etc/ssl/caddy/*.sjis.me.key --fullchain-file /etc/ssl/caddy/fullchain.cer","categories":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}],"tags":[{"name":"certificate","slug":"certificate","permalink":"/tags/certificate/"}],"keywords":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}]},{"title":"CloudXNS DDNS","slug":"2018-03-18-cloudxns_ddns","date":"2018-03-17T16:00:00.000Z","updated":"2020-01-03T09:55:50.146Z","comments":true,"path":"2018/03/18/2018-03-18-cloudxns_ddns/","link":"","permalink":"/2018/03/18/2018-03-18-cloudxns_ddns/","excerpt":"DDNSDynamic Domain Name Server(åŠ¨æ€åŸŸåæœåŠ¡)ï¼ŒDDNSæ˜¯å°†ç”¨æˆ·çš„åŠ¨æ€IPåœ°å€æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šçš„åŸŸåè§£ææœåŠ¡ä¸Šï¼Œç”¨æˆ·æ¯æ¬¡è¿æ¥ç½‘ç»œçš„æ—¶å€™å®¢æˆ·ç«¯ç¨‹åºå°±ä¼šé€šè¿‡ä¿¡æ¯ä¼ é€’æŠŠè¯¥ä¸»æœºçš„åŠ¨æ€IPåœ°å€ä¼ é€ç»™ä½äºæœåŠ¡å•†ä¸»æœºä¸Šçš„æœåŠ¡å™¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç¨‹åºè´Ÿè´£æä¾›DNSæœåŠ¡å¹¶å®ç°åŠ¨æ€åŸŸåè§£æã€‚","text":"DDNSDynamic Domain Name Server(åŠ¨æ€åŸŸåæœåŠ¡)ï¼ŒDDNSæ˜¯å°†ç”¨æˆ·çš„åŠ¨æ€IPåœ°å€æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šçš„åŸŸåè§£ææœåŠ¡ä¸Šï¼Œç”¨æˆ·æ¯æ¬¡è¿æ¥ç½‘ç»œçš„æ—¶å€™å®¢æˆ·ç«¯ç¨‹åºå°±ä¼šé€šè¿‡ä¿¡æ¯ä¼ é€’æŠŠè¯¥ä¸»æœºçš„åŠ¨æ€IPåœ°å€ä¼ é€ç»™ä½äºæœåŠ¡å•†ä¸»æœºä¸Šçš„æœåŠ¡å™¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç¨‹åºè´Ÿè´£æä¾›DNSæœåŠ¡å¹¶å®ç°åŠ¨æ€åŸŸåè§£æã€‚ åœºæ™¯ç”µä¿¡å…‰çº¤è™½ç„¶ä¼šç»™ä¸€ä¸ªå…¬ç½‘ipï¼Œä½†æ˜¯è¿™ä¸ªå…¬ç½‘ipç»å¸¸ä¼šå˜ï¼Œè¿™å°±ç»™æˆ‘ä»¬éƒ¨ç½²äº›è‡ªå·±çš„åšå®¢ç­‰å°æœåŠ¡å¸¦æ¥å¾ˆå¤šéº»çƒ¦ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æ€»æ˜¯åœ¨å…¬ç½‘ipå˜äº†åå…ˆå»çœ‹è·¯ç”±çš„å…¬ç½‘ipç„¶åå†é‡æ–°è®¾ç½®dnsè§£æipã€‚è¿™å°±ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤šå›°æ‰°ï¼Œddnså°±éå¸¸é€‚åˆè¿™ç§åœºæ™¯ã€‚ CloudXNS DDNSæˆ‘è¿™é‡Œç”¨çš„ä¸€ä¸ªgithubä¸€ä¸ªå¼€æºé¡¹ç›®cloudxns-ddnsï¼Œgoè¯­è¨€å°è£…çš„CloudXNSçš„apié€šè¿‡å®šæ—¶è¯·æ±‚CloudXNSçš„apiæ¥å£æ¥åŠ¨æ€è®¾ç½®å¯¹åº”åŸŸåçš„è§£æipåœ°å€ã€‚","categories":[{"name":"dns","slug":"dns","permalink":"/categories/dns/"}],"tags":[{"name":"dns","slug":"dns","permalink":"/tags/dns/"}],"keywords":[{"name":"dns","slug":"dns","permalink":"/categories/dns/"}]},{"title":"ubuntu nat","slug":"2018-02-01-ubuntu_nat","date":"2018-01-31T16:00:00.000Z","updated":"2020-01-03T10:12:29.205Z","comments":true,"path":"2018/02/01/2018-02-01-ubuntu_nat/","link":"","permalink":"/2018/02/01/2018-02-01-ubuntu_nat/","excerpt":"åœºæ™¯å…¬å¸iBoxï¼ˆubuntu 16.04ç³»ç»Ÿï¼‰éœ€è¦ä¸æœºåºŠè¿æ¥å®ç°å®ç°ä¸šåŠ¡ï¼ŒiBoxæœ¬èº«åªæœ‰ä¸¤ä¸ªç½‘å£ï¼Œéœ€è¦ä¸€ä¸ªå£è¿æ¥å‚æˆ¿å†…ç½‘è·¯ç”±ï¼Œä¸€ä¸ªå£ä¸æœºåºŠç›´è¿ï¼ŒæœºåºŠæœ¬èº«éœ€è¦èƒ½å¤Ÿè¿æ¥å¤–ç½‘ã€‚è¿™æ—¶å€™å°±éœ€è¦iBoxå®ç°natè½¬å‘å¹¶å®ç°è·¯ç”±åŠŸèƒ½ã€‚","text":"åœºæ™¯å…¬å¸iBoxï¼ˆubuntu 16.04ç³»ç»Ÿï¼‰éœ€è¦ä¸æœºåºŠè¿æ¥å®ç°å®ç°ä¸šåŠ¡ï¼ŒiBoxæœ¬èº«åªæœ‰ä¸¤ä¸ªç½‘å£ï¼Œéœ€è¦ä¸€ä¸ªå£è¿æ¥å‚æˆ¿å†…ç½‘è·¯ç”±ï¼Œä¸€ä¸ªå£ä¸æœºåºŠç›´è¿ï¼ŒæœºåºŠæœ¬èº«éœ€è¦èƒ½å¤Ÿè¿æ¥å¤–ç½‘ã€‚è¿™æ—¶å€™å°±éœ€è¦iBoxå®ç°natè½¬å‘å¹¶å®ç°è·¯ç”±åŠŸèƒ½ã€‚ é…ç½®routeræ‰“å¼€è·¯ç”±è½¬å‘ï¼š # cat /proc/sys/net/ipv4/ip_forward æŸ¥çœ‹æ˜¯å¦æ‰“å¼€è·¯ç”±è½¬å‘ï¼Œ0åˆ™æ²¡æœ‰æ‰“å¼€ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ‰“å¼€ï¼š # echo 1 &gt; /proc/sys/net/ipv4/ip_forward é€šè¿‡ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶ï¼Œnet.ipv4.ip_forward = 1ï¼Œç„¶åæ‰§è¡Œsysctl -på¯ä»¥æ°¸ä¹…æ‰“å¼€ SNATè¿™é‡Œeth0ä½œä¸ºå†…ç½‘å£ï¼Œeth1ä½œä¸ºå¤–ç½‘å£ä¸¤ç§å®ç°æ–¹å¼ï¼šç¬¬ä¸€ç§ï¼š # iptables -t nat -A POSTROUTING -s 192.168.6.0/24 -o eth1 -j MASQUERADE ç¬¬äºŒç§ï¼š iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT iptables -A FORWARD -i eth1 -o eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT å»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œç¬¬ä¸€ç§å­˜åœ¨çš„å¼Šç«¯æ˜¯æŒ‡å®šäº†å†…ç½‘ç½‘æ®µï¼Œå½“éœ€è¦ä¿®æ”¹å†…ç½‘ipæ—¶ä¼šå¯¼è‡´å†…ç½‘æœºå™¨æ— æ³•è®¿é—®å¤–ç½‘äº†ï¼Œç¬¬äºŒç§æ–¹å¼åˆ™æ˜¯åœ¨ä¸¤ä¸ªç½‘å¡ç›´æ¥åšæµé‡è½¬å‘ï¼Œå…å»ä¿®æ”¹ipçš„é—®é¢˜ã€‚ ä¿å­˜é…ç½®# iptables-save &gt; /etc/iptables/rules.v4 å®‰è£…iptables-persistentapt-get install iptables-persistent ç³»ç»Ÿå¯åŠ¨æ—¶iptables-persistentä¼šä»¥å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨åŠ è½½/etc/iptables/rules.v4çš„é…ç½® æ‰‹åŠ¨æ¢å¤é…ç½®# iptables-restore &lt; /etc/iptables/rules.v4 æŸ¥çœ‹natè½¬å‘åˆ—è¡¨# iptables -t nat --list dhcpå®‰è£…äºé…ç½®å®‰è£…# sudo apt-get install isc-dhcp-server é…ç½®vim /etc/default/isc-dhcp-server # On what interfaces should the DHCP server (dhcpd) serve DHCP requests? # Separate multiple interfaces with spaces, e.g. &quot;eth0 eth1&quot;. INTERFACES=&quot;eth0&quot; INTERFACESä¿®æ”¹ä¸ºå¯¹åº”çš„å†…ç½‘ç½‘å£ ä¿®æ”¹/etc/dhcp/dhcpd.confé…ç½®æ–‡ä»¶ # vim /etc/dhcp/dhcpd.conf ä¿®æ”¹ä¸º subnet 192.168.6.0 netmask 255.255.255.0 { range 192.168.6.100 192.168.6.200; option routers 192.168.6.1; option broadcast-address 192.168.6.255; option domain-name-servers 114.114.114.114; default-lease-time 600; max-lease-time 7200; } å…¶ä¸­çš„ipã€æ©ç ç­‰ä¿®æ”¹ä¸ºå¯¹åº”å†…ç½‘ç½‘å£çš„ipä¸æ©ç ï¼Œè¿™é‡Œä»¥192.168.6.1ä¸ºä¾‹ã€‚é…ç½®å®Œä¹‹åé‡å¯dhcpæœåŠ¡service isc-dhcp-server restart","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"ubuntu","slug":"ubuntu","permalink":"/tags/ubuntu/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"nginx request copy","slug":"2018-01-29-nginx_http_mirro","date":"2018-01-28T16:00:00.000Z","updated":"2020-01-03T09:35:02.392Z","comments":true,"path":"2018/01/29/2018-01-29-nginx_http_mirro/","link":"","permalink":"/2018/01/29/2018-01-29-nginx_http_mirro/","excerpt":"é—®é¢˜ç›®å‰å…¬å¸å‰ç«¯é¡¹ç›®çš„å›¾ç‰‡æ–‡ä»¶å…¨éƒ¨æ˜¯é€šè¿‡è¯·æ±‚åå°è·å–tokenæ¥å£è·å–ä¸ƒç‰›ä¸Šä¼ tokenï¼Œç„¶åå‰ç«¯ç›´æ¥ä¸Šä¼ ä¸ƒç‰›ã€‚è¿™ä¸ªæœºåˆ¶æœ¬èº«ä¸å­˜åœ¨é—®é¢˜ï¼Œé—®é¢˜åœ¨äºå…¬å¸ä½¿ç”¨äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹æˆæƒæœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨éœ€è¦ä¸‹è½½æ‹¿åˆ°ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ã€‚é—®é¢˜æ¥äº†ï¼Œè¿™ä¸ªæœåŠ¡å™¨å½“åˆéƒ¨ç½²åœ¨å†…ç½‘ï¼Œå¦‚æœéœ€è¦å®ƒè®¿é—®åˆ°ä¸Šä¼ å›¾ç‰‡ï¼Œéœ€è¦å°†æ–‡ä»¶åœ¨ç”¨æˆ·ä¸Šä¼ åå†å¤‡ä»½åˆ°ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ã€‚","text":"é—®é¢˜ç›®å‰å…¬å¸å‰ç«¯é¡¹ç›®çš„å›¾ç‰‡æ–‡ä»¶å…¨éƒ¨æ˜¯é€šè¿‡è¯·æ±‚åå°è·å–tokenæ¥å£è·å–ä¸ƒç‰›ä¸Šä¼ tokenï¼Œç„¶åå‰ç«¯ç›´æ¥ä¸Šä¼ ä¸ƒç‰›ã€‚è¿™ä¸ªæœºåˆ¶æœ¬èº«ä¸å­˜åœ¨é—®é¢˜ï¼Œé—®é¢˜åœ¨äºå…¬å¸ä½¿ç”¨äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹æˆæƒæœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨éœ€è¦ä¸‹è½½æ‹¿åˆ°ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ã€‚é—®é¢˜æ¥äº†ï¼Œè¿™ä¸ªæœåŠ¡å™¨å½“åˆéƒ¨ç½²åœ¨å†…ç½‘ï¼Œå¦‚æœéœ€è¦å®ƒè®¿é—®åˆ°ä¸Šä¼ å›¾ç‰‡ï¼Œéœ€è¦å°†æ–‡ä»¶åœ¨ç”¨æˆ·ä¸Šä¼ åå†å¤‡ä»½åˆ°ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ã€‚ å®ç°é¦–å…ˆå°±é—®é¢˜æœ¬èº«ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç»™å‡ºä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š ä¸Šä¼ æ—¶åŒæ—¶ä¸Šä¼ åˆ°æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ ä¸Šä¼ ä¸ƒç‰›åä¸ƒç‰›è‡ªå·±å›è°ƒæˆ‘ä»¬çš„æ–‡ä»¶å¤‡ä»½æ¥å£ ä¸Šä¼ ååœ¨ä¸ƒç‰›å›è°ƒæˆ‘ä»¬çš„æ¥å£æ—¶ä¸‹è½½åå†å¤‡ä»½åˆ°æœåŠ¡å™¨ é¦–å…ˆçœ‹ç¬¬ä¸€ç§ï¼Œè¿™ç§å°±æ˜¯ä¸Šä¼ äº†ä¸¤æ¬¡æ–‡ä»¶ï¼Œå¤ªæµªè´¹å®¢æˆ·ç«¯æµé‡å’Œå¸¦å®½ï¼Œè€Œä¸”ä¹Ÿä¸ä¼˜é›…ã€‚ç¬¬äºŒç§æƒ³æ³•å¦‚æœå¯è¡Œçš„è¯å½“ç„¶æ˜¯æœ€å¥½çš„æ–¹å¼ï¼Œä½†æ˜¯å°±ç›®å‰æ¥çœ‹ä¸ƒç‰›è²Œä¼¼æ²¡æœ‰ç±»ä¼¼çš„æ¥å£ã€‚é‚£ä¹ˆå°±åªæœ‰ç¬¬ä¸‰ç§æ–¹å¼ã€‚ å…·ä½“å®ç°é€šè¿‡ä¸ƒç‰›å›è°ƒæˆ‘ä»¬è‡ªå·±çš„æ¥å£å†å»å¤‡ä»½ï¼Œè¿™é‡ŒåŒæ ·ä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š åœ¨å›è°ƒæ¥å£ä¸­é€šè¿‡mqå¼‚æ­¥ä¸‹è½½å’Œå¤‡ä»½æ–‡ä»¶ nginxä¸­é€šè¿‡è¯·æ±‚çš„æ‹·è´|é•œåƒè¯·æ±‚å®ç°å°†è¯·æ±‚åŒæ—¶è½¬ç»™å¦ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç†æ–‡ä»¶å¤‡ä»½çš„æ¥å£ä»ç¨‹åºçš„è§£è€¦å’Œæ•´ä½“æ¶æ„ä¸Šçœ‹å¯èƒ½nginxæµé‡çš„æ‹·è´|é•œåƒæ›´ä¸ºç†æƒ³ï¼ŒåŒæ—¶å®ç°ç¨æ˜¾å¤æ‚ï¼ŒåŒæ—¶éœ€è¦ä¸è¿ç»´çš„åŒäº‹è¿›è¡Œæ²Ÿé€šäº¤æµå¹¶è¿›è¡Œnginxçš„é…ç½®è°ƒè¯•ã€‚ç›´æ¥é€šè¿‡åŸæœ‰æ¥å£mqå¼‚æ­¥å¤‡ä»½æ–‡ä»¶ä¹Ÿæ˜¯ä¸€ç§å®ç°æ–¹å¼ï¼Œä¸¤è€…ä¸ªäººè®¤ä¸ºéƒ½æ˜¯å¯è¡Œæ–¹æ¡ˆï¼Œå¦‚æœæ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹å»ºè®®ç¬¬äºŒç§ï¼Œæ¯•ç«Ÿç¨‹åºå‘˜å°±æ˜¯å–œæ¬¢æŠ˜è…¾-_-ã€‚é€šè¿‡mqå¼‚æ­¥è¿›è¡Œæ–‡ä»¶å¤‡ä»½çš„æ–¹å¼æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯å‘mqæ¶ˆæ¯ï¼Œä¸‹è½½ä¸Šä¼ ã€‚æœ¬æ–‡é‡ç‚¹ï¼Œå¦‚ä½•é€šè¿‡nginxè¿›è¡Œè¯·æ±‚çš„copy|é•œåƒè½¬å‘ã€‚ post_actionæ–¹å¼location / { uwsgi_pass unix:app.sock; post_action @post_action; } location @post_action { proxy_pass http://dst_host:dst_port; } è¿™ç§æ–¹å¼è¯·æ±‚é¦–å…ˆä¼ é€’ç»™unixï¼šapp.sockï¼Œå¹¶åœ¨å®Œæˆæ—¶ï¼Œpost_actionæŒ‡ä»¤å°†è¯·æ±‚ä¼ é€’ç»™æŒ‡å®šä½ç½®çš„@post_actionã€‚ä½†æ˜¯è¿™ç§æ–¹å¼@post_actionä¸­çš„proxy_passä¸èƒ½æ˜¯uriï¼Œæ¯”å¦‚ï¼šhttp://ip:port/test;è¿™ç§æ˜¯ä¸å¯ä»¥çš„ã€‚å¾ˆå¯æƒœ... mirror_modulenginx1.13.4ä¹‹åå¼€å§‹æ”¯æŒngx_http_mirror_moduleæ¨¡å—ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯·æ±‚é•œåƒè½¬å‘æ¨¡å—ï¼Œç›¸ä¿¡å¬åå­—å°±çŸ¥é“æ˜¯å¹²å˜›çš„äº†ï¼Œè¯·æ±‚é•œåƒæ‹·è´è½¬å‘å‘—ã€‚ # originalé…ç½® location / { mirror /mirror; mirror_request_body off; proxy_pass http://127.0.0.1:9502; } # mirroré…ç½® location /mirror { internal; proxy_pass http://127.0.0.1:8081$request_uri; proxy_set_header X-Original-URI $request_uri; } å‚è€ƒhttps://www.centos.bz/2017/08/nginx-request-copy-ngx_http_mirror_module/","categories":[],"tags":[{"name":"nginx","slug":"nginx","permalink":"/tags/nginx/"}],"keywords":[]},{"title":"openpgpç­¾åä¸éªŒç­¾","slug":"2018-01-23-go_java_signature_check","date":"2018-01-22T16:00:00.000Z","updated":"2020-01-03T09:55:50.250Z","comments":true,"path":"2018/01/23/2018-01-23-go_java_signature_check/","link":"","permalink":"/2018/01/23/2018-01-23-go_java_signature_check/","excerpt":"å­˜åœ¨çš„é—®é¢˜ç›®å‰æ¯æ¬¡ç¨‹åºç‰ˆæœ¬å‘å¸ƒéœ€è¦æ‰‹åŠ¨gpgç­¾åå¹¶æ‰“åŒ…å‘å¸ƒï¼Œå­˜åœ¨çš„é—®é¢˜ï¼š æ¯æ¬¡éƒ½éœ€è¦äººå·¥æ‰‹åŠ¨ä½¿ç”¨gpgç­¾å å¦‚æœå¦‚æœéœ€è¦ç­¾åå‘å¸ƒçš„appå˜å¤šä¹Ÿä¼šå¢åŠ å¾ˆå¤šé‡å¤åŠ³åŠ¨ å…¶ä»–é¡¹ç›®æˆ–åº”ç”¨æ–‡ä»¶ç­¾åä¸‹å‘éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£","text":"å­˜åœ¨çš„é—®é¢˜ç›®å‰æ¯æ¬¡ç¨‹åºç‰ˆæœ¬å‘å¸ƒéœ€è¦æ‰‹åŠ¨gpgç­¾åå¹¶æ‰“åŒ…å‘å¸ƒï¼Œå­˜åœ¨çš„é—®é¢˜ï¼š æ¯æ¬¡éƒ½éœ€è¦äººå·¥æ‰‹åŠ¨ä½¿ç”¨gpgç­¾å å¦‚æœå¦‚æœéœ€è¦ç­¾åå‘å¸ƒçš„appå˜å¤šä¹Ÿä¼šå¢åŠ å¾ˆå¤šé‡å¤åŠ³åŠ¨ å…¶ä»–é¡¹ç›®æˆ–åº”ç”¨æ–‡ä»¶ç­¾åä¸‹å‘éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ å…¶å®ä¹Ÿè€ƒè™‘è¿‡å†™è„šæœ¬è¿›è¡Œç­¾åï¼Œä½†æ˜¯ç”Ÿäº§æœºå™¨è¿˜éœ€è¦è£…gpgæ¯”è¾ƒéº»çƒ¦ã€‚å…¶å®ä¸»è¦è¿˜æ˜¯æƒ³å­¦ä¹ ä¸€ä¸‹å¦‚ä½•ä»£ç è¿›è¡ŒgpgåŠ å¯†,å“ˆå“ˆâ€¦ golang openpgpç­¾åéªŒç­¾å…¶å®å…¬å¸éœ€è¦çš„æ˜¯javaç‰ˆï¼Œä½†æ˜¯æœ€è¿‘ä¸€ç›´åœ¨åšgoçš„é¡¹ç›®ï¼Œå¹¶ä¸”ä»¥ågoçš„é¡¹ç›®è¯´ä¸å®šä¹Ÿä¼šç”¨åˆ°ã€‚è™½ç„¶è¯­è¨€ä¸é€šï¼Œä½†ä¹Ÿä½œä¸ºæ‘¸ç´¢ç­¾ååŠ å¯†çš„ä¸€ç§é€”å¾„ã€‚ package main import ( &quot;bytes&quot; &quot;golang.org/x/crypto/openpgp&quot; &quot;os&quot; &quot;io/ioutil&quot; ) func main() { ArmoredDetachSign(&quot;d:/test.txt&quot;) CheckArmoredDetachedSignature(&quot;d:/test.txt.asc&quot;,&quot;d:/test.txt&quot;) } //CheckArmoredDetachedSignature openpgpéªŒç­¾ func CheckArmoredDetachedSignature(signatureFile, verificationFile string) (*openpgp.Entity, error) { pubring, err := ioutil.ReadFile(&quot;path to pubring.gpg&quot;) keyRingReader := bytes.NewBuffer(pubring) signature, err := os.Open(signatureFile) if err != nil { return nil, err } defer signature.Close() verification, err := os.Open(verificationFile) if err != nil { return nil, err } defer verification.Close() keyring, err := openpgp.ReadKeyRing(keyRingReader) if err != nil { return nil, err } entity, err := openpgp.CheckArmoredDetachedSignature(keyring, verification, signature) if err != nil { return nil, err } return entity, nil } //ArmoredDetachSign openpgpç­¾å func ArmoredDetachSign(signFile string) error { var entity *openpgp.Entity var entityList openpgp.EntityList pubring, err := ioutil.ReadFile(&quot;path to secring.gpg&quot;) if err!=nil{ return err } keyringFileBuffer := bytes.NewBuffer(pubring) entityList, err = openpgp.ReadKeyRing(keyringFileBuffer) if err != nil { return err } entity = entityList[0] passPhraseByte := []byte(&quot;your private key password&quot;) entity.PrivateKey.Decrypt(passPhraseByte) for _, subKey := range entity.Subkeys { subKey.PrivateKey.Decrypt(passPhraseByte) } sign, err := os.Open(signFile) if err != nil { return err } defer sign.Close() asc, err := os.Create(signFile + &quot;.asc&quot;) if err != nil { return err } defer asc.Close() err = openpgp.ArmoredDetachSign(asc, entity, sign, nil) if err != nil { return err } return nil } java openpgpç­¾åéªŒç­¾mavenå¼•å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt; &lt;artifactId&gt;bcprov-jdk15on&lt;/artifactId&gt; &lt;version&gt;1.59&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt; &lt;artifactId&gt;bcpg-jdk15on&lt;/artifactId&gt; &lt;version&gt;1.59&lt;/version&gt; &lt;/dependency&gt; è®°ä½ä¸€å®šè¦ä½¿ç”¨æœ€æ–°çš„1.59ç‰ˆæœ¬ï¼Œä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯jdk1.5ã€1.6ç‰ˆæœ¬ç¼–è¯‘çš„ï¼Œæˆ‘ä»¬ç°åœ¨é¡¹ç›®éƒ½æ˜¯1.8ç‰ˆæœ¬å·®å¼‚å¤ªå¤§æ— æ³•ç¼–è¯‘ã€‚ import org.apache.commons.io.*; import org.bouncycastle.bcpg.*; import org.bouncycastle.jce.provider.*; import org.bouncycastle.openpgp.*; import org.bouncycastle.openpgp.jcajce.*; import org.bouncycastle.openpgp.operator.jcajce.*; import java.io.*; import java.security.*; import java.util.*; /** * OpenGPGç­¾åå·¥å…·ç±» * * @author SunJun */ public class OpenPgpService { public static void main(String[] args) throws Exception { Security.addProvider(new BouncyCastleProvider()); createSignature(&quot;d:/test.txt&quot;, &quot;d:/test.txt.asc&quot;, true); verifySignature(&quot;d:/test.txt&quot;,&quot;d:/test.txt.asc&quot;); } /** * verifySignature ç­¾åéªŒè¯ * * @param fileName å¾…éªŒç­¾æ–‡ä»¶å * @param inputFileName ascæ–‡ä»¶ * @author SunJun */ public static boolean verifySignature(String fileName, String inputFileName) throws IOException, PGPException { InputStream in = null; InputStream keyIn = null; boolean result; try { in = new BufferedInputStream(new FileInputStream(inputFileName)); keyIn = new BufferedInputStream(new FileInputStream(new File(&quot;pubring.asc&quot;))); result = verifySignature(fileName, in, keyIn); } finally { IOUtils.closeQuietly(keyIn); IOUtils.closeQuietly(in); } return result; } /** * verifySignature * * @param fileName å¾…éªŒç­¾æ–‡ä»¶å * @param in ascæ–‡ä»¶æµ * @param keyIn å…¬é’¥æ–‡ä»¶ * @author SunJun */ private static boolean verifySignature(String fileName, InputStream in, InputStream keyIn) throws IOException, PGPException { PGPSignature sig; InputStream dIn = null; PGPSignatureList p3; in = PGPUtil.getDecoderStream(in); JcaPGPObjectFactory pgpFact = new JcaPGPObjectFactory(in); Object o = pgpFact.nextObject(); if (o instanceof PGPCompressedData) { PGPCompressedData c1 = (PGPCompressedData) o; pgpFact = new JcaPGPObjectFactory(c1.getDataStream()); p3 = (PGPSignatureList) pgpFact.nextObject(); } else { p3 = (PGPSignatureList) o; } PGPPublicKeyRingCollection pgpPubRingCollection = new PGPPublicKeyRingCollection(PGPUtil.getDecoderStream(keyIn), new JcaKeyFingerprintCalculator()); try { dIn = new BufferedInputStream(new FileInputStream(fileName)); sig = p3.get(0); PGPPublicKey key = pgpPubRingCollection.getPublicKey(sig.getKeyID()); sig.init(new JcaPGPContentVerifierBuilderProvider().setProvider(&quot;BC&quot;), key); int ch; while ((ch = dIn.read()) &gt;= 0) { sig.update((byte) ch); } } finally { IOUtils.closeQuietly(dIn); } return sig.verify(); } /** * createSignature æ–‡ä»¶ç­¾å * * @param inputFileName å¾…ç­¾åæ–‡ä»¶ * @param outputFileName ç­¾åascæ–‡ä»¶ * @param armor æ˜¯å¦ç”ŸæˆASSCIIç å½¢å¼ç­¾åæ–‡ä»¶ * @author SunJun */ public static void createSignature(String inputFileName, String outputFileName, boolean armor) throws IOException, PGPException { InputStream keyIn = null; OutputStream out = null; try { keyIn = new BufferedInputStream(new FileInputStream(new File(&quot;secring.asc&quot;))); out = new BufferedOutputStream(new FileOutputStream(outputFileName)); createSignature(inputFileName, keyIn, out, &quot;private key password&quot;.toCharArray(), armor); } finally { IOUtils.closeQuietly(keyIn); IOUtils.closeQuietly(out); } } /** * createSignature æ–‡ä»¶ç­¾å * * @param fileName å¾…ç­¾åæ–‡ä»¶å * @param keyIn ç§é’¥æ–‡ä»¶æµ * @param outputStream ç­¾åascæ–‡ä»¶ * @param pass ç§é’¥å¯†ç  * @param armor æ˜¯å¦ç”ŸæˆASSCIIç å½¢å¼ç­¾åæ–‡ä»¶ * @author SunJun */ private static void createSignature(String fileName, InputStream keyIn, OutputStream outputStream, char[] pass, boolean armor) throws IOException, PGPException { if (armor) { outputStream = new ArmoredOutputStream(outputStream); } PGPSecretKey pgpSec = readSecretKey(keyIn); PGPPrivateKey pgpPriKey = pgpSec.extractPrivateKey(new JcePBESecretKeyDecryptorBuilder().setProvider(&quot;BC&quot;).build(pass)); PGPSignatureGenerator sGen = new PGPSignatureGenerator( new JcaPGPContentSignerBuilder(pgpSec.getPublicKey().getAlgorithm(), PGPUtil.SHA1).setProvider(&quot;BC&quot;)); sGen.init(PGPSignature.BINARY_DOCUMENT, pgpPriKey); BCPGOutputStream bOut = new BCPGOutputStream(outputStream); InputStream fIn = null; try { int ch; fIn = new BufferedInputStream(new FileInputStream(fileName)); while ((ch = fIn.read()) &gt;= 0) { sGen.update((byte) ch); } sGen.generate().encode(bOut); } finally { IOUtils.closeQuietly(fIn); IOUtils.closeQuietly(bOut); } } /** * readSecretKey * * @param input ç§é’¥æ–‡ä»¶æµ * @return ç§é’¥ */ private static PGPSecretKey readSecretKey(InputStream input) throws IOException, PGPException { PGPSecretKeyRingCollection pgpSec = new PGPSecretKeyRingCollection( PGPUtil.getDecoderStream(input), new JcaKeyFingerprintCalculator()); Iterator keyRingIterator = pgpSec.getKeyRings(); while (keyRingIterator.hasNext()) { PGPSecretKeyRing keyRing = (PGPSecretKeyRing) keyRingIterator.next(); Iterator keyIterator = keyRing.getSecretKeys(); while (keyIterator.hasNext()) { PGPSecretKey key = (PGPSecretKey) keyIterator.next(); if (key.isSigningKey()) { return key; } } } throw new IllegalArgumentException(&quot;Can&#39;t find signing key in key ring.&quot;); } }","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[{"name":"algorithms","slug":"algorithms","permalink":"/tags/algorithms/"}],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"Goé¡¹ç›®å®æˆ˜æ€»ç»“","slug":"2017-09-25-start_golang","date":"2017-09-24T16:00:00.000Z","updated":"2020-01-03T10:12:29.209Z","comments":true,"path":"2017/09/25/2017-09-25-start_golang/","link":"","permalink":"/2017/09/25/2017-09-25-start_golang/","excerpt":"GOPATHgo getã€go installç­‰å‘½ä»¤éƒ½ä¼šç”¨åˆ°gopathï¼Œgopathå‘Šè¯‰goå‘½ä»¤å’Œå’Œå…¶ä»–ç›¸å…³å·¥å…·åˆ°å“ªæ‰¾å®‰è£…åœ¨ä½ ç³»ç»Ÿä¸Šçš„goåŒ…ã€‚","text":"GOPATHgo getã€go installç­‰å‘½ä»¤éƒ½ä¼šç”¨åˆ°gopathï¼Œgopathå‘Šè¯‰goå‘½ä»¤å’Œå’Œå…¶ä»–ç›¸å…³å·¥å…·åˆ°å“ªæ‰¾å®‰è£…åœ¨ä½ ç³»ç»Ÿä¸Šçš„goåŒ…ã€‚ windowsè®¾ç½®gopath set GOPATH=c:/Users/user/go;d:/workspace/mygo linuxè®¾ç½®gopath export GOPATH=/home/user/go:/usr/local/mygo gopathä¹Ÿæ˜¯å·¥ä½œç›®å½•ï¼Œç”¨æˆ·æºç æ–‡ä»¶æ”¾åœ¨gopath/srcä¸‹,go install ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨gopath/binä¸‹ï¼Œgo installäº§ç”Ÿçš„ä¸­é—´æ–‡ä»¶.aæ–‡ä»¶åœ¨gopath/pkgä¸‹ï¼Œgo installç¼–è¯‘å™¨ä¼šåˆ¤æ–­æºç æ˜¯å¦æœ‰æ”¹åŠ¨ï¼Œå¦‚æœæ²¡æœ‰æ”¹åŠ¨å°±ä¸ä¼šé‡æ–°ç”Ÿæˆ.aæ–‡ä»¶ï¼Œå¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚ vendorgolangç‰ˆæœ¬ä¾èµ–æ˜¯ä¸ªå¾ˆå¤´ç–¼çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–æŸä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹åº“ä¸æ»¡è¶³æˆ‘ä»¬éœ€è¦ä½†æ˜¯åˆå¾ˆéš¾è®©ä½œè€…åšå‡ºæ”¹åŠ¨çš„æ—¶å€™ï¼Œä¾èµ–é—®é¢˜éƒ½æ˜¯ä¸ªç—›ç‚¹ã€‚é€šè¿‡go get è·å–çš„ä¾èµ–åœ¨ä¸åŒçš„ç”µè„‘ä¸Šå¯èƒ½å‡ºç°ç¼–è¯‘ä¸é€šè¿‡çš„æƒ…å†µã€‚go1.5åæä¾›äº†GO15VENDOREXPERIMENTç¯å¢ƒå˜é‡ï¼Œç”¨äºå°†go buildã€go installæ—¶çš„æœç´¢è·¯å¾„ä¿®æ”¹ä¸ºå½“å‰ç›®å½•/vendorä¸‹ï¼Œé€šè¿‡ä¾èµ–é¡¹ç›®vendorç›®å½•å¯ä»¥ä¾èµ–ä¸€äº›ç‰¹å®šç‰ˆæœ¬çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œæˆ–è€…æ˜¯è‡ªå·±åšå‡ºä¿®æ”¹çš„ä¾èµ–åŒ…ä½†æ˜¯åˆä¸å±äºé¡¹ç›®æœ¬èº«ä¸šåŠ¡ä»£ç ï¼Œå°±å¯ä»¥æ”¾åœ¨vendorç›®å½•ä¸‹ã€‚ bindataçš„ä½¿ç”¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­å¯èƒ½å¸¦æœ‰å‰ç«¯é¡µé¢ï¼Œè™½ç„¶æ˜¯å¯ä»¥å‰åç«¯åˆ†ç¦»ï¼Œä½†æ˜¯å‰ç«¯é¡µé¢æ¯”è¾ƒç®€å•å°±æ²¡æœ‰å¿…è¦å•ç‹¬åˆ†å‡ºæ¥ã€‚å¦‚æœå‰ç«¯ä»£ç ä¹Ÿèƒ½ç›´æ¥ç¼–è¯‘åˆ°goçš„å¯æ‰§è¡Œç¨‹åºä¸­é‚£ä¸æ˜¯ä¸€ä»¶å¾ˆçˆ½çš„äº‹ä¹ˆï¼Œè¿™å°±ç”¨åˆ°äº†go-bindataï¼Œä»–ä¼šæŠŠé™æ€æ–‡ä»¶ç”Ÿæˆä¸º.goæ–‡ä»¶ã€‚go-bindatago-bindata-assetfsgo-bindataä¸go-bindata-assetfsçš„åŒºåˆ«: go-bindataä»…ä»…ç”¨äºç”Ÿæˆbindataæ–‡ä»¶æä¾›åŸºæœ¬çš„æ–¹æ³• go-bindata-assetfsä¾èµ–go-bindataå¹¶æä¾›æ–¹æ³•è®©æˆ‘ä»¬èƒ½å¤Ÿå¾ˆè½»æ¾çš„å‘å¤–æä¾›FileServer åœ¨é¡¹ç›®ä¸­æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å‘¢ï¼š go-bindata -pkg=asserts -o src/isesol.com/agentServer/asserts/bindata.go asserts/... pkg:æŒ‡å®šç”Ÿæˆçš„.goæ–‡ä»¶çš„packageå o:æŒ‡å®šç”Ÿæˆçš„.goæ–‡ä»¶çš„è·¯å¾„å·²ç»åç§° asserts/â€¦:assertsé™æ€æ–‡ä»¶ç›®å½•,â€¦å¾ªç¯è¿­ä»£assertsç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ è‡ªå·±çš„ä»£ç ä¸­ var fsh http.Handler if config.AgentConfig.LocalTest { fsh = http.FileServer(http.Dir(&quot;asserts&quot;)) } else { fsh = http.FileServer(&amp;assetfs.AssetFS{Asset: asserts.Asset, AssetDir: asserts.AssetDir, Prefix: &quot;asserts&quot;}) } r.PathPrefix(&quot;/&quot;).Handler(fsh) æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®é¡¹æŒ‡å®šä½¿ç”¨æœ¬åœ°é™æ€æ–‡ä»¶è¿˜æ˜¯ç”Ÿæˆçš„bindataæ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å…¶ä¸­: Prefix: &quot;asserts&quot;assertsä¸€å®šè¦ä¸é™æ€æ–‡ä»¶ç›®å½•åŒåã€‚ xormçš„ä½¿ç”¨xormæ˜¯ä¸€ä¸ªæ•°æ®åº“æ¡†æ¶ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä½¿ç”¨sqliteæ•°æ®åº“ï¼Œä½†æ˜¯æœ‰ä¸ªå¾ˆæ¶å¿ƒçš„åœ°æ–¹å°±æ˜¯sqlite3çš„é©±åŠ¨éƒ¨åˆ†ä»£ç ç¡®æ˜¯cï¼Œè¿™å¯¼è‡´windowsä¸Šç¼–è¯‘ä¸äº†å…¶ä»–å¹³å°çš„ä»£ç ã€‚æ¯•ç«Ÿæ•°æ®åº“å‘å±•è¿™ä¹ˆå¤šå¹´ï¼Œä»¥å‰çš„æ•°æ®åº“éƒ½æ˜¯cå†™çš„ï¼Œæƒ³è¦æŠŠå‡ Mçš„cä»£ç å…¨éƒ¨æ›¿æ¢æˆgoç¡®å®ä¹Ÿä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚xormä½¿ç”¨è¿‡ç¨‹ä¸­çš„å‘ï¼š æ•°æ®åº“ä¸»é”®è‡ªå¢:æ•°æ®åº“è®¾ç½®äº†ä¸»é”®è‡ªå¢ï¼Œæˆ‘ä»¬insertçš„æ—¶å€™ä¸è®¾ç½®ä¸»é”®å€¼é»˜è®¤æ˜¯0ï¼Œstructä¸­idå­—æ®µtagå¿…é¡»åŠ ä¸Šautoincr å¤šè¡¨è”åˆæŸ¥è¯¢æ—¶:å¦‚æœä¸åŒstructä¸­æœ‰ç›¸åŒçš„å­—æ®µstruct A { ID int64 `xorm:&quot;id&quot; json:&quot;id&quot;` Name string `xorm:&quot;name&quot; json:&quot;name&quot;` } struct B { ID id int64 `json:&quot;id&quot;` } struct C { A B } var c C xorm.Find(&amp;c) Aã€Bä¸­éƒ½æœ‰idå­—æ®µå¹¶ä¸”jsonçš„tagéƒ½æ˜¯idï¼ŒæŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¼šå‘ç°æ²¡æœ‰idå­—æ®µï¼Œå¦‚æœå‰ç«¯éœ€è¦ä½¿ç”¨idå­—æ®µé‚£å°±ä¼šæœ‰é—®é¢˜,è§£å†³åŠæ³•æ˜¯åœ¨struct Cä¸­æ·»åŠ IDå­—æ®µå°±å¯ä»¥äº†ã€‚ è¡¨åä¸structåä¸ä¸€è‡´ï¼ŒæŸ¥è¯¢æ—¶ä¸€å®šè¦æŒ‡å®šè¡¨å åˆ†é¡µæ“ä½œéœ€è¦countè·å–æ€»æ¡æ•°ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬æŸ¥è¯¢æ—¶å¯èƒ½éœ€è¦æŒ‡å®šå“ªäº›å­—æ®µï¼ŒSelect()è¯­å¥ä¸è¦æ”¾åœ¨Count()ä¹‹å‰ï¼Œå¦åˆ™ç”Ÿæˆçš„sqlä¼šå˜æˆselect Select()ä¸­çš„å­—æ®µè€Œä¸æ˜¯select count(*) å¤æ‚çš„æŸ¥è¯¢ä½¿ç”¨sqlè¯­å¥ xormæŸ¥è¯¢æ—¶ä¸è¦newä¸€ä¸ªå˜é‡ï¼Œåº”ä¸ºæŸ¥è¯¢æ—¶xormä¼šnewä¸€ä¸ªï¼Œç›¸å½“äºç”³è¯·äº†ä¸¤æ¬¡å†…å­˜ï¼Œä¼šé€ æˆå†…å­˜å†…å­˜æµªè´¹ã€‚ goä¸­cgiæ¥å£çš„è®¾è®¡goä¸­å®ç°ä¸€ä¸ªwebæœåŠ¡éå¸¸çš„å®¹æ˜“: http.HandlerFunc(&quot;/test&quot;,func(w http.ResponseWriter, r *http.Request){ }) http.HandlerFunc(&quot;/cgi&quot;,func(w http.ResponseWriter, r *http.Request){ }) http.ListenAndServe(&quot;:8080&quot;, nil) å‡ è¡Œä»£ç å°±å¯ä»¥å®ç°ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œtestã€cgiå°±æ˜¯å¯¹åº”çš„å¤„ç†å‡½æ•°ç”¨äºå¤„ç†è¯·æ±‚ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„cgiæ¥å£ä½œä¸ºè¯·æ±‚çš„å”¯çš„ä¸€å…¥å£è€Œä¸æ˜¯æ·»åŠ ä¸€ä¸ªåˆä¸€ä¸ªHandlerFuncï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Œé¦–å…ˆä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸€ä¸ªpostè¯·æ±‚çš„cgiæ¥å£ï¼Œä»¥åŠä»–çš„å¥½å¤„ï¼š ç”¨æˆ·ä¸èƒ½é€šè¿‡urlæ¢æµ‹æ¥å£åŠŸèƒ½ å‚æ•°ä¸ä¼šæ˜¾å¼çš„ä¼ é€’ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¿è¯äº†æ¥å£å®‰å…¨æ€§ å³ä½¿æ¥å£è¢«æ¢æµ‹åˆ°ï¼Œä¿®æ”¹æ¥å£ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œåªéœ€è¦ä¿®æ”¹bodyå†…å®¹è€Œä¸éœ€è¦urlåœ°å€å®ç°ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨cgiä½œä¸ºç»Ÿä¸€çš„å…¥å£ï¼Œç›´æ¥ä¸Šä»£ç ï¼š func cgi(w http.ResponseWriter, r *http.Request) { if r.Body == nil { util.JSON(w, map[string]string{&quot;errorCode&quot;: &quot;-1&quot;, &quot;errorInfo&quot;: &quot;systemError&quot;}) return } defer r.Body.Close() var req map[string]interface{} err = jsoniter.NewDecoder(r.Body).Decode(&amp;req) if err != nil { util.JSON(w, map[string]string{&quot;errorCode&quot;: &quot;-1&quot;, &quot;errorInfo&quot;: &quot;systemError&quot;}) return } cmd := strings.TrimPrefix(req[&quot;cmd&quot;].(string), constant.ServiceName) if fn, ok := util.Cgi.Get(cmd); ok { res = fn(req) } else { util.JSON(w, model.RestError{ErrorCode: &quot;-1&quot;, ErrorInfo: &quot;cmd not found&quot;}) return } switch res.(type) { case error: util.JSON(w, model.RestError{ErrorCode: &quot;-1&quot;, ErrorInfo: res.(error).Error()}) case model.RestError: util.JSON(w, res) default: util.JSON(w, map[string]interface{}{&quot;cmd&quot;: constant.ServiceName + cmd, &quot;response&quot;: res}) } } å°†request bodyä¸­å†…å®¹è§£æå‡ºæ¥ï¼ŒcmdæŒ‡å‘å¯¹åº”å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªmap[string]interface,å…¶ä¸­keyæ˜¯cmdçš„å€¼valueæ˜¯æ¥å£ç±»å‹ã€‚serviceåŒ…ä¸­é€šè¿‡ func init() { util.Cgi.Register(&quot;test/test&quot;, service) } func service(req interface{}) (interface{}) { //ä¸šåŠ¡ä»£ç  } æ¥å®ç°å¤„ç†æ–¹æ³•çš„æ³¨å†Œï¼Œè¿™é‡Œç”¨åˆ°çš„å…¶å®æ˜¯æ¥å£å€¼ã€‚ ç»“æœé€šè¿‡resè¿”å›ï¼Œè¿™é‡Œä¸€ä¸ªå¾ˆé‡è¦çš„åœ°æ–¹å°±æ˜¯æ¥å£çš„ç±»å‹åˆ¤æ–­ï¼Œé€šè¿‡switch res.(type)åˆ¤æ–­è¿”å›ç±»å‹æ˜¯ç³»ç»Ÿå¼‚å¸¸ã€ä¸šåŠ¡å¼‚å¸¸ã€æ­£å¸¸è¿”å›ä¸­çš„å“ªç§ã€‚è¿™æ ·ä¸€ä¸ªç®€å•çš„cgiæ¥å£å°±å®Œæˆäº†ã€‚ å¦‚ä½•ç»Ÿä¸€è¿”å›æ ¼å¼åŒ–æ—¶é—´package model // JSONTime JSONTime type JSONTime time.Time // MarshalJSON MarshalJSON func (t JSONTime) MarshalJSON() ([]byte, error) { stamp := fmt.Sprintf(&quot;\\&quot;%s\\&quot;&quot;, time.Time(t).Format(&quot;2006-01-02 15:04:05&quot;)) return []byte(stamp), nil } //model type Subscription struct { ID int64 `xorm:&quot;id pk autoincr&quot; json:&quot;id&quot;` MachineID string `xorm:&quot;machine_id&quot; json:&quot;machineId&quot;` MsgID int64 `xorm:&quot;msg_id&quot; json:&quot;msgId&quot;` MessageID string `xorm:&quot;message_id&quot; json:&quot;messageId&quot;` UsingStatus string `json:&quot;usingStatus&quot;` MachineType string `json:&quot;machineType&quot;` Status string `json:&quot;status&quot;` RuleName string `json:&quot;ruleName&quot;` GmtCreate model.JSONTime `xorm:&quot;created&quot; json:&quot;-&quot;` GmtModify model.JSONTime `xorm:&quot;created updated&quot; json:&quot;-&quot;` } json.Marshal(sub) å½“æˆ‘ä»¬è°ƒjson.Marshalæ—¶ï¼Œå…¶å®å°±æ˜¯è°ƒäº†è¿™é‡Œæˆ‘ä»¬è¿™é‡Œæˆ‘ä»¬è‡ªå·±å®ç°çš„MarshalJSONæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€å±‚ä¸€å±‚è¿›å»ä¼šå‘ç°ã€‚ // Marshaler is the interface implemented by types that // can marshal themselves into valid JSON. type Marshaler interface { MarshalJSON() ([]byte, error) } var ( marshalerType = reflect.TypeOf(new(Marshaler)).Elem() textMarshalerType = reflect.TypeOf(new(encoding.TextMarshaler)).Elem() ) // newTypeEncoder constructs an encoderFunc for a type. // The returned encoder only checks CanAddr when allowAddr is true. func newTypeEncoder(t reflect.Type, allowAddr bool) encoderFunc { if t.Implements(marshalerType) { return marshalerEncoder } if t.Kind() != reflect.Ptr &amp;&amp; allowAddr { if reflect.PtrTo(t).Implements(marshalerType) { return newCondAddrEncoder(addrMarshalerEncoder, newTypeEncoder(t, false)) } } if t.Implements(textMarshalerType) { return textMarshalerEncoder } if t.Kind() != reflect.Ptr &amp;&amp; allowAddr { if reflect.PtrTo(t).Implements(textMarshalerType) { return newCondAddrEncoder(addrTextMarshalerEncoder, newTypeEncoder(t, false)) } } switch t.Kind() { case reflect.Bool: return boolEncoder case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64: return intEncoder case reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64, reflect.Uintptr: return uintEncoder case reflect.Float32: return float32Encoder case reflect.Float64: return float64Encoder case reflect.String: return stringEncoder case reflect.Interface: return interfaceEncoder case reflect.Struct: return newStructEncoder(t) case reflect.Map: return newMapEncoder(t) case reflect.Slice: return newSliceEncoder(t) case reflect.Array: return newArrayEncoder(t) case reflect.Ptr: return newPtrEncoder(t) default: return unsupportedTypeEncoder } } è¿™é‡Œä¼šåˆ¤æ–­æˆ‘ä»¬æ˜¯ä¸æ˜¯å®ç°äº†Marshaleræ¥å£ï¼Œå¦‚æœå®ç°äº†å°±è¿”å›è¿™ä¸ªencoderFuncï¼Œå¦åˆ™t.Kind()åˆ¤æ–­æ˜¯å“ªç§ç±»å‹è¿”å›å¯¹åº”çš„Encoderã€‚ mapstructureä½¿ç”¨mapstructure m.(map[string]interface{})[&quot;parameters&quot;] parameterså‚æ•°ä¸structæ˜ å°„å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œåå°structä½¿ç”¨stringå­—æ®µå»æ¥æ”¶æ—¶ï¼Œå‰ç«¯ä¼ ä¸€ä¸ªintå‹çš„å€¼ï¼Œä¼šå‘ç”Ÿç±»å‹è½¬æ¢é”™è¯¯ï¼Œä¸€èµ·å¼€å§‹æ²¡æœ‰å‘ç°è§£å†³æ–¹æ³•ã€‚åæ¥å‘ç°mapstructureæœ‰ä¸€ä¸ªé…ç½®é¡¹ mapstructure.DecoderConfig.WeaklyTypedInput é»˜è®¤æ˜¯falseï¼Œè®¾ç½®æˆtrueå·¥å…·å†…éƒ¨å°±ä¼šå¸®æˆ‘ä»¬è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå‰ç«¯ä¼ æ¥çš„intæˆ–floatç±»å‹ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è½¬æˆstructä¸­å¯¹åº”çš„ç±»å‹ã€‚ çˆ½äº†ï¼ä¸ç”¨å†å»ä¿®æ”¹å‰ç«¯ä»£ç äº†ï¼^_^ negroniä¸­é—´ä»¶Negroni ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒæ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ net/http è€Œè®¾è®¡çš„ä¸€ä¸ªåº“è€Œå·²ã€‚å¯ä»¥ç”¨ Use å‡½æ•°æŠŠè¿™äº› http.Handler å¤„ç†å™¨å¼•è¿›åˆ°å¤„ç†å™¨é“¾ä¸Šæ¥ï¼š mux := http.NewServeMux() n := negroni.New() n.Use(negroni.HandlerFunc(Test1)) n.Use(negroni.HandlerFunc(Test2)) n.UseHandler(mux) n.Run(&quot;:8080&quot;) è¿™ä¸ªåŠŸèƒ½éå¸¸çš„å¥½ç”¨ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨æ‰€æœ‰çš„å¤„ç†å‡½æ•°ä¹‹å‰æ·»åŠ ä¸€ä¸ªæƒé™æ ¡éªŒæˆ–è€…å…¶ä»–çš„å…¨å±€å¤„ç†çš„handlerï¼Œnameè¿™ä¸ªåŠŸèƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ å†…åµŒngrokä¸æºç ä¿®æ”¹åŸºäºngrok 1.7 æ·»åŠ /api/tunnelsæ¥å£ï¼Œæ˜¾ç¤ºæœ¬åœ°æš´éœ²ç«¯å£client/views/web/http.go: registeræ–¹æ³•æ·»åŠ  http.HandleFunc(&quot;/api/tunnels&quot;, func(w http.ResponseWriter, r *http.Request) { payloadData := whv.ctl.State().GetTunnels() payload, err := json.Marshal(payloadData) if err != nil { panic(err) } w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;) w.Write(payload) }) å»é™¤ngrokå¯åŠ¨é¡µé¢ 166 //var termView *term.TermView 167 //if config.LogTo != &quot;stdout&quot; { 168 // termView = term.NewTermView(ctl) 169 // ctl.AddView(termView) 170 //} 175 //if termView != nil { 176 // ctl.AddView(termView.NewHttpView(p)) 177 //} ä¿®æ”¹å¯åŠ¨é…ç½®é¡¹client/main.go: éƒ¨åˆ†ä»£ç æ³¨é‡Š //func init() { // if runtime.GOOS == &quot;windows&quot; { // if mousetrap.StartedByExplorer() { // fmt.Println(&quot;Don&#39;t double-click ngrok!&quot;) // fmt.Println(&quot;You need to open cmd.exe and run it from the command line!&quot;) // time.Sleep(5 * time.Second) // os.Exit(1) // } // } //} client/cli.go: ParseArgsæ–¹æ³•ä»£ç ä¿®æ”¹ä¸º opts = &amp;Options{} configS := strings.Fields(config.AgentConfig.NgrokArgs) confMap := make(map[string]string, 0) commandSlice := make([]string, 0) for _, v := range configS { if strings.HasPrefix(v, &quot;-&quot;) { v = strings.TrimPrefix(v, &quot;-&quot;) if strings.Contains(v, &quot;=&quot;) { cfgVal := strings.Split(v, &quot;=&quot;) confMap[cfgVal[0]] = cfgVal[1] } else { confMap[v] = &quot;&quot; } } else { commandSlice = append(commandSlice, v) } } if v, ok := confMap[&quot;config&quot;]; ok { opts.config = v } if v, ok := confMap[&quot;log&quot;]; ok { opts.logto = v } if v, ok := confMap[&quot;log-level&quot;]; ok { opts.loglevel = v } if v, ok := confMap[&quot;authtoken&quot;]; ok { opts.authtoken = v } if v, ok := confMap[&quot;httpauth&quot;]; ok { opts.httpauth = v } if v, ok := confMap[&quot;subdomain&quot;]; ok { opts.subdomain = v } if v, ok := confMap[&quot;hostname&quot;]; ok { opts.hostname = v } opts.command = commandSlice[0] switch opts.command { case &quot;list&quot;: opts.args = commandSlice[1:] case &quot;start&quot;: opts.args = commandSlice[1:] case &quot;start-all&quot;: opts.args = commandSlice[1:] case &quot;version&quot;: fmt.Println(version.MajorMinor()) os.Exit(0) case &quot;help&quot;: flag.Usage() os.Exit(0) case &quot;&quot;: fmt.Errorf(&quot;Error: Specify a local port to tunnel to, or &quot; + &quot;an ngrok command.\\n\\nExample: To expose port 80, run &quot; + &quot;&#39;ngrok 80&#39;&quot;) return default: if len(commandSlice) &gt; 1 { fmt.Errorf(&quot;You may only specify one port to tunnel to on the command line, got %d: %v&quot;, len(commandSlice), commandSlice) return } opts.command = &quot;default&quot; opts.args = commandSlice } return client/config.goï¼šLoadConfigurationä»£ç ä¿®æ”¹ if matched, err = regexp.MatchString(&quot;^[0-9a-zA-Z_\\\\-!]+$&quot;, content); err != nil {} ä¹‹å‰ä»£ç æ›¿æ¢æˆï¼š configPath := opts.config if configPath == &quot;&quot; { configPath = defaultPath() } log.Info(&quot;Reading configuration file %s&quot;, configPath) // deserialize/parse the config config = &amp;Configuration{} // try to parse the old .ngrok format for backwards compatibility matched := false var content string //config from file if opts.config != &quot;&quot; { configBuf, err := ioutil.ReadFile(configPath) if err != nil { panic(&quot;Failed to read configuration file &quot; + configPath + &quot;: &quot; + err.Error()) } if err = yaml.Unmarshal(configBuf, &amp;config); err != nil { panic(&quot;Error parsing configuration file &quot; + configPath + &quot;: &quot; + err.Error()) } content = strings.TrimSpace(string(configBuf)) } else { config = &amp;Configuration{ ServerAddr: &quot;tunnel.qydev.com:4443&quot;, TrustHostRootCerts: false, Tunnels: map[string]*TunnelConfiguration{ &quot;ssh&quot;: { Protocols: map[string]string{&quot;tcp&quot;: &quot;127.0.0.1:22&quot;}, }, &quot;web&quot;: { Subdomain: strings.TrimPrefix(agentConf.AgentConfig.BoxName, &quot;LocalBox-&quot;), Protocols: map[string]string{&quot;http&quot;: &quot;80&quot;}, }, }, } } for name, t := range config.Tunnels { //æ·»åŠ  if &quot;web&quot; == name { t.Subdomain = strings.TrimPrefix(agentConf.AgentConfig.BoxName, &quot;LocalBox-&quot;) } for k, addr := range t.Protocols { //æ·»åŠ  if &quot;http&quot; == k { t.HttpAuth = agentConf.AgentConfig.BoxUserName + &quot;:&quot; + agentConf.AgentConfig.BoxPassword } } } ä»£ç æ‰«æå·¥å…·go get github.com/alecthomas/gometalinter gometalinter --install --update gometalinter ./... --vendor -e asserts --fast","categories":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}],"tags":[{"name":"golang","slug":"golang","permalink":"/tags/golang/"}],"keywords":[{"name":"golang","slug":"golang","permalink":"/categories/golang/"}]},{"title":"ä¸ƒç‰›æ–‡ä»¶ä¸Šä¼ ","slug":"2017-07-10-qiniu_upload","date":"2017-07-09T16:00:00.000Z","updated":"2020-01-03T10:12:29.219Z","comments":true,"path":"2017/07/10/2017-07-10-qiniu_upload/","link":"","permalink":"/2017/07/10/2017-07-10-qiniu_upload/","excerpt":"åŸºæœ¬çš„ç¯å¢ƒæ­å»º è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸ƒç‰›çš„Java sdkï¼Œæ¡†æ¶ç”¨çš„æ˜¯spring bootï¼Œè‡³äºspring bootçš„åŸºæœ¬æ¡†æ¶æ­å»ºå°±ä¸è¯´äº†ã€‚mavenå¼•å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.qiniu&lt;/groupId&gt; &lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt; &lt;version&gt;[7.0.0, 7.2.99]&lt;/version&gt; &lt;/dependency&gt;","text":"åŸºæœ¬çš„ç¯å¢ƒæ­å»º è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸ƒç‰›çš„Java sdkï¼Œæ¡†æ¶ç”¨çš„æ˜¯spring bootï¼Œè‡³äºspring bootçš„åŸºæœ¬æ¡†æ¶æ­å»ºå°±ä¸è¯´äº†ã€‚mavenå¼•å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.qiniu&lt;/groupId&gt; &lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt; &lt;version&gt;[7.0.0, 7.2.99]&lt;/version&gt; &lt;/dependency&gt; ä¸Šä¼ tokençš„è·å–public String getUpToken(String appId){ StringMap map = new StringMap(); StringMap putPolicy = new StringMap(); map.put(&quot;key&quot;, &quot;${key}&quot;); map.put(&quot;hash&quot;, &quot;${hash}&quot;); map.put(&quot;bucket&quot;, &quot;${bucket}&quot;); map.put(&quot;fsize&quot;, &quot;${fsize}&quot;); map.put(&quot;fname&quot;, &quot;${fname}&quot;); map.put(&quot;appId&quot;, appId); Auth auth = Auth.create(Constants.ACCESSS_KEY, Constants.SECRET_KEY); //ä¸Šä¼ æ–‡ä»¶ä¸èƒ½é‡å¤(0:ç›¸åŒæ–‡ä»¶è¦†ç›–;1:ç›¸åŒæ–‡ä»¶ä¸ä¼šè¦†ç›–) åªæœ‰åœ¨è®¾ç½®äº†keyæ—¶æ‰ä¼šç”Ÿæ•ˆ,é»˜è®¤ç›¸åŒæ–‡ä»¶ç›¸åŒkeyä¸ä¼šè¦†ç›–æ­£ç¡®è¿”å› putPolicy.put(&quot;insertOnly&quot;, 0); //æ˜¯å¦å¯ç”¨ä¸Šä¼ æ¨¡å¼(1:å¯ç”¨;0:å…³é—­)å¯ç”¨å ç”±å›è°ƒçš„è¿”å›å‚æ•°çš„keyå­—æ®µæŒ‡å®šä¸ƒç‰›ä¸­çš„èµ„æºåç§° putPolicy.put(&quot;callbackFetchKey&quot;, 1); //å›è°ƒContent-Type putPolicy.put(&quot;callbackBodyType&quot;, &quot;application/json&quot;); //å›è°ƒURL putPolicy.put(&quot;callbackUrl&quot;, Constants.CALLBACK_URL); //å›è°ƒpostè¯·æ±‚ä½“ putPolicy.put(&quot;callbackBody&quot;, Json.encode(map)); String uploadToken = auth.uploadToken(Constants.BUCKET, null, Constants.EXPIRES_1H, putPolicy); return uploadToken; } ä»£ç ä¸­çš„callbackBodyå®šä¹‰ä¸Šä¼ è¿”å›çš„å˜é‡å’Œç”¨æˆ·è‡ªå®šä¹‰çš„é­”æ³•å˜é‡ã€‚å…¶ä¸­ï¼škeyï¼šä¸ƒç‰›å­˜å‚¨ç©ºé—´ä¸­çš„èµ„æºåç§°ï¼Œå¯ä»¥ç”¨æˆ·å®šä¹‰æˆ–è€…ä¸ƒç‰›è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„UUIDhashï¼šæ–‡ä»¶çš„hashå€¼bucketï¼šå­˜å‚¨ç©ºé—´åç§°fsizeï¼šæ–‡ä»¶å¤§å°fnameï¼šæ–‡ä»¶åappIdï¼šè‡ªå®šä¹‰å˜é‡callbackFetchKeyï¼šä¸ƒç‰›é€šè¿‡å›è°ƒçš„è¿”å›å‚æ•°ä¸­çš„keyæ¥ç¡®å®šèµ„æºæ–‡ä»¶åç§°ï¼Œç”¨äºè‡ªå®šä¹‰å‰ç¼€ è¿™é‡Œçš„appIdç”¨äºç¡®å®šå“ªä¸ªä¸šåŠ¡çº¿ï¼Œå®é™…é¡¹ç›®ä¸­åº”è¯¥å®šä¹‰å›ºå®šçš„appIdï¼Œæ‹¿åˆ°ä¸Šä¼ Tokenå°±å¯ä»¥è¿›è¡Œä¸Šä¼ æ“ä½œäº†ã€‚ æ–‡ä»¶ä¸Šä¼ public Object callback(HttpServletRequest request) throws IOException{ String line = &quot;&quot;; StringBuilder sb = new StringBuilder(); BufferedReader br = new BufferedReader(new InputStreamReader(request.getInputStream())); while ((line = br.readLine()) != null){ sb.append(line); } String authorization = request.getHeader(&quot;Authorization&quot;); String contentType = request.getContentType(); Auth auth = Auth.create(Constants.ACCESSS_KEY, Constants.SECRET_KEY); //ä¸ƒç‰›å›è°ƒé‰´æƒ boolean isQiniuCallback = auth.isValidCallback(authorization, Constants.CALLBACK_URL, sb.toString().getBytes(), contentType); Map&lt;String, Object&gt; returnMap = Maps.newHashMap(); if (isQiniuCallback){ CallBackParam callBackParam = Json.decode(sb.toString(), CallBackParam.class); String appId = callBackParam.getAppId(); String key = callBackParam.getKey(); callBackParam.setKey(appId + &quot;/&quot; + key); returnMap.put(&quot;key&quot;, appId + &quot;/&quot; + key); returnMap.put(&quot;payload&quot;, callBackParam); } else{ returnMap.put(&quot;success&quot;, false); } return returnMap; } å›è°ƒä¸­è·å¾—appIdä»¥åŠä¸ƒç‰›ç”Ÿæˆçš„keyï¼Œæˆ‘ä»¬å°†å…¶ç»„è£…èµ·æ¥ä»¥è‡ªå®šä¹‰å‰ç¼€ã€‚ æˆ‘ä»¬ä¼šçœ‹åˆ°ä¹‹å‰è®¾ç½®çš„è‡ªå®šä¹‰å˜é‡appId:blogæ˜¯åœ¨ç”Ÿæˆtokençš„æ—¶å€™è®¾ç½®çš„ï¼Œä¸Šä¼ å®Œæˆåä¼šè¿”å›ç»™æˆ‘ä»¬ã€‚å¯èƒ½æœ‰äººä¼šé—®ï¼Œè¿™é‡Œç›´æ¥ä¸Šä¼ åˆ°ä¸ƒç‰›ä¸å°±å¥½äº†ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†™ä¸€ä¸ªæ–¹æ³•ã€‚å…¶å®åŸå› å¾ˆç®€å•ï¼Œä»ä¸Šé¢çš„ç”Ÿæˆtokençš„æ–¹æ³•ä¸­å·²ç»å¯ä»¥çœ‹å‡ºæˆ‘ä»¬è®¾ç½®äº†callbackUrlä»¥åŠcallbackBodyæ¥è®©ä¸ƒç‰›åœ¨ä¸Šä¼ å®Œæˆçš„æ—¶å€™æœ¬æ¥å›è°ƒæˆ‘ä»¬è‡ªå·±çš„æ¥å£ï¼Œåªæœ‰å½“æˆ‘ä»¬è‡ªå·±çš„æ¥å£å›è°ƒæˆåŠŸæ•´ä¸ªä¸Šä¼ æ‰ä¼šæˆåŠŸï¼Œåä¹‹å¤±è´¥ã€‚è€Œä¸”é€šè¿‡å›è°ƒæˆ‘ä»¬å¯ä»¥çŸ¥é“æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™ä¸Šä¼ å®Œæˆï¼ŒåŒæ—¶å¯ä»¥è¿›è¡Œä¸€ç³»åˆ—çš„logã€æ’è¡¨ç­‰æ“ä½œæ¥è®°å½•ä¸Šä¼ ä¿¡æ¯ã€‚ è®¾ç½®callbackFetchKeyæƒ…å†µ æœªè®¾ç½®callbackFetchKeyæƒ…å†µå¯ä»¥çœ‹åˆ°å›å‚ä¸­æœ‰å‰ç¼€ä½†æ˜¯ä¸ƒç‰›å­˜å‚¨ç©ºé—´ä¸­æ˜¯æ²¡æœ‰å‰ç¼€çš„ å› ä¸ºä¸ƒç‰›å›è°ƒéœ€è¦è°ƒç”¨æˆ‘ä»¬æœ¬åœ°çš„æ¥å£ï¼Œå¯æ˜¯æˆ‘ä»¬æ²¡æœ‰å…¬ç½‘ipæ‰€ä»¥ä½¿ç”¨çš„ngrokå†…ç½‘ç©¿é€æ¥å®ç°çš„ï¼Œngrokçš„å®‰è£…æˆ‘çš„åšå®¢æ²¡æœ‰å†™ï¼Œå¯ä»¥å‚è€ƒæˆ‘åŒäº‹çš„åšå®¢ã€‚","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"qiniu","slug":"qiniu","permalink":"/tags/qiniu/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"nginx luaé¢„ç¼–è¯‘","slug":"2017-04-0-precompile_lua_module","date":"2017-04-04T16:00:00.000Z","updated":"2020-01-03T10:12:29.224Z","comments":true,"path":"2017/04/05/2017-04-0-precompile_lua_module/","link":"","permalink":"/2017/04/05/2017-04-0-precompile_lua_module/","excerpt":"å‰æ™¯æè¦å‰æ®µæ—¶é—´nginxæ–°ç‰ˆ1.11.11æ›´æ–°ä¹‹ånginx_http_connection_tç»“æ„ä½“ä¸­çš„ngx_buf_t **busyä»äºŒçº§æŒ‡é’ˆæ”¹ä¸ºäº†ngx_chain_t *busyé“¾è¡¨ã€‚å¦‚ä½•ä¿®æ”¹è§ä¹‹å‰çš„blogã€‚","text":"å‰æ™¯æè¦å‰æ®µæ—¶é—´nginxæ–°ç‰ˆ1.11.11æ›´æ–°ä¹‹ånginx_http_connection_tç»“æ„ä½“ä¸­çš„ngx_buf_t **busyä»äºŒçº§æŒ‡é’ˆæ”¹ä¸ºäº†ngx_chain_t *busyé“¾è¡¨ã€‚å¦‚ä½•ä¿®æ”¹è§ä¹‹å‰çš„blogã€‚ é—®é¢˜ç”±äºæ˜¯ç›´æ¥å°†æºç ä¿®æ”¹ä¸ºæ”¯æŒnginx-1.11.11åŠä¹‹åç‰ˆæœ¬ï¼Œå­˜åœ¨çš„é—®é¢˜æ˜¯ï¼šå¦‚æœæˆ‘æƒ³ç¼–è¯‘nginx-1.11.11ä¹‹å‰çš„ç‰ˆæœ¬æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ ·ä»£ç å°±ä¸å…¼å®¹ä¹‹å‰ç‰ˆæœ¬çš„nginxäº†ï¼Œä¹‹å‰åªè€ƒè™‘åˆ°è§£å†³ä¸å…¼å®¹æ–°ç‰ˆæœ¬çš„é—®é¢˜ã€‚æ™šä¸Šä¸‹ç­å’Œå¤§ç¥èŠåˆ°å‰ç«¯æ—¶é—´nginx-1.11.11æ–°ç‰ˆæœ¬çš„ç¬¬ä¸‰æ–¹luaæ¨¡å—çš„ä¸å…¼å®¹é—®é¢˜ï¼Œå—å¤§ç¥çš„æç¤ºåº”è¯¥å…¼å®¹ä¸åŒç‰ˆæœ¬çš„nginxåŒ…æ‹¬æ–°ç‰ˆå’Œä¹‹å‰çš„è€ç‰ˆæœ¬ã€‚ è§£å†³åœ¨luaæ¨¡å—ä¸­é€šè¿‡é¢„ç¼–è¯‘åˆ¤æ–­nginxçš„ç‰ˆæœ¬æ¥å†³å®šä½¿ç”¨å“ªæ®µä»£ç ï¼ŒåºŸè¯ä¸å¤šè¯´ä¸Šä»£ç ï¼š if (hc-&gt;nbusy) { b = NULL; for (i = 0; i &lt; hc-&gt;nbusy; i++) { /*get first buf*/ /* b = hc-&gt;busy[i]; */ #if nginx_version &gt;= 1011011 b = hc-&gt;busy-&gt;buf; #else b = hc-&gt;busy[i]; #endif dd(&quot;busy buf: %d: [%.*s]&quot;, (int) i, (int) (b-&gt;pos - b-&gt;start), b-&gt;start); if (first == NULL) { if (mr-&gt;request_line.data &gt;= b-&gt;pos || mr-&gt;request_line.data + mr-&gt;request_line.len + line_break_len &lt;= b-&gt;start) { continue; } dd(&quot;found first at %d&quot;, (int) i); first = b; } dd(&quot;adding size %d&quot;, (int) (b-&gt;pos - b-&gt;start)); size += b-&gt;pos - b-&gt;start; /*buf next*/ #if nginx_version &gt;= 1011011 hc-&gt;busy = hc-&gt;busy-&gt;next; #endif } } å¯ä»¥çœ‹åˆ°è¿™é‡Œé€šè¿‡#if nginx_version &gt;= 1011011é¢„ç¼–è¯‘æŒ‡ä»¤åˆ¤æ–­nginxç‰ˆæœ¬æ¥å†³å®šä½¿ç”¨b = hc-&gt;busy-&gt;buf;æ¥å…¼å®¹é«˜ç‰ˆæœ¬è¿˜æ˜¯ä½¿ç”¨b = hc-&gt;busy[i];å…¼å®¹è€ç‰ˆæœ¬ï¼Œè‡³äºnginx_versionæ˜¯å•¥ï¼Œè§nginxæºç ä¸­çš„nginx.hå¤´æ–‡ä»¶ï¼š #ifndef _NGINX_H_INCLUDED_ #define _NGINX_H_INCLUDED_ #define nginx_version 1011013 #define NGINX_VERSION &quot;1.11.13&quot; #define NGINX_VER &quot;nginx/&quot; NGINX_VERSION #ifdef NGX_BUILD #define NGINX_VER_BUILD NGINX_VER &quot; (&quot; NGX_BUILD &quot;)&quot; #else #define NGINX_VER_BUILD NGINX_VER #endif #define NGINX_VAR &quot;NGINX&quot; #define NGX_OLDPID_EXT &quot;.oldbin&quot; #endif /* _NGINX_H_INCLUDED_ */ ä¸ºäº†ä¾¿äºåˆ¤æ–­nginxç‰ˆæœ¬ï¼Œnginxä¸­å®šä¹‰äº†nginx_versionçš„è§„åˆ™ï¼Œ1.11.13å°±æ˜¯1011013,1.11.11å°±æ˜¯1011011ï¼Œç”±æ­¤è§£å†³ç¬¬ä¸‰æ–¹luaæ¨¡å—çš„å…¼å®¹æ€§é—®é¢˜ã€‚","categories":[{"name":"blog","slug":"blog","permalink":"/categories/blog/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"/tags/nginx/"}],"keywords":[{"name":"blog","slug":"blog","permalink":"/categories/blog/"}]},{"title":"Nginx epolläº‹ä»¶é©±åŠ¨","slug":"2017-04-05-nginx_epoll","date":"2017-04-04T16:00:00.000Z","updated":"2020-01-03T09:55:50.314Z","comments":true,"path":"2017/04/05/2017-04-05-nginx_epoll/","link":"","permalink":"/2017/04/05/2017-04-05-nginx_epoll/","excerpt":"###Linux IOæ¨¡å¼ åœ¨äº†è§£Nginxäº‹ä»¶é©±åŠ¨æœºåˆ¶ä¹‹å‰é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯Linuxçš„IOæ¨¡å¼ï¼Œä¹‹æ‰€ä»¥éœ€è¦äº†è§£Linuxçš„IOæ¨¡å¼æ˜¯åº”ä¸ºNginxæ­£æ˜¯é€šè¿‡å®ƒå®ç°çš„â€éé˜»å¡IOâ€ä¸é«˜å¹¶å‘ã€‚","text":"###Linux IOæ¨¡å¼ åœ¨äº†è§£Nginxäº‹ä»¶é©±åŠ¨æœºåˆ¶ä¹‹å‰é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯Linuxçš„IOæ¨¡å¼ï¼Œä¹‹æ‰€ä»¥éœ€è¦äº†è§£Linuxçš„IOæ¨¡å¼æ˜¯åº”ä¸ºNginxæ­£æ˜¯é€šè¿‡å®ƒå®ç°çš„â€éé˜»å¡IOâ€ä¸é«˜å¹¶å‘ã€‚ Linux IOæ¨¡å¼åŠselectã€pollã€epollåŒæ­¥IOå’Œå¼‚æ­¥IOï¼Œé˜»å¡IOå’Œéé˜»å¡IOåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåœ¨ä¸é€šçš„åœºæ™¯ä¸‹ä¸åŒçš„äººç»™å‡ºçš„ç­”æ¡ˆæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æœ¬æ–‡é™å®šä¸€ä¸‹æˆ‘ä»¬è®¨è®ºçš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚ æœ¬æ–‡è®¨è®ºçš„èƒŒæ™¯å‰ææ˜¯Linuxç¯å¢ƒä¸‹çš„network IOã€‚ ä¸€ã€åŸºæœ¬æ¦‚å¿µåœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦çŸ¥é“å‡ ä¸ªæ¦‚å¿µï¼š ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ è¿›ç¨‹é—´åˆ‡æ¢ è¿›ç¨‹çš„é˜»å¡ æ–‡ä»¶æè¿°ç¬¦ ç¼“å­˜IO ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé‚£ä¹ˆå¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å†…æ ¸ï¼Œç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼ˆkernelï¼‰ï¼Œä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œæ“å¿ƒç³»ç»Ÿå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ã€‚é’ˆå¯¹linuxæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå°†æœ€é«˜çš„1Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œä¾›å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸ºå†…æ ¸ç©ºé—´ï¼Œè€Œå°†è¾ƒä½çš„3Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰ï¼Œä¾›å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸ºç”¨æˆ·ç©ºé—´ã€‚ è¿›ç¨‹é—´åˆ‡æ¢ä¸ºäº†æ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œå†…æ ¸å¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¢å¤ä»¥å‰æŒ‚èµ·çš„æŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œä»»ä½•è¿›ç¨‹éƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œæ˜¯ä¸å†…æ ¸ç´§å¯†ç›¸å…³çš„ã€‚ ä»ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œè½¬åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šè¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç»è¿‡ä¸‹é¢è¿™äº›å˜åŒ–ï¼š ä¿å­˜å¤„ç†æœºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨ã€‚ æ›´æ–°PCBä¿¡æ¯ã€‚ æŠŠè¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼Œå¦‚å°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡ç­‰é˜Ÿåˆ—ã€‚ é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå¹¶æ›´æ–°å…¶PCBã€‚ æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„ã€‚ æ¢å¤å¤„ç†æœºä¸Šä¸‹æ–‡ã€‚ æ³¨ï¼šæ€»è€Œè¨€ä¹‹å°±æ˜¯å¾ˆè€—èµ„æºï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šè¿›ç¨‹é—´åˆ‡æ¢ è¿›ç¨‹çš„é˜»å¡æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œç”±äºæœŸå¾…çš„æŸäº›äº‹ä»¶æœªå‘ç”Ÿï¼Œå¦‚è¯·æ±‚ç³»ç»Ÿèµ„æºå¤±è´¥ã€ç­‰å¾…æŸç§æ“ä½œçš„å®Œæˆã€æ–°æ•°æ®å°šæœªåˆ°è¾¾æˆ–æ— æ–°å·¥ä½œåšç­‰ï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé˜»å¡åŸè¯­(Block)ï¼Œä½¿è‡ªå·±ç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºé˜»å¡çŠ¶æ€ã€‚å¯è§ï¼Œè¿›ç¨‹çš„é˜»å¡æ˜¯è¿›ç¨‹è‡ªèº«çš„ä¸€ç§ä¸»åŠ¨è¡Œä¸ºï¼Œä¹Ÿå› æ­¤åªæœ‰å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹ï¼ˆè·å¾—CPUï¼‰ï¼Œæ‰å¯èƒ½å°†å…¶è½¬ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“è¿›ç¨‹ è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæ˜¯ä¸å ç”¨CPUèµ„æºçš„ã€‚ æ–‡ä»¶æè¿°ç¬¦fdæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œæ˜¯ä¸€ä¸ªç”¨äºè¡¨è¿°æŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µã€‚ æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äºUNIXã€Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚ ç¼“å­˜IOç¼“å­˜ I/O åˆè¢«ç§°ä½œæ ‡å‡† I/Oï¼Œå¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤ I/O æ“ä½œéƒ½æ˜¯ç¼“å­˜ I/Oã€‚åœ¨ Linux çš„ç¼“å­˜ I/O æœºåˆ¶ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šå°† I/O çš„æ•°æ®ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆ page cache ï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åæ‰ä¼šä»æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚ ç¼“å­˜ I/O çš„ç¼ºç‚¹ï¼šæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­éœ€è¦åœ¨åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´å’Œå†…æ ¸è¿›è¡Œå¤šæ¬¡æ•°æ®æ‹·è´æ“ä½œï¼Œè¿™äº›æ•°æ®æ‹·è´æ“ä½œæ‰€å¸¦æ¥çš„ CPU ä»¥åŠå†…å­˜å¼€é”€æ˜¯éå¸¸å¤§çš„ã€‚ äºŒã€IOæ¨¡å¼","categories":[{"name":"io","slug":"io","permalink":"/categories/io/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"/tags/nginx/"}],"keywords":[{"name":"io","slug":"io","permalink":"/categories/io/"}]},{"title":"nginx-1.11.11æ¨¡å—ç¼–è¯‘æŠ¥é”™è§£å†³","slug":"2017-03-24-build_nginx_error","date":"2017-03-23T16:00:00.000Z","updated":"2020-01-03T09:55:50.279Z","comments":true,"path":"2017/03/24/2017-03-24-build_nginx_error/","link":"","permalink":"/2017/03/24/2017-03-24-build_nginx_error/","excerpt":"Nginxæœ€æ–°ç‰ˆ1.11.11ç¼–è¯‘æŠ¥é”™æœ€è¿‘nginxå®˜ç½‘æ›´æ–°äº†nginxçš„æœ€æ–°ç‰ˆnginx-1.11.11ï¼Œäºæ˜¯ä¸‹è½½ä¸‹æ¥æƒ³è¦æ­åœ¨æ–°ä¹°çš„vpsä¸Šã€‚ä½†æ˜¯å‘ç°åœ¨äº†ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç¼–è¯‘æ·»åŠ openrestyå¤–éƒ¨æ¨¡å—lua-nginx-moduleå’Œecho-nginx-moduleæ—¶æŠ¥é”™ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š","text":"Nginxæœ€æ–°ç‰ˆ1.11.11ç¼–è¯‘æŠ¥é”™æœ€è¿‘nginxå®˜ç½‘æ›´æ–°äº†nginxçš„æœ€æ–°ç‰ˆnginx-1.11.11ï¼Œäºæ˜¯ä¸‹è½½ä¸‹æ¥æƒ³è¦æ­åœ¨æ–°ä¹°çš„vpsä¸Šã€‚ä½†æ˜¯å‘ç°åœ¨äº†ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç¼–è¯‘æ·»åŠ openrestyå¤–éƒ¨æ¨¡å—lua-nginx-moduleå’Œecho-nginx-moduleæ—¶æŠ¥é”™ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š æŠ¥é”™åˆ†æç”±æŠ¥é”™ä¿¡æ¯å¯ä»¥çœ‹å‡ºlua-nginx-moduleæ¨¡å—çš„ngx_http_lua_headers.cæ–‡ä»¶ä¸­çš„ç¬¬151å’Œç¬¬227è¡ŒæŠ¥ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ã€‚åˆ†ælua-nginx-moduleæºç å¯ä»¥çœ‹å‡ºï¼šngx_http_connection_tç»“æ„ä½“ä¸­çš„busyå‚æ•°,ç”±ngx_buf_tçš„åŒé‡æŒ‡é’ˆå˜ä¸ºngx_chain_tçš„ngx_buf_té“¾è¡¨:ä¸‹é¢æ˜¯æŠ¥é”™å˜é‡å’Œå¯¹åº”çš„æŠ¥é”™ä½ç½®ï¼šä¸ºä½•å‡½æ•°ä¸­b = hc-&gt;busy[i]æ”¹ä¸ºb = hc-&gt;busy-&gt;bufå’Œç»“å°¾çš„hc-&gt;busy = hc-&gt;busy-&gt;nextå°±å¯ä»¥äº†å‘¢ï¼Ÿçœ‹ä¸‹å›¾:ä¸ä¸Šé¢çš„ngx_buf_tçš„åŒé‡æŒ‡é’ˆå¯¹æ¯”å‘ç°äº†ä»€ä¹ˆå‘¢ï¼Ÿæ²¡é”™ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯è¦å–ngx_buf_tçš„å€¼ï¼Œ1.10ä»¥åŠä¹‹å‰çš„åšæ³•æ˜¯ngx_buf_tåŒé‡æŒ‡é’ˆçš„å¾ªç¯éå†ã€‚è€Œ1.11å¼€å§‹ä½¿ç”¨ngx_chain_sé“¾è¡¨æ¥éå†è·å–ngx_buf_tçš„å€¼ã€‚æˆ‘ä»¬è¦åšçš„åªä¸è¿‡æ˜¯å°†å¾ªç¯ä¸­çš„ngx_buf_tçš„åŒé‡æŒ‡é’ˆçš„å¾ªç¯ä¿®æ”¹ä¸ºé“¾è¡¨çš„æ–¹å¼å°±å¥½äº†ã€‚ç¼–è¯‘ä¹‹åæ²¡æœ‰æŠ¥é”™ï¼š åˆ°æ­¤åˆ†æçš„ä¹Ÿå°±å·®ä¸å¤šäº†å‘¢ï¼Œechoæ¨¡å—çš„æŠ¥é”™åŸå› ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå°±æ˜¯å†™blogçš„è¿‡ç¨‹ä¸­å®˜ç½‘åˆæ›´æ–°äº†æœ€æ–°ç‰ˆnginx-1.11.12ç‰ˆæœ¬,1.11.12ç‰ˆæœ¬è¿™éƒ¨åˆ†çš„ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œå…¶ä»–åœ°æ–¹çš„ä¿®æ”¹å°±ä¸çŸ¥é“äº†ï¼Œä¸çŸ¥é“ä¼šä¸ä¼šè¿˜æœ‰åˆ«çš„å’Œç¬¬ä¸‰æ–¹æ¨¡å—ä¸å…¼å®¹çš„åœ°æ–¹ã€‚ç­‰å¾…åç»­éªŒè¯ï¼","categories":[{"name":"C","slug":"C","permalink":"/categories/C/"}],"tags":[{"name":"C","slug":"C","permalink":"/tags/C/"}],"keywords":[{"name":"C","slug":"C","permalink":"/categories/C/"}]},{"title":"åœ¨æ¬ç“¦å·¥VPSä¸Šæ­å»ºVPNæœåŠ¡","slug":"2017-03-24-build_vpn_in_vps","date":"2017-03-23T16:00:00.000Z","updated":"2020-01-03T09:55:50.292Z","comments":true,"path":"2017/03/24/2017-03-24-build_vpn_in_vps/","link":"","permalink":"/2017/03/24/2017-03-24-build_vpn_in_vps/","excerpt":"æ­å»ºShadowsocksæœåŠ¡å®‰è£…ç»„ä»¶$ yum install m2crypto python-setuptools $ easy_install pip $ pip install shadowsocks","text":"æ­å»ºShadowsocksæœåŠ¡å®‰è£…ç»„ä»¶$ yum install m2crypto python-setuptools $ easy_install pip $ pip install shadowsocks å®‰è£…å®Œæˆä»¥åé…ç½®æœåŠ¡ç«¯å‚æ•°$ vi /etc/shadowsocks.json å†™å…¥å¦‚ä¸‹é…ç½® { &quot;server&quot;:&quot;0.0.0.0&quot;, &quot;server_port&quot;:443, &quot;local_address&quot;: &quot;127.0.0.1&quot;, &quot;local_port&quot;:1080, &quot;password&quot;:&quot;mypassword&quot;, &quot;timeout&quot;:300, &quot;method&quot;:&quot;rc4-md5&quot;, &quot;fast_open&quot;: false, &quot;workers&quot;: 1 } å°†ä¸Šé¢çš„mypasswordæ›¿æ¢æˆä½ è‡ªå·±çš„å¯†ç server_portä¹Ÿå¯ä»¥ä¿®æ”¹ï¼Œé»˜è®¤æ˜¯443ç«¯å£ è¿è¡Œå¯åŠ¨ShadowsocksæœåŠ¡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ $ ssserver -c /etc/shadowsocks.json å¦‚æœæƒ³è¦åå°è¿è¡Œï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ ssserver -c /etc/shadowsocks.json -d start æ·»åŠ å¼€æœºå¯åŠ¨é¡¹å‘½ä»¤è¡Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ $ cd /etc/rc.d/rc.local æ·»åŠ  ssserver -c /etc/shadowsocks.json -d start é…ç½®å¤šå®¢æˆ·ç«¯ç™»é™†ä¿®æ”¹shadowsocks.jsonï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹ä¸ºä¸‹é¢çš„é…ç½® { &quot;server&quot;:&quot;23.105.215.43&quot;, #ä½ æœåŠ¡å™¨çš„ip &quot;local_address&quot;:&quot;127.0.0.1&quot;, &quot;local_port&quot;:1080, &quot;port_password&quot;:{ #ç«¯å£ä»¥åŠå¯¹åº”çš„å¯†ç  &quot;9000&quot;:&quot;password&quot;, &quot;9001&quot;:&quot;password&quot;, &quot;9002&quot;:&quot;password&quot; }, &quot;timeout&quot;:300, &quot;method&quot;:&quot;rc4-md5&quot;, #é€‰æ‹©çš„åŠ å¯†æ–¹å¼ &quot;fast_open&quot;: false } Shadowsockså®¢æˆ·ç«¯ä¸‹è½½åœ¨è¿™é‡Œä¸‹è½½å®‰è£…è¯·ç‚¹å‡»ä¸‹è½½ï¼Œé€‰æ‹©è‡ªå·±æƒ³è¦çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œæä¾›çš„iphoneç‰ˆæœ¬éœ€è¦è´­ä¹°è²Œä¼¼è¦40RMBï¼Œè¿˜æ˜¯æŒºè´µçš„ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯appstoreä¸Šçš„å…¶ä»–çš„ç‰ˆæœ¬çš„ã€‚ç›´æ¥åœ¨appstoreä¸Šæœç´¢shadowrocketï¼Œè¿™ä¸ªå¾ˆå¥½ç”¨è€Œä¸”åªè¦6RMBã€‚ä¸‹è½½å¥½å®¢æˆ·ç«¯åªè¦é…ç½®å¥½ipã€portã€methodï¼ˆä½ çš„æœåŠ¡ç«¯é…ç½®çš„åŠ å¯†æ–¹å¼ï¼‰ã€ä»¥åŠå¯†ç ä¹‹åä½ å°±å¯ä»¥æ„‰å¿«çš„ç¿»å¢™äº†ï¼ä¸‹é¢è´´å‡ºäº†appä¸Šçš„è¿æ¥ï¼ŒwindowsæŒ‰ç…§ä¸Šé¢çš„åœ°å€ä¸‹è½½å¥½æŒ‰ç…§ç›¸åº”çš„é…ç½®å¥½å°±è¡Œäº†ã€‚","categories":[{"name":"VPS","slug":"VPS","permalink":"/categories/VPS/"}],"tags":[{"name":"VPS","slug":"VPS","permalink":"/tags/VPS/"}],"keywords":[{"name":"VPS","slug":"VPS","permalink":"/categories/VPS/"}]},{"title":"luaè„šæœ¬è§£æwebhookså®ç°è‡ªåŠ¨éƒ¨ç½²","slug":"2017-02-27-deploy_blog_by_lua","date":"2017-02-26T16:00:00.000Z","updated":"2020-01-03T09:55:50.216Z","comments":true,"path":"2017/02/27/2017-02-27-deploy_blog_by_lua/","link":"","permalink":"/2017/02/27/2017-02-27-deploy_blog_by_lua/","excerpt":"ç äº‘é…ç½®webhookså®ç°è‡ªåŠ¨éƒ¨ç½²çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¯ä»¥æŠŠé¡¹ç›®æ”¾åœ¨githubç”¨githubçš„webhooksï¼Œä½†æ˜¯githubåªèƒ½åˆ›å»ºå…¬å¼€é¡¹ç›®ç§æœ‰é¡¹ç›®æ˜¯è¦é’±çš„ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ç§ç›¸å¯¹éº»çƒ¦çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨vpsä¸Šå»ºä¸€ä¸ªgitä»“åº“æ¯æ¬¡æäº¤åˆ°vpsä¸Šä¹‹åè§¦å‘hookå»æ›´æ–°blogï¼Œè¿™ç§æ–¹æ³•ç›¸å¯¹éº»çƒ¦è€Œä¸”vpsä¸Šçš„é¡¹ç›®å®¹æ˜“ä¸¢å¤±ã€‚æ‰€ä»¥æœ€åé€‰æ‹©äº†ç äº‘ï¼Œåœ¨ç äº‘ä¸Šåˆå§‹åŒ–ä¸€ä¸ªblogé¡¹ç›®ï¼Œä¹‹åé…ç½®ä¸€ä¸ªwebhookså¹¶ä¸”è·‘é…ç½®å¯†ç ï¼Œé˜²æ­¢urlè¢«æ¶æ„è°ƒç”¨ã€‚","text":"ç äº‘é…ç½®webhookså®ç°è‡ªåŠ¨éƒ¨ç½²çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¯ä»¥æŠŠé¡¹ç›®æ”¾åœ¨githubç”¨githubçš„webhooksï¼Œä½†æ˜¯githubåªèƒ½åˆ›å»ºå…¬å¼€é¡¹ç›®ç§æœ‰é¡¹ç›®æ˜¯è¦é’±çš„ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ç§ç›¸å¯¹éº»çƒ¦çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨vpsä¸Šå»ºä¸€ä¸ªgitä»“åº“æ¯æ¬¡æäº¤åˆ°vpsä¸Šä¹‹åè§¦å‘hookå»æ›´æ–°blogï¼Œè¿™ç§æ–¹æ³•ç›¸å¯¹éº»çƒ¦è€Œä¸”vpsä¸Šçš„é¡¹ç›®å®¹æ˜“ä¸¢å¤±ã€‚æ‰€ä»¥æœ€åé€‰æ‹©äº†ç äº‘ï¼Œåœ¨ç äº‘ä¸Šåˆå§‹åŒ–ä¸€ä¸ªblogé¡¹ç›®ï¼Œä¹‹åé…ç½®ä¸€ä¸ªwebhookså¹¶ä¸”è·‘é…ç½®å¯†ç ï¼Œé˜²æ­¢urlè¢«æ¶æ„è°ƒç”¨ã€‚ å¦‚ä¸‹å›¾ï¼š nginxé…ç½®å‰ææ˜¯å®‰è£…äº†luaæˆ–è€…Luajitä»¥åŠnginxç¼–è¯‘äº†lua-nginx-moduleæ¨¡å— location /webhooks { content_by_lua_file blog_hook.lua; } ç°åœ¨å¼€å§‹ç¼–å†™luaè„šæœ¬ ngx.req.read_body() local data = ngx.req.get_body_data() local args = ngx.req.get_uri_args() local cjson = require &quot;cjson&quot; value = cjson.decode(data) if value[&quot;password&quot;]==&quot;your_password&quot; then os.execute(&quot;sh /www/blog_update.sh&quot;); ngx.say(&quot;OK&quot;) ngx.exit(200) else ngx.exit(404) end è¿™é‡Œåº”è¯¥æ³¨æ„ï¼Œåœ¨è·å–bodyå†…å®¹ä¹‹å‰å¿…é¡»ngx.req.read_body()ï¼Œé€šè¿‡local data = ngx.req.get_body_data()è·å–bodyå†…å®¹ï¼Œé€šè¿‡local args = ngx.req.get_uri_args()è·å–urlåé¢æºå¸¦çš„å‚æ•°ã€‚ â€œcjsonâ€ä½¿ç”¨cjsonæ¨¡å—è§£æjsonå­—ç¬¦ä¸² $ git clone https://github.com/openresty/lua-cjson.git $ cd ./lua-cjson åœ¨ç¼–è¯‘ä¹‹å‰éœ€è¦ä¿®æ”¹ä¸€ä¸‹Makefile 21 LUA_INCLUDE_DIR ?= $(PREFIX)/include æ‰“å¼€Makefileä¿®æ”¹ç¬¬21è¡Œï¼Œä¿®æ”¹ä¸º 21 LUA_INCLUDE_DIR ?= $(PREFIX)/include/luajit-2.0 å› ä¸ºluajité»˜è®¤å°†luaå¤´æ–‡ä»¶æ”¾åœ¨ /usr/local/include/luajit-2.0 ä¸­ï¼Œä¿®æ”¹ä¹‹åæ‰§è¡Œ $ make all $ make install ä¹‹åå°±å¯ä»¥é€šè¿‡cjsonè§£æbodyä¸­çš„jsonä¸²äº†ï¼Œå¯†ç éªŒè¯é€šè¿‡æ‰å¯ä»¥ç»§ç»­è°ƒç”¨è‡ªåŠ¨æ›´æ–°è„šæœ¬å¦åˆ™è¿”å›404ï¼Œæ›´æ–°çš„è„šæœ¬è¿™é‡Œä¹Ÿåˆ—å‡ºæ¥ã€‚ ç¼–å†™shellè„šæœ¬#!/bin/sh export PATH=$PATH:/usr/local/nodejs/bin export LANG=&quot;en_US.UTF-8&quot; unset GIT_DIR NowPath=`pwd` WebSite=&quot;/www&quot; BlogPath=&quot;/www/blog&quot; if [ ! -d &quot;$BlogPath&quot; ]; then cd $WebSite git clone git@git.oschina.net:sunblog/blog.git cd $BlogPath else cd $BlogPath git fetch --all git reset --hard origin/master fi hexo clean hexo g #awk &#39;{message=&quot;äº²çˆ±çš„&quot;$1&quot;ï¼Œæ‚¨æ‰€å…³æ³¨çš„åšå®¢Sunâ€˜s Blogå·²æ›´æ–°ï¼Œå¿«å»å›´è§‚å§ï¼https://www.sunsblog.cn&quot;;tittle=&quot;Sunâ€™s Blogæ›´æ–°&quot;;system(&quot;echo \\&quot;&quot;message&quot;\\&quot; | mail -s \\&quot;&quot;tittle&quot;\\&quot; &quot;$2);}&#39; /www/mail.txt echo æ‚¨çš„åšå®¢å·²æˆåŠŸæ›´æ–°ï¼Œhttps://www.sunsblog.cn | mail -s åšå®¢æ›´æ–°æˆåŠŸ admin@sunsblog.cn cd $NowPath echo &quot;deploy done&quot; exit 0 è„šæœ¬ä¼šå»åˆ¤æ–­blogæ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ä¸å­˜åœ¨å°±cloneå¦åˆ™å¼ºåˆ¶æ›´æ–°ï¼Œæ¯æ¬¡æ›´æ–°æˆåŠŸä¹‹åéƒ½ä¼šå‘ä½ è‡ªå·±æˆ–è€…å…¶ä»–äººå‘é€é‚®ä»¶ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨awkè¯»å–mail.txtä¸­çš„qqå¥½å‹çš„é‚®ç®±è´¦å·å»å‘é€é‚®ä»¶ï¼Œç”±äºåŒä¸€æ—¶é—´å‘é€å¤§é‡é‚®ä»¶å¯èƒ½ä¼šå­˜åœ¨vpsè¢«å°çš„é£é™©ã€‚æ‰€ä»¥æœ€å¥½è¿˜æ˜¯ä¸è¦å¤§é‡å‘é€ï¼Œåªæ˜¯æ¯æ¬¡ç»™è‡ªå·±æˆ–è€…å‡ ä¸ªé‡è¦çš„äººå‘é€å°±å¥½äº†ã€‚æ„Ÿå…´è¶£çš„è¯å¯ä»¥è‡ªå·±ç ”ç©¶awkä»¥åŠsendmailã€‚","categories":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}],"tags":[{"name":"vps","slug":"vps","permalink":"/tags/vps/"}],"keywords":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}]},{"title":"çªç ´ç®—æ³•ä¹‹-é€‰æ‹©æ’åº","slug":"2016-10-14-select_sort","date":"2016-10-14T06:00:00.000Z","updated":"2020-01-03T10:12:29.156Z","comments":true,"path":"2016/10/14/2016-10-14-select_sort/","link":"","permalink":"/2016/10/14/2016-10-14-select_sort/","excerpt":"é€‰æ‹©æ’åºåŸç†é€‰æ‹©æ’åºæ€æƒ³å°±æ˜¯éå†æ‰¾å‡ºæœ€å°å€¼æˆ–è€…æœ€å¤§å€¼åç»´æŠ¤æœ‰åºåºåˆ—ï¼Œä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡å¾€åæ‰¾åˆ°æœ€å°æˆ–è€…æœ€å¤§å…ƒç´ ï¼Œç„¶åä¸ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œç„¶åä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡å¾€å¤ç›´åˆ°å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ æ‰¾å‡ºæœ€å°æ•°ï¼Œæ—¶é—´å¤æ‚åº¦O(n^2)ã€‚","text":"é€‰æ‹©æ’åºåŸç†é€‰æ‹©æ’åºæ€æƒ³å°±æ˜¯éå†æ‰¾å‡ºæœ€å°å€¼æˆ–è€…æœ€å¤§å€¼åç»´æŠ¤æœ‰åºåºåˆ—ï¼Œä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡å¾€åæ‰¾åˆ°æœ€å°æˆ–è€…æœ€å¤§å…ƒç´ ï¼Œç„¶åä¸ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œç„¶åä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡å¾€å¤ç›´åˆ°å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ æ‰¾å‡ºæœ€å°æ•°ï¼Œæ—¶é—´å¤æ‚åº¦O(n^2)ã€‚ Golangä»£ç å®ç°package main import &quot;fmt&quot; /** 1. æ‰¾åˆ°æ•°ç»„é‡Œæœ€å°çš„å…ƒç´  2. è®©å®ƒå’Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ 3. åœ¨å‰©ä¸‹å…ƒç´ ä¸­æ‰¾åˆ°æœ€å°å€¼ï¼Œä¸æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ äº¤æ¢ 4. å¦‚æ­¤å¾€å¤ï¼Œç›´åˆ°å°†æ•´ä¸ªæ•°ç»„æ’åº */ func main() { var minIndex int array := []int{6, 7, 9, 3, 6, 8, 1, 9, 3} for i := 0; i &lt; len(array)-1; i++ { minIndex = i for j := i + 1; j &lt; len(array); j++ { if array[j] &lt; array[minIndex] { minIndex = j } } array[i], array[minIndex] = array[minIndex], array[i] } fmt.Println(array) } githubåœ°å€ é€‰æ‹©æ’åºçš„æ”¹è¿›æ¯æ¬¡å¾ªç¯æ—¶å¯ä»¥åˆ†åˆ«æ‰¾å‡ºæœ€å¤§å€¼ä¸æœ€å°å€¼ç„¶åè¿›è¡ŒåŒå‘é€‰æ‹©æ’åºï¼Œå¤–å±‚åˆ¤æ–­minIndex==maxIndex+1è·³å‡ºå¾ªç¯ã€‚ array := []int{6, 7, 9, 3, 6, 8, 1, 9, 3} len := len(array) for i := 0; i &lt; len-1; i++ { minIndex := i maxIndex := len - i - 1 if minIndex == maxIndex+1 { break } for j := i + 1; j &lt; len; j++ { if array[j] &lt; array[minIndex] { minIndex = j } else if array[j] &gt; array[maxIndex] &amp;&amp; j &lt; len-i-1 { maxIndex = j } } array[i], array[minIndex] = array[minIndex], array[i] array[len-i-1], array[maxIndex] = array[maxIndex], array[len-i-1] } fmt.Println(array)","categories":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}],"tags":[{"name":"sort","slug":"sort","permalink":"/tags/sort/"}],"keywords":[{"name":"algorithms","slug":"algorithms","permalink":"/categories/algorithms/"}]},{"title":"å…¬å¸Restæ¶æ„å¯åŠ¨è¿‡ç¨‹åˆ†æ","slug":"2016-10-14-rest_framework_analyse","date":"2016-10-13T16:00:00.000Z","updated":"2020-01-03T10:12:29.222Z","comments":true,"path":"2016/10/14/2016-10-14-rest_framework_analyse/","link":"","permalink":"/2016/10/14/2016-10-14-rest_framework_analyse/","excerpt":"ä»€ä¹ˆæ˜¯RESTå…·è±¡çŠ¶æ€ä¼ è¾“ï¼ˆè‹±æ–‡ï¼šRepresentational State Transferï¼Œç®€ç§°RESTï¼‰ï¼Œæ˜¯Roy Thomas Fieldingåšå£«ä¸2000å¹´åœ¨ä»–çš„åšå£«è®ºæ–‡ â€œArchitectural Styles and the Design of Network-based Software Architecturesâ€ ä¸­æå‡ºæ¥çš„ä¸€ç§ä¸‡ç»´ç½‘è½¯ä»¶æ¶æ„é£æ ¼ã€‚ RESTç›¸å¯¹äºä¼ ç»Ÿçš„SOAPåˆ°åº•æœ‰å“ªäº›ä¸åŒï¼Œæˆ–è€…è¯´ä¸¤è€…åˆ†åˆ«æ›´é€‚åˆè¿ç”¨äºä»€ä¹ˆæ ·çš„åœºæ™¯ã€‚","text":"ä»€ä¹ˆæ˜¯RESTå…·è±¡çŠ¶æ€ä¼ è¾“ï¼ˆè‹±æ–‡ï¼šRepresentational State Transferï¼Œç®€ç§°RESTï¼‰ï¼Œæ˜¯Roy Thomas Fieldingåšå£«ä¸2000å¹´åœ¨ä»–çš„åšå£«è®ºæ–‡ â€œArchitectural Styles and the Design of Network-based Software Architecturesâ€ ä¸­æå‡ºæ¥çš„ä¸€ç§ä¸‡ç»´ç½‘è½¯ä»¶æ¶æ„é£æ ¼ã€‚ RESTç›¸å¯¹äºä¼ ç»Ÿçš„SOAPåˆ°åº•æœ‰å“ªäº›ä¸åŒï¼Œæˆ–è€…è¯´ä¸¤è€…åˆ†åˆ«æ›´é€‚åˆè¿ç”¨äºä»€ä¹ˆæ ·çš„åœºæ™¯ã€‚ SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰ï¼šæ˜¯äº¤æ¢æ•°æ®çš„ä¸€ç§åè®®è§„èŒƒï¼Œä½¿ç”¨åœ¨è®¡ç®—æœºç½‘ç»œWebæœåŠ¡ï¼ˆweb serviceï¼‰ä¸­ï¼Œäº¤æ¢å¸¦ç»“æ„ä¿¡æ¯ã€‚SOAPä¸ºäº†ç®€åŒ–ç½‘é¡µæœåŠ¡å™¨ï¼ˆWeb Serverï¼‰ä»XMLæ•°æ®åº“ä¸­æå–æ•°æ®æ—¶ï¼ŒèŠ‚çœå»æ ¼å¼åŒ–é¡µé¢æ—¶é—´ï¼Œä»¥åŠä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´æŒ‰ç…§HTTPé€šä¿¡åè®®ï¼Œéµä»XMLæ ¼å¼æ‰§è¡Œèµ„æ–™äº’æ¢ï¼Œä½¿å…¶æŠ½è±¡äºè¯­è¨€å®ç°ã€å¹³å°å’Œç¡¬ä»¶ã€‚ RESTï¼šæ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œç›¸å¯¹SOAPè¦ç›¸å¯¹ç®€å•ï¼Œèµ„æºæ˜¯ç”±URIæ¥æŒ‡å®šï¼Œå¯¹èµ„æºçš„æ“ä½œåŒ…æ‹¬è·å–ã€åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤èµ„æºï¼Œè¿™äº›æ“ä½œæ­£å¥½å¯¹åº”HTTPåè®®æä¾›çš„GETã€POSTã€PUTå’ŒDELETEæ–¹æ³•ï¼Œé€šè¿‡æ“ä½œèµ„æºçš„è¡¨ç°å½¢å¼æ¥æ“ä½œèµ„æºï¼Œèµ„æºçš„è¡¨ç°å½¢å¼åˆ™æ˜¯XMLæˆ–è€…HTMLï¼Œå–å†³äºè¯»è€…æ˜¯æœºå™¨è¿˜æ˜¯äººï¼Œæ˜¯æ¶ˆè´¹webæœåŠ¡çš„å®¢æˆ·è½¯ä»¶è¿˜æ˜¯webæµè§ˆå™¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ä»»ä½•å…¶ä»–çš„æ ¼å¼ã€‚RESTçš„å‡ ä¸ªé‡è¦çº¦æŸï¼š å®¢æˆ·-æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰é€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å•æ–¹é¢å‘èµ·ï¼Œè¡¨ç°ä¸ºè¯·æ±‚-å“åº”çš„å½¢å¼ã€‚ æ— çŠ¶æ€ï¼ˆStatelessï¼‰é€šä¿¡çš„ä¼šè¯çŠ¶æ€ï¼ˆSession Stateï¼‰åº”è¯¥å…¨éƒ¨ç”±å®¢æˆ·ç«¯è´Ÿè´£ç»´æŠ¤ã€‚ ç¼“å­˜ï¼ˆCacheï¼‰å“åº”å†…å®¹å¯ä»¥åœ¨é€šä¿¡é“¾çš„æŸå¤„è¢«ç¼“å­˜ï¼Œä»¥æ”¹å–„ç½‘ç»œæ•ˆç‡ã€‚ ç»Ÿä¸€æ¥å£ï¼ˆUniform Interfaceï¼‰é€šä¿¡é“¾çš„ç»„ä»¶ä¹‹é—´é€šè¿‡ç»Ÿä¸€çš„æ¥å£ç›¸äº’é€šä¿¡ï¼Œä»¥ æé«˜äº¤äº’çš„å¯è§æ€§ã€‚ åˆ†å±‚ç³»ç»Ÿï¼ˆLayered Systemï¼‰é€šè¿‡é™åˆ¶ç»„ä»¶çš„è¡Œä¸ºï¼ˆå³ï¼Œæ¯ä¸ªç»„ä»¶åªèƒ½â€œçœ‹åˆ°â€ä¸å…¶äº¤äº’çš„ç´§é‚»å±‚ï¼‰ï¼Œå°†æ¶æ„åˆ†è§£ä¸ºè‹¥å¹²ç­‰çº§çš„å±‚ã€‚ æŒ‰éœ€ä»£ç ï¼ˆCode-On-Demandï¼Œå¯é€‰ï¼‰æ”¯æŒé€šè¿‡ä¸‹è½½å¹¶æ‰§è¡Œä¸€äº›ä»£ç ï¼ˆä¾‹å¦‚Java Appletã€Flashæˆ–JavaScriptï¼‰ï¼Œå¯¹å®¢æˆ·ç«¯çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•ã€‚ è¿™åªæ˜¯ç½‘ä¸Šæœç´¢å‡ºæ¥çš„è§£é‡Šï¼Œæ›´åŠ æ·±å…¥çš„ç†è§£éœ€è¦å…·ä½“çš„é¡¹ç›®å¼€å‘ä¸­å»æ…¢æ…¢ç†è§£ã€‚ å…¬å¸æ¶æ„æºç ä»¥åŠå¯åŠ¨è¿‡ç¨‹åˆ†æ1.é¦–å…ˆåŠ è½½å‚æ•°spring.profiles.activeè®¾ç½®é¡¹ç›®ç¯å¢ƒä¿¡æ¯ï¼ˆdevã€testã€productï¼‰ï¼Œé…ç½®contextConfigLocationé…ç½®Springé…ç½®æ–‡ä»¶è·¯å¾„ã€‚ç´§æ¥ç€å®¹å™¨ä¼šåˆå§‹åŒ–ä¸€ä¸ªServletContextä¸Šä¸‹æ–‡ï¼Œåˆ©ç”¨ ServletContext èƒ½å¤Ÿè·å¾— WEB è¿ç”¨çš„é…ç½®ä¿¡æ¯, å®ç°åœ¨å¤šä¸ª Servlet ä¹‹é—´å…±äº«æ•°æ®ç­‰ã€‚ 2.ContextLoaderListeneræ ¹æ®contextConfigLocationæŒ‡å®šçš„Springé…ç½®æ–‡ä»¶å»åˆå§‹åŒ–springçš„WebApplicationContextä¸Šä¸‹æ–‡ï¼Œå¹¶åŠ å…¥ServletContextä¸­ï¼ˆServletContextæ˜¯æ•´ä¸ªWEBåº”ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨å®¹å™¨ï¼ˆTomcatã€JBoosç­‰ï¼‰å®Œå…¨å¯åŠ¨WEBåº”ç”¨ä¹‹å‰è¢«åˆ›å»ºï¼Œç”Ÿå‘½å‘¨æœŸä¼´éšçœŸä¸ªWEBåº”ç”¨ï¼‰ï¼Œä¹‹åå¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„æ¡†æ¶ä¸Šä¸‹æ–‡ç›‘å¬å™¨è·å–ServletContexå»è·å–WebApplicationContextä¸Šä¸‹æ–‡ã€‚ ä¸Šè¿°ä¸ºä»€ä¹ˆæ˜¯WebApplicationContextè€Œä¸æ˜¯ApplicationContextå‘¢ï¼Ÿ SpringMVCæœ¬èº«æ˜¯ä¸å…·å¤‡WebåŠŸèƒ½çš„ï¼ŒWebApplicationContexté€šè¿‡ç»§æ‰¿ApplicationContextå»æ‰©å±•è·å¾—WebåŠŸèƒ½ï¼ŒSpring MVCæ˜¯å¦‚ä½•åœ¨webç¯å¢ƒä¸­åˆ›å»ºIoCå®¹å™¨å‘¢ï¼Ÿwebç¯å¢ƒä¸­çš„IoCå®¹å™¨çš„ç»“æ„åˆæ˜¯ä»€ä¹ˆç»“æ„å‘¢ï¼Ÿwebç¯å¢ƒä¸­ï¼Œspring IoCå®¹å™¨æ˜¯æ€ä¹ˆå¯åŠ¨å‘¢ï¼Ÿ åœ¨web.xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦çš„é…ç½®ï¼šContextLoaderListenerå’ŒDispatcherServletã€‚åŒæ ·çš„å…³äºspringé…ç½®æ–‡ä»¶çš„ç›¸å…³é…ç½®ä¹Ÿæœ‰ä¸¤éƒ¨åˆ†ï¼šcontext-paramå’ŒDispatcherServletä¸­çš„init-paramã€‚é‚£ä¹ˆï¼Œè¿™ä¸¤éƒ¨åˆ†çš„é…ç½®æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå®ƒä»¬éƒ½æ‹…ä»»ä»€ä¹ˆæ ·çš„èŒè´£å‘¢ï¼Ÿ åœ¨Spring MVCä¸­ï¼ŒSpring Contextæ˜¯ä»¥çˆ¶å­çš„ç»§æ‰¿ç»“æ„å­˜åœ¨çš„ã€‚Webç¯å¢ƒä¸­å­˜åœ¨ä¸€ä¸ªROOT Contextï¼Œè¿™ä¸ªContextæ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹ä¸Šä¸‹æ–‡ï¼Œæ˜¯å…¶ä»–contextçš„åŒäº²Contextã€‚åŒæ—¶Spring MVCä¹Ÿå¯¹åº”çš„æŒæœ‰ä¸€ä¸ªç‹¬ç«‹çš„Contextï¼Œå®ƒæ˜¯ROOT Contextçš„å­ä¸Šä¸‹æ–‡ã€‚ å¯¹äºè¿™æ ·çš„Contextç»“æ„åœ¨Spring MVCä¸­æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿä¸‹é¢å°±å…ˆä»ROOT Contextå…¥æ‰‹ï¼ŒROOT Contextæ˜¯åœ¨ContextLoaderListenerä¸­é…ç½®çš„ï¼ŒContextLoaderListenerè¯»å–context-paramä¸­çš„contextConfigLocationæŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºROOT Contextã€‚ Spring MVCå¯åŠ¨è¿‡ç¨‹å¤§è‡´åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š ContextLoaderListeneråˆå§‹åŒ–ï¼Œå®ä¾‹åŒ–IoCå®¹å™¨ï¼Œå¹¶å°†æ­¤å®¹å™¨å®ä¾‹æ³¨å†Œåˆ°ServletContextä¸­ï¼› DispatcherServletåˆå§‹åŒ–ï¼› å…¶ä¸­ContextLoaderListeneræ˜¯åœ¨Webå®¹å™¨ä¸­åˆå§‹åŒ–Springçš„æ ¹ä¸Šä¸‹æ–‡å’Œå®ä¾‹åŒ–IOCå®¹å™¨ï¼ŒDispatcherServletæ˜¯åˆå§‹åŒ–Spring MVCå¯¹åº”çš„ä¸Šä¸‹æ–‡ã€‚å…·ä½“åˆ†æè¯·å‚è€ƒåŸæ–‡ï¼šæ·±å…¥åˆ†æSpringä¸Springå®¹å™¨ 3. ArchListener æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°ServletContextListenerå»å®ç°æˆ‘ä»¬è‡ªå·±çš„Servletç›‘å¬å™¨ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„Servletç›‘å¬å™¨ä¸­çš„contextInitializedæ–¹æ³•ä¸­é€šè¿‡WebApplicationContextUtils.getRequiredWebApplicationContext(event.getServletContext());ä»åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å»è·å–WebApplicationCotextä¸Šä¸‹æ–‡ã€‚åŸºäºè¿™ä¸€æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå·±åˆ›å»ºæ¡†æ¶ä¸Šä¸‹æ–‡ç›‘å¬ç±»æ·»æ•´ä¸ªæ¡†æ¶æ‰€æœ‰çš„ä¸Šä¸‹æ–‡å®ç°å¯¹æ•´ä¸ªæ¡†æ¶çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ç®¡ç†ã€‚ 4.RestServiceListenerï¼ˆRestæœåŠ¡ç›‘å¬ï¼‰ ä»ServletContextä¸­è·å–Springçš„WebApplicationContextä¸Šä¸‹æ–‡ï¼š è·å–åˆ°Springçš„ä¸Šä¸‹æ–‡åè·å–ä¸Šé¢Springé…ç½®æ–‡ä»¶ ä¸­çš„RestServiceConfiguration Bean ReståŸºç¡€æœåŠ¡å¯¹è±¡ï¼šç”¨äºä¿å­˜å‰ç½®æ‹¦æˆªå™¨ã€è‡ªå®šä¹‰å‰ç½®æ‹¦æˆªå™¨ã€åç½®æ‹¦æˆªå™¨ã€è‡ªå®šä¹‰åç½®æ‹¦æˆªå™¨ã€CGIæœåŠ¡åç§°ï¼ˆé…ç½®æ–‡ä»¶æŒ‡å®šï¼‰ã€CMDå‰ç¼€ï¼ˆé…ç½®æ–‡ä»¶æŒ‡å®šï¼‰ã€è°ƒç”¨ä¸šåŠ¡è¶…æ—¶é‚®ä»¶æ¥æ”¶è€…ï¼ˆé…ç½®æ–‡ä»¶æŒ‡å®šï¼‰ã€ç³»ç»Ÿå¼‚å¸¸é‚®ä»¶æ¥æ”¶è€…ï¼ˆé…ç½®æ–‡ä»¶æŒ‡å®šï¼‰ï¼Œä¹‹åé€šè¿‡RestServiceUtils.registerServices(configuration);ï¼ˆæ‰«æè‡ªå®šä¹‰æ³¨è§£è¿›è¡Œä¾èµ–æ³¨å…¥ï¼‰configuration.init();ï¼ˆåˆå§‹åŒ–å¯¼å…¥æ‹¦æˆªå™¨ï¼‰ 5.åˆå§‹åŒ–ä¸€ç³»åˆ—è¿‡æ»¤å™¨6.DispatcherServletï¼šåˆå§‹åŒ–Spring MVCä¸Šä¸‹æ–‡7.PropertiesServletï¼šç”¨äºåŠ¨æ€ä¿®æ”¹é…ç½®æ–‡ä»¶8.ç´§æ¥ç€Springæ¥ç®¡MsgSenderServiceæ—¶@PostConstructæ³¨è§£çš„initæ–¹æ³•ä¼šè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–MQå‘é€ç«¯ã€åˆå§‹åŒ–BaseConsumer","categories":[{"name":"framework","slug":"framework","permalink":"/categories/framework/"}],"tags":[{"name":"rest","slug":"rest","permalink":"/tags/rest/"}],"keywords":[{"name":"framework","slug":"framework","permalink":"/categories/framework/"}]},{"title":"Spring Booté…ç½®å®šæ—¶ä»»åŠ¡ä»¥åŠæ³¨å†Œå¯åŠ¨ç±»","slug":"2016-08-1-springboot_scheduling","date":"2016-08-13T16:00:00.000Z","updated":"2020-01-03T10:12:29.213Z","comments":true,"path":"2016/08/14/2016-08-1-springboot_scheduling/","link":"","permalink":"/2016/08/14/2016-08-1-springboot_scheduling/","excerpt":"é…ç½®Spring Bootå®šæ—¶ä»»åŠ¡åœ¨Spring Bootå¯åŠ¨æ–¹æ³•ä¸ŠåŠ ä¸Š@EnableSchedulingå¼€å¯å®šæ—¶ä»»åŠ¡","text":"é…ç½®Spring Bootå®šæ—¶ä»»åŠ¡åœ¨Spring Bootå¯åŠ¨æ–¹æ³•ä¸ŠåŠ ä¸Š@EnableSchedulingå¼€å¯å®šæ—¶ä»»åŠ¡ @SpringBootApplication @EnableScheduling @EnableAutoConfiguration @ComponentScan(basePackages = &quot;com.smtcl.machinetool&quot;) public class Main extends SpringBootServletInitializer{ private static Class&lt;Main&gt; applicationClass = Main.class; /*build spring boot*/ @Override protected SpringApplicationBuilder configure(SpringApplicationBuilder builder){ return builder.sources(applicationClass); } /*spring boot å¯åŠ¨ä¸»æ–¹æ³•*/ public static void main(String[] args){ SpringApplication.run(applicationClass, args); } } å¼€å¯å®šæ—¶ä»»åŠ¡ @Scheduled(fixedRate = 10000) public void updateOemTool(){ // List&lt;Name&gt; list = idao.executeQuery(&quot;from Name&quot;); // for (Name name : list){ // // System.out.println(name.getName()); // } } fixedRate=10000è¡¨ç¤ºæ¯åç§’æ‰§è¡Œä¸€æ¬¡è¯¥æ–¹æ³•ï¼Œå¦‚æœéœ€è¦æ›´ç²¾ç¡®çš„å®šæ—¶å¯ä»¥ç”¨ cronè¡¨è¾¾å¼ &quot;0 0 12 * * ?&quot; æ¯å¤©ä¸­åˆåäºŒç‚¹è§¦å‘ &quot;0 15 10 ? * *&quot; æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘ &quot;0 15 10 * * ?&quot; æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘ &quot;0 15 10 * * ? *&quot; æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘ &quot;0 15 10 * * ? 2005&quot; 2005å¹´çš„æ¯å¤©æ—©ä¸Š10ï¼š15è§¦å‘ &quot;0 * 14 * * ?&quot; æ¯å¤©ä»ä¸‹åˆ2ç‚¹å¼€å§‹åˆ°2ç‚¹59åˆ†æ¯åˆ†é’Ÿä¸€æ¬¡è§¦å‘ &quot;0 0/5 14 * * ?&quot; æ¯å¤©ä»ä¸‹åˆ2ç‚¹å¼€å§‹åˆ°2ï¼š55åˆ†ç»“æŸæ¯5åˆ†é’Ÿä¸€æ¬¡è§¦å‘ &quot;0 0/5 14,18 * * ?&quot; æ¯å¤©çš„ä¸‹åˆ2ç‚¹è‡³2ï¼š55å’Œ6ç‚¹è‡³6ç‚¹55åˆ†ä¸¤ä¸ªæ—¶é—´æ®µå†…æ¯5åˆ†é’Ÿä¸€æ¬¡è§¦å‘ &quot;0 0-5 14 * * ?&quot; æ¯å¤©14:00è‡³14:05æ¯åˆ†é’Ÿä¸€æ¬¡è§¦å‘ &quot;0 10,44 14 ? 3 WED&quot; ä¸‰æœˆçš„æ¯å‘¨ä¸‰çš„14ï¼š10å’Œ14ï¼š44è§¦å‘ &quot;0 15 10 ? * MON-FRI&quot; æ¯ä¸ªå‘¨ä¸€ã€å‘¨äºŒã€å‘¨ä¸‰ã€å‘¨å››ã€å‘¨äº”çš„10ï¼š15è§¦å‘ é…ç½®éšé¡¹ç›®å¯åŠ¨å¯åŠ¨åœ¨application.propertitesä¸­æ·»åŠ å¦‚ä¸‹é…ç½® context.listener.classes=ä½ è¦æ³¨å†Œçš„ç±»çš„è·¯å¾„ ä½ è¦æ³¨å†Œçš„ç±»åªè¦ç»§æ‰¿ApplicationListener&lt;ContextRefreshedEvent&gt;å¹¶ä¸”å®ç°onApplicationEventæ–¹æ³•å°±å¯ä»¥äº†ï¼Œè¿™æ—¶é¡¹ç›®å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨è¿è¡ŒonApplicationEventä¸­çš„æœåŠ¡ã€‚ public class RFIDTCPService implements ApplicationListener&lt;ContextRefreshedEvent&gt;{ public void onApplicationEvent(ContextRefreshedEvent event){ /** * è·å–æœåŠ¡ç«¯ç«¯å£ */ Integer port = (Integer) event.getApplicationContext().getBean(&quot;SERVER_PORT&quot;); new Thread(new waitConnection(port)).start(); } }","categories":[{"name":"java","slug":"java","permalink":"/categories/java/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"/tags/SpringBoot/"}],"keywords":[{"name":"java","slug":"java","permalink":"/categories/java/"}]},{"title":"ä½¿ç”¨Springäº‹åŠ¡æ—¶é‡åˆ°çš„Sessioné—®é¢˜","slug":"2016-08-05-problem_hibernate_session","date":"2016-08-04T16:00:00.000Z","updated":"2020-01-03T10:12:29.241Z","comments":true,"path":"2016/08/05/2016-08-05-problem_hibernate_session/","link":"","permalink":"/2016/08/05/2016-08-05-problem_hibernate_session/","excerpt":"é—®é¢˜å½“å¼€å¯äº‹åŠ¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°ä¸€ä¸ªè¡¨å¯¹è±¡æ•°æ®æ—¶ï¼Œå¯èƒ½æˆ‘ä»¬å¹¶æ²¡æœ‰æ‰€æœ‰çš„è¡¨å¯¹è±¡çš„æ•°æ®ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å…ˆæŸ¥çœ‹ä»–çš„åŸå§‹æ•°æ®ï¼Œç„¶åæ›´æ–°æ•°æ®åˆ°æˆ‘ä»¬é‡æ–°å°è£…çš„å®ä¾‹å¯¹è±¡ä¸­å»ã€‚è¿™æ—¶å¦‚æœæˆ‘ä»¬ç›´æ¥å»save()æˆ–è€…update()è¿™ä¸ªå¯¹è±¡å°±å›æŠ¥è¿™æ ·çš„é”™ã€‚","text":"é—®é¢˜å½“å¼€å¯äº‹åŠ¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°ä¸€ä¸ªè¡¨å¯¹è±¡æ•°æ®æ—¶ï¼Œå¯èƒ½æˆ‘ä»¬å¹¶æ²¡æœ‰æ‰€æœ‰çš„è¡¨å¯¹è±¡çš„æ•°æ®ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å…ˆæŸ¥çœ‹ä»–çš„åŸå§‹æ•°æ®ï¼Œç„¶åæ›´æ–°æ•°æ®åˆ°æˆ‘ä»¬é‡æ–°å°è£…çš„å®ä¾‹å¯¹è±¡ä¸­å»ã€‚è¿™æ—¶å¦‚æœæˆ‘ä»¬ç›´æ¥å»save()æˆ–è€…update()è¿™ä¸ªå¯¹è±¡å°±å›æŠ¥è¿™æ ·çš„é”™ã€‚ org.springframework.dao.DuplicateKeyException: A different object with the same identifier value was already associated with the session åŸå› å› ä¸ºåœ¨æŸ¥è¯¢å¯¹è±¡æ•°æ®çš„æ—¶å€™sessionä¸­å°±å·²ç»ä¿äº†è¿™ä¸ªå¯¹è±¡ï¼Œç°åœ¨åˆè¦å†æ¬¡å»æ›´æ–°æˆ–è€…ä¿å­˜è¿™ä¸ªå¯¹è±¡ï¼Œhibernateå°±ä¼šä¸çŸ¥é“åˆ°åº•å“ªä¸€ä¸ªæ‰æ˜¯æˆ‘ä»¬éœ€è¦å»æ“ä½œçš„å¯¹è±¡ã€‚å› ä¸ºè¿™æ—¶sessionä¸­æœ‰äº†ä¸¤ä¸ªç›¸åŒidä½†æ˜¯ä¸åŒçš„å®ä½“ï¼Œè¿™æ˜¯æˆ‘ä»¬éœ€è¦å…ˆåˆ é™¤sessionä¸­å­˜åœ¨çš„å¯¹è±¡ã€‚ åˆ é™¤sessionä¸­ç¼“å­˜å¯¹è±¡çš„æ–¹å¼ï¼š1.clear()(ä¸æ¨èä½¿ç”¨ï¼Œä¼šç›´æ¥æ¸…ç©ºsessionï¼Œæ“ä½œå½±å“å¤ªå¤§)2.evict()(å®šç‚¹åˆ é™¤sessionä¸­çš„æŸä¸ªå¯¹è±¡)è¿™ä¸ªä¹Ÿæ˜¯æˆ‘è‡ªå·±çš„åšæ³•ï¼Œè¿™æ ·åˆ é™¤å½±å“æœ€å°ã€‚ é™„ä¸Šä»£ç ï¼š //é€šè¿‡ç‰©æ–™ç¼–å·è·å–ç‰©æ–™id String hql = &quot;from CGeneralMaterial cgm where cgm.materialNo=&#39;&quot; + materialNo + &quot;&#39;&quot;; List&lt;CGeneralMaterial&gt; materialIdList = dao.executeQuery(hql); Integer materialId = materialIdList.get(0).getMaterialId(); saveMaterial.setMaterialId(materialId); /** * è¿™é‡Œæ˜¯åˆ é™¤sessionä¸­ç›¸åŒçš„å¯¹è±¡ */ session.evict(materialIdList.get(0));//å°‘äº†è¿™å¥å°±ä¼šæŠ¥ä¸Šé¢çš„é”™è¯¯ dao.update(saveMaterial);","categories":[{"name":"java","slug":"java","permalink":"/categories/java/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"/tags/SpringBoot/"}],"keywords":[{"name":"java","slug":"java","permalink":"/categories/java/"}]},{"title":"å¼€å¯Springäº‹åŠ¡æœºåˆ¶","slug":"2016-08-04-spring_transaction","date":"2016-08-03T16:00:00.000Z","updated":"2020-01-03T10:12:29.186Z","comments":true,"path":"2016/08/04/2016-08-04-spring_transaction/","link":"","permalink":"/2016/08/04/2016-08-04-spring_transaction/","excerpt":"ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿåœ¨ä¼ä¸šçº§å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºä¸æ— äººå‘˜æ¥è¯´ä¸€ä¸ªå®é™…çš„å¯¹æ•°æ®åº“çš„æ“ä½œå¯èƒ½æ˜¯å¤šæ­¥ç»“åˆè¿›è¡Œçš„ã€‚","text":"ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿåœ¨ä¼ä¸šçº§å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºä¸æ— äººå‘˜æ¥è¯´ä¸€ä¸ªå®é™…çš„å¯¹æ•°æ®åº“çš„æ“ä½œå¯èƒ½æ˜¯å¤šæ­¥ç»“åˆè¿›è¡Œçš„ã€‚ç”±äºå¯¹æ•°æ®åº“çš„æ“ä½œåœ¨ä»»ä½•ä¸€ä¸ªæ­¥éª¤éƒ½æœ‰å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œå¼‚å¸¸ä¼šå¯¼è‡´åç»­æ“ä½œæ— æ³•å®Œæˆï¼Œå¯æ˜¯æ­¤æ—¶ä¸šåŠ¡é€»è¾‘æ²¡æœ‰æ­£ç¡®å®Œæˆï¼Œä¹‹å‰çš„æ“ä½œæ•°æ®ä¹Ÿå°±ä¸å¯é ï¼Œéœ€è¦åœ¨è¿™ç§æƒ…å†µä¸‹å¯¹ä¹‹å‰çš„æ“ä½œçš„æ•°æ®è¿›è¡Œå›æ»šã€‚ å›æ»šæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·æ¯ä¸€æ­¥çš„æ“ä½œéƒ½æ˜¯å¯é çš„ï¼Œäº‹åŠ¡ä¸­çš„æ¯ä¸€æ­¥æ“ä½œéƒ½å¿…é¡»æ­£ç¡®å®Œæˆï¼Œåªè¦æœ‰ä¸€ä¸ªå¼‚å¸¸çš„å‘ç”Ÿéƒ½éœ€è¦å›é€€åˆ°å¼€å§‹çš„æœªè¿›è¡Œçš„çŠ¶æ€ã€‚ äº‹åŠ¡ç®¡ç†ä¹Ÿæ˜¯Springæ¡†æ¶ä¸­æœ€ä¸ºå¸¸ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ å¿«é€Ÿå…¥é—¨åœ¨Spring Bootä¸­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äº†spring-boot-starter-jdbcæˆ–spring-boot-starter-data-jpaä¾èµ–çš„æ—¶å€™ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨é»˜è®¤åˆ†åˆ«æ³¨å…¥ DataSourceTransactionManageræˆ–JpaTransactionManagerã€‚æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä»»ä½•é¢å¤–é…ç½®å°±å¯ä»¥ç”¨@Transactionalæ³¨è§£è¿›è¡Œäº‹åŠ¡çš„ä½¿ç”¨ã€‚ é€šå¸¸åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³è¦æµ‹è¯•ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®ä¸å¦ï¼Œå¹¶ä¸æƒ³ä¿å­˜æµ‹è¯•æ•°æ®ã€‚ @RunWith(SpringJUnit4ClassRunner.class) @SpringApplicationConfiguration(Application.class) public class ApplicationTests { @Autowired private UserRepository userRepository; @Test public void test() throws Exception { // åˆ›å»º10æ¡è®°å½• userRepository.save(new User(&quot;AAA&quot;, 10)); userRepository.save(new User(&quot;BBB&quot;, 20)); userRepository.save(new User(&quot;CCC&quot;, 30)); userRepository.save(new User(&quot;DDD&quot;, 40)); userRepository.save(new User(&quot;EEE&quot;, 50)); userRepository.save(new User(&quot;FFF&quot;, 60)); userRepository.save(new User(&quot;GGG&quot;, 70)); userRepository.save(new User(&quot;HHH&quot;, 80)); userRepository.save(new User(&quot;III&quot;, 90)); userRepository.save(new User(&quot;JJJ&quot;, 100)); // çœç•¥åç»­çš„ä¸€äº›éªŒè¯æ“ä½œ } } å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œä½¿ç”¨UserRepositoryå¯¹è±¡è¿ç»­åˆ›å»ºäº†10ä¸ªUserå®ä½“åˆ°æ•°æ®åº“ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬äººä¸ºçš„æ¥åˆ¶é€ ä¸€äº›å¼‚å¸¸ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚ é€šè¿‡å®šä¹‰Userçš„nameå±æ€§é•¿åº¦ä¸º5ï¼Œè¿™æ ·é€šè¿‡åˆ›å»ºæ—¶Userå®ä½“çš„nameå±æ€§è¶…é•¿å°±å¯ä»¥è§¦å‘å¼‚å¸¸äº§ç”Ÿã€‚ @Entity public class User { @Id @GeneratedValue private Long id; @Column(nullable = false, length = 5) private String name; @Column(nullable = false) private Integer age; // çœç•¥æ„é€ å‡½æ•°ã€getterå’Œsetter } ä¿®æ”¹æµ‹è¯•ç”¨ä¾‹ä¸­åˆ›å»ºè®°å½•çš„è¯­å¥ï¼Œå°†ä¸€æ¡è®°å½•çš„nameé•¿åº¦è¶…è¿‡5ï¼Œå¦‚ä¸‹ï¼šnameä¸ºHHHHHHHHHçš„Userå¯¹è±¡å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ // åˆ›å»º10æ¡è®°å½• userRepository.save(new User(&quot;AAA&quot;, 10)); userRepository.save(new User(&quot;BBB&quot;, 20)); userRepository.save(new User(&quot;CCC&quot;, 30)); userRepository.save(new User(&quot;DDD&quot;, 40)); userRepository.save(new User(&quot;EEE&quot;, 50)); userRepository.save(new User(&quot;FFF&quot;, 60)); userRepository.save(new User(&quot;GGG&quot;, 70)); userRepository.save(new User(&quot;HHHHHHHHHH&quot;, 80)); userRepository.save(new User(&quot;III&quot;, 90)); userRepository.save(new User(&quot;JJJ&quot;, 100)); æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°ä¸­æŠ›å‡ºäº†å¦‚ä¸‹å¼‚å¸¸ï¼Œnameå­—æ®µè¶…é•¿ï¼š 2016-05-27 10:30:35.948 WARN 2660 --- [ main] o.h.engine.jdbc.spi.SqlExceptionHelper : SQL Error: 1406, SQLState: 22001 2016-05-27 10:30:35.948 ERROR 2660 --- [ main] o.h.engine.jdbc.spi.SqlExceptionHelper : Data truncation: Data too long for column &#39;name&#39; at row 1 2016-05-27 10:30:35.951 WARN 2660 --- [ main] o.h.engine.jdbc.spi.SqlExceptionHelper : SQL Warning Code: 1406, SQLState: HY000 2016-05-27 10:30:35.951 WARN 2660 --- [ main] o.h.engine.jdbc.spi.SqlExceptionHelper : Data too long for column &#39;name&#39; at row 1 org.springframework.dao.DataIntegrityViolationException: could not execute statement; SQL [n/a]; nested exception is org.hibernate.exception.DataException: could not execute statement æ­¤æ—¶æŸ¥æ•°æ®åº“ä¸­ï¼Œåˆ›å»ºäº†nameä»AAAåˆ°GGGçš„è®°å½•ï¼Œæ²¡æœ‰HHHHHHHHHHã€IIIã€JJJçš„è®°å½•ã€‚è€Œè‹¥è¿™æ˜¯ä¸€ä¸ªå¸Œæœ›ä¿è¯å®Œæ•´æ€§æ“ä½œçš„æƒ…å†µä¸‹ï¼ŒAAAåˆ°GGGçš„è®°å½•å¸Œæœ›èƒ½åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™è¢«å›é€€ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨äº‹åŠ¡è®©å®ƒå®ç°å›é€€ï¼Œåšæ³•éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨testå‡½æ•°ä¸Šæ·»åŠ @Transactionalæ³¨è§£å³å¯ã€‚ @Test @Transactional public void test() throws Exception { // çœç•¥æµ‹è¯•å†…å®¹ } äº‹åŠ¡è¯¦è§£ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨äº†é»˜è®¤çš„äº‹åŠ¡é…ç½®ï¼Œå¯ä»¥æ»¡è¶³ä¸€äº›åŸºæœ¬çš„äº‹åŠ¡éœ€æ±‚ï¼Œä½†æ˜¯å½“æˆ‘ä»¬é¡¹ç›®è¾ƒå¤§è¾ƒå¤æ‚æ—¶ï¼ˆæ¯”å¦‚ï¼Œæœ‰å¤šä¸ªæ•°æ®æºç­‰ï¼‰ï¼Œè¿™æ—¶å€™éœ€è¦åœ¨å£°æ˜äº‹åŠ¡æ—¶ï¼ŒæŒ‡å®šä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨ã€‚å¯¹äºä¸åŒæ•°æ®æºçš„äº‹åŠ¡ç®¡ç†é…ç½®å¯ä»¥è§ã€ŠSpring Bootå¤šæ•°æ®æºé…ç½®ä¸ä½¿ç”¨ã€‹ä¸­çš„è®¾ç½®ã€‚åœ¨å£°æ˜äº‹åŠ¡æ—¶ï¼Œåªéœ€è¦é€šè¿‡valueå±æ€§æŒ‡å®šé…ç½®çš„äº‹åŠ¡ç®¡ç†å™¨åå³å¯ï¼Œä¾‹å¦‚ï¼š@Transactional(value=â€transactionManagerPrimaryâ€)ã€‚ é™¤äº†æŒ‡å®šä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨ä¹‹åï¼Œè¿˜èƒ½å¯¹äº‹åŠ¡è¿›è¡Œéš”ç¦»çº§åˆ«å’Œä¼ æ’­è¡Œä¸ºçš„æ§åˆ¶ï¼Œä¸‹é¢åˆ†åˆ«è¯¦ç»†è§£é‡Šï¼š éš”ç¦»çº§åˆ«éš”ç¦»çº§åˆ«æ˜¯æŒ‡è‹¥å¹²ä¸ªå¹¶å‘çš„äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ï¼Œä¸æˆ‘ä»¬å¼€å‘æ—¶å€™ä¸»è¦ç›¸å…³çš„åœºæ™¯åŒ…æ‹¬ï¼šè„è¯»å–ã€é‡å¤è¯»ã€å¹»è¯»ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹org.springframework.transaction.annotation.Isolationæšä¸¾ç±»ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å€¼ï¼š public enum Isolation { DEFAULT(-1), READ_UNCOMMITTED(1), READ_COMMITTED(2), REPEATABLE_READ(4), SERIALIZABLE(8); } DEFAULTï¼šè¿™æ˜¯é»˜è®¤å€¼ï¼Œè¡¨ç¤ºä½¿ç”¨åº•å±‚æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚å¯¹å¤§éƒ¨åˆ†æ•°æ®åº“è€Œè¨€ï¼Œé€šå¸¸è¿™å€¼å°±æ˜¯ï¼šREAD_COMMITTEDã€‚ READ_UNCOMMITTEDï¼šè¯¥éš”ç¦»çº§åˆ«è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ä½†è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ã€‚è¯¥çº§åˆ«ä¸èƒ½é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œå› æ­¤å¾ˆå°‘ä½¿ç”¨è¯¥éš”ç¦»çº§åˆ«ã€‚ READ_COMMITTEDï¼šè¯¥éš”ç¦»çº§åˆ«è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ï¼Œè¿™ä¹Ÿæ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹çš„æ¨èå€¼ã€‚ REPEATABLE_READï¼šè¯¥éš”ç¦»çº§åˆ«è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å¯ä»¥å¤šæ¬¡é‡å¤æ‰§è¡ŒæŸä¸ªæŸ¥è¯¢ï¼Œå¹¶ä¸”æ¯æ¬¡è¿”å›çš„è®°å½•éƒ½ç›¸åŒã€‚å³ä½¿åœ¨å¤šæ¬¡æŸ¥è¯¢ä¹‹é—´æœ‰æ–°å¢çš„æ•°æ®æ»¡è¶³è¯¥æŸ¥è¯¢ï¼Œè¿™äº›æ–°å¢çš„è®°å½•ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ã€‚ SERIALIZABLEï¼šæ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚ æŒ‡å®šæ–¹æ³•ï¼šé€šè¿‡ä½¿ç”¨isolationå±æ€§è®¾ç½®ï¼Œä¾‹å¦‚ï¼š @Transactional(propagation = Propagation.REQUIRED) å®ç°å›æ»šçš„ä¸‰ç§æ–¹å¼1.ç›´æ¥æŠ›å‡ºå¼‚å¸¸å‘ç”Ÿå¼‚å¸¸æ—¶åœ¨catchä¸­ç›´æ¥é€šè¿‡throwæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºSpringäº‹åŠ¡é»˜è®¤æ¥æ”¶åˆ°æŠ›å‡ºå¼‚å¸¸æ—¶å›æ»šï¼Œä»@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)ä¸­çš„é…ç½®ä¹Ÿå¯ä»¥çœ‹å‡ºã€‚ 2.æŠ›å‡ºRunTimeExceptionæˆ–è€…åœ¨catchä¸­é€šè¿‡è‡ªå·±æ‰‹åŠ¨throw new RunTimeException();æŠ›å‡ºå¼‚å¸¸ã€‚ 3.TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();é€šè¿‡è¿™ç§æ”¾å‘å¯ä»¥ä¸éœ€è¦æŠ›å‡ºå¼‚å¸¸ç›´æ¥å›æ»šã€‚åœ¨å‰å°éœ€è¦è¿”å›å¼‚å¸¸ä¿¡æ¯æ—¶ç”¨è¿™ç§æ–¹æ³•å°±å¯ä»¥èµ·åˆ°å¾ˆå¥½çš„ä½œç”¨ã€‚","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"/categories/SpringBoot/"}],"tags":[{"name":"transaction","slug":"transaction","permalink":"/tags/transaction/"}],"keywords":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"/categories/SpringBoot/"}]},{"title":"é€šè¿‡è´¦å·å¯†ç æŸ¥çœ‹Nginxæ—¥å¿—","slug":"2016-08-01-nginx_logs_account","date":"2016-07-31T16:00:00.000Z","updated":"2020-01-03T10:12:29.189Z","comments":true,"path":"2016/08/01/2016-08-01-nginx_logs_account/","link":"","permalink":"/2016/08/01/2016-08-01-nginx_logs_account/","excerpt":"ä¿®æ”¹è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶åœ¨serverä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  $ vim /usr/local/nginx/nginx.conf server{ location /logs { alias /usr/local/nginx/logs; autoindex on; autoindex_exact_size off; autoindex_localtime on; add_header Cache-Control no-store; auth_basic &quot;Restricted&quot;; auth_basic_user_file /usr/local/nginx/conf/loguser; } }","text":"ä¿®æ”¹è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶åœ¨serverä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  $ vim /usr/local/nginx/nginx.conf server{ location /logs { alias /usr/local/nginx/logs; autoindex on; autoindex_exact_size off; autoindex_localtime on; add_header Cache-Control no-store; auth_basic &quot;Restricted&quot;; auth_basic_user_file /usr/local/nginx/conf/loguser; } } å…¶ä¸­auth_basic_user_file /usr/local/nginx/conf/loguser;æŒ‡å®šç™»é™†è´¦å·çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ é€šè¿‡htpasswdå‘½ä»¤ç”Ÿæˆç”¨æˆ·ååŠå¯¹åº”å¯†ç æ•°æ®åº“æ–‡ä»¶$ htpasswd -c /usr/local/nginx/conf/loguser admin //adminä¸ºè®¤è¯ç”¨æˆ·å $ New password: ******** //è¾“å…¥è®¤è¯å¯†ç  Re-type new password: ******** //å†æ¬¡è¾“å…¥è®¤è¯å¯†ç  Adding password for user admin $ chmod 666 /usr/local/nginx/conf //ä¿®æ”¹ç½‘ç«™è®¤è¯æ•°æ®åº“æƒé™ $ cat /usr/local/nginx/conf/loguser //å¯ä»¥çœ‹åˆ°é€šè¿‡htpasswdç”Ÿæˆçš„å¯†ç ä¸ºåŠ å¯†æ ¼å¼ é…ç½®ç‚¹å‡»æ—¥å¿—æ–‡ä»¶æ‰“å¼€æ–‡ä»¶è€Œä¸æ˜¯ä¸‹è½½æ‰“å¼€æ–‡ä»¶ $ vim /usr/local/nginx/mime.types æ·»åŠ  text/log log; é‡å¯nginx$ nginx -s reload è®¿é—®ç«™ç‚¹æŸ¥çœ‹æ—¥å¿—https://sunsblog.cn/logs è¾“å…¥ç”¨æˆ·åå¯†ç ç™»é™† htpasswdå‘½ä»¤æ±‡æ€»è¯­æ³•htppasswd(é€‰é¡¹)ï¼ˆå‚æ•°ï¼‰ é€‰é¡¹-cï¼šåˆ›å»ºä¸€ä¸ªåŠ å¯†æ–‡ä»¶ï¼› -nï¼šä¸æ›´æ–°åŠ å¯†æ–‡ä»¶ï¼Œåªå°†åŠ å¯†åçš„ç”¨æˆ·åå¯†ç æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼› -mï¼šé»˜è®¤é‡‡ç”¨MD5ç®—æ³•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼› -dï¼šé‡‡ç”¨CRYPTç®—æ³•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼› -pï¼šä¸å¯¹å¯†ç è¿›è¡Œè¿›è¡ŒåŠ å¯†ï¼Œå³æ˜æ–‡å¯†ç ï¼› -sï¼šé‡‡ç”¨SHAç®—æ³•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼› -bï¼šåœ¨å‘½ä»¤è¡Œä¸­ä¸€å¹¶è¾“å…¥ç”¨æˆ·åå’Œå¯†ç è€Œä¸æ˜¯æ ¹æ®æç¤ºè¾“å…¥å¯†ç ï¼› -Dï¼šåˆ é™¤æŒ‡å®šçš„ç”¨æˆ·ã€‚ å‚æ•°ç”¨æˆ·ï¼š è¦åˆ›å»ºæˆ–è€…æ›´æ–°å¯†ç çš„ç”¨æˆ·åå¯†ç ï¼š ç”¨æˆ·çš„æ–°å¯†ç  å®ä¾‹åˆ©ç”¨htppasswdå‘½ä»¤æ·»åŠ ç”¨æˆ·$ htpasswd -bc .passwd www.linuxde.net php åœ¨binç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª.passwdæ–‡ä»¶ï¼Œç”¨æˆ·åwww.linuxde.netï¼Œå¯†ç ï¼šphpï¼Œé»˜è®¤é‡‡ç”¨MD5åŠ å¯†æ–¹å¼ã€‚ åœ¨åŸæœ‰å¯†ç æ–‡ä»¶ä¸­å¢åŠ ä¸‹ä¸€ä¸ªç”¨æˆ·$ htpasswd -b .passwd Jack 123456 å»æ‰-cé€‰é¡¹ï¼Œå³å¯åœ¨ç¬¬ä¸€ä¸ªç”¨æˆ·ä¹‹åæ·»åŠ ç¬¬äºŒä¸ªç”¨æˆ·ï¼Œä¾æ­¤ç±»æ¨ã€‚ ä¸æ›´æ–°å¯†ç æ–‡ä»¶ï¼Œåªæ˜¾ç¤ºåŠ å¯†åçš„ç”¨æˆ·åå’Œå¯†ç $ htpasswd -nb Jack 123456 ä¸æ›´æ–°.passwdæ–‡ä»¶ï¼Œåªåœ¨å±å¹•ä¸Šè¾“å‡ºç”¨æˆ·åå’Œç»è¿‡åŠ å¯†åçš„å¯†ç ã€‚ åˆ©ç”¨htpasswdå‘½ä»¤åˆ é™¤ç”¨æˆ·åå’Œå¯†ç $ htpasswd -D .passwd Jack åˆ©ç”¨htpasswdå‘½ä»¤ä¿®æ”¹å¯†ç $ htpasswd -D .passwd Jack $ htpasswd -b .passwd Jack 123456 å³å…ˆä½¿ç”¨htpasswdåˆ é™¤å‘½ä»¤åˆ é™¤æŒ‡å®šç”¨æˆ·ï¼Œå†åˆ©ç”¨htpasswdæ·»åŠ ç”¨æˆ·å‘½ä»¤åˆ›å»ºç”¨æˆ·å³å¯å®ç°ä¿®æ”¹å¯†ç çš„åŠŸèƒ½ã€‚","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"/tags/nginx/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"nginx luaç¯å¢ƒæ­å»º","slug":"2016-07-31-nginx_lua","date":"2016-07-30T16:00:00.000Z","updated":"2020-01-03T10:12:29.192Z","comments":true,"path":"2016/07/31/2016-07-31-nginx_lua/","link":"","permalink":"/2016/07/31/2016-07-31-nginx_lua/","excerpt":"å®‰è£…nginxåŠæ­å»ºæœ¬åœ°æµ‹è¯•ç¯å¢ƒä¸‹è½½æœ€æ–°ç‰ˆçš„nginx $ cd /usr/local/src $ wget http://nginx.org/download/nginx-1.11.3.tar.gz $ tar -zxvf nginx-1.11.3.tar.gz","text":"å®‰è£…nginxåŠæ­å»ºæœ¬åœ°æµ‹è¯•ç¯å¢ƒä¸‹è½½æœ€æ–°ç‰ˆçš„nginx $ cd /usr/local/src $ wget http://nginx.org/download/nginx-1.11.3.tar.gz $ tar -zxvf nginx-1.11.3.tar.gz å®‰è£…Luajit(æœ€æ–°ç‰ˆ) $ cd /usr/local/src $ wget http://luajit.org/download/LuaJIT-2.1.0-beta2.tar.gz $ tar -zxvf LuaJIT-2.1.0-beta2.tar.gz $ cd ./LuaJIT-2.1.0-beta2 $ make &amp;&amp; make install åœ¨/usr/local/srcç›®å½•ä¸‹åˆ›å»ºnginx-moduleç›®å½•ï¼Œåœ¨nginx-moduleç›®å½•ä¸‹ä¸‹è½½ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šlua-nginx-module: $ git clone https://github.com/chaoslawful/lua-nginx-module.git $ git clone https://github.com/agentzh/echo-nginx-module.git $ git clone https://github.com/simpl/ngx_devel_kit.git ä¸ºäº†é¿å…å†²çªæˆ‘è¿™é‡Œæ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªå®‰è£…ç›®å½• $ mkdir /usr/local/nginx2 ä¿®æ”¹nginxé…ç½®ï¼šè¿›å…¥nginx-1.11.3ç›®å½• $ ./configure --prefix=/usr/local/nginx \\ --add-module=../nginx-module/lua-nginx-module \\ --add-module=../nginx-module/echo-nginx-module \\ --add-module=../nginx-module/ngx_devel_kit \\ --with-http_ssl_module \\ --with-http_v2_module \\ --with-pcre=/usr/local/src/pcre \\ --with-zlib=/usr/local/src/zlib \\ --with-openssl=/usr/local/src/openssl \\ $ make &amp;&amp; make install è¿™é‡Œå°±ä¸è¯¦ç»†çš„ä»‹ç»å„ä¸ªæ¨¡å—çš„ä¸‹è½½å’Œå®‰è£…ï¼Œä¸æ¸…æ¥šçš„å¯ä»¥åˆ°ä¹‹å‰çš„æ–‡ç« æŸ¥çœ‹è¯¦ç»†å®‰è£…é…ç½®ç¼–è¯‘Nginx å¯¼å…¥lualuajité»˜è®¤æ˜¯å®‰è£…åœ¨/usr/local/libç›®å½•ä¸‹ï¼Œä½†æ˜¯nginxæ˜¯ä»/usr/libä¸‹æ‰¾luajitï¼Œå› æ­¤ä¸¤ç§è§£å†³åŠæ³•ï¼Œä¸€ç§æ˜¯å®‰è£…å®Œæˆåæ‰‹åŠ¨cp luajitåº“ç§»ä¸€ä¸‹ï¼Œå¦ä¸€ç§æ˜¯å®‰è£…nginx configå‰å…ˆå¯¼å…¥ç¯å¢ƒå˜é‡,å‘Šè¯‰nginxå»å“ªé‡Œæ‰¾luajit $ export LUAJIT_LIB=/usr/local/lib $ export LUAJIT_INC=/usr/local/include/luajit-2.0 å¦‚æœè¿è¡ŒnginxæŠ¥error while loading shared libraries: libluajit-5.1.so.2: cannot open shared é”™è¯¯ï¼Œè¯´æ˜ä¸Šé¢çš„ä¿®æ”¹è¿˜æ˜¯æ²¡æœ‰ç”Ÿæ•ˆã€‚ å°è¯•ä¸€ä¸‹ä¸‹é¢çš„æ–¹æ³•ï¼š å¦‚æœå…±äº«åº“æ–‡ä»¶å®‰è£…åˆ°äº†/usr/local/lib(å¾ˆå¤šå¼€æºçš„å…±äº«åº“éƒ½ä¼šå®‰è£…åˆ°è¯¥ç›®å½•ä¸‹)æˆ–å…¶å®ƒâ€é/libæˆ–/usr/libâ€ç›®å½•ä¸‹, é‚£ä¹ˆåœ¨æ‰§è¡Œldconfigå‘½ä»¤å‰, è¿˜è¦æŠŠæ–°å…±äº«åº“ç›®å½•åŠ å…¥åˆ°å…±äº«åº“é…ç½®æ–‡ä»¶/etc/ld.so.confä¸­, æ“ä½œå¦‚ä¸‹: $ cat /etc/ld.so.conf $ echo &quot;/usr/local/lib&quot; &gt;&gt; /etc/ld.so.conf $ ldconfig æµ‹è¯•ç¯å¢ƒ$ vim /usr/example/lua/test.lua æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š $ ngx.say(&quot;hello world&quot;); ç„¶åä¿®æ”¹nginxå®‰è£…ç›®å½•ä¸‹çš„nginx.conf location /test { default_type &#39;text/html&#39;; content_by_lua_file /usr/example/lua/test.lua; } åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼šyourServerIp/test å¦‚æœå‡ºç°ï¼šå‡ºç°ï¼šhello world æ­å–œï¼nginx+luaå¼€å‘ç¯å¢ƒå°±å®‰è£…æˆåŠŸäº†ï¼","categories":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"/tags/nginx/"}],"keywords":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}]},{"title":"Hexoæ–°å»ºMarkdownè‡ªåŠ¨æ‰“å¼€ç¼–è¾‘å™¨","slug":"2016-07-2-open_markdown_pad","date":"2016-07-27T16:00:00.000Z","updated":"2020-01-03T10:12:29.152Z","comments":true,"path":"2016/07/28/2016-07-2-open_markdown_pad/","link":"","permalink":"/2016/07/28/2016-07-2-open_markdown_pad/","excerpt":"æ·»åŠ jsè„šæœ¬åœ¨ç«™ç‚¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªjsï¼Œå†…å®¹å¦‚ä¸‹ï¼š var exec = require(&#39;child_process&#39;).exec; hexo.on(&#39;new&#39;, function(data){ exec(&#39;start &quot;D:\\dev\\editor\\MarkdownPad2\\MarkdownPad2.exe&quot; &#39; + data.path); });","text":"æ·»åŠ jsè„šæœ¬åœ¨ç«™ç‚¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªjsï¼Œå†…å®¹å¦‚ä¸‹ï¼š var exec = require(&#39;child_process&#39;).exec; hexo.on(&#39;new&#39;, function(data){ exec(&#39;start &quot;D:\\dev\\editor\\MarkdownPad2\\MarkdownPad2.exe&quot; &#39; + data.path); }); åº”è¯¥çœ‹çš„å¾ˆæ˜æ˜¾ï¼Œstartåçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä½ çš„ç¼–è¾‘å™¨çš„å¯æ‰§è¡Œç¨‹åºçš„è·¯å¾„ï¼Œdata.pathå°±æ˜¯ä½ æ–°ç”Ÿæˆçš„Markdownæ–‡ä»¶çš„è·¯å¾„ã€‚è¿™å°±è¯å°±æ˜¯ç”¨ä½ æŒ‡å®šçš„ç¼–è¾‘å™¨æ‰“å¼€ç”Ÿæˆçš„Markdownæ–‡ä»¶ã€‚ $ hexo new &quot;newMarkdown&quot; æ–°å»ºmarkdownæ–‡ä»¶çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ‰“å¼€ä½ çš„ç¼–è¾‘å™¨å•¦ï¼","categories":[{"name":"blog","slug":"blog","permalink":"/categories/blog/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"/tags/hexo/"}],"keywords":[{"name":"blog","slug":"blog","permalink":"/categories/blog/"}]},{"title":"æ›¿æ¢Hexoä»£ç æ®µæ ·å¼ä¸ºgoogle code prettify","slug":"2016-07-28-google_code_prettify","date":"2016-07-27T16:00:00.000Z","updated":"2020-01-03T10:12:29.146Z","comments":true,"path":"2016/07/28/2016-07-28-google_code_prettify/","link":"","permalink":"/2016/07/28/2016-07-28-google_code_prettify/","excerpt":"ä¸‹è½½google code prettifynodeä¸‹è½½ï¼š npm install google-code-prettify --save","text":"ä¸‹è½½google code prettifynodeä¸‹è½½ï¼š npm install google-code-prettify --save GitHubä¸‹è½½ï¼šhttps://github.com/google/code-prettify æ›¿æ¢hexoæ¨¡æ¿å°†ä¸‹è½½å¥½çš„prettify.jså’Œthemesæ–‡ä»¶å¤¹æ”¾åœ¨ä¸»é¢˜ä¸‹çš„source/js/google-code-prettifyç›®å½•ä¸‹ã€‚ç°åœ¨å°±å¼€å§‹ä¿®æ”¹ä¸»é¢˜çš„æ¨¡æ¿æ–‡ä»¶ï¼Œä¿®æ”¹ä¸»é¢˜ç›®å½•ä¸‹çš„layout/_layout.swigæ–‡ä»¶ï¼Œåœ¨&lt;/head&gt;å‰æ·»åŠ  &lt;link href=&quot;/js/google-code-prettify/themes/tomorrow-night.min.css&quot; type=&quot;text/css&quot; rel=&quot;stylesheet&quot; /&gt; å…¶ä¸­tomorrow-night.min.csså¯ä»¥æ¢æˆä½ æƒ³è¦çš„æ ·å¼ï¼Œå‚è€ƒè¿™é‡Œé€‰æ‹©ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„æ ·å¼ã€‚åœ¨&lt;/body&gt;å‰æ·»åŠ ï¼š &lt;script type=&quot;text/javascript&quot; src=&quot;/js/google-code-prettify/prettify.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot;&gt; $(&quot;pre&quot;).addClass(&quot;prettyprint&quot;); $(&quot;pre&quot;).addClass(&quot;linenums&quot;); $(&quot;pre&quot;).addClass(&quot;lang-html&quot;); $(&quot;pre&quot;).addClass(&quot;prettyprinted&quot;); prettyPrint(); &lt;/script&gt; ç°åœ¨ä½ åªè¦åœ¨ä½ åªéœ€è¦ç”¨&lt;pre&gt;&lt;/pre&gt;å°†ä½ éœ€è¦é«˜äº®çš„ä»£ç åŒ…è£¹èµ·æ¥å°±å¯ä»¥äº†ã€‚","categories":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"/tags/hexo/"}],"keywords":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}]},{"title":"vpså®‰è£…ocserv","slug":"2016-07-28-install_ocserv","date":"2016-07-27T16:00:00.000Z","updated":"2020-01-03T10:12:29.231Z","comments":true,"path":"2016/07/28/2016-07-28-install_ocserv/","link":"","permalink":"/2016/07/28/2016-07-28-install_ocserv/","excerpt":"ä¸€ã€å®‰è£…å¿…è¦ç»„ä»¶$ yum install epel-release $ yum install ocserv","text":"ä¸€ã€å®‰è£…å¿…è¦ç»„ä»¶$ yum install epel-release $ yum install ocserv äºŒã€ç”Ÿæˆè¯ä¹¦1ã€ç”Ÿæˆcaè¯ä¹¦ç”Ÿæˆcaç§é’¥$ mkdir -p /etc/ocserv/pki/ca $ cd /etc/ocserv/pki/ca $ certtool --generate-privkey --outfile ca-key.pem ç¼–å†™æ¨¡æ¿cat &lt;&lt; _EOF_ &gt;ca.tmpl cn = &quot;VPN CA&quot; organization = &quot;sunsblog&quot; serial = 1 expiration_days = 999 ca signing_key cert_signing_key crl_signing_key _EOF_ ç”Ÿæˆcaè¯ä¹¦$ certtool --generate-self-signed --load-privkey ca-key.pem --template ca.tmpl --outfile ca-cert.pem 2ã€ç”Ÿæˆserverç«¯è¯ä¹¦ç”Ÿæˆserverç«¯ç§é’¥$ mkdir -p /etc/ocserv/pki/server $ cd /etc/ocserv/pki/server $ certtool --generate-privkey --outfile server-key.pem ç”Ÿæˆserverè¯ä¹¦æ¨¡æ¿cat &lt;&lt; _EOF_ &gt;server.tmpl cn = &quot;sunsblog.cn&quot; organization = &quot;sunsblog.cn&quot; expiration_days = 999 signing_key encryption_key tls_www_server _EOF_ ç”Ÿæˆserverç«¯è¯ä¹¦$ certtool --generate-certificate --load-privkey server-key.pem --load-ca-certificate ../ca/ca-cert.pem --load-ca-privkey ../ca/ca-key.pem --template server.tmpl --outfile server-cert.pem 3ã€ç”Ÿæˆclientç«¯è¯ä¹¦ç”Ÿæˆclientç«¯ç§é’¥$ certtool --generate-privkey --outfile user-key.pem ç”Ÿæˆclientç«¯è¯ä¹¦æ¨¡æ¿cat &lt;&lt; _EOF_ &gt;user.tmpl cn = &quot;user&quot; unit = &quot;admins&quot; expiration_days = 999 signing_key tls_www_client _EOF_ ç”Ÿæˆclientç«¯è¯ä¹¦$ certtool --generate-certificate --load-privkey user-key.pem --load-ca-certificate ../ca/ca-cert.pem --load-ca-privkey ../ca/ca-key.pem --template user.tmpl --outfile user-cert.pem 4ã€ä½¿ç”¨OpenSSLå°†å®¢æˆ·ç«¯è¯ä¹¦ user-cert.pemè½¬åŒ–æˆ.p12æ ¼å¼å¯ä»¥æŒ‰ç…§æç¤ºè®¾ç½®è¯ä¹¦å¯†ç  $ openssl pkcs12 -export -inkey user-key.pem -in user-cert.pem -name &quot;client&quot; -certfile ../ca/ca-cert.pem -caname &quot;VPN CA&quot; -out user-cert.p12 ä¸‰ã€ä¿®æ”¹é…ç½®æ–‡ä»¶$ vim /etc/ocserv/ocserv.conf #è®¾ç½®ä½¿ç”¨è¯ä¹¦ç™»å½• auth = &quot;certificate&quot; #è®¾ç½®ç«¯å£ tcp-port = 9000 udp-port = 9000 #å°†ä»¥ocservè¿™ä¸ªç”¨æˆ·å’Œç”¨æˆ·ç»„å»è¿è¡Œå·¥ä½œè¿›ç¨‹ run-as-user = ocserv run-as-group = ocserv #socketæ–‡ä»¶ socket-file = ocserv.sock #æœåŠ¡çš„é»˜è®¤ç›®å½• chroot-dir = /var/lib/ocserv #æ—¶å€™å¯ç”¨å·¥ä½œè¿›ç¨‹çš„å‘½åç©ºé—´éš”ç¦»ï¼Œè¿›ç¨‹éš”ç¦»é™å®šç‰¹å®šçš„libcç‰ˆæœ¬ä»¥åŠç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ï¼Œå¦‚æœå¯åŠ¨å¤±è´¥è¯·å…³é—­é€‰é¡¹ isolate-workers = true #å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•° max-clients = 16 #åŒä¸€ä¸ªè´¦å·æœ€å¤šå¯ç™»é™†çš„ç»ˆç«¯æ•° max-same-clients = 16 keepalive = 32400 # Dead Peeræ£€æµ‹é¢‘ç‡ dpd = 240 # ç§»åŠ¨è®¾å¤‡ç”¨çš„, åªè¦å‘é€äº† X-AnyConnect-Identifier-DeviceType å¤´, ocs å°±ä¼šå‘é€è¿™ä¸ª dpd mobile-dpd = 1800 try-mtu-discovery = true # serverç«¯è¯ä¹¦å’Œç§é’¥ server-cert = /etc/ocserv/pki/server/server-cert.pem server-key = /etc/ocserv/pki/server/server-key.pem # caè¯ä¹¦ ca-cert = /etc/ocserv/pki/ca/ca-cert.pem # å®¢æˆ·ç«¯id CN = 2.5.4.3, UID = 0.9.2342.19200300.100.1.1 cert-user-oid = 2.5.4.3 tls-priorities = &quot;NORMAL:%SERVER_PRECEDENCE:%COMPAT:-VERS-SSL3.0&quot; # è®¤è¯è¶…æ—¶æ—¶é—´ auth-timeout = 240 # æœ€çŸ­çš„è®¤è¯é‡æ–°è¿æ¥æ—¶é—´ min-reauth-time = 300 max-ban-score = 50 ban-reset-time = 300 # cookieä¿å­˜æ—¶é—´ï¼Œæ‰‹æœºå…³å±åœ¨æ—¶é—´å†…æ‰“å¼€ä¼šè‡ªåŠ¨é‡æ–°è¿æ¥ cookie-timeout = 86400 deny-roaming = false rekey-time = 172800 rekey-method = ssl use-occtl = true # è¿›ç¨‹idä¿å­˜ä½ç½® pid-file = /var/run/ocserv.pid # è®¾å¤‡åç§°ï¼Œåšç­–ç•¥å¯èƒ½ä¼šç”¨åˆ° device = vpns predictable-ips = true # é»˜è®¤ç»‘å®šåŸŸå default-domain = sunsblog.cn # å®¢æˆ·ç«¯åˆ†é…çš„ç½‘æ®µ ipv4-network = 192.168.101.0 ipv4-netmask = 255.255.255.0 # dns ip dns = 172.20.10.60 dns = 8.8.8.8 ping-leases = false # anyconnect è¿æ¥éœ€è¦è®¾ç½® true cisco-client-compat = true dtls-legacy = true user-profile = profile.xml #route = ipç½‘æ®µ/å­ç½‘æ©ç  # å…¨å±€è·¯ç”± #route = 0.0.0.0/128.0.0.0 #route = 128.0.0.0/128.0.0.0 route-add-cmd = &quot;ip route add %{R} dev %{D}&quot; route-del-cmd = &quot;ip route delete %{R} dev %{D}&quot; #no-route å»æ‰vps ipåœ°å€å’Œå›½å†…çš„ç½‘æ®µ custom-header = &quot;X-DTLS-MTU: 1200&quot; custom-header = &quot;X-CSTP-MTU: 1200&quot; æ·»åŠ å¼€æœºå¯åŠ¨é¡¹å¹¶ä¸”å¯åŠ¨ $ systemctl enable ocserv $ systemctl start ocserv å…è®¸æµé‡è½¬å‘,ä¿®æ”¹/etc/sysctl.conf net.ipv4.ip_forward = 1 ä½¿é…ç½®ç”Ÿæ•ˆ sysctl -p /etc/sysctl.conf åœ¨vpnè™šæ‹Ÿç½‘å¡å’Œvpså¤–ç½‘ç½‘å¡ä¹‹é—´åšæµé‡è½¬å‘ $ iptables -A FORWARD -i vpns0 -o venet0:0 -j ACCEPT $ iptables -A FORWARD -i venet0:0 -o vpns0 -m state --state ESTABLISHED,RELATED -j ACCEPT å¼€å¯NATå¹¶ä¸”è®©iptablesæ¥åå•†MTUå€¼ $ iptables -t nat -A POSTROUTING -j MASQUERADE $ iptables -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu ä¿å­˜iptablesé…ç½®ï¼Œå¦åˆ™é‡å¯ä¹‹åé…ç½®ä¼šå¤±æ•ˆ $ sysctl iptables save","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"vpn","slug":"vpn","permalink":"/tags/vpn/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"ç¼–è¯‘Nginx","slug":"2016-07-28-nginx","date":"2016-07-27T16:00:00.000Z","updated":"2020-01-03T09:55:50.170Z","comments":true,"path":"2016/07/28/2016-07-28-nginx/","link":"","permalink":"/2016/07/28/2016-07-28-nginx/","excerpt":"###å®‰è£…gcc g++ç¯å¢ƒ(vpså·²æœ‰ç¼–è¯‘ç¯å¢ƒå¯ä»¥çœç•¥) å®‰è£…makeç¯å¢ƒï¼šyum -y install automake autoconf libtool libtool-ltdl libtool-ltdl-devel makeå®‰è£…gcc g++ï¼šyum -y install gcc gcc-c++","text":"###å®‰è£…gcc g++ç¯å¢ƒ(vpså·²æœ‰ç¼–è¯‘ç¯å¢ƒå¯ä»¥çœç•¥) å®‰è£…makeç¯å¢ƒï¼šyum -y install automake autoconf libtool libtool-ltdl libtool-ltdl-devel makeå®‰è£…gcc g++ï¼šyum -y install gcc gcc-c++ å¼€å§‹å®‰è£…Nginxåœ¨å®‰è£…nginxä¹‹å‰ä¸€èˆ¬å…ˆå®‰è£…pcreã€zlibï¼Œå‰è€…ä¸ºäº†nginxä¸­rewriteåŠŸèƒ½ï¼Œåè€…ä¸ºäº†è§£å‹gzipã€‚ ####æºç ç›®å½•æˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©/usr/local/src $ cd /usr/local/src å®‰è£…pcreåº“$ cd /usr/local/src $ wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.34.tar.gz $ tar -zxvf pcre-8.34.tar.gz $ mv pcre-8.34.tar.gz pcre $ cd pcre $ ./configure $ make &amp; make install å®‰è£…zlibåº“$ cd /usr/local/src $ wget http://zlib.net/zlib-1.2.8.tar.é€‰æ‹©æºç ç›®å½•gz $ tar -zxvf zlib-1.2.8.tar.gz $ mv zlib-1.2.8.tar.gz zlib $ cd zlib $ ./configure $ make &amp; make install å®‰è£…SSlæ¨¡å—ï¼ˆæŸäº›vpsé»˜è®¤æ²¡æœ‰å®‰è£…SSLï¼‰$ cd /usr/local/src $ wget http://www.openssl.org/source/openssl-1.0.1c.tar.gz $ tar -zxvf openssl-1.0.1c.tar.gz $ mv openssl-1.0.1c.tar.gz openssl $ ./config $ make &amp; make install å®‰è£…Nginx$ cd /usr/local/src $ wget http://nginx.org/download/nginx-1.9.9.tar.gz $ tar -zxvf nginx-1.9.9.tar.gz $ cd nginx-1.9.9 $ ./configure --prefix=/usr/local/nginx \\ --with-http_ssl_module \\ --with-http_v2_module \\ --with-pcre=/usr/local/src/pcre \\ --with-zlib=/usr/local/src/zlib \\ --with-openssl=/usr/local/src/openssl $ make &amp; make install å®‰è£…æˆåŠŸä»¥åè¿›å…¥nginxç›®å½•å¯åŠ¨nginx $ /usr/local/nginx/nginx å¯åŠ¨nginxå¦‚æœæç¤º80ç«¯å£è¢«å ç”¨ã€‚å¯ä»¥æŸ¥çœ‹80ç«¯å£è¢«å“ªäº›è¿›ç¨‹å ç”¨ï¼Œç„¶åæ€æ­»è¯¥è¿›ç¨‹ä¹‹åé‡å¯nginx 6.ç¼–è¯‘å¯èƒ½é‡åˆ°çš„é”™è¯¯åœ¨æ›´æ–°äº†ç³»ç»Ÿçš„opensslä¹‹åç¼–è¯‘å®‰è£…nginxçš„æ—¶å€™ï¼ˆå…·ä½“æ˜¯åœ¨makeçš„æ—¶å€™ï¼‰å‡ºç°äº†å¦‚ä¸‹æŠ¥é”™ï¼š nginxçš„configureå‚æ•°ä¸­çš„â€“with-opensslå·²ç»æŒ‡å‘äº†opensslçš„æºä»£ç äº†ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä¿®æ”¹nginxæºç ä¸‹çš„auto/lib/opensslä¸­çš„confæ–‡ä»¶ $ vim nginx-1.6.1/auto/lib/openssl/conf æ”¹ä¸º å³æŒ‡å®šnginxæ‰€éœ€opensslä¸­çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶çš„ä½ç½®ã€‚ä¿å­˜ä¹‹åï¼Œé‡æ–°ç¼–è¯‘ã€‚ makeæˆåŠŸï¼Œmake installå®Œæˆå®‰è£…ã€‚","categories":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"/tags/nginx/"}],"keywords":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}]},{"title":"Hexoé…ç½®Gitä¸€é”®éƒ¨ç½²","slug":"2016-07-25-deploy_hexo","date":"2016-07-24T16:00:00.000Z","updated":"2020-01-03T09:55:50.276Z","comments":true,"path":"2016/07/25/2016-07-25-deploy_hexo/","link":"","permalink":"/2016/07/25/2016-07-25-deploy_hexo/","excerpt":"èµ°è¿‡çš„å‘æœ¬ä»¥ä¸ºåœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šè£…ä¸€ä¸ªGitæœåŠ¡ï¼Œç„¶åHexoç›´æ¥é…ç½®ä¸€ä¸‹å°±å¥½äº†å¾ˆç®€å•çš„äº‹ï¼Œå¯æ˜¯å®è·µè¯æ˜å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œè™½ç„¶èµ°äº†ä¸€ç‚¹å¼¯è·¯ä½†æ˜¯æœ€åè¿˜æ˜¯å…¨éƒ¨é…ç½®å¥½äº†ã€‚","text":"èµ°è¿‡çš„å‘æœ¬ä»¥ä¸ºåœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šè£…ä¸€ä¸ªGitæœåŠ¡ï¼Œç„¶åHexoç›´æ¥é…ç½®ä¸€ä¸‹å°±å¥½äº†å¾ˆç®€å•çš„äº‹ï¼Œå¯æ˜¯å®è·µè¯æ˜å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œè™½ç„¶èµ°äº†ä¸€ç‚¹å¼¯è·¯ä½†æ˜¯æœ€åè¿˜æ˜¯å…¨éƒ¨é…ç½®å¥½äº†ã€‚ æœåŠ¡å™¨å®‰è£…GitæœåŠ¡ä¹‹å ä½¿ç”¨XShellç”¨SSHè¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼ˆæš‚æ—¶æ²¡æœ‰æ‰¾å‡ºåŸå› ï¼‰ä½¿ç”¨SSHç™»é™†çš„æ—¶å€™ï¼Œè¿æ¥æœåŠ¡å™¨æ—¶æœåŠ¡å™¨æ€»æ˜¯ä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œè¿™æ˜¯å› ä¸º/home/git/.sshç›®å½•æ²¡æœ‰æ”¹å˜ç›®å½•æ‰€å±ç”¨æˆ·ï¼Œå°†.sshç›®å½•æ‰€å±ç”¨æˆ·æ”¹ä¸ºgitå°±è¡Œäº†ã€‚ä½¿ç”¨Git Bashé€šè¿‡SSHè¿æ¥è¿œç¨‹VPSçš„æ—¶å€™ä¼šè¯´è¿æ¥è¢«å†³ç»ï¼Œå› ä¸ºé»˜è®¤è¿œç¨‹ç™»å½•ä½¿ç”¨22ç«¯å£ï¼Œåœ¨.sshç›®å½•æ·»åŠ configé…ç½®æ–‡ä»¶ä¿®æ”¹è¿æ¥æœåŠ¡å™¨çš„ç«¯å£ã€‚Host sunsblog.cn User git Hostname 23.105.215.43 Port 27765 è®¾ç½®Gitç”¨æˆ·åã€ç”ŸæˆSSHå¯†é’¥git config --global user.email &quot;email@example.com&quot; git config --global user.name &quot;username&quot; ssh-keygen -t rsa -C &quot;email@example.com&quot; #ä¸€è·¯å›è½¦ç”Ÿæˆå…¬é’¥å’Œå¯†é’¥ï¼Œä¸€ä¼šä¼šè¦ç”¨åˆ°å…¬é’¥id_rsa.pub å¼€å§‹å®‰è£…Gitï¼ˆCentOSï¼‰yum update &amp;&amp; apt-get upgrade -y #æ›´æ–°å†…æ ¸ yum install git-core æ–°å»ºgitç”¨æˆ·æ·»åŠ sudoæƒé™adduser git chmod 740 /etc/sudoers vim /etc/sudoers åœ¨ç¼–è¾‘å™¨ä¸­æ‰¾åˆ°å¦‚ä¸‹å†…å®¹ ##Allow root to run any commands anywhere root ALL=(ALL) ALL æ·»åŠ ä¸‹é¢ä¸€è¡Œ git ALL=(ALL) ALL ä¿å­˜å¹¶é€€å‡ºåæ‰§è¡Œ chmod 440 /etc/sudoers åˆ›å»ºgitä»“åº“ï¼Œå¹¶é…ç½®sshç™»å½•su git cd /home/git mkdir .ssh &amp;&amp; cd .ssh touch authorized_keys vi authorized_keys //åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç²˜è´´è¿›åˆšåˆšç”³è¯·çš„keyï¼ˆåœ¨id_rsa.pubæ–‡ä»¶ä¸­ï¼‰ chown git .ssh //æ³¨æ„å¦‚æœ.sshç›®å½•ä¸æ˜¯gitç”¨æˆ·åˆ›å»ºçš„ä¸€å®šè¦ä¿®æ”¹ç›®å½•æ‰€å±ç”¨æˆ· ä¿®æ”¹æ–‡ä»¶æƒé™ chmod 600 authorized_keys chmod 700 ~/.ssh è®¾ç½®SSHï¼Œæ‰“å¼€å¯†é’¥ç™»é™†åŠŸèƒ½ç¼–è¾‘/etc/ssh/sshd_confæ–‡ä»¶ï¼Œè¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š RSAAuthentication yes PubkeyAuthentication yes å¦å¤–ï¼Œè¯·ç•™æ„ root ç”¨æˆ·èƒ½å¦é€šè¿‡ SSH ç™»å½•ï¼š PermitRootLogin yes å½“ä½ å®Œæˆå…¨éƒ¨è®¾ç½®ï¼Œå¹¶ä»¥å¯†é’¥æ–¹å¼ç™»å½•æˆåŠŸåï¼Œå¯ç¦ç”¨å¯†ç ç™»å½•ï¼š PasswordAuthentication no åˆå§‹åŒ–Gitä»“åº“cd /home/git mkdir hexo.git &amp;&amp; cd hexo.git git init --bare åˆ›å»ºç½‘ç«™æ ¹ç›®å½•å¹¶èµ‹äºˆgitç”¨æˆ·å¯¹ç½‘ç«™ç›®å½•çš„æ‰€æœ‰æƒcd /www mkdir blog chown git:git -R /www/blog é…ç½®Git hooksè„šæœ¬é…ç½®é¡¹ç›®éƒ¨ç½²åè‡ªåŠ¨æ›´æ–°ç½‘ç«™su git cd /home/git/hexo.git/hooks vim post-receive è¾“å…¥å¦‚ä¸‹å†…å®¹ #!/bin/sh unset GIT_DIR NowPath=`pwd` DeployPath=&quot;/www/blog&quot; cd $DeployPath git fetch --all git reset --hard origin/master cd $NowPath echo &quot;deploy done&quot; exit 0 æ”¹å˜è„šæœ¬æ‰§è¡Œæƒé™ chmod +x post-receive éƒ¨ç½²å’Œæ›´æ–°åšå®¢deploy: type: git message: update repo:git@sunsblog.cn:hexo.git,master","categories":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}],"tags":[{"name":"vps","slug":"vps","permalink":"/tags/vps/"}],"keywords":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}]},{"title":"Nginxé…ç½®sslæ¨¡å—","slug":"2016-07-24-ssl_nginx","date":"2016-07-23T16:00:00.000Z","updated":"2020-01-03T10:12:29.160Z","comments":true,"path":"2016/07/24/2016-07-24-ssl_nginx/","link":"","permalink":"/2016/07/24/2016-07-24-ssl_nginx/","excerpt":"ä»€ä¹ˆæ˜¯HTTPSï¼Ÿæ ¹æ®ç»´åŸºç™¾ç§‘çš„è§£é‡Šï¼š è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆç¼©å†™ï¼šHTTPSï¼Œè‹±è¯­ï¼šHypertext Transfer Protocol Secureï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®å’ŒSSL/TLSçš„ç»„åˆï¼Œç”¨ä»¥æä¾›åŠ å¯†é€šè®¯åŠå¯¹ç½‘ç»œæœåŠ¡å™¨èº«ä»½çš„é‰´å®šã€‚","text":"ä»€ä¹ˆæ˜¯HTTPSï¼Ÿæ ¹æ®ç»´åŸºç™¾ç§‘çš„è§£é‡Šï¼š è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆç¼©å†™ï¼šHTTPSï¼Œè‹±è¯­ï¼šHypertext Transfer Protocol Secureï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®å’ŒSSL/TLSçš„ç»„åˆï¼Œç”¨ä»¥æä¾›åŠ å¯†é€šè®¯åŠå¯¹ç½‘ç»œæœåŠ¡å™¨èº«ä»½çš„é‰´å®šã€‚HTTPSè¿æ¥ç»å¸¸è¢«ç”¨äºä¸‡ç»´ç½‘ä¸Šçš„äº¤æ˜“æ”¯ä»˜å’Œä¼ä¸šä¿¡æ¯ç³»ç»Ÿä¸­æ•æ„Ÿä¿¡æ¯çš„ä¼ è¾“ã€‚HTTPSä¸åº”ä¸åœ¨RFC 2660ä¸­å®šä¹‰çš„å®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆS-HTTPï¼‰ç›¸æ··ã€‚HTTPS ç›®å‰å·²ç»æ˜¯æ‰€æœ‰æ³¨é‡éšç§å’Œå®‰å…¨çš„ç½‘ç«™çš„é¦–é€‰ï¼Œéšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒHTTPS ç½‘ç«™å·²ä¸å†æ˜¯å¤§å‹ç½‘ç«™çš„ä¸“åˆ©ï¼Œæ‰€æœ‰æ™®é€šçš„ä¸ªäººç«™é•¿å’Œåšå®¢å‡å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ­å»ºä¸€ä¸ªå®‰å…¨çš„åŠ å¯†çš„ç½‘ç«™ã€‚ å¦‚æœä¸€ä¸ªç½‘ç«™æ²¡æœ‰åŠ å¯†ï¼Œé‚£ä¹ˆä½ çš„æ‰€æœ‰å¸å·å¯†ç éƒ½æ˜¯æ˜æ–‡ä¼ è¾“ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œå¦‚æœæ¶‰åŠåˆ°éšç§å’Œé‡‘èé—®é¢˜ï¼Œä¸åŠ å¯†çš„ä¼ è¾“æ˜¯å¤šä¹ˆå¯æ€•çš„ä¸€ä»¶äº‹ã€‚ é‰´äºæœ¬åšå®¢çš„è¯»è€…éƒ½æ˜¯æ¥è¿‘ä¸“ä¸šäººå£«ï¼Œæˆ‘ä»¬ä¸å†å¤šè´¹å£èˆŒï¼Œç›´æ¥è¿›å…¥æ­£é¢˜å§ã€‚ ä½¿ç”¨OpenSSLç”ŸæˆSSL Keyå’ŒCSRç”±äºåªæœ‰æµè§ˆå™¨æˆ–è€…ç³»ç»Ÿä¿¡èµ–çš„ CA æ‰å¯ä»¥è®©æ‰€æœ‰çš„è®¿é—®è€…é€šç•…çš„è®¿é—®ä½ çš„åŠ å¯†ç½‘ç«™ï¼Œè€Œä¸æ˜¯å‡ºç°è¯ä¹¦é”™è¯¯çš„æç¤ºã€‚æ‰€ä»¥æˆ‘ä»¬è·³è¿‡è‡ªç­¾è¯ä¹¦çš„æ­¥éª¤ï¼Œç›´æ¥å¼€å§‹ç­¾ç½²ç¬¬ä¸‰æ–¹å¯ä¿¡ä»»çš„ SSL è¯ä¹¦å§ã€‚ OpenSSL åœ¨ Linuxã€OS X ç­‰å¸¸è§„çš„ç³»ç»Ÿä¸‹é»˜è®¤éƒ½å®‰è£…äº†ï¼Œå› ä¸ºä¸€äº›å®‰å…¨é—®é¢˜ï¼Œä¸€èˆ¬ç°åœ¨çš„ç¬¬ä¸‰æ–¹ SSL è¯ä¹¦ç­¾å‘æœºæ„éƒ½è¦æ±‚èµ·ç  2048 ä½çš„ RSA åŠ å¯†çš„ç§é’¥ã€‚ åŒæ—¶ï¼Œæ™®é€šçš„ SSL è¯ä¹¦è®¤è¯åˆ†ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯ DVï¼ˆDomain Validatedï¼‰ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ OV ï¼ˆOrganization Validatedï¼‰ï¼Œå‰è€…åªéœ€è¦éªŒè¯åŸŸåï¼Œåè€…éœ€è¦éªŒè¯ä½ çš„ç»„ç»‡æˆ–å…¬å¸ï¼Œåœ¨å®‰å…¨æ€§æ–¹é¢ï¼Œè‚¯å®šæ˜¯åè€…è¦å¥½ã€‚ æ— è®ºä½ ç”¨ DV è¿˜æ˜¯ OV ç”Ÿæˆç§é’¥ï¼Œéƒ½éœ€è¦å¡«å†™ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾å¦‚ä¸‹ï¼š åŸŸåï¼Œä¹Ÿç§°ä¸º Common Nameï¼Œå› ä¸ºç‰¹æ®Šçš„è¯ä¹¦ä¸ä¸€å®šæ˜¯åŸŸåï¼šexample.com ç»„ç»‡æˆ–å…¬å¸åå­—ï¼ˆOrganizationï¼‰ï¼šExample, Inc. éƒ¨é—¨ï¼ˆDepartmentï¼‰ï¼šå¯ä»¥ä¸å¡«å†™ï¼Œè¿™é‡Œæˆ‘ä»¬å†™ Web Security åŸå¸‚ï¼ˆCityï¼‰ï¼šBeijing çœä»½ï¼ˆState / Provinceï¼‰ï¼šBeijing å›½å®¶ï¼ˆCountryï¼‰ï¼šCN åŠ å¯†å¼ºåº¦ï¼š2048 ä½ï¼Œå¦‚æœä½ çš„æœºå™¨æ€§èƒ½å¼ºåŠ²ï¼Œä¹Ÿå¯ä»¥é€‰æ‹© 4096 ä½ æŒ‰ç…§ä»¥ä¸Šä¿¡æ¯ï¼Œä½¿ç”¨ OpenSSL ç”Ÿæˆ key å’Œ csr çš„å‘½ä»¤å¦‚ä¸‹ openssl req -new -newkey rsa:2048 -sha256 -nodes -out example_com.csr -keyout example_com.key -subj â€œ/C=CN/ST=Beijing/L=Beijing/O=Example Inc./OU=Web Security/CN=example.comâ€PSï¼šå¦‚æœæ˜¯æ³›åŸŸåè¯ä¹¦ï¼Œåˆ™åº”è¯¥å¡«å†™ *.example.com ä½ å¯ä»¥åœ¨ç³»ç»Ÿçš„ä»»ä½•åœ°æ–¹è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œä¼šè‡ªåŠ¨åœ¨å½“å‰ç›®å½•ç”Ÿæˆ example_com.csr å’Œ example_com.key è¿™ä¸¤ä¸ªæ–‡ä»¶ æ¥ä¸‹æ¥ä½ å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ example_com.csrï¼Œå¾—åˆ°ç±»ä¼¼è¿™ä¹ˆä¸€é•¿ä¸²çš„æ–‡å­— â€”â€“BEGIN CERTIFICATE REQUESTâ€”â€“MIICujCCAaICAQAwdTELMAkGA1UEBhMCQ04xEDAOBgNVBAgTB0JlaWppbmcxEDAOBgNVBAcTB0JlaWppbmcxFTATBgNVBAoTDEV4YW1wbGUgSW5jLjEVMBMGA1UECxMMV2ViIFNlY3VyaXR5MRQwEgYDVQQDEwtleGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAPME+nvVCdGN9VWn+vp7JkMoOdpOurYMPvclIbsIiD7mGN982Ocl22O9wCV/4tL6DpTcXfNX+eWd7CNEKT4i+JYGqllqP3/CojhkemiYSF3jwncvP6VoST/HsZeMyNB71XwYnxFCGqSyE3QjxmQ9ae38H2LIpCllfd1l7iVpAX4i2+HvGTHFzb0XnmMLzq4HyVuEIMoYwiZX8hq+kwEAhKpBdfawkOcIRkbOlFewSEjLyHY+nruXutmQx1d7lzZCxut5Sm5At9al0bf5FOaaJylTEwNEpFkP3L29GtoUqg1t9Q8WufIfK9vXqQqwg8J1muK7kksnbYcoPnNgPx36kZsCAwEAAaAAMA0GCSqGSIb3DQEBBQUAA4IBAQCHgIuhpcgrsNwDuW6731/DeVwq2x3ZRqRBuj9/M8oONQen1QIacBifEMr+Ma+C+wIpt3bHvtXEF8cCAJAR9sQ4Svy7M0w25DwrwaWIjxcf/J8UaudL/029CkAuewFCdBILTRAAeDqxsAsUyiBIGTIT+uqi+EpGG4OlyKK/MF13FxDj/oKyrSJDtp1Xr9R7iqGCs/Zl5qWmDaLN7/qxBK6vX2R/HLhOK0aKi1ZQ4cZeP7Mr8EzjDIAko87Nb/aIsFyKrt6Ze3jOF0/vnnpw7pMvhq+folWdTVXddjd9Dpr2x1ncy5hnop4k6kVRXDjQ4OTduQq4P+SzU4hb41GIQEz4â€”â€“END CERTIFICATE REQUESTâ€”â€“è¿™ä¸ª CSR æ–‡ä»¶å°±æ˜¯ä½ éœ€è¦æäº¤ç»™ SSL è®¤è¯æœºæ„çš„ï¼Œå½“ä½ çš„åŸŸåæˆ–ç»„ç»‡é€šè¿‡éªŒè¯åï¼Œè®¤è¯æœºæ„å°±ä¼šé¢å‘ç»™ä½ ä¸€ä¸ª example_com.crt è€Œ example_com.key æ˜¯éœ€è¦ç”¨åœ¨ Nginx é…ç½®é‡Œå’Œ example_com.crt é…åˆä½¿ç”¨çš„ï¼Œéœ€è¦å¥½å¥½ä¿ç®¡ï¼Œåƒä¸‡åˆ«æ³„éœ²ç»™ä»»ä½•ç¬¬ä¸‰æ–¹ã€‚ å¯é çš„ç¬¬ä¸‰æ–¹SSLç­¾å‘æœºæ„æœ¬ç«™ä½¿ç”¨çš„æ˜¯æ²ƒé€šçš„å…è´¹ç”µå­è¯ä¹¦ç”³è¯·å…è´¹ç”µå­è¯ä¹¦ï¼Œåœ¨ç½‘ç«™å¡«å†™åŸŸåç™»é™†å¹¶æäº¤ç”³è¯·éªŒè¯åŸŸåæ‰€æœ‰æƒä¹‹åæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ç”Ÿæˆçš„è¯ä¹¦ï¼Œè§£å‹ä»¥åé€‰æ‹©å¯¹åº”æœåŠ¡å™¨çš„è¯ä¹¦é…ç½®æœåŠ¡å™¨å³å¯ï¼Œæœ¬ç«™ä½¿ç”¨çš„æ˜¯Nginxæ‰€ä»¥é€‰æ‹©NginxåŒ…ä¸‹çš„è¯ä¹¦ã€‚ Nginxé…ç½®HTTPSç½‘ç«™ä»¥åŠå¢åŠ å®‰å…¨çš„é…ç½®å‰é¢å·²ç»æåˆ°ï¼Œä½ éœ€è¦æäº¤ CSR æ–‡ä»¶ç»™ç¬¬ä¸‰æ–¹ SSL è®¤è¯æœºæ„ï¼Œé€šè¿‡è®¤è¯åï¼Œä»–ä»¬ä¼šé¢å‘ç»™ä½ ä¸€ä¸ª CRT æ–‡ä»¶ï¼Œæˆ‘ä»¬å‘½åä¸º example_com.crt åŒæ—¶ï¼Œä¸ºäº†ç»Ÿä¸€ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½ç§»åŠ¨åˆ° /etc/nginx/ ç›®å½•ã€‚ ç„¶åå¯ä»¥ä¿®æ”¹ Nginx é…ç½®æ–‡ä»¶ nginx.conf server{ listen 80; listen [::]:80 ssl ipv6only=on; listen 443 ssl; listen [::]:443 ssl ipv6only=on; server_name example.com; ssl on; ssl_certificate /etc/nginx/example_com.crt; ssl_certificate_key /etc/nginx/example_com.key; } ä½†æ˜¯è¿™ä¹ˆåšå¹¶ä¸å®‰å…¨ï¼Œé»˜è®¤æ˜¯ SHA-1 å½¢å¼ï¼Œè€Œç°åœ¨ä¸»æµçš„æ–¹æ¡ˆåº”è¯¥éƒ½é¿å… SHA-1ï¼Œä¸ºäº†ç¡®ä¿æ›´å¼ºçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–è¿ªè²ï¼èµ«å°”æ›¼å¯†é’¥äº¤æ¢ã€‚é¦–å…ˆï¼Œè¿›å…¥ /etc/ssl/certs ç›®å½•å¹¶ç”Ÿæˆä¸€ä¸ª dhparam.pem cd /etc/ssl/certs openssl dhparam -out dhparam.pem 2048 #å¦‚æœä½ çš„æœºå™¨æ€§èƒ½è¶³å¤Ÿå¼ºå¤§ï¼Œå¯ä»¥ç”¨ 4096 ä½åŠ å¯† ç”Ÿæˆå®Œæ¯•åï¼Œåœ¨ Nginx çš„ SSL é…ç½®åé¢åŠ å…¥ sl_dhparam /etc/ssl/certs/dhparam.pem; å¹¶ä¸”é…ç½®ç½‘ç«™æ‰€æœ‰è¯·æ±‚è·³è½¬https location / { rewrite ^/(.*) https://&amp;host/$1 permanent; } httpsé»˜è®¤è·³è½¬443ç«¯å£ï¼Œåœ¨nginxä¸‹æ–°å»ºvhostsæ–‡ä»¶å¤¹æ”¾ä¸åŒä¸»æœºé…ç½®ã€‚è¿™é‡Œä»¥æœ¬ç½‘ç«™åŸŸåä¸ºä¾‹ï¼Œè´´ä¸Šé…ç½®ï¼Œä»¥ä¾›å‚è€ƒï¼š server { server_name sunsblog.cn www.sunsblog.cn; listen 443 ssl http2 default_server; ssl on; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_certificate /etc/nginx/sunsblog.cn.crt; ssl_certificate_key /etc/nginx/sunsblog.cn.key; ssl_prefer_server_ciphers on; ssl_ciphers &quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&quot;; #ssl_dhparam /etc/ssl/dhparam4096.pem; ssl_session_cache shared:SSL:1m; ssl_session_timeout 10m; #ssl_stapling on; #ssl_stapling_verify on; root /root/ddatsh.github.io; #Add index.php to the list if you are using PHP index index.html index.htm index.nginx-debian.html; add_header Strict-Transport-Security &quot;max-age=63072000; includeSubdomains;preload&quot;; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; if ( $host ~* &quot;\\d+\\.\\d+\\.\\d+\\.\\d+&quot; ) { return 503; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } location / { root /www/blog; #proxy_pass http://localhost:4000; #root /usr/local/nginx/html; #root /usr/local/ink/blog/public; #root /usr/local/www_root/app-wzst; # alias d:/ddatsh.github.io; index index.html; } location /logs { alias /usr/local/nginx/logs; autoindex on; autoindex_exact_size off; autoindex_localtime on; add_header Cache-Control no-store; auth_basic &quot;Restricted&quot;; auth_basic_user_file /usr/local/nginx/conf/loguser; } }","categories":[{"name":"net","slug":"net","permalink":"/categories/net/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"/tags/nginx/"}],"keywords":[{"name":"net","slug":"net","permalink":"/categories/net/"}]},{"title":"å®‰è£…å’Œé…ç½®Hexo","slug":"2016-07-24-start_hexo","date":"2016-07-23T16:00:00.000Z","updated":"2020-01-03T10:12:29.175Z","comments":true,"path":"2016/07/24/2016-07-24-start_hexo/","link":"","permalink":"/2016/07/24/2016-07-24-start_hexo/","excerpt":"HexoHexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚","text":"HexoHexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚ é¦–å…ˆå®‰è£…node.jså’ŒGitå®˜æ–¹ä¸‹è½½åœ°å€https://nodejs.org/en/download/ï¼Œä¸‹è½½å’Œå®‰è£…å¥½nodes.jsä¹‹åã€‚ç»§ç»­å®‰è£…Gitï¼Œhttps://git-scm.com/(å·²ç»æœ‰nodeå’ŒGitå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥)ã€‚ å®‰è£…Hexo$ npm install -g hexo-cli ä½¿ç”¨Hexoæ„å»ºåšå®¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å¦‚ï¼šhexoï¼Œè¿›å…¥hexoç›®å½•ä¸‹è¿è¡Œ $ hexo init ä¹‹åä¸€ä¸ªåšå®¢çš„åŸºæœ¬æ¡†æ¶å°±è´­å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥å¦‚æœä¸æƒ³ä¿®æ”¹ä¸»é¢˜çš„è¯å°±å¯ä»¥å¼€å§‹æ„‰å¿«çš„å†™åšå®¢äº†ã€‚é€šè¿‡ï¼š hexo new [layout] &lt;title&gt; å…¶ä¸­ï¼ˆlayoutï¼‰æŒ‡å®šæ–‡ç« çš„å¸ƒå±€ï¼Œé»˜è®¤ä¸ºpostï¼Œå¯ä»¥ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlä¸­çš„default_layoutå‚æ•°æ¥ä¿®æ”¹æŒ‡å®šé»˜è®¤å¸ƒå±€ã€‚ æ¥ä¸‹æ¥é€šè¿‡ï¼š $ heox g å°†æˆ‘ä»¬å†™å¥½çš„markdownæ–‡æ¡£ç”Ÿæˆé™æ€çš„htmlæ–‡æ¡£ï¼ˆç”Ÿæˆçš„ç«™ç‚¹æ–‡ä»¶é»˜è®¤æ”¾åœ¨publicæ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼Œä¹‹åä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶_config.yml deploy: - type: git repo: ä¸€ä¸ªæ­£ç¡®çš„éƒ¨ç½²é…ç½®ä¸­è‡³å°‘è¦æœ‰typeå‚æ•°ï¼ŒrepoæŒ‡å®šgitä»“åº“ä½ç½®ã€‚å¦‚æœé€šè¿‡gitè¿›è¡Œéƒ¨ç½²ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…hexo-deployer-git $ npm install hexo-deployer-git --save ä¿®æ”¹é»˜è®¤ä¸»é¢˜å¯ä»¥ç°åœ¨githubä¸Šä¸‹è½½å¥½è‡ªå·±æƒ³è¦çš„ä¸»é¢˜ï¼Œæœ¬ç«™ç”¨çš„æ˜¯nextä¸»é¢˜åœ¨æ­¤ä¸‹è½½ï¼Œä¸‹è½½å¥½ä¸»é¢˜ä¹‹åæˆ‘ä»¬å°±å¯ä»¥æ›¿æ¢hexoçš„é»˜è®¤ä¸»é¢˜äº†ï¼Œå°†ä¸‹è½½å¥½çš„ä¸»é¢˜æ”¾åœ¨themesæ–‡ä»¶å¤¹ä¸‹ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlä¸­çš„themeå‚æ•°ä¸ºï¼šnextã€‚è¿™æ ·æˆ‘ä»¬å°±åº”ç”¨äº†nextä¸»é¢˜ï¼Œä¹‹ånextä¸»é¢˜çš„é…ç½®è¯·å‚ç…§è¿™é‡Œè¿›è¡Œè‡ªå·±æƒ³è¦çš„é…ç½®å°±å¯ä»¥äº†ã€‚","categories":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"/tags/hexo/"}],"keywords":[{"name":"vps","slug":"vps","permalink":"/categories/vps/"}]}]}